(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[1],{620:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(21),a=n(52),o=function(){function e(){this._eventSource=new a.a}var t=e.prototype;return t.add_onEditHappened=function(e){this._eventSource.addHandler("OnEditHappenedEvent",e)},t.remove_onEditHappened=function(e){this._eventSource.removeHandler("OnEditHappenedEvent",e)},t.raiseEditHappenedEvent=function(){this._eventSource.raiseEvent("OnEditHappenedEvent")},e}();Object(i.a)(o,"EditNotificationEventSource",null,[]);var s=n(1),l=n(75),c=n(65),u=n(56),d=n(33),p=n(5);function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(e,t,n,i,a,o,s){var l=this;void 0===s&&(s=0),this._editHappenedInTimeWindow=!1,this._notificationTask=null,this._editDocumentTelemetryReportingTask=null,this._userEverEdited=!1,this.sendPostMessageIfNecessary=function(e){l._editHappenedInTimeWindow&&(l._hostPostmessengerTask.CWR((function(e){return l._hostPostmessengerTask.result.sendMessage(d.a.editNotification,null)})),r.ULS.sendTraceTag(38086292,209,50,"EditNotificationManager: sending post message to the host."),l._editHappenedInTimeWindow=!1)},this.reportEditDocumentUserActionTelemetryIfNecessary=function(e){try{l._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport&&(c.c(p.a.editDocument),l._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1)}catch(e){l._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1,r.ULS.sendTraceTag(51246177,383,50,"Hit an exception while trying to send the EditDocument user action: "+e)}},this._taskManager=t,this._notificationIntervalInMs=e,this._hostPostmessengerTask=n,this._editNotificationEventSource=i,this._userActivityHostNotificationManager=a,this._editNotificationPostMessageIsEnabled=o,this._editDocumentUserActionReportingIntervalInMs=0,this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!1;try{s>0&&(this._editDocumentUserActionReportingIntervalInMs=s,this._editDocumentUserActionReportingIntervalInMs<3e5&&(this._editDocumentUserActionReportingIntervalInMs=3e5),this._taskManager&&!this._editDocumentTelemetryReportingTask&&(this._editDocumentTelemetryReportingTask=new u.a(3,2,this._editDocumentUserActionReportingIntervalInMs,this.reportEditDocumentUserActionTelemetryIfNecessary),this._taskManager.addTask(this._editDocumentTelemetryReportingTask)))}catch(e){r.ULS.sendTraceTag(51246176,383,50,"Hit an exception while trying to queue up the EditDocument user action reporting interval: "+e)}}var t,n,i;return e.prototype.editHappened=function(){this.userEverEdited?this._hasAnotherEditBeenMadeSinceLastEditDocumentTelemetryReport=!0:(this._userEverEdited=!0,l.Health.instance.addQosPillar("Save"),l.Health.instance.addQosPillar("ContentCreation"),c.c(p.a.editDocument)),this._editHappenedInTimeWindow=!0,this._userActivityHostNotificationManager&&this._userActivityHostNotificationManager.activityHappened(),this._editNotificationEventSource&&this._editNotificationEventSource.raiseEditHappenedEvent(),s.AFrameworkApplication.dataPlumber&&s.AFrameworkApplication.dataPlumber.markAsRealEditSession(),this._editNotificationPostMessageIsEnabled&&(this._notificationTask||(this.sendPostMessageIfNecessary(null),this._notificationTask=new u.a(3,2,this._notificationIntervalInMs,this.sendPostMessageIfNecessary,113),this._taskManager.addTask(this._notificationTask)))},t=e,(n=[{key:"userEverEdited",get:function(){return this._userEverEdited}}])&&h(t.prototype,n),i&&h(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(g,"EditNotificationManager",null,[201]);var m=n(2);function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(e,t,n,i,a){var o=this;this._notificationTask=null,this._handlerTask=null,this._activityHappenedInTimeWindow=!1,this._userWasEverActive=!1,this._handlerRegistered=!1,this.registerHandlerTask=function(e){var t=document.getElementById(s.AFrameworkApplication.applicationOuterContainerId);!o._handlerRegistered&&o._mouseInputManager&&t&&(o._mouseInputManager.registerHandler(m.a.mouseOver,t,o.mouseActivityHandler,null),o._handlerRegistered=!0),o._onBeforeShutdownSubscriber((function(e,t){o.dispose()}))},this.mouseActivityHandler=function(e){return o._handlerRegistered&&(o._mouseInputManager.unregisterHandler(m.a.mouseOver,document.getElementById(s.AFrameworkApplication.applicationOuterContainerId),o.mouseActivityHandler),o._handlerRegistered=!1),o.activityHappened(),!1},this.sendPostMessageIfNecessary=function(e){o._activityHappenedInTimeWindow&&(o._hostPostmessengerTask.CWR((function(e){return o._hostPostmessengerTask.result.sendMessage(d.a.userActivity,null)})),r.ULS.sendTraceTag(38405446,209,50,"UserActivityHostNotificationManager: sending post message to the host."),o._activityHappenedInTimeWindow=!1)},this._taskManager=t,this._notificationIntervalInMs=e,this._hostPostmessengerTask=n,this._mouseInputManager=i,this._onBeforeShutdownSubscriber=a,this.registerHandlerTask(null)}var t,n,i,a=e.prototype;return a.activityHappened=function(){this._userWasEverActive=!0,this._activityHappenedInTimeWindow=!0,this._handlerTask||(this._handlerTask=new u.a(3,2,this._notificationIntervalInMs,this.registerHandlerTask,112),this._taskManager.addTask(this._handlerTask)),this._notificationTask||(this.sendPostMessageIfNecessary(null),this._notificationTask=new u.a(3,2,this._notificationIntervalInMs,this.sendPostMessageIfNecessary,111),this._taskManager.addTask(this._notificationTask))},a.dispose=function(){this._handlerRegistered&&(this._mouseInputManager.unregisterHandler(m.a.mouseOver,document.getElementById(s.AFrameworkApplication.applicationOuterContainerId),this.mouseActivityHandler),this._handlerRegistered=!1)},t=e,(n=[{key:"userWasEverActive",get:function(){return this._userWasEverActive}}])&&f(t.prototype,n),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(v,"UserActivityHostNotificationManager",null,[200,10]);var _=n(82),y=n(79),S=n(61),b=n(613),A=n(67),C=function(){function e(){}return e.taskFromFuture=function(e){var t=new b.a;return e.execute(Object(A.a)(t,t.setResult,"setResult")),t.task},e.toTask=function(t){return e.taskFromFuture(t)},e}();function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(C,"ContainerUtils",null,[]);var k=function(){function e(){var t=this;this._container=null,this.onFullAppSettingsReady=function(){e.editNotificationIsEnabled&&e.editNotificationInterval>0&&(t._container.register(o,"Common.App.HostNotification.EditNotificationEventSource").singleInstance(),t._container.register(v,"Common.App.HostNotification.UserActivityHostNotificationManager").as("Common.Interface.IUserActivityHostNotificationManager").singleInstance().usingFactory((function(){return new v(6e4,S.TaskManager.instance,C.taskFromFuture(t._container.resolveFuture("Postmessage.IHostPostmessenger")),_.a.instance,s.AFrameworkApplication.subscribeToBeforeAppShutDown)})),t._container.register(g,"Common.App.HostNotification.EditNotificationManager").as("Common.Interface.IEditNotificationManager").singleInstance().usingFactory((function(){return new g(e.editNotificationInterval,S.TaskManager.instance,C.taskFromFuture(t._container.resolveFuture("Postmessage.IHostPostmessenger")),t._container.resolve("Common.App.HostNotification.EditNotificationEventSource"),t._container.tryResolve("Common.Interface.IUserActivityHostNotificationManager"),e.editNotificationPostMessageIsEnabled,e.editDocumentUserActionTelemetryReportingIntervalInMilliseconds)})),t._container.resolve("Common.Interface.IEditNotificationManager"),r.ULS.shipAssertTag(38086291,209,e.editNotificationInterval>0,"EditNotification Interval is less than or equal to 0."))}}var t,n,i,a=e.prototype;return a.init=function(){s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(this.onFullAppSettingsReady)},a.configure=function(e){this._container=e},a.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,i=[{key:"editNotificationInterval",get:function(){return s.AFrameworkApplication.appSettingsManager?parseInt(s.AFrameworkApplication.appSettingsManager.appSettings.EditNotificationTimeIntervalMs||"300000"):3e5}},{key:"editDocumentUserActionTelemetryReportingIntervalInMilliseconds",get:function(){return s.AFrameworkApplication.appSettingsManager?parseInt(s.AFrameworkApplication.appSettingsManager.appSettings.EditDocumentUserActionTelemetryReportingIntervalInMilliseconds||"0"):0}},{key:"editNotificationIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EditNotificationIsEnabled")}},{key:"editNotificationPostMessageIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EditNotificationPostMessageIsEnabled")}}],(n=[{key:"name",get:function(){return"Common.App.EditNotification"}}])&&T(t.prototype,n),i&&T(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(k,"CommonHostNotificationPackage",null,[2,3]);var w,I=n(614),P=n(319),F=n(153);!function(e){e[e.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler",e[e.cloudPolicySettings=1]="cloudPolicySettings",e[e.alternateAuthToken=2]="alternateAuthToken"}(w||(w={})),Object(i.b)("ApplicationFeatureHelperRequestType",w);var E=function(){this.message=null,this.httpStatusCode=0};Object(i.a)(E,"HttpRequstToPromiseRejectData",null,[]);var O=n(28),M=n(134),L=n(253);function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var x,B=function(){function e(e,t){this._appSettingsManager=e,this._clientRequestManager=t}var t=e.prototype;return t.createHttpResponsePromise=function(e,t,n,i,a,o,s,c){var u=this;void 0===i&&(i=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null);var d=w[n],p=d+"RequestFailure";return l.Health.instance.recordKpiUsage(p,0,"jpittsdirects",null),new Promise((function(h,g){r.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",d);var m=null!=s?s:u._appSettingsManager.getIntAppSetting("ApplicationFeatureHelperRequestQueueTimeout",15e3),f=null!=c?c:u._appSettingsManager.getIntAppSetting("ApplicationFeatureHelperRequestSentTimeout",3e4);u._clientRequestManager.addRequestWithHeaderForwarding(e,1,null,u.getHeaders(n,i),o,!1,1,(function(e){r.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",d);try{if(null==e||void 0===e.data||null===e.data||void 0===e.data.responseData||null===e.data.responseData){l.Health.instance.recordKpiFailure(p,"Invalid RequestSucceededEventArgs",!1,!0,null);var n=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",d);return void g(u.getRejectData(n,e))}if(e.data.httpStatus!==M.a.OK_200){l.Health.instance.recordKpiFailure(p,"HttpStatusCode_"+e.data.httpStatus.toString(),!1,!0,null);var i=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",e.data.httpStatus,d);return void g(u.getRejectData(i,e))}null!=a&&void 0!==e.data.responseHeaders&&null!==e.data.responseHeaders&&a(e.data.responseHeaders);var o=t(e.data.responseData);if(!o){l.Health.instance.recordKpiFailure(p,"Parse Failure",!1,!0,null);var s=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",d);return void g(u.getRejectData(s,e))}r.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",d),h(o)}catch(t){l.Health.instance.recordKpiFailure(p,"Unexpected Failure",!1,!0,null);var c=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",t,d);g(u.getRejectData(c,e))}}),(function(e){var t="";if(!e.data)return l.Health.instance.recordKpiFailure(p,"Invalid RequestFailedEventArgs",!1,!0,null),t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",d),void g(u.getRejectData(t,e));l.Health.instance.recordKpiFailure(p,"HttpStatusCode_"+e.data.httpStatus.toString(),!1,!0,null);var n=L.a.getScrubbedHttpErrorDetails(e.data.responseData||"No Data");t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",e.data.httpStatus,n,d),g(u.getRejectData(t,e))}),null,void 0,void 0,m,f)}))},t.getRejectData=function(e,t){var n=new E;return n.message=e,t&&t.data?n.httpStatusCode=t.data.httpStatus:n.httpStatusCode=-1,n},t.getHeaders=function(e,t){var n={};if(n["x-UserDataSignature"]=this._appSettingsManager.getStringAppSetting("UserDataSignature"),n["x-LicensingIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingIsEnabled").toString(),n["x-CacheIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingRedisIsEnabled").toString(),n["x-OcpsIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("OcpsIsEnabled").toString(),n["x-LicensingAADIdIsEnabled"]=this._appSettingsManager.getBooleanAppSetting("LicensingAadIdIsEnabled").toString(),0===e&&(n["x-LicenseCheckOnTenantEnabled"]="true",n["x-SupportUserConsentDependentFeatures"]="true",n["x-AFHUserConsentGroupValue"]="0",n["x-UseShellServiceForUserConsentGroup"]="true",n["x-SMBUserLicensingEnabled"]="true",n["x-AFHPIPLComplianceEnabled"]=O.a.getParameterValue(window.location.href,"wd_afhpipl")||"false",n["x-ConsumerLicensingSNICertIsEnabled"]=this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ConsumerLicensingSNICertIsEnabled",!1).toString(),n["x-MSGraphInLicensingIsEnabled"]=this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.MSGraphInLicensingIsEnabled",!1).toString()),t)for(var i,r=R(t.keys);!(i=r()).done;){var a=i.value;n[a]=t.get_item(a)}return n},e}();Object(i.a)(B,"HttpRequestToPromiseUtility",null,[]),function(e){e[e.loki=0]="loki",e[e.augloopACLP=1]="augloopACLP"}(x||(x={})),Object(i.b)("AlternateAuthSupportApp",x);var U=n(426),H=n(27),N=function(){this.Token=null,this.ExpirationTime=0};Object(i.a)(N,"WacAlternateAuthToken",null,[]);var W=function(){function e(e,t){if(this.tokenRefreshThreshold=3e5,this.parseAlternateAuthTokenResponse=function(e){return H.d(e).deserialized},null==e||null==t)throw Error.argumentNull("appSettingsManager/clientRequestManager");if(this._appSettingsManager=e,this._alternateAuthTokens=new I.a(P.a.get_ordinalIgnoreCase()),this._httpRequestToPromise=new B(e,t),void 0!==U.a.lokiAlternateAuthToken&&null!==U.a.lokiAlternateAuthToken&&void 0!==U.a.lokiAlternateAuthTokenTTL&&null!==U.a.lokiAlternateAuthTokenTTL&&U.a.lokiAlternateAuthTokenTTL>0){var n=new N;n.Token=U.a.lokiAlternateAuthToken,n.ExpirationTime=U.a.lokiAlternateAuthTokenTTL,this._alternateAuthTokens.set_item("loki",n)}}var t=e.prototype;return t.getAlternateAuthToken=function(e){var t=null;return this._alternateAuthTokens.containsKey(x[e])&&(t=this._alternateAuthTokens.get_item(x[e])),null==t||this.isTokenExpired(t)?this.fetchNewUserDataSignatureToken(e):Promise.resolve(t.Token)},t.isTokenExpired=function(e){return e.ExpirationTime-Date.now()<this.tokenRefreshThreshold},t.fetchNewUserDataSignatureToken=function(e){var t=this,n=new I.a(P.a.get_ordinalIgnoreCase());return n.set_item("X-AlternateAuthApp",x[e]),this._httpRequestToPromise.createHttpResponsePromise(this.getEndpointUrl("/afhs/AlternateAuthHelperHandler.ashx"),this.parseAlternateAuthTokenResponse,2,n).then((function(n){return r.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",x[e]),t._alternateAuthTokens.set_item(x[e],n),n.Token}),(function(e){var t=Object(F.a)(E,e);return r.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",t.message,t.httpStatusCode),null}))},t.getEndpointUrl=function(e){var t=this._appSettingsManager.getBooleanAppSetting("SuiteOriginForAFHSIsEnabled")?this._appSettingsManager.getStringAppSetting("SuiteOrigin"):this._appSettingsManager.getStringAppSetting("WebServiceBase");return String.format("{0}{1}?{2}",t,e,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)},e}();Object(i.a)(W,"AlternateAuthHelper",null,[179]);var j=n(356),V=function(e,t,n){this.featureName=null,this.isEnabled=!1,this.tierName=0,this.featureName=e,this.isEnabled=t,this.tierName=n};Object(i.a)(V,"FeatureStateChangeArgs",null,[]);var q,G=n(487),K=n(166),z=n(8),X=n(45),J=n(105);!function(e){e[e.Enabled=0]="Enabled",e[e.Disabled=1]="Disabled"}(q||(q={})),Object(i.b)("FeatureState",q);var Q=n(20),Z=n(164);function Y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var ee=function(){function e(e,t,n,i,a){var o=this;void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),this._stopWatchBuiler=null,this._licensingStopWatch=null,this._requestTime=null,this._responseTime=null,this.featuresPromise=null,this.parseApplicationFeatureHelperResponse=function(e){var t=H.b(e);return t?(r.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),r.ULS.sendTraceTag(50938594,3004,50,"{0}",t)):r.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set"),t.Features},this.handleDimeTaskComplete=function(){r.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete"),o.featuresPromise.then((function(e){o.refreshLicensingAndNotifyUpdatedFeatures(e)})).catch((function(e){o.refreshLicensingAndNotifyUpdatedFeatures({})}))},this.processApplicationFeatureHelperResponseHeaders=function(e){try{e&&"Date"in e&&(o._responseTime=new Date(e.Date),r.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",o._responseTime.toString()))}catch(e){r.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",e)}},this._httpRequestToPromise=new B(e,t),this._appSettingsManager=e,this._licensingMaxRetryAttempts=e.getIntAppSetting("LicensingMaxRetryAttempts",0),this._isO365ConsumerHost=e.getBooleanAppSetting("IsO365ConsumerHost"),this._isO365CommercialHost=e.getBooleanAppSetting("IsO365CommercialHost"),this._isFreemiumUpsellSettingEnabled=e.getBooleanAppSetting("PremiumUpsellIsEnabled"),this._isFreemiumUpsellFeatureEnabled=!1,this._lastUpsellStatusLogged=0,this._cloudPolicySettingsHelper=n,this._userPrivacySettingsHelper=i,this._actionManager=a,this._licensingIsEnabled=e.getBooleanAppSetting("LicensingIsEnabled"),this._ocpsIsEnabled=e.getBooleanAppSetting("OcpsIsEnabled")&&this._isO365CommercialHost,this._userPrivacySettingsEnabled=e.getBooleanAppSetting("ShowPrivacyDialog")&&!!i,this._isAnonymousUser=e.getBooleanAppSetting("IsAnonymousUser"),this.falseBooleanPromise=new Promise((function(e,t){e(!1)})),this.trueBooleanPromise=new Promise((function(e,t){e(!0)})),this.featureStateChangeCallbacks=new I.a(P.a.get_ordinalIgnoreCase()),this._userConsentBasedFeaturesSupported=!0,this._licensedControlledFeatureSet=this.getLicensedControlledFeatures(),this.isO365Host()&&!this._isAnonymousUser?(void 0!==s.AFrameworkApplication.activeFrame&&null!==s.AFrameworkApplication.activeFrame&&(this._stopWatchBuiler=s.AFrameworkApplication.activeFrame.theStopwatchBuilder,void 0!==this._stopWatchBuiler&&null!==this._stopWatchBuiler&&(this._licensingStopWatch=this._stopWatchBuiler.makeStopwatch("WebServiceCall","ApplicationFeatureHelperService"))),this.featuresPromise=this.tryInitializeLicensing()):this.featuresPromise=new Promise((function(e){e({})})),this.featuresPromise.catch((function(e){var t=Object(F.a)(E,e),n=t?t.httpStatusCode.toString():"Unknown";r.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",n)})),this._userConsentBasedFeaturesSupported&&this.isFeatureEnabled("FreemiumUpsell",!0).then((function(e){return o._isFreemiumUpsellFeatureEnabled=e,null}))}var t=e.prototype;return t.getLicensedControlledFeatures=function(){for(var e=this._appSettingsManager.containsAppSetting("AllLicensedFeatures")?this._appSettingsManager.getListAppSetting("AllLicensedFeatures"):new Array(0),t=new j.a,n=0;n<e.length;n++)t.add(e[n]);return t},t.isO365Host=function(){return this._isO365CommercialHost||this._isO365ConsumerHost},t.tryInitializeLicensing=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=!1),r.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",t);var i=G.a.createExtendedPropertiesMap();i&&(i.set("retryAttempt",e.toString()),i.set("forceRefresh",t.toString()),i.set("isO365ConsumerHost",this._isO365ConsumerHost.toString()),i.set("isO365CommercialHost",this._isO365CommercialHost.toString()),i.set("isFreemiumUpsellSettingEnabled",this._isFreemiumUpsellSettingEnabled.toString())),l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",i),l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",i),void 0!==this._licensingStopWatch&&null!==this._licensingStopWatch&&this._licensingStopWatch.start();var a=null;return t&&(a=new I.a(P.a.get_ordinalIgnoreCase())).set_item("x-LicensingForceRefresh","true"),this._requestTime=new Date,(this._licensingIsEnabled?this._httpRequestToPromise.createHttpResponsePromise(this.getEndpointUrl("/afhs/ApplicationFeatureHelperHandler.ashx"),this.parseApplicationFeatureHelperResponse,0,a,this.processApplicationFeatureHelperResponseHeaders,["Date"]):Promise.resolve({})).then((function(e){var t=Object.assign(new Z.a,{durationMs:n.stopAndGetDurationInMsFromLicensingStopwatch()});return t.extendedProperties=i,t.extendedProperties&&e&&(t.extendedProperties.set("featureCount",X.a.count(e).toString()),t.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in e).toString()),t.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in e).toString()),"FreemiumUpsell"in e&&t.extendedProperties.set("isFreemiumUpsellEnabled",e.FreemiumUpsell.toString()),n._responseTime&&t.extendedProperties.set("fromCache",(n._responseTime<n._requestTime).toString())),l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",t),e}),(function(t){var a=Object.assign(new Z.a,{durationMs:n.stopAndGetDurationInMsFromLicensingStopwatch()}),o=Object(F.a)(E,t);return o?(a.extendedProperties=i,a.extendedProperties&&a.extendedProperties.set("status",o.httpStatusCode.toString()),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,a),408===o.httpStatusCode&&++e<=n._licensingMaxRetryAttempts?n.tryInitializeLicensing(e):new Promise((function(e,t){t(o)}))):(r.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,a),new Promise((function(e,n){n(t)})))}))},t.getEndpointUrl=function(t){var n=this._appSettingsManager.getBooleanAppSetting("SuiteOriginForAFHSIsEnabled")?this._appSettingsManager.getStringAppSetting("SuiteOrigin"):this._appSettingsManager.getStringAppSetting("WebServiceBase"),i=String.format("{0}{1}",n,t);if(this._appSettingsManager.containsAppSetting("ApplicationFeatureHelperHttpCachingEnabled")&&this._appSettingsManager.getBooleanAppSetting("ApplicationFeatureHelperHttpCachingEnabled")){var r=e.getLocalStorageCacheKey(this._appSettingsManager);if(r&&r.length>0){this._userConsentBasedFeaturesSupported&&(r+="ucbf");var a=new K.QueryStringBuilder(i);a.addParam("afhskey",r),i=a.toString()}}return i},t.isFeatureEnabled=function(e,t){var n=this;if(!this._ocpsIsEnabled&&!this._userPrivacySettingsEnabled&&!this._licensingIsEnabled)return this.trueBooleanPromise;if(r.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",e),"ConnectedServices"===e){var i=this._ocpsIsEnabled?this._cloudPolicySettingsHelper.getBooleanPolicySetting("ControllerConnectedServicesEnabled"):this.trueBooleanPromise,a=this._userPrivacySettingsEnabled?this._userPrivacySettingsHelper.getSettings().then((function(e){return 2!==e.controllerServicesStateRoaming}),(function(e){return t})):this.trueBooleanPromise;return i.then((function(e){return e?a:n.falseBooleanPromise}))}if("FreemiumUpsell"===e&&(!this._isFreemiumUpsellSettingEnabled||!this._isO365ConsumerHost||this._isAnonymousUser))return this.falseBooleanPromise;var o=null;o=this._ocpsIsEnabled?this._cloudPolicySettingsHelper.isFeatureEnabled(e):this.trueBooleanPromise;var s=null;s=this._licensingIsEnabled?this.isFeatureAllowedByUserLicense(e,t):this.trueBooleanPromise;var l=null;return l=this._userPrivacySettingsEnabled?this._userPrivacySettingsHelper.isFeatureEnabled(e):this.trueBooleanPromise,o.then((function(e){return e?l.then((function(e){return e?s:n.falseBooleanPromise})):n.falseBooleanPromise})).then((function(t){return n.logFeatureStatus(e,t,!0),t}),(function(i){return n.logFeatureStatus(e,t,!1),t}))},t.logFeatureStatus=function(e,t,n){r.ULS.sendTraceTag(526713106,3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",e,t,n)},t.getFeatureTier=function(e,t){var n=this;return this._licensingIsEnabled?(r.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",e),this.featuresPromise.then((function(i){return n.getTierName(e,i,t)}),(function(e){return t}))):new Promise((function(e,t){e(2)}))},t.isFreemiumUpsellEnabled=function(){return!!(this._isFreemiumUpsellSettingEnabled&&this._isO365ConsumerHost&&!this._isAnonymousUser)&&((this._isFreemiumUpsellFeatureEnabled&&2!==this._lastUpsellStatusLogged||!this._isFreemiumUpsellFeatureEnabled&&1!==this._lastUpsellStatusLogged)&&(r.ULS.sendTraceTag(509728161,3004,20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isFreemiumUpsellFeatureEnabled={0}",this._isFreemiumUpsellFeatureEnabled.toString()),this._lastUpsellStatusLogged=this._isFreemiumUpsellFeatureEnabled?2:1),this._isFreemiumUpsellFeatureEnabled)},t.launchUpsellExperience=function(e,t){void 0===t&&(t=null),r.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",e));var n=G.a.createExtendedPropertiesMap();n&&(n.set("experienceId",e),t&&n.set("campaignId",t)),l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",n);var i=Q.a.instance.tryResolve("Common.IInProductMessagingUIManager");if(i){var a=this.handleDimeTaskComplete;i.launchDimeExperience(e,a,t)}else r.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this._actionManager.processActionWithData(p.a.freemiumUpsellEligible,2,{experience:e})},t.registerFeatureStateChangeCallback=function(e,t){if(!this._licensingIsEnabled)return null;if(!e||!t)return r.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;var n=J.a.create().toString();return this.featureStateChangeCallbacks.containsKey(e)||this.featureStateChangeCallbacks.set_item(e,new I.a(P.a.get_ordinalIgnoreCase())),this.featureStateChangeCallbacks.get_item(e).add(n,t),r.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",n,e)),n},t.removeFeatureStateChangeCallback=function(e,t){return!!this._licensingIsEnabled&&(e&&this.featureStateChangeCallbacks.containsKey(e)?t&&J.a.isValid(t)?this.featureStateChangeCallbacks.get_item(e).containsKey(t)?(r.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",t,e)),this.featureStateChangeCallbacks.get_item(e).remove(t)):(r.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",t,e)),!1):(r.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",t,e)),!1):(r.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",e)),!1))},t.getTierName=function(e,t,n){return this._userConsentBasedFeaturesSupported?e in t?t[e].LicenseTier:n:e in t?this.parseTierName(t[e],n):n},t.parseTierName=function(e,t){switch(e.toLowerCase()){case"unknown":return 0;case"basic":return 1;case"premium":return 2;default:return t}},t.refreshLicensingAndNotifyUpdatedFeatures=function(e){var t=this;r.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");var n=this.tryInitializeLicensing(0,!0);n.then((function(i){t.featuresPromise=n,X.a.count(i)>X.a.count(e)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(var r,a=Y(t.featureStateChangeCallbacks.keys);!(r=a()).done;){var o=r.value;if(o in i){var s=t.getTierName(o,i,0);if(o in e)t.getTierName(o,e,0)!==s&&t.notifyFeatureStateChanged(o,!0,s);else t.notifyFeatureStateChanged(o,!0,s)}else o in e&&t.notifyFeatureStateChanged(o,!1,t.getTierName(o,e,0))}})).catch((function(e){l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null),r.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(e))}))},t.notifyFeatureStateChanged=function(e,t,n){r.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",e,t,n);for(var i,a=new V(e,t,n),o=Y(this.featureStateChangeCallbacks.get_item(e));!(i=o()).done;){var s=i.value;try{s.value(a)}catch(t){r.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",e,s.key,t.message))}}},t.isFeatureAllowed=function(e,t){var n=this;if(this._licensingIsEnabled){var i=this._licensedControlledFeatureSet.contains(e),r=!0,a="",o=!1;return this.featuresPromise.then((function(s){if(e in s){var l=s[e];a=q[l.FeatureState],r=1!==l.FeatureState}else r=!i;return n.logIsFeatureAllowed(e,i,a,o,t,r),r}),(function(s){return o=!0,i&&(r=t),n.logIsFeatureAllowed(e,i,a,o,t,r),r}))}return this.trueBooleanPromise},t.logIsFeatureAllowed=function(e,t,n,i,a,o){r.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",e,t,i,n,a,o)},t.isFeatureAllowedByUserLicense=function(e,t){return this._userConsentBasedFeaturesSupported?this.isFeatureAllowed(e,t):this._licensingIsEnabled?this._licensedControlledFeatureSet.contains(e)?this.featuresPromise.then((function(t){return e in t}),(function(e){return t})):(r.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",e),this.trueBooleanPromise):this.trueBooleanPromise},t.stopAndGetDurationInMsFromLicensingStopwatch=function(){if(void 0!==this._licensingStopWatch&&null!==this._licensingStopWatch){var e=this._licensingStopWatch.ageInMilliseconds;return this._licensingStopWatch.stop(),e}return null},e.getLocalStorageCacheKey=function(e){try{if(z.a.supportsWindowAtob){var t=e.getStringAppSetting("UserDataSignature").split(".");if(t.length>1){var n=window.self.atob(t[1]),i=JSON.parse(n).LocalStorageKey;if(null!=i&&i.length>0)return i}}}catch(e){r.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",e.toString())}return null},e}();Object(i.a)(ee,"ApplicationFeatureHelper",null,[180]);var te=n(117),ne=function(e,t){this.PolicySettings=null,this.ExpirationTime=0,this.PolicySettings=e.PolicySettings;var n=new Date;n.setMinutes(n.getMinutes()+t),this.ExpirationTime=n.getTime()};function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ne,"CloudPolicySettingsCacheData",null,[]);var re=function(){function e(){this._localStorageNotWorking=!1}var t,n,i,a=e.prototype;return a.getItem=function(t){try{if(e.isValidKey(t)&&this.localStorage)return this.localStorage.getItem(t)}catch(e){r.ULS.sendTraceTag(593512200,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}return null},a.setItem=function(t,n){try{e.isValidKey(t)&&this.localStorage&&this.localStorage.setItem(t,n)}catch(e){r.ULS.sendTraceTag(593512199,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}},a.removeItem=function(t){try{e.isValidKey(t)&&this.localStorage&&this.localStorage.removeItem(t)}catch(e){r.ULS.sendTraceTag(593512198,306,15,"LocalStorageWrapper Exception: {0} ",e.message)}},e.isValidKey=function(e){return!(null==e||e.length<=0)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=[{key:"localStorage",get:function(){var e=null;if(!this._localStorageNotWorking)try{localStorage&&(e=localStorage)}catch(e){this._localStorageNotWorking=!0}return e}}])&&ie(t.prototype,n),i&&ie(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();re._instance=null,Object(i.a)(re,"LocalStorageWrapper",null,[216]);var ae=n(250),oe=n(148),se=function(){function e(){}return e.sideCarIsAvailable=function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SideCarIsEnabled")?e.scriptResourceWithAction&&e.isDownloaded?new Promise((function(e){e(!0)})):new Promise((function(t,n){e.scriptResourceWithAction=oe.a.create(s.AFrameworkApplication.appSettingsManager.getStringAppSetting("SideCarUrl")),ae.a.enqueueResourceWithoutEnabling(e.scriptResourceWithAction),e.scriptResourceWithAction.add_loadFinished((function(i,r){e.isDownloaded=r.succeeded,r.succeeded?t(r.succeeded):n(r.succeeded)}))})):new Promise((function(e){e(!1)}))},e}();se.isDownloaded=!1,se.scriptResourceWithAction=null,Object(i.a)(se,"SideCarLoader",null,[]);var le=function(){this.PolicySettings=null,this.ControllerConnectedServicesFeatureNames=null};function ce(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ue(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(le,"CloudPolicySettingsData",null,[]);var de=function(){function e(e,t){var n=this;this._checkInInterval=0,this.cloudPolicySettingsPromise=null,this.parseCloudPolicySettingsResponse=function(e){var t,n=!!(t=H.d(e).deserialized);return r.ULS.sendTraceTag(50622687,3004,n?50:10,"ParseCloudPolicySettingsResponse: Success={0}",n),t},this.processCloudPolicySettingsResponseHeaders=function(e){try{if(null==e)return;if("CheckIn-Interval"in e){var t=parseInt(e["CheckIn-Interval"]);null!=t&&t>0&&(n._checkInInterval=t)}}catch(e){r.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",e)}},this._httpRequestToPromise=new B(e,t),this._appSettingsManager=e;var i=e.getStringAppSetting("HostAuthType");this._ocpsIsEnabled=e.getBooleanAppSetting("OcpsIsEnabled")&&e.getBooleanAppSetting("IsO365CommercialHost")&&!(null==i)&&"aad"===i.toLowerCase(),this._ocpsPolicyDefaults=H.b(e.getStringAppSetting("OcpsDefaultSettings")||"{}"),this._localStorageCacheKey=this.getLocalStorageCacheKey();var a=this._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")&&this._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList")||new Array(0);this._controllerConnectedServicesSet=new j.a;for(var o=0;o<a.length;o++)this._controllerConnectedServicesSet.add(a[o]);var s=this._ocpsIsEnabled&&!e.getBooleanAppSetting("IsAnonymousUser")&&e.getBooleanAppSetting("SideCarIsEnabled");this.cloudPolicySettingsPromise=s?this.tryInitializeWithSideCar():this.tryInitialize(this._ocpsIsEnabled,this.getEndpointUrl("/afhs/CloudPolicySettings.ashx"),this.parseCloudPolicySettingsResponse),this.cloudPolicySettingsPromise.then((function(e){return null})).catch((function(e){var t=Object(F.a)(E,e),n=t?t.httpStatusCode.toString():"Unknown";r.ULS.sendTraceTag(50622685,3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",n)}))}var t=e.prototype;return t.getBooleanPolicySetting=function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!0),!this._ocpsIsEnabled){var i=this;return new Promise((function(t,n){t(i.getOcpsBooleanPolicyDefault(e))}))}var a=this,o=this,s=this.cloudPolicySettingsPromise.then((function(i){try{var o=null,s="unknown".toLowerCase();if(i.PolicySettings&&s in i.PolicySettings&&(o=i.PolicySettings[s]),o){if(e in o&&void 0!==o[e]&&null!==o[e])return new Promise((function(t,n){t("0"!==o[e])}));var l=e.toLowerCase();return l in o&&void 0!==o[l]&&null!==o[l]?new Promise((function(e,t){e("0"!==o[l])})):n?(r.ULS.sendTraceTag(51512667,3004,50,"Policy"+e+" not found, using default"),new Promise((function(t,n){t(a.getOcpsBooleanPolicyDefault(e))}))):(r.ULS.sendTraceTag(508395746,3004,50,"Policy"+e+" not found, returning PolicyNotConfigured error"),new Promise((function(e,t){t("PolicyNotConfigured")})))}return new Promise((function(t,n){t(a.getOcpsBooleanPolicyDefault(e))}))}catch(n){return r.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+e+" policy value. Error Message: {0}",n.message),a.handleError(n.toString(),t,a.getOcpsBooleanPolicyDefault(e))}}),(function(n){return o.handleError(n,t,o.getOcpsBooleanPolicyDefault(e))}));return s.then((function(t){return r.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",e,t),null})),s},t.isFeatureEnabled=function(e,t){if(void 0===t&&(t=!0),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.isFeatureEnabledV2(e,t);var n=new Promise((function(e,t){e(!0)})),i="";return this._controllerConnectedServicesSet.contains(e)&&(i="ControllerConnectedServicesEnabled",n=this.getBooleanPolicySetting(i,t)),n.then((function(t){return r.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",e,t,i),null})),n},t.isFeatureEnabledV2=function(e,t){void 0===t&&(t=!0);var n=new Promise((function(e,t){e(!0)})),i="";return"mso_sendASmile"===e?i="Enabled":"Survey"===e||"FloodgateSurvey"===e?i="SurveyEnabled":this._controllerConnectedServicesSet.contains(e)&&(i="ControllerConnectedServicesEnabled"),""!==i&&(n=this.getBooleanPolicySetting(i,t)),n.then((function(t){return r.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",e,t,i),null})),n},t.handleError=function(e,t,n){return new Promise(t?function(e,t){e(n)}:function(t,n){n(e)})},t.tryInitialize=function(e,t,n){var i=this;if(!e)return Promise.resolve(new le);var a=!1,o=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);var s=this.createAndStartStopwatch("GetCloudPolicySettings");return new Promise((function(e,o){if(void 0!==i._localStorageCacheKey&&null!==i._localStorageCacheKey&&i._localStorageCacheKey.length>0){var s=i.tryGetCloudPolicySettingsDataFromCache();if(null!=s)return a=!0,void e(s)}i._httpRequestToPromise.createHttpResponsePromise(t,n,1,null,i.processCloudPolicySettingsResponseHeaders,["CheckIn-Interval"],i._appSettingsManager.getIntAppSetting("CloudPolicySettingsRequestQueueTimeout",15e3),i._appSettingsManager.getIntAppSetting("CloudPolicySettingsRequestSentTimeout",3e4)).then((function(t){return r.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS"),i.trySetCloudPolicySettingsDataIntoCache(t),e(t),t}),(function(e){return o(e),null}))})).then((function(e){var t=i.stopAndGetDurationInMsFromStopwatch(s);s=t.stopwatch,o=t.returnValue;var n=G.a.createExtendedPropertiesMap();n&&n.set("FromCache",a.toString());var r=Object.assign(new Z.a,{durationMs:o,extendedProperties:n});return l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",r),e}))},t.tryInitializeWithSideCar=function(){return se.sideCarIsAvailable().then((function(e){return r.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar"),sidecar.cloudPolicy.GetCloudPolicySettingsData()}))},t.getEndpointUrl=function(e){var t=this._appSettingsManager.getBooleanAppSetting("SuiteOriginForAFHSIsEnabled")?this._appSettingsManager.getStringAppSetting("SuiteOrigin"):this._appSettingsManager.getStringAppSetting("WebServiceBase");return String.format("{0}{1}",t,e)},t.getOcpsBooleanPolicyDefault=function(e){return!(e in this._ocpsPolicyDefaults)||"0"!==this._ocpsPolicyDefaults[e]},t.tryGetCloudPolicySettingsDataFromCache=function(){try{var e=re.instance.getItem(this._localStorageCacheKey);if(null==e)return r.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;r.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",e);var t=JSON.parse(e);if(null==t)return r.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===t.ExpirationTime||null===t.ExpirationTime)return r.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if(new Date(t.ExpirationTime).getTime()<Date.now())return r.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;var n=new le;n.PolicySettings=t.PolicySettings,n.ControllerConnectedServicesFeatureNames=new te.a;this._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")?this._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList"):new Array(0);for(var i,a=ce(this._controllerConnectedServicesSet);!(i=a()).done;){var o=i.value;n.ControllerConnectedServicesFeatureNames.add(o)}return r.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved"),n}catch(e){return r.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",e.toString()),null}},t.trySetCloudPolicySettingsDataIntoCache=function(e){try{if(null==e||void 0===e.PolicySettings||null===e.PolicySettings)r.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(this._checkInInterval<=0)r.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{var t=new ne(e,this._checkInInterval),n=JSON.stringify(t);r.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",n),re.instance.setItem(this._localStorageCacheKey,n),r.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(e){r.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",e.toString())}},t.getLocalStorageCacheKey=function(){var e=ee.getLocalStorageCacheKey(this._appSettingsManager);return e&&e.length>0?"OCPS"+e:null},t.createAndStartStopwatch=function(e){var t=Q.a.instance.tryResolve("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return null!=t?t.makeAndStartStopwatch("WebServiceCall",e):null},t.stopAndGetDurationInMsFromStopwatch=function(e){if(null!=e){var t=e.ageInMilliseconds;return e.stop(),{returnValue:t,stopwatch:e=null}}return{returnValue:null,stopwatch:e}},e}();function pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(de,"CloudPolicySettingsHelper",null,[177]);var he=function(){function e(){this.controllerServicesStateRoaming=0,this.userContentStateRoaming=0,this.downloadContentStateRoaming=0,this.controllerServicesTimeRoaming="",this.userContentTimeRoaming="",this.downloadContentTimeRoaming="",this.userPrivacySettingsRoamedNoticeShown=2,this._src=2}var t,n,i,a=e.prototype;return a.clone=function(){var t=new e;return t.controllerServicesStateRoaming=this.controllerServicesStateRoaming,t.userContentStateRoaming=this.userContentStateRoaming,t.downloadContentStateRoaming=this.downloadContentStateRoaming,t.controllerServicesTimeRoaming=this.controllerServicesTimeRoaming,t.userContentTimeRoaming=this.userContentTimeRoaming,t.downloadContentTimeRoaming=this.downloadContentTimeRoaming,t.userPrivacySettingsRoamedNoticeShown=this.userPrivacySettingsRoamedNoticeShown,t._src=this.src,t},a.serialize=function(t){void 0===t&&(t=null);var n={};return t&&!t.contains(e.officePrivacyControllerConnectedServicesKey)||(n[e.officePrivacyControllerConnectedServicesKey]=this.controllerServicesStateRoaming),t&&!t.contains(e.officePrivacyControllerConnectedServicesTimeKey)||(n[e.officePrivacyControllerConnectedServicesTimeKey]=this.controllerServicesTimeRoaming),t&&!t.contains(e.officePrivacyRoamedNoticeShownKey)||(n[e.officePrivacyRoamedNoticeShownKey]=this.userPrivacySettingsRoamedNoticeShown),JSON.stringify(n)},e.create=function(t,n){void 0===n&&(n=null);var i=new e;return i._src=t,null!=n&&(e.officePrivacyControllerConnectedServicesKey in n&&(i.controllerServicesStateRoaming=n[e.officePrivacyControllerConnectedServicesKey]),e.officePrivacyControllerConnectedServicesTimeKey in n&&(i.controllerServicesTimeRoaming=n[e.officePrivacyControllerConnectedServicesTimeKey]),e.officePrivacyRoamedNoticeShownKey in n&&(i.userPrivacySettingsRoamedNoticeShown=n[e.officePrivacyRoamedNoticeShownKey])),i},e.deserialize=function(t,n){try{var i=JSON.parse(t);if(null!=i)return e.create(n,i);throw r.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",t),Error.argument("settingsData")}catch(e){throw r.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",e.toString()),e}},t=e,(n=[{key:"src",get:function(){return this._src}}])&&pe(t.prototype,n),i&&pe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();he.officePrivacyControllerConnectedServicesKey="CCS",he.officePrivacyControllerConnectedServicesTimeKey="CCSTime",he.officePrivacyRoamedNoticeShownKey="OfficePrivacyRoamedNoticeShown",Object(i.a)(he,"UserPrivacySettings",null,[]);var ge=n(94),me=function(){function e(e,t){if(null==e||null==t)throw Error.argumentNull("appSettingsManager/clientRequestManager");this._appSettingsManager=e,this._clientRequestManager=t,this._settings=null,this._settingsPromise=null}var t=e.prototype;return t.getEndpointUrl=function(e){var t=this._appSettingsManager.appSettings.RoamingServiceHandlerWebServiceBase||"",n=String.format("{0}RoamingServiceHandler.ashx?action=",t),i=new Sys.StringBuilder(n);return i.append(e),i.append("&"),i.append(s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),i.toString()},t.executeRequest=function(e,t,n,i){return void 0===i&&(i=null),this._clientRequestManager.addRequestWithTaskAndStopWatch(e,t,i,null,!1,2,null,n,"33",!1,null,6e4)},t.saveSettings=function(e){var t=this;return new Promise((function(n,i){try{if(void 0===t._settings||null===t._settings||null==e)return r.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),void i("Can't determine setting changes to save");var a=t._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming;if(2===t._settings.src&&a)return t.saveSettingsToQueryParam(e),void n(!0);var o=t.serializeSettingUpdates(e);if(null==o||!o.length)return r.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),void i("No changes to save");if(1===t._settings.src)return void n(t.trySaveSettingsToCookie(o));if(0===t._settings.src){r.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",o);var s=t.executeRequest(t.getEndpointUrl("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",o);s.continueWith((function(e){if(s.isCanceled||s.isFaulted)return r.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),void n(!1);var t=s.result;void 0!==t.args&&null!==t.args&&void 0!==t.args.data&&null!==t.args.data&&t.args.data.httpStatus===M.a.OK_200?(r.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),n(!0)):(r.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),n(!1))}))}}catch(e){r.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",e.toString()),n(!1)}}))},t.serializeSettingUpdates=function(e){if(void 0===this._settings||null===this._settings||null==e)throw Error.invalidOperation("User Privacy settings have not been initialized");var t=new te.a;return 0===e.src?(this._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming&&(t.add(he.officePrivacyControllerConnectedServicesKey),t.add(he.officePrivacyControllerConnectedServicesTimeKey)),this._settings.userPrivacySettingsRoamedNoticeShown!==e.userPrivacySettingsRoamedNoticeShown&&t.add(he.officePrivacyRoamedNoticeShownKey)):1===e.src&&this._settings.controllerServicesStateRoaming!==e.controllerServicesStateRoaming&&t.add(he.officePrivacyControllerConnectedServicesKey),t.count?e.serialize(t):(r.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)},t.getSettings=function(){if(!this._settingsPromise){var e=this;this._settingsPromise=new Promise((function(t,n){try{if(e._settings)return void t(e._settings.clone());e.tryGetSettingsFromRoaming().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return e.tryGetSettingsFromCookie().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return e.tryGetSettingsFromQueryParams().then((function(n){return e._settings=n,t(e._settings.clone()),null}),(function(n){return r.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)"),e._settings=new he,t(e._settings.clone()),null})),null})),null}))}catch(n){r.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",n.toString()),e._settings=new he,t(e._settings.clone())}}))}return this._settingsPromise},t.tryGetSettingsFromRoaming=function(){var t=this;return new Promise((function(n,i){try{var a=-1!==window.location.href.indexOf("&wd_pn=2");if(!t._appSettingsManager.getBooleanAppSetting("PrivacyDialogShouldCheckRoaming")&&!a)return r.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),void i("Roaming should not be used");var o=t.executeRequest(t.getEndpointUrl("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");o.continueWith((function(t){try{if(!o.isCanceled&&!o.isFaulted){var a=o.result;if(a&&a.args&&a.args.data)if(a.args.data.httpStatus!==M.a.OK_200)r.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",a.args.data.httpStatus);else{if(a.args.data.responseData)return n(e.parse(a.args.data.responseData,0)),void r.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",a.args.data.responseData);r.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else r.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");return void i("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}r.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure")}catch(e){return r.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",e.toString()),void i("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}}))}catch(e){return r.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",e.toString()),void i("UserPrivacySettings TryGetSettingsFromRoaming Exception")}}))},t.tryGetSettingsFromCookie=function(){var t=this;return new Promise((function(n,i){try{var a=ge.a.get("WacUPToggleState"),o=null;if(null!=a&&a.length>0&&(o=decodeURIComponent(a)),null!=o&&o.length>0){var s=e.parse(o,1);return r.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",s.toString()),void n(s)}var l=he.create(1),c=new te.a;c.add(he.officePrivacyControllerConnectedServicesKey);var u=l.serialize(c);return t.trySaveSettingsToCookie(u)?(r.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",u),void n(l)):(r.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",u),void i("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}catch(e){r.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",e.toString()),i("UserPrivacySettings TryGetSettingsFromCookie Eception")}}))},t.tryGetSettingsFromQueryParams=function(){return new Promise((function(e,t){try{var n=-1!==window.location.href.indexOf("&wdccsoff=1"),i=he.create(2);return n?(i.controllerServicesStateRoaming=2,s.AFrameworkApplication.disableControllerServicesViaQueryParam(),r.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",i.toString())):(i.controllerServicesStateRoaming=1,r.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",i.toString())),void e(i)}catch(t){r.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",t.toString());var a=he.create(2);a.controllerServicesStateRoaming=1,e(a)}}))},t.saveSettingsToQueryParam=function(e){return r.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam"),2===e.controllerServicesStateRoaming?s.AFrameworkApplication.disableControllerServicesViaQueryParam():s.AFrameworkApplication.enableControllerServicesViaQueryParam(),r.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",e),!0},t.trySaveSettingsToCookie=function(e){try{r.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",e);var t=this._appSettingsManager.getStringAppSetting("PrivacyCookieDomain")||"";if(!t||!t.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");return r.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",e),ge.a.setWithAllTheThings("WacUPToggleState",e,ge.a.maxComplianceAllowedRetentionInDays,"/",t)}catch(e){return r.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",e.toString()),!1}},t.isFeatureEnabled=function(e){var t=this;return this.getSettings().then((function(n){for(var i=t._appSettingsManager.containsAppSetting("ServicesControlsMicrosoftControllerServicesList")?t._appSettingsManager.getListAppSetting("ServicesControlsMicrosoftControllerServicesList"):new Array(0),r=new j.a,a=0;a<i.length;a++)r.add(i[a]);return!r.contains(e)||2!==n.controllerServicesStateRoaming}),(function(t){return r.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",e),!0}))},e.parse=function(e,t){try{return r.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",e,t),he.deserialize(e,t)}catch(e){throw r.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",e.toString()),e}},e}();function fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(me,"UserPrivacySettingsHelper",null,[178]);var ve=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.configure=function(e){var t=this;this._container=e,this._container.register(177,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").singleInstance().usingFactory((function(){return new de(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(178,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").singleInstance().usingFactory((function(){return new me(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(179,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").singleInstance().usingFactory((function(){return new W(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager)})),this._container.register(180,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").singleInstance().usingFactory((function(){return new ee(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,t._container.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),t._container.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),s.AFrameworkApplication.theActionManager)}))},a.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){var t=e._container.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LicensingIsEnabled")&&(t.isFeatureEnabled("LicensingTestFeature",!1).then((function(e){return r.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",e,s.AFrameworkApplication.appSettingsManager.getStringAppSetting("IsAnonymousUser")),null})),t.getFeatureTier("LicensingTestFeature",0).then((function(e){return r.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",e,s.AFrameworkApplication.appSettingsManager.getStringAppSetting("IsAnonymousUser")),null}))),e._container.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper"),e.temporarySideCarVerifier()}))},a.dispose=function(){},a.temporarySideCarVerifier=function(){try{s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SideCarIsEnabled")&&se.sideCarIsAvailable().then((function(e){return r.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",e),e}))}catch(e){return}},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}}])&&fe(t.prototype,n),i&&fe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(ve,"ApplicationFeatureHelperPackage",null,[2,3]);var _e=n(38),ye=n(349),Se=n(50),be=function(){function e(e,t){var n=this;this._environmentString=null,this.updateEnvironmentName=function(e,t,i,r,a){if(1===i)return 32;var o=a;return o[ye.a.Value]=n._environmentString,o[Se.a.labelText]=n._environmentString,o[ye.a.Visible]=!0,32},this._actionManager=e,this._appSettingsManager=t}return e.prototype.registerActions=function(){this._environmentString=this._appSettingsManager.getStringAppSetting("StatusBarEnvironmentNameToUse"),this._environmentString&&""!==this._environmentString&&this._actionManager.addActionWithFlags(p.a.queryEnvironmentName,_e.a.frame,this.updateEnvironmentName,96)},e}();function Ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(be,"DisplayEnvironmentName",null,[]);var Ce=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,this._container.register(be,"Common.App.DisplayEnvironmentName.DisplayEnvironmentName").singleInstance().usingFactory((function(){return new be(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.appSettingsManager)}))},r.init=function(){this._container.resolve("Common.App.DisplayEnvironmentName.DisplayEnvironmentName").registerActions()},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.DisplayEnvironmentName"}}])&&Ae(t.prototype,n),i&&Ae(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ce,"DisplayEnvironmentNamePackage",null,[2,3]);var Te=function(){this.x=0,this.y=0};function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Te,"HammerPoint",null,[]);var we=function(){function e(e,t,n,i,r){this._initialPinchScale=1,this._initialDocumentScale=1,this._lastRelativeScale=1,this._unscaledAbsolutePinchStartX=0,this._unscaledAbsoluteLeftPageMargin=0,this._unscaledAbsolutePinchStartY=0,this._containerBounds=null,this._nextUiUpdateTime=null,this._promoteLayerPinchToZoomIsEnabled=!1,this._finalizeWithInitialPinchScaleIsEnabled=!1,this._adjustPinchStartXWithPageMarginIsEnabled=!1,this._futureZoomManager=e,this._scrollContainer=t,this._scrollable=n,this._actionManager=i,r&&(this._promoteLayerPinchToZoomIsEnabled=r.getBooleanAppSetting("PromoteLayerPinchToZoomIsEnabled"),this._finalizeWithInitialPinchScaleIsEnabled=r.getBooleanAppSetting("FinalizeWithInitialPinchScaleIsEnabled"),this._adjustPinchStartXWithPageMarginIsEnabled=r.getBooleanAppSetting("AdjustPinchStartXWithPageMarginIsEnabled"))}var t,n,i,a=e.prototype;return a.isGesturePossible=function(e){return!!this._futureZoomManager.instance},a.onGestureStart=function(e){this._actionManager&&this._actionManager.processAction(p.a.startPinchToZoom,2);var t=this.getZoomManager();if(this._promoteLayerPinchToZoomIsEnabled&&t.raisePinchStartEvent(),this._initialDocumentScale=t.currentZoom,this._initialPinchScale=e.gestureData.scale,this._lastRelativeScale=1,this._nextUiUpdateTime=this.calculateNextUiControlUpdateTime(),this._containerBounds=this._scrollContainer.getBounds(),!this._containerBounds)return r.ULS.sendTraceTag(42821145,353,15,"Unexpected null bounds"),!1;var n=this.getPinchCenterRelativeToContainer(e);return this._adjustPinchStartXWithPageMarginIsEnabled?this.setOrUpdatePinchStartX(this._scrollContainer.scrollWidth,this._containerBounds.width,n,this._initialDocumentScale,t):this._unscaledAbsolutePinchStartX=this._scrollContainer.scrollWidth>this._containerBounds.width?this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,n.x,this._initialDocumentScale):null,this._unscaledAbsolutePinchStartY=this._scrollContainer.scrollHeight>this._containerBounds.height?this.calculateAbsolutePinchStartPos(this._scrollable.scrollTop,n.y,this._initialDocumentScale):null,!0},a.resetPinchStartX=function(){this._unscaledAbsolutePinchStartX=null,this._unscaledAbsoluteLeftPageMargin=0},a.setOrUpdatePinchStartX=function(e,t,n,i,r){if(e>t)if(this._unscaledAbsolutePinchStartX){var a=r.leftPageMargin;if(a!==this._unscaledAbsoluteLeftPageMargin){var o=this._unscaledAbsoluteLeftPageMargin-a;this._unscaledAbsolutePinchStartX=this._unscaledAbsolutePinchStartX-o,this._unscaledAbsoluteLeftPageMargin=a}}else this._unscaledAbsolutePinchStartX=this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,n.x,i),this._unscaledAbsoluteLeftPageMargin=r.leftPageMargin;else this.resetPinchStartX()},a.onGestureEvent=function(e){var t=this.getPinchCenterRelativeToContainer(e);if(!t)return r.ULS.sendTraceTag(42821147,353,15,"Unexpected null pinch center"),!1;var n=this.setFilteredRelativeScale(e.gestureData.scale/this._initialPinchScale)*this._initialDocumentScale;return this.updateScrollLeft(t,n),this.updateScrollTop(t,n),!0},a.updateScrollLeft=function(e,t){var n=this._scrollContainer.scrollWidth,i=this._containerBounds.width;this._adjustPinchStartXWithPageMarginIsEnabled?this.setOrUpdatePinchStartX(n,i,e,t,this.getZoomManager()):!this._unscaledAbsolutePinchStartX&&n>i&&(this._unscaledAbsolutePinchStartX=this.calculateAbsolutePinchStartPos(this._scrollable.scrollLeft,e.x,t));var r=this.calculateScrollPosition(e.x,this._unscaledAbsolutePinchStartX,n,i,t);r&&(this._scrollable.scrollLeft=r)},a.updateScrollTop=function(e,t){var n=this._scrollContainer.scrollHeight,i=this._containerBounds.height;!this._unscaledAbsolutePinchStartY&&n>i&&(this._unscaledAbsolutePinchStartY=this.calculateAbsolutePinchStartPos(this._scrollable.scrollTop,e.y,t));var r=this.calculateScrollPosition(e.y,this._unscaledAbsolutePinchStartY,n,i,t);r&&(this._scrollable.scrollTop=r)},a.calculateScrollPosition=function(e,t,n,i,r){if(n<=i||!t||!i)return null;var a=t*r-e,o=n-i;return Math.max(0,Math.min(a,o))},a.calculateAbsolutePinchStartPos=function(e,t,n){return(e+t)/n},a.onGestureEnd=function(e){var t=e.gestureData.scale;this._finalizeWithInitialPinchScaleIsEnabled&&(t/=this._initialPinchScale),this.finalizeRelativeScale(t),this._promoteLayerPinchToZoomIsEnabled&&this.getZoomManager().raisePinchEndEvent(),this._actionManager&&this._actionManager.processAction(p.a.endPinchToZoom,2),this._adjustPinchStartXWithPageMarginIsEnabled&&this.resetPinchStartX()},a.onGestureCancel=function(e){var t=e.gestureData.scale;this._finalizeWithInitialPinchScaleIsEnabled&&(t/=this._initialPinchScale),this.finalizeRelativeScale(t,!0),this._promoteLayerPinchToZoomIsEnabled&&this.getZoomManager().raisePinchEndEvent(),this._actionManager&&this._actionManager.processAction(p.a.endPinchToZoom,2),this._adjustPinchStartXWithPageMarginIsEnabled&&this.resetPinchStartX()},a.getZoomManager=function(){return this._futureZoomManager.instance},a.setFilteredRelativeScale=function(e){var t=this.getZoomManager(),n=new Date>=this._nextUiUpdateTime;return n&&(this._nextUiUpdateTime=this.calculateNextUiControlUpdateTime()),Math.abs(e-this._lastRelativeScale)>=.01*e&&t.setZoomDuringResize(e*this._initialDocumentScale,n),t.currentZoom/this._initialDocumentScale},a.finalizeRelativeScale=function(e,t){void 0===t&&(t=!1);var n=e*this._initialDocumentScale;this.getZoomManager().setZoom(n,!1);var i={};i.initialScale=this._initialDocumentScale,i.finalScale=n,i.cancelled=t,r.ULS.sendTraceTag(42821150,353,50,"Pinch zoom ended: {0}",i)},a.getPinchCenterRelativeToContainer=function(e){var t=e.gestureData.center;return t&&this._containerBounds?Object.assign(new Te,{x:t.x-this._containerBounds.x,y:t.y-this._containerBounds.y}):null},a.calculateNextUiControlUpdateTime=function(){var e=(new Date).getTime();return new Date(e+1e3)},t=e,(n=[{key:"scrollContainer",get:function(){return this._scrollContainer}},{key:"scrollable",get:function(){return this._scrollable}}])&&ke(t.prototype,n),i&&ke(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(we,"PinchZoomAdapter",null,[215]);var Pe=function(){function e(e){this._element=e}var t,n,i;return e.prototype.getBounds=function(){return Sys.UI.DomElement.getBounds(this._element)},t=e,(n=[{key:"scrollWidth",get:function(){return this._element.scrollWidth}},{key:"scrollHeight",get:function(){return this._element.scrollHeight}}])&&Ie(t.prototype,n),i&&Ie(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Pe,"ScrollContainerElement",null,[214]);var Fe=n(68);function Ee(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oe(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Me=function(){function e(e,t,n,i,r,a){this._gestureInputManager=null,this._stopwatchForRegister=null,this._container=e,this._stopwatchBuilder=t,this._isMultiTouchGestureEnabled=n,this._isPinchZoomEnabled=i,this._isPinchZoomOnlyPointerEventsEnabled=r,this._hammerJsPerformanceTimersIsEnabled=a,this._containerElements=new te.a}var t=e.prototype;return t.register=function(e,t){var n=this;this._isMultiTouchGestureEnabled&&(4===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.OneNoteOnline.OneNoteDelayLoadHammerJs",!1)?Fe.a.get_instance().executeWhen(8,(function(){n.resolveGestureInputManager(e,t)})):this.resolveGestureInputManager(e,t))},t.resolveGestureInputManager=function(e,t){var n=this;this._container.resolveFuture("Common.IGestureInputManager").execute((function(i){if(n.startRegisterTimer(),n._gestureInputManager=i,n._containerElements.add(e),n._isPinchZoomEnabled){if(n._isPinchZoomOnlyPointerEventsEnabled&&0!==i.getGestureBrowserEvents())return void n.stopRegisterTimer();var r=n._container.resolveFuture("Common.IZoomManager"),a=(n._container.resolve("Common.IAppSettingsManager"),new Pe(e)),o=s.AFrameworkApplication.theActionManager,l=s.AFrameworkApplication.appSettingsManager,c=new we(r,a,t,o,l);i.registerGestureAdapter(0,e,c)}n.stopRegisterTimer()}))},t.unregister=function(){if(this._gestureInputManager&&this._containerElements){if(this._isPinchZoomEnabled){for(var e,t=Ee(this._containerElements);!(e=t()).done;){var n=e.value;this._gestureInputManager.unregisterGestureAdapter(0,n)}this._containerElements.clear()}this._gestureInputManager=null}},t.startRegisterTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchBuilder?this._stopwatchForRegister=this._stopwatchBuilder.makeAndStartStopwatch("Task","Register"):r.ULS.sendTraceTag(590387076,310,10,"_stopwatchBuilder is null"))},t.stopRegisterTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchForRegister?this._stopwatchForRegister.stop():r.ULS.sendTraceTag(590387077,310,10,"_stopwatchForRegister is null"))},e}();function Le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Me,"GestureInputRegistrar",null,[176]);var Re=function(){function e(){this._container=null,this._isInitialized=!1}var t,n,i,r=e.prototype;return r.init=function(){this._isInitialized||(this._container.resolve("Common.IGestureInputRegistrar"),this._isInitialized=!0)},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(176,"Common.IGestureInputRegistrar").singleInstance().usingFactory((function(){return new Me(e,s.AFrameworkApplication.activeFrame.theStopwatchBuilder,s.AFrameworkApplication.isMultiTouchGestureEnabled(),s.AFrameworkApplication.isPinchToZoomEnabled(),!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PinchZoomOnlyPointerEventsIsEnabled"),!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HammerJsPerformanceTimersIsEnabled"))}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.GestureInput"}}])&&Le(t.prototype,n),i&&Le(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Re,"GestureInputPackage",null,[2,3]);var De=n(255),xe=n(112),Be=n(19),Ue=function(){this.gestureAdapter=null,this.recognizer=null};function He(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ue,"GestureAdapterInfo",null,[]);var Ne=function(){function e(){this._dependenciesTask=null}var t,n,i;return e.prototype.loadDependenciesAsync=function(){if(!this._dependenciesTask){var e="hammer.min.js";s.AFrameworkApplication.appSettingsManager.containsAppSetting("IsServerFlavorDebug")&&(e=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsServerFlavorDebug")?"hammer.js":"hammer.min.js");var t=s.AFrameworkApplication.scriptUrlFromName(String.format("{0}",e),5),n=oe.a.create(t,null,null);ae.a.enqueueResourceWithoutEnabling(n),this._dependenciesTask=n.loadFinishedTask}return this._dependenciesTask},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&He(t.prototype,n),i&&He(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Ne._instance=null,Object(i.a)(Ne,"HammerJsDependencyLoader",null,[217]);var We,je=function(e,t,n){if(void 0===n&&(n=null),null==t)throw r.ULS.sendTraceTag(42256258,310,10,"manager cannot be null"),Error.argumentNull("manager can not be null");var i=null;switch(e){case m.a.pinch:i=new Hammer.Pinch(n);break;case m.a.pan:i=new Hammer.Pan(n)}return i&&(i.manager=t),i};!function(e){e[e.none=-1]="none",e[e.pinch=0]="pinch",e[e.pan=1]="pan",e[e.swipe=2]="swipe"}(We||(We={})),Object(i.b)("GestureEvent",We);var Ve=n(42);function qe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ge(e,t){return(Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Ke=function(e){var t,n,i,r,a;function o(t,n,i,r,a,o,s,l,c){var u;return(u=e.call(this,t,i,r,o)||this)._clientPoint=n,u._shiftKey=s,u._ctrlKey=l,u._isPointerEvent=c,u._gestureData=a,u}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ge(t,n),o.create=function(e,t,n,i,r,a){var s;if(n.rawEvent)if(a){var l=n.rawEvent;s=new Sys.UI.Point(l.clientX,l.clientY)}else s=Ve.a.getClientPointFromTouchEvent(n);else s=new Sys.UI.Point(n.clientX,n.clientY);return new o(e,s,t,n,i,r,n.shiftKey,n.ctrlKey,a)},i=o,(r=[{key:"shiftKey",get:function(){return this._shiftKey}},{key:"ctrlKey",get:function(){return this._ctrlKey}},{key:"clientPoint",get:function(){return this._clientPoint}},{key:"gestureData",get:function(){return this._gestureData}},{key:"isPointerEvent",get:function(){return this._isPointerEvent}}])&&qe(i.prototype,r),a&&qe(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(Ve.a);Object(i.a)(Ke,"GestureEventArgs",Ve.a,[]);var ze=function(){this.pointers=null,this.changedPointers=null,this.pointerType=null,this.srcEvent=null,this.overallVelocityX=0,this.overallVelocityY=0,this.overallVelocity=0,this.distance=0,this.angle=0,this.scale=0,this.rotation=0,this.maxPointers=0,this.target=null,this.center=null,this.additionalEvent=null,this.isFirst=!1,this.isFinal=!1,this.eventType=0,this.deltaX=0,this.deltaY=0,this.timeStamp=0,this.deltaTime=0,this.offsetDirection=null};Object(i.a)(ze,"GestureManagerData",null,[]);var Xe=function(){};Xe.STATE_POSSIBLE=1,Xe.STATE_BEGAN=2,Xe.STATE_CHANGED=4,Xe.STATE_ENDED=8,Xe.STATE_RECOGNIZED=8,Xe.STATE_CANCELLED=16,Xe.STATE_FAILED=32,Object(i.a)(Xe,"HammerConstants",null,[]);var Je=n(57),Qe=n(119),Ze=n(7),Ye=n(103);function $e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return et(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e,t){return(nt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var it=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this)._inputDataName=De.a.gestureAdapterCache,i._pointerEventsEnabled=!!window.PointerEvent,i._touchEventsEnabled=window.hasOwnProperty("ontouchstart"),i._onGestureEvent=null,i._gestureEvents=null,i._handled=!1,i._pointerEventsCache=new xe.a,i._pointerTargetCache=new xe.a,i._gestureRegions=new te.a,i._currentGestureTarget=null,i._usePointerCaptureIsEnabled=!1,i._clearCacheOnPrimaryPointerIsEnabled=!1,i._resetHandledBeforeInputHandlerIsEnabled=!1,i._logCoalescedEventsIsEnabled=!1,i._checkExistenceOfGetCoalescedEventsIsEnabled=!1,i._checkIfHammerExistsAfterDownloadIsEnabled=!1,i._hammerJsPerformanceTimersIsEnabled=!1,i._cancelDragFromGestureInputManagerIsEnabled=!1,i._maxCoalescedEvents=-1,i._stopwatchForRegisterGestureAdapterAfterLoad=null,i.session=null,i.handlers=null,i.element=null,i.curRecognizer=null,i.onTouchEvent=function(e,t,n){var r=i.getInputType(e),a=i.getInputDataFromTouchEvents(n,r);return Hammer.inputHandler(tt(i),r,a),i._handled&&n.preventDefault(),i._handled},i.onPointerEvent=function(e,t,n){var a=n.rawEvent.pointerType.toString(),o=n.rawEvent.pointerId.toString();if("touch"!==a)return!1;var s=i.getInputType(e);if(1!==s&&!i._pointerEventsCache.containsKey(o))return!1;if((i._clearCacheOnPrimaryPointerIsEnabled&&1===s&&n.rawEvent.isPrimary&&i._pointerEventsCache.count&&(r.ULS.sendTraceTag(593839564,310,10,"Pointer cache should be empty"),i.cancelPendingPointerEvents()),i._usePointerCaptureIsEnabled?i.addOrReplacePointerInCaches(o,t,n):i._pointerEventsCache.set_item(o,n),i._logCoalescedEventsIsEnabled&&2===s)&&(!i._checkExistenceOfGetCoalescedEventsIsEnabled||i._checkExistenceOfGetCoalescedEventsIsEnabled&&"function"==typeof n.rawEvent.getCoalescedEvents)){var l=n.rawEvent.getCoalescedEvents();l&&i.handlingMultiTouchPointerGesture()&&(i._maxCoalescedEvents=Math.max(i._maxCoalescedEvents,l.length))}i._resetHandledBeforeInputHandlerIsEnabled&&(i._handled=!1);var c=i.getInputDataFromPointerEvents(i._pointerEventsCache,n,a);return Hammer.inputHandler(tt(i),s,c),4!==s&&8!==s||(i._usePointerCaptureIsEnabled?i.removePointerFromCaches(o):i._pointerEventsCache.remove(o),i._pointerEventsCache.count||(i.session=null,i._logCoalescedEventsIsEnabled&&-1!==i._maxCoalescedEvents&&(r.ULS.sendTraceTag(593597138,310,50,"Max number of coalesced events: {0}",i._maxCoalescedEvents),i._maxCoalescedEvents=-1))),i._handled&&n.preventDefault(),i._handled},i.onMouseEvent=function(e,t,n){return!1},i._eventHandlerManager=Je.EventHandlerManager.instance,i._pointerEventsEnabled?(r.ULS.sendTraceTag(593893141,310,50,"Using pointer events"),i._onGestureEvent=i.onPointerEvent,i._gestureEvents=m.a.gesturePointerEvents):i._touchEventsEnabled?(r.ULS.sendTraceTag(593893140,310,50,"Using touch events"),i._onGestureEvent=i.onTouchEvent,i._gestureEvents=m.a.touchEvents):(r.ULS.sendTraceTag(593893139,310,50,"Using mouse events"),i._onGestureEvent=i.onMouseEvent,i._gestureEvents=m.a.gestureMouseEvents),i._stopwatchBuilder=n,i._dragInputManager=t,s.AFrameworkApplication.appSettingsManager&&(i._usePointerCaptureIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UsePointerCaptureIsEnabled"),i._clearCacheOnPrimaryPointerIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ClearCacheOnPrimaryPointerIsEnabled"),i._resetHandledBeforeInputHandlerIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ResetHandledBeforeInputHandlerIsEnabled"),i._logCoalescedEventsIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LogCoalescedEventsIsEnabled"),i._checkExistenceOfGetCoalescedEventsIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CheckExistenceOfGetCoalescedEventsIsEnabled"),i._checkIfHammerExistsAfterDownloadIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CheckIfHammerExistsAfterDownloadIsEnabled"),i._hammerJsPerformanceTimersIsEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HammerJsPerformanceTimersIsEnabled"),i._cancelDragFromGestureInputManagerIsEnabled=i._usePointerCaptureIsEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CancelDragFromGestureInputManagerIsEnabled")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UseGestureInputManagerPointerCacheIsEnabled")),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,nt(t,n);var a=i.prototype;return a.getGestureBrowserEvents=function(){return this._pointerEventsEnabled?0:this._touchEventsEnabled?1:2},a.initializeForElement=function(t){e.prototype.initializeForElement.call(this,t),this._eventHandlerManager.initializeListForElement(this._gestureEvents,t,0,this._onGestureEvent)},a.deinitializeForElement=function(t){e.prototype.deinitializeForElement.call(this,t),this._eventHandlerManager.deinitializeListForElement(t,this._gestureEvents)},a.registerGestureAdapter=function(e,t,n,i,a){var o=this;void 0===i&&(i=null),void 0===a&&(a=null),s.AFrameworkApplication.isMultiTouchGestureEnabled()?Ne.instance.loadDependenciesAsync().continueWith((function(s){if(o.startRegisterGestureAdapterAfterLoadTimer(),s.isFaulted||s.isCanceled)return r.ULS.sendTraceTag(591192778,310,10,"Hammer did not download correctly: {0}",s.status),void o.stopRegisterGestureAdapterAfterLoadTimer();if(r.ULS.sendTraceTag(591192779,310,50,"Hammer download status: {0}",s.status),o._checkIfHammerExistsAfterDownloadIsEnabled){var l=window.Hammer;if(void 0===l)return r.ULS.sendTraceTag(590901389,310,10,"Hammer does not exist"),void o.stopRegisterGestureAdapterAfterLoadTimer();if(void 0===l.inputHandler)return r.ULS.sendTraceTag(590901390,310,10,"Hammer.inputHandler does not exist"),void o.stopRegisterGestureAdapterAfterLoadTimer()}if(!t)throw o.stopRegisterGestureAdapterAfterLoadTimer(),Error.argumentNull("source element can not be null");var c=Qe.a.getObject(t,o._inputDataName);null==c&&(c=new xe.a,Qe.a.setObject(t,o._inputDataName,c),o.registerGestureRegion(t));var u=null;if(c.containsKey(We[e])||(u=Object.assign(new Ue,{recognizer:je(We[e],o,a),gestureAdapter:n}),c.add(We[e],u)),null!=i)for(var d=0;d<i.length;d++)if(c.containsKey(We[i[d]])){var p=c.get_item(We[i[d]]);u.recognizer.recognizeWith(p.recognizer)}else 0;o.stopRegisterGestureAdapterAfterLoadTimer()})):r.ULS.sendTraceTag(42256219,310,10,"Multi Touch is not enabled either from common BRS or from your app BRS")},a.startRegisterGestureAdapterAfterLoadTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchBuilder?this._stopwatchForRegisterGestureAdapterAfterLoad=this._stopwatchBuilder.makeAndStartStopwatch("Task","RegisterGestureAdapterAfterLoad"):r.ULS.sendTraceTag(590387074,310,10,"_stopwatchBuilder is null"))},a.stopRegisterGestureAdapterAfterLoadTimer=function(){this._hammerJsPerformanceTimersIsEnabled&&(this._stopwatchForRegisterGestureAdapterAfterLoad?this._stopwatchForRegisterGestureAdapterAfterLoad.stop():r.ULS.sendTraceTag(590387075,310,10,"_stopwatchForRegisterGestureAdapterAfterLoad is null"))},a.unregisterGestureAdapter=function(e,t){r.ULS.sendTraceTag(42256223,310,t?100:10,"source element {0} ",t.id);var n=Qe.a.getObject(t,this._inputDataName);null!=n&&(n.remove(We[e]),n.count||(Qe.a.removeObject(t,this._inputDataName),this.curRecognizer=null,this.unregisterGestureRegion(t)))},a.registerGestureRegion=function(e){this._gestureRegions.add(e),this._eventHandlerManager.initializeListForElement(this._gestureEvents,e,0,this._onGestureEvent)},a.unregisterGestureRegion=function(e){this._gestureRegions.remove(e),this._eventHandlerManager.deinitializeListForElement(e,this._gestureEvents)},a.recognize=function(e){for(var t=new Array(e.pointers.length),n=0;n<e.pointers.length;n++)t[n]=e.pointers[n].target;var i=null;for(this._currentGestureTarget=this.getLowestCommonAncestor(t);void 0!==this._currentGestureTarget&&null!==this._currentGestureTarget&&null==(i=Qe.a.getObject(this._currentGestureTarget,this._inputDataName));this._currentGestureTarget=this._currentGestureTarget.parentNode);if(null!=i){this.curRecognizer&&this.curRecognizer.state===Xe.STATE_RECOGNIZED&&(this.curRecognizer=null);for(var r,a=$e(i.keys);!(r=a()).done;){var o=r.value,s=i.get_item(o);null!=s&&void 0!==s.recognizer&&null!==s.recognizer&&(void 0===this.curRecognizer||null===this.curRecognizer||s.recognizer===this.curRecognizer||s.recognizer.canRecognizeWith(this.curRecognizer))&&s.recognizer.recognize(e);var l=s.recognizer.state;this.curRecognizer||Xe.STATE_BEGAN!==l&&Xe.STATE_CHANGED!==l&&Xe.STATE_ENDED!==l||(this.curRecognizer=s.recognizer)}}},a.emit=function(e,t){if("hammer.input"!==e){this._handled=!1;var n,i=Ke.create(e,this._currentGestureTarget,t.srcEvent,t,3,this._pointerEventsEnabled),a=Qe.a.getObject(this._currentGestureTarget,this._inputDataName),o=-1;if(this.isPinchEvent(e))o=0;else if(this.isPanEvent(e))o=1;else{if(!this.isSwipeEvent(e))return void r.ULS.sendTraceTag(42256256,310,15,"Event can not be recognized by current manager");o=2}if(null!=(n=a.tryGetValue(We[o]).value)){var s=n.gestureAdapter;s.isGesturePossible(i)?e.endsWith("start")?this._handled=s.onGestureStart(i):e.endsWith("end")?(s.onGestureEnd(i),this._handled=!0):e.endsWith("cancel")?(s.onGestureCancel(i),this._handled=!0):e.endsWith("move")&&(this._handled=s.onGestureEvent(i)):r.ULS.sendTraceTag(42256257,310,50,"App rejected to perform gesture now : {0}",e)}}},a.get=function(e){return Object(F.a)(Hammer.Recognizer,e)},a.getLowestCommonAncestor=function(e){if(e.length<1)return null;if(1===e.length)return e[0];for(var t=e[0],n=!0,i=1;i<e.length;i++){if(!e[i])return null;if(t!==e[i]){n=!1;break}}if(n)return t;for(var r,a=this.getAncestryList(e[0]),o=0,s=$e(e);!(r=s()).done;){var l=r.value,c=this.getAncestryList(l);if(a.get_item(a.count-1)!==c.get_item(c.count-1))return null;for(var u=a.count-2,d=c.count-2;u>=o&&d>=0;u--,d--)if(a.get_item(u)!==c.get_item(d)){o=u+1;break}}return a.get_item(o)},a.getAncestryList=function(e){for(var t=new te.a;null!=e;e=e.parentNode)t.add(e);return t},a.getInputType=function(e){switch(e){case m.a.touchStart:case m.a.browserPointerDown:return 1;case m.a.touchMove:case m.a.browserPointerMove:return 2;case m.a.touchEnd:case m.a.browserPointerUp:return 4;case m.a.touchCancel:case m.a.browserPointerCancel:return 8}return 0},a.handlingMultiTouchPointerGesture=function(){return this._pointerEventsCache.count>1},a.cancelPendingPointerEvents=function(){if(r.ULS.sendTraceTag(594055960,310,50,"CancelPendingPointerEvents"),this._usePointerCaptureIsEnabled)for(var e,t=$e(this._pointerEventsCache);!(e=t()).done;){var n=e.value;this.removePointerFromCaches(n.key)}else this._pointerEventsCache=new xe.a;this.session=null},a.addOrReplacePointerInCaches=function(e,t,n){if(r.ULS.sendTraceTag(594055959,310,50,"AddOrReplacePointerInCaches: pointerId: {0}",e),!this._pointerTargetCache.containsKey(e)){try{t.setPointerCapture(e)}catch(e){r.ULS.sendTraceTag(594055958,310,10,"Exception: {0}",e)}this._pointerTargetCache.add(e,t)}this._pointerEventsCache.set_item(e,n),this._cancelDragFromGestureInputManagerIsEnabled&&this._pointerEventsCache.count>1&&this._dragInputManager&&!this._dragInputManager.cancelDragForMultiTouchPointerGesture&&(this._dragInputManager.cancelDragForMultiTouchPointerGesture=!0)},a.removePointerFromCaches=function(e){if(r.ULS.sendTraceTag(594055957,310,50,"RemovePointerFromCaches: pointerId: {0}",e),this._pointerTargetCache.containsKey(e)){try{this._pointerTargetCache.get_item(e).releasePointerCapture(e)}catch(e){r.ULS.sendTraceTag(594055956,310,10,"Exception: {0}",e)}this._pointerTargetCache.remove(e)}else r.ULS.sendTraceTag(594055955,310,10,"RemovePointerFromCaches: pointerId should be in cache: {0}",e);this._pointerEventsCache.remove(e),this._cancelDragFromGestureInputManagerIsEnabled&&this._pointerEventsCache.count<=1&&this._dragInputManager&&this._dragInputManager.cancelDragForMultiTouchPointerGesture&&(this._dragInputManager.cancelDragForMultiTouchPointerGesture=!1)},a.getInputDataFromTouchEvents=function(e,t){var n=new ze,i=e.rawEvent,r=i.touches,a=i.changedTouches;n.pointers=Array.clone(r);var o=r.length>0?r:a;return n.pointers=Array.clone(o),n.changedPointers=Array.clone(a),n.srcEvent=e,n.pointerType="touch",n},a.getInputDataFromPointerEvents=function(e,t,n){var i=new ze;e.keys;return i.pointers=Ye.toArray(e.values),i.changedPointers=[t],i.pointerType=n,i.srcEvent=t,i},a.isPinchEvent=function(e){return Ze.a.startsWith(e,m.a.pinch)},a.isPanEvent=function(e){return Ze.a.startsWith(e,m.a.pan)},a.isSwipeEvent=function(e){return Ze.a.startsWith(e,m.a.swipe)},i}(Be.a);Object(i.a)(it,"GestureInputManager",Be.a,[197,198]);var rt=n(187);function at(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ot=function(){function e(){this._container=null,this._isInitialized=!1}var t,n,i,r=e.prototype;return r.configure=function(e){e.register(it,"Common.App.GestureManager.GestureInputManager").as("Common.IGestureInputManager").singleInstance().usingFactory((function(){return new it(rt.a.instance,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})),this._container=e},r.init=function(){this._isInitialized||(this._container.resolve("Common.App.GestureManager.GestureInputManager"),this._isInitialized=!0)},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.GestureInputManager"}}])&&at(t.prototype,n),i&&at(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(ot,"GestureInputManagerPackage",null,[2,3]);var st=function(e,t,n,i,r,a){this.IsSafeLinksEnabled=null,this.WebAffinitizedUrl=null,this.PolicyCookie=null,this.PolicyCookieTTL=0,this.WasServiceDown=!1,this.AffinitizedUrl=null,this.IsSafeLinksEnabled=e,this.WebAffinitizedUrl=t,this.PolicyCookie=n,this.PolicyCookieTTL=i,this.WasServiceDown=r,this.AffinitizedUrl=a};Object(i.a)(st,"SafeLinksData",null,[]);var lt=function(e,t){this.targetUrl=e,this.stopwatch=t};Object(i.a)(lt,"SafeLinksGetUrlReputationRequestData",null,[]);var ct,ut=n(16),dt=function(){function e(t,n,i,r){var a=this;this.onGetUrlReputationSuccessCallback=function(e){var t="OnGetUrlReputationSuccessCallback: ",n=10,i=e.data.state;try{var r=H.b(e.data.responseData).reputationResults[0],o=r.navigateUrl.length,s=i.targetUrl.length,l=r.navigateUrl===i.targetUrl;r.navigateUrl&&r.navigateUrl.length>0&&(i.targetUrl=r.navigateUrl),t+=String.format("HttpStatus {0}, verdict {1}, clickedUrlLength = {2} navigateUrlLength {3}, navigateUrlSameAsClickedUrl {4}",e.data.httpStatus,r.verdict,s.toString(),o.toString(),l.toString()),n=50}catch(e){t+=String.format("Exception {0}",e.message)}a.handleGetUrlReputationCompletion(i,t,n)},this.onGetUrlReputationFailureCallback=function(e){var t="OnGetUrlReputationFailureCallback: ",n=e.data.state;try{t+=String.format("HttpStatus {0}",e.data.httpStatus)}catch(e){t+=String.format("Exception {0}",e.message)}a.handleGetUrlReputationCompletion(n,t,10)},this._appSettingsManager=t,this._clientRequestManager=n,this._getUrlReputationHandlerUrl=i,e._stopwatchBuilder=r}var t=e.prototype;return t.tryNavigate=function(t,n,i){try{var a=null;e._stopwatchBuilder&&(a=e._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","SafeLinksGetUrlReputation"));var o=new lt(n,a),s={};s.AffinitizedUrl=t,s.TargetUrl=n,s.PolicyCookie=i;var l=H.c(s);return this._clientRequestManager.addRequest(this._getUrlReputationHandlerUrl,2,l,null,!1,2,this.onGetUrlReputationSuccessCallback,this.onGetUrlReputationFailureCallback,o,void 0,void 0,3e3,3e3,"36"),!0}catch(e){r.ULS.sendTraceTag(588788033,378,10,e.message)}return!1},t.handleGetUrlReputationCompletion=function(e,t,n){e.stopwatch&&(e.stopwatch.stop(),e.stopwatch=null),r.ULS.sendTraceTag(588788034,378,n,t),ut.a.safelyOpenWindow(e.targetUrl,void 0,"noopener,noreferrer","SafeLinksNav")},e}();dt._stopwatchBuilder=null,Object(i.a)(dt,"SafeLinksNavigationHelper",null,[]),function(e){e[e.enabledByPolicy=0]="enabledByPolicy",e[e.disabledByPolicy=1]="disabledByPolicy",e[e.disabled_GetPolicyFailure=2]="disabled_GetPolicyFailure",e[e.disabled_PendingGetPolicyRequest=3]="disabled_PendingGetPolicyRequest"}(ct||(ct={})),Object(i.b)("SafeLinksNavigationState",ct);var pt=n(617);function ht(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var gt=function(){function e(t,n,i,a,o,s){var c=this;if(void 0===a&&(a=!1),void 0===o&&(o=null),void 0===s&&(s=null),this._getPolicyOnBootRetries=0,this._getPolicyOnLinkClickRetries=0,this._getPolicyRequestPending=!1,this.isGetPolicyBootRequest=!1,this._pendingUrlToFollow=null,this._isUserLicensedForSafeLinks=!0,this._sessionCacheSafeLinksData=null,this.getSafeLinksDataFromServer_OnSuccessCallback=function(t){var n=M.a.notAcceptable_406,i="";try{var a;c.isGetPolicyBootRequest=!1,c._getPolicyRequestPending=!1;var o=t.data.state,s=(a=c.stopAndGetDurationInMsFromStopwatch(o),o=a.stopwatch,a).returnValue,u=Object.assign(new Z.a,{durationMs:s});if(l.Health.instance.recordKpiSuccess("SafeLinksGetPolicySuccessfulRequest",u),r.ULS.sendTraceTag(594830614,378,50,"GetSafeLinksDataFromServer_OnSuccessCallback: HttpStatus {0}, data length {1}, Duration {2}",t.data.httpStatus,t.data.responseData.length,s),t.data.httpStatus!==M.a.OK_200)return void(i="Unexpected httpStatus: "+t.data.httpStatus.toString());var d=null;try{d=H.b(t.data.responseData)}catch(e){return void(i="Exception:"+e.toString()+" deserializing response")}if(!d)return void(i="Error when serializing response into SafeLinksData. SafeLinksData is null.");var p=d.IsSafeLinksEnabled;if(null==p||p.length<=0)return void(i="Invalid isSafeLinksEnabledString");r.ULS.sendTraceTag(594830613,378,50,"Retrieved isSafeLinksEnabledString {0}",p);var h=e.parseSafeLinksEnabledForUser(p);if(void 0===d.WebAffinitizedUrl||null===d.WebAffinitizedUrl||d.WebAffinitizedUrl.length<=0)return void(i="Invalid WebAffinitizedUrl");if(void 0===d.PolicyCookie||null===d.PolicyCookie||d.PolicyCookie.length<=0)return void(i="Invalid PolicyCookie");if(void 0===d.PolicyCookieTTL||null===d.PolicyCookieTTL)return void(i="Invalid PolicyCookieTTL");var g=d.WebAffinitizedUrl,m=d.PolicyCookie,f=d.AffinitizedUrl,v=new Date,_=d.PolicyCookieTTL>5?d.PolicyCookieTTL-5:0;v.setMinutes(v.getMinutes()+_);var y=v.getTime(),S=new st(p,g,m,y,!1,f);c.setCachedData(S),n=t.data.httpStatus,c._pendingUrlToFollow&&(h?(c.tryNavigateInternal(c._pendingUrlToFollow),c._getPolicyOnBootRetries=0,c._getPolicyOnLinkClickRetries=0):(r.ULS.sendTraceTag(26019602,378,50,"SafeLinks is disabled by admin; Navigating without SafeLinks"),l.Health.instance.recordKpiFailure("SafeLinksNavigations","disabledByPolicy",!0,!0,null),ut.a.followHyperlinkWithNoReferrer(c._pendingUrlToFollow)),c._pendingUrlToFollow=null)}catch(e){i="GetSafeLinksDataFromServer_OnSuccessCallback: Exception:  "+e.toString()}finally{n!==M.a.OK_200&&c.handleGetPolicyRequestError(n,i)}},this.getSafeLinksDataFromServer_OnFailureCallback=function(e){c._getPolicyRequestPending=!1;var t=500,n="";try{var i,r=e.data.state,a=(i=c.stopAndGetDurationInMsFromStopwatch(r),r=i.stopwatch,i).returnValue,o=Object.assign(new Z.a,{durationMs:a});t=e.data.httpStatus,l.Health.instance.recordKpiFailure("SafeLinksGetPolicyFailedRequest","HttpStatusCode_"+t.toString(),!1,!0,o),n="Request Failed, Status="+pt.a[e.data.status]+" Duration: "+a}catch(e){n="GetSafeLinksDataFromServer_OnFailureCallback Exception: "+e.toString()}finally{c.handleGetPolicyRequestError(t,n)}},r.ULS.sendTraceTag(26019598,378,100,"Initializing SafeLinksManager."),this._appSettingsManager=t,this._clientRequestManager=n,this._appName=i,e._stopwatchBuilder=s,this._webServiceBaseUrl=a?this._appSettingsManager.getStringAppSetting("SafeLinksHandlerWebServiceBase"):this._appSettingsManager.getStringAppSetting("WebServiceBase"),this._userId=this._appSettingsManager.getStringAppSetting("SafeLinksHashedUserId"),this.workloadId=this._appSettingsManager.getStringAppSetting("SafeLinksWorkloadIdHeaderValue"),this._maxGetPolicyBootRetries=this._appSettingsManager.getIntAppSetting("SafeLinksMaxGetPolicyBootRetries",2),this._maxGetPolicyOnLinkClickRetries=this._appSettingsManager.getIntAppSetting("SafeLinksMaxGetPolicyOnLinkClickRetries",1),this._isEnabledForUser=this.isSafeLinksEnabledForUser(),this._isEnabledForBrowser=this.isSafeLinksEnabledForBrowser(),e._userPrincipalName=this._appSettingsManager.getStringAppSetting("UserPrincipalName")||"",e._tenantId=this._appSettingsManager.getStringAppSetting("TenantId")||"",r.ULS.sendTraceTag(26019599,378,50,"SafeLinksManager _isEnabledForUser={0}, _isEnabledForBrowser={1}",this._isEnabledForUser,this._isEnabledForBrowser),this._isEnabledForUser&&this._isEnabledForBrowser){var u=this.getCachedData(),d=u?u.IsSafeLinksEnabled.toLowerCase():"",p=this.isPolicyCookieExpired();r.ULS.sendTraceTag(36231312,378,50,"Cached values for IsSafeLinksEnabled: {0}, IsPolicyCookieExpired: {1}.",d,p);var h=!u||"unknown"===d||u.WasServiceDown||p,g=G.a.createExtendedPropertiesMap();g&&(g.set("shouldGetSafeLinksDataFromServer",h.toString()),g.set("isSafeLinksEnabledCacheValue",d.toString())),o?(this._isUserLicensedForSafeLinks=!1,o.execute((function(e){e.isFeatureEnabled("MsoUrlreputation",!0).then((function(e){return c._isUserLicensedForSafeLinks=e,g.set("isUserLicensedForSafeLinks",c._isUserLicensedForSafeLinks.toString()),l.Health.instance.recordKpiUsage("SafeLinksGetPolicy1",0,"jpittsdirects",g),c._isUserLicensedForSafeLinks&&h&&c.getSafeLinksDataFromServerAsync(!0),null}))}))):(l.Health.instance.recordKpiUsage("SafeLinksGetPolicy1",0,"jpittsdirects",g),h&&this.getSafeLinksDataFromServerAsync(!0))}}var t,n,i,a=e.prototype;return a.tryNavigate=function(e){var t;if(!e)return r.ULS.sendTraceTag(593367827,378,10,"SafeLinksManager.TryNavigate: Null/Empty targetUrl"),!1;var n=this.isHyperLinkTypeSupportedBySafeLinks(e);if(r.ULS.sendTraceTag(594830615,378,50,"SafeLinksManager.TryNavigate: isSupportedHyperLinkType={0},_isEnabledForUser={1},_isEnabledForBrowser={2},_isUserLicensedForSafeLinks={3}",n,this._isEnabledForUser,this._isEnabledForBrowser,this._isUserLicensedForSafeLinks),!(n&&this._isEnabledForUser&&this._isEnabledForBrowser&&this._isUserLicensedForSafeLinks))return!1;var i,a=(t=this.shouldTryUsingSafeLinksService(),i=t.state,t).returnValue;r.ULS.sendTraceTag(595079385,378,50,"ShouldTryUsingSafeLinksService returned NavigationState={0}",ct[i]);var o=G.a.createExtendedPropertiesMap();return o&&o.set("SafeLinksNavigationState",ct[i]),l.Health.instance.recordKpiUsage("SafeLinksNavigations",0,"jpittsdirects",o),a?(r.ULS.sendTraceTag(26019601,378,50,"Using safelinks to navigate hyperlink"),this.shouldUseNavigationHelper()?!this.isPolicyCookieExpired()&&this.navigationHelper.tryNavigate(this.getAffinitizedUrlFromCache(),e,this.getPolicyCookieFromCache()):this.isPolicyCookieExpired()?(this._pendingUrlToFollow=e,r.ULS.sendTraceTag(24462627,378,50,"Refreshing the cache as policy cookie expired."),this.isGetPolicyBootRequest=!1,this.getSafeLinksDataFromServerAsync(),!0):(this.tryNavigateInternal(e),!0)):(2!==i&&3!==i||l.Health.instance.recordKpiFailure("SafeLinksNavigations",ct[i],!1,!0,null),!1)},a.isHyperLinkTypeSupportedBySafeLinks=function(e){e=e.toLowerCase();var t=this._appSettingsManager.getListAppSetting("SafeLinksUnsupportedProtocols");if(t)for(var n=0;n<t.length;n++)if(e.startsWith(t[n]))return!1;return!0},a.getSafeLinksDataFromServerAsync=function(e){void 0===e&&(e=!1);var t=G.a.createExtendedPropertiesMap();t&&t.set("isOnBootRequest",e.toString()),l.Health.instance.recordKpiUsage("SafeLinksGetPolicySuccessfulRequest",1,"jpittsdirects",t),l.Health.instance.recordKpiUsage("SafeLinksGetPolicyFailedRequest",0,"jpittsdirects",t);var n=this.createAndStartStopwatch("SafeLinksGetPolicy");this._clientRequestManager.addRequest(this.getPolicyHandlerUrl,1,null,null,!0,2,this.getSafeLinksDataFromServer_OnSuccessCallback,this.getSafeLinksDataFromServer_OnFailureCallback,n,void 0,void 0,void 0,void 0,"23"),this.isGetPolicyBootRequest=e,this._getPolicyRequestPending=!0,e?this._getPolicyOnBootRetries++:this._getPolicyOnLinkClickRetries++},a.handleGetPolicyRequestError=function(e,t){void 0===t&&(t="");try{if(r.ULS.sendTraceTag(594830612,378,10,"HandleGetPolicyRequestError: HttpStatus {0}, Error {1}",e,t),this._getPolicyOnBootRetries<this._maxGetPolicyBootRetries&&this._getPolicyOnLinkClickRetries<this._maxGetPolicyOnLinkClickRetries)this.getSafeLinksDataFromServerAsync(this.isGetPolicyBootRequest);else{this.isGetPolicyBootRequest=!1,r.ULS.sendTraceTag(24462656,378,10,"Exhausted all retries for SafeLinks GetPolicy call. OnBootRetries: {0}, OnClickRetries: {1}, HttpStatus: {2}, Error: {3}",this._getPolicyOnBootRetries,this._getPolicyOnLinkClickRetries,e,t);var n=null,i=G.a.createExtendedPropertiesMap();i&&(i.set("HttpStatus",e.toString()),n=Object.assign(new Z.a,{extendedProperties:i})),l.Health.instance.recordKpiFailure("SafeLinksGetPolicy1","GetPolicyRequestError",!1,!0,n);var a=new st("false","","",0,!0,"");this.setCachedData(a),this._pendingUrlToFollow&&(r.ULS.sendTraceTag(26019603,378,50,"Error occurred during at-click GetPolicy call, NavigationState = {0}","disabled_GetPolicyFailure"),l.Health.instance.recordKpiFailure("SafeLinksNavigations","disabled_GetPolicyFailure",!1,!0,null),ut.a.followHyperlinkWithNoReferrer(this._pendingUrlToFollow),this._pendingUrlToFollow=null)}}catch(e){r.ULS.sendTraceTag(594830611,378,10,"HandleGetPolicyRequestError: Exception {0}",e.toString())}},a.tryNavigateInternal=function(t){var n=this.getPolicyCookieFromCache(),i=this.getWebAffinitizedUrlFromCache(),a={};a.Url=t,a.SafeLinksCookie=n,a.CorrelationId=J.a.create().toString(),a.WorkloadId=this.workloadId,a.UserAgentInfo=z.a.browserNameForlogging+"|"+this.appName,this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksParamUpdates",!1)&&(a.User=e._userPrincipalName,a.TenantId=e._tenantId,a.AdditionalProperties=this.getUrlReputationAdditionalProperties),r.ULS.sendTraceTag(23900187,378,50,"Validating hyperlink with request correlation: {0}",a.CorrelationId),ut.a.postToWindow(ut.a.windowTargetToString(4),i,a)},a.isSafeLinksEnabledForUser=function(){var t=this._appSettingsManager.getStringAppSetting("IsSafeLinksEnabledForUser");return!!t&&e.parseSafeLinksEnabledForUser(t)},a.isSafeLinksEnabledForBrowser=function(){var e=this._appSettingsManager.getListAppSetting("SafeLinksDisabledBrowsers");if(z.a.isElectron){if(this._appSettingsManager.containsAppSetting("SafeLinksForTeamsIsEnabled")&&this._appSettingsManager.getBooleanAppSetting("SafeLinksForTeamsIsEnabled"))return!0;if(Array.contains(e,"Electron"))return!1}else if(Array.contains(e,z.a.browserNameForlogging))return!1;return"officecomhwa"!==(this._appSettingsManager.getStringAppSetting(s.AFrameworkApplication.uiHostSettingName)||"").toLowerCase()},a.shouldUseNavigationHelper=function(){return!(-1===window.location.href.indexOf("&wd_slnh=1"))||(!(!this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksUseNavigationHelperForMobile",!1)||!z.a.isMobileBrowser)||(z.a.isElectron||z.a.isWebview2))},a.shouldTryUsingSafeLinksService=function(){var t;t=0;var n=this.getCachedData(),i=n?n.IsSafeLinksEnabled:"";if(""!==i)return n.WasServiceDown?(r.ULS.sendTraceTag(51663971,378,50,"Failed to retrieve policy data"),{returnValue:!1,state:t=2}):"false"===i.toLowerCase()?(r.ULS.sendTraceTag(51664e3,378,50,"SafeLinks disabled for the user"),{returnValue:!1,state:t=1}):{returnValue:e.parseSafeLinksEnabledForUser(i),state:t};if(this._getPolicyRequestPending)return t=3,r.ULS.sendTraceTag(595079384,378,50,"Currently getting SafeLinks policy"),{returnValue:!1,state:t};if(this._getPolicyOnBootRetries>=this._maxGetPolicyBootRetries||this._getPolicyOnLinkClickRetries>=this._maxGetPolicyOnLinkClickRetries)return t=2,r.ULS.sendTraceTag(51664001,378,50,"Exhausted all retries- Failure in GetPolicy for SafeLinks ({0}/{1} boot, {2}/{3} onClick)",this._getPolicyOnBootRetries,this._maxGetPolicyBootRetries,this._getPolicyOnLinkClickRetries,this._maxGetPolicyOnLinkClickRetries),{returnValue:!1,state:t};var a=this._getPolicyOnBootRetries+this._getPolicyOnLinkClickRetries;return r.ULS.sendTraceTag(23900182,378,10,"Inconsistent SafeLinks state: SafeLinks cache data is null with no on boot request pending, and {0} retries left over. Perhaps LocalStorage is inaccessable.",this._maxGetPolicyBootRetries+this._maxGetPolicyOnLinkClickRetries-a),{returnValue:!0,state:t}},a.getPolicyCookieFromCache=function(){var e=this.getCachedData();return e?e.PolicyCookie:""},a.getWebAffinitizedUrlFromCache=function(){var e=this.getCachedData();return e?e.WebAffinitizedUrl:""},a.getAffinitizedUrlFromCache=function(){var e=this.getCachedData();return e?e.AffinitizedUrl:""},a.getExpirationTimeFromCache=function(){var e=new Date;try{var t=this.getCachedData(),n=t?t.PolicyCookieTTL:0;e.setTime(n)}catch(e){r.ULS.sendTraceTag(24462658,378,10,"Exception occured while fetching expiration time from cache: {0}",e)}return e},a.isPolicyCookieExpired=function(){var e=this.getExpirationTimeFromCache();return!!e&&e.getTime()<Date.now()},a.getCachedData=function(){if(!this._sessionCacheSafeLinksData){var e=re.instance.getItem(this.userId);if(!e||""===e)return null;this._sessionCacheSafeLinksData=JSON.parse(e)}return this._sessionCacheSafeLinksData},a.setCachedData=function(e){if(null==e)throw Error.argumentNull("safeLinksData");if(void 0===e.IsSafeLinksEnabled||null===e.IsSafeLinksEnabled||e.IsSafeLinksEnabled.length<=0)throw Error.argumentNull("safeLinksData.IsSafeLinksEnabled");this._sessionCacheSafeLinksData=e,e.WasServiceDown||this.writeValuesToLocalStorage(e)},a.writeValuesToLocalStorage=function(e){var t=JSON.stringify(e);re.instance.setItem(this.userId,t)},a.createAndStartStopwatch=function(t){return void 0!==e._stopwatchBuilder&&null!==e._stopwatchBuilder?e._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall",t):null},a.stopAndGetDurationInMsFromStopwatch=function(e){if(null!=e){var t=e.ageInMilliseconds;return e.stop(),{returnValue:t,stopwatch:e=null}}return{returnValue:null,stopwatch:e}},e.parseSafeLinksEnabledForUser=function(e){return"false"!==e.toLowerCase()},t=e,(n=[{key:"appName",get:function(){return this._appName}},{key:"webServiceBaseUrl",get:function(){return this._webServiceBaseUrl}},{key:"userId",get:function(){return this._userId}},{key:"getUrlReputationAdditionalProperties",get:function(){try{if(""===e._getUrlReputationAdditionalProperties){var t={};t["X-AppName"]=this.appName,t["X-AppVersion"]=s.AFrameworkApplication.buildVersion,t.OS=this._appSettingsManager.getStringAppSetting("PlatformNameAndVersion")||"";var n=JSON.stringify(t);e._getUrlReputationAdditionalProperties=window.self.btoa(n)}}catch(e){r.ULS.sendTraceTag(508909765,378,10,"GetUrlReputationAdditionalProperties Error: {0}",e.message)}return e._getUrlReputationAdditionalProperties}},{key:"getPolicyHandlerUrl",get:function(){var e=this.webServiceBaseUrl?this.webServiceBaseUrl+"/":"",t=new K.QueryStringBuilder("SafeLinksHandler.ashx");return t.addParam("app",this.appName),this._appSettingsManager.getBooleanAppSetting("SafeLinksUseDebugHeader")&&t.addParam("action","debug"),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksS2SAuthAATPOP",!1)&&t.addParam("s2satpop","1"),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksS2SAuthUseE03App",!1)&&t.addParam("s2se03","1"),String.format("{0}{1}&{2}",e,t.toString(),s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)}},{key:"getUrlReputationHandlerUrl",get:function(){var e=this.webServiceBaseUrl?this.webServiceBaseUrl+"/":"",t=new K.QueryStringBuilder("SafeLinksHandler.ashx");return t.addParam("app",this.appName),this._appSettingsManager.getBooleanAppSetting("SafeLinksUseDebugHeader")&&t.addParam("action","debug"),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksS2SAuthAATPOP",!1)&&t.addParam("s2satpop","1"),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksS2SAuthAAT",!1)&&t.addParam("s2saat","1"),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksS2SAuthUseE03App",!1)&&t.addParam("s2se03","1"),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksParamUpdates",!1)&&t.addParam("sladpar",this.getUrlReputationAdditionalProperties),t.addParam("slrt","GetUrlReputation"),String.format("{0}{1}&{2}",e,t.toString(),s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion)}},{key:"navigationHelper",get:function(){return e._safeLinksNavigationHelper||(e._safeLinksNavigationHelper=new dt(this._appSettingsManager,this._clientRequestManager,this.getUrlReputationHandlerUrl,e._stopwatchBuilder)),e._safeLinksNavigationHelper}}])&&ht(t.prototype,n),i&&ht(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();gt._stopwatchBuilder=null,gt._safeLinksNavigationHelper=null,gt._tenantId="",gt._userPrincipalName="",gt._getUrlReputationAdditionalProperties="",Object(i.a)(gt,"SafeLinksManager",null,[195]);function mt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ft=function(){function e(){var e=this;this._container=null,this.onFullAppSettingsReady=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WACSafeLinksIsEnabled")&&(e._container.register(gt,"Common.App.SafeLinks.SafeLinksManager").as("Common.App.SafeLinks.ISafeLinksManager").singleInstance().usingFactory((function(){return new gt(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,String.format("{0}-{1}",function(e){switch(e){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 4:return"OneNote";case 5:return"Visio";default:return"Unknown"}}(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType),function(e){switch(e){case 1:return"Edit";case 2:return"View";case 3:return"InstantView";default:return"Unknown"}}(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppMode)),!1,e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})),e._container.tryResolve("Common.App.SafeLinks.ISafeLinksManager"))}}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e},r.init=function(){s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(this.onFullAppSettingsReady)},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SafeLinks"}}])&&mt(t.prototype,n),i&&mt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(ft,"SafeLinksPackage",null,[2,3]);var vt=n(43),_t=n(267);function yt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function St(e,t){return(St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var bt=function(e){var t,n;function i(t){return e.call(this,t)||this}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,St(t,n);var r,a,o,s=i.prototype;return s.createElement=function(){var e=document.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",this.resourceUrl),e},s.createHighPriorityResourceElement=function(){return null},s.reloadReference=function(){this.element.setAttribute("href",""),this.element.setAttribute("href",this.retryBehavior.resourceUrl)},r=i,(a=[{key:"couldGenerateLayout",get:function(){return!1}}])&&yt(r.prototype,a),o&&yt(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(_t.a);Object(i.a)(bt,"CssResource",_t.a,[]);var At=n(118),Ct=function(){function e(){this._firstRunExperienceDependenciesTask=null,this._premiumMessagingDependenciesTask=null}var t=e.prototype;return t.loadFirstRunExperienceDependenciesAsync=function(){return this._firstRunExperienceDependenciesTask||(r.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this._firstRunExperienceDependenciesTask=At.Task.WAA(e.loadJavaScriptAsync("inproductmessaging.js"),e.loadCssAsync("inproductmessaging.css")),this._firstRunExperienceDependenciesTask.continueWith((function(e){r.ULS.sendTraceTag(21030599,324,10,"{0}",Ze.a.getExceptionMessage(e.exception))}),5)),this._firstRunExperienceDependenciesTask},t.loadFreemiumDependenciesAsync=function(){if(!this._premiumMessagingDependenciesTask)try{r.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage");var t=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("DimeUrl");this._premiumMessagingDependenciesTask=At.Task.WAA(e.enqueDownload(oe.a.create(t,null,null))),this._premiumMessagingDependenciesTask.continueWith((function(e){r.ULS.sendTraceTag(39978391,324,10,"{0}",Ze.a.getExceptionMessage(e.exception))}),5)}catch(e){r.ULS.sendTraceTag(594874951,324,10,"{0}",Ze.a.getExceptionMessage(e))}return this._premiumMessagingDependenciesTask},e.loadJavaScriptAsync=function(t){var n=e.getUrl(t),i=oe.a.create(n,null,null);return e.enqueDownload(i)},e.loadCssAsync=function(t){var n=e.getUrl(t),i=new bt(n);return e.enqueDownload(i)},e.getUrl=function(e){return vt.a.commonScripts(String.format("ipm/{0}",e))},e.enqueDownload=function(e){return ae.a.enqueueResourceWithoutEnabling(e),e.loadFinishedTask},e}();Object(i.a)(Ct,"DependencyDownloader",null,[196]);var Tt=function(){};function kt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Tt.overlayDiv="inProductMessagingOverlayDiv",Tt.welcomeVideoKey="WelcomeVideoKey",Tt.suggestedVideo1Key="SuggestedVideo1Key",Tt.suggestedVideo2Key="SuggestedVideo2Key",Tt.welcomeVideoTranscript="WelcomeVideoTranscript",Tt.suggestedVideo1Transcript="SuggestedVideo1Transcript",Tt.suggestedVideo2Transcript="SuggestedVideo2Transcript",Tt.mainDivLogo="MainDivLogo",Tt.playButtonImage="PlayButtonImage",Tt.replayButtonImage="ReplayButtonImage",Tt.welcomeVideoImage="WelcomeVideoImage",Tt.welcomeVideoTitle="WelcomeVideoTitle",Tt.suggestedVideo1Image="SuggestedVideo1Image",Tt.suggestedVideo1Title="SuggestedVideo1Title",Tt.suggestedVideo2Image="SuggestedVideo2Image",Tt.suggestedVideo2Title="SuggestedVideo2Title",Tt.landingPageTitle="LandingPageUpperMessageTitle",Tt.appThemeActiveColor="AppThemeActiveColor",Tt.appThemePrimaryColor="AppThemePrimaryColor",Tt.appThemeSecondaryBackgroundColor="AppThemeSecondaryBackgroundColor",Tt.appThemeSecondaryHoverColor="AppThemeSecondaryHoverColor",Object(i.a)(Tt,"Constants",null,[]);var wt=function(){function e(){this._autoPlay=!0,this._modernPlayerSupported=!0,this._showLandingPage=!0,this.playIcon=null,this.replayIcon=null,this.mutePlayer=!1,this.locale=null,this.uiResources={}}var t,n,i,r=e.prototype;return r.addMainDivLogo=function(e){this.addUIResource(Tt.mainDivLogo,e)},r.addLandingPageTitle=function(e){this.addUIResource(Tt.landingPageTitle,e)},r.addAppThemeColors=function(e,t,n,i){this.addUIResource(Tt.appThemeActiveColor,e),this.addUIResource(Tt.appThemePrimaryColor,t),this.addUIResource(Tt.appThemeSecondaryBackgroundColor,n),this.addUIResource(Tt.appThemeSecondaryHoverColor,i)},r.addWelcomeVideo=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(Tt.welcomeVideoKey,e),this.addUIResource(Tt.welcomeVideoTranscript,t),this.addUIResource(Tt.welcomeVideoImage,n),this.addUIResource(Tt.welcomeVideoTitle,i)},r.addSuggestedVideo1=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(Tt.suggestedVideo1Key,e),this.addUIResource(Tt.suggestedVideo1Transcript,t),this.addUIResource(Tt.suggestedVideo1Image,n),this.addUIResource(Tt.suggestedVideo1Title,i)},r.addSuggestedVideo2=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.addUIResource(Tt.suggestedVideo2Key,e),this.addUIResource(Tt.suggestedVideo2Transcript,t),this.addUIResource(Tt.suggestedVideo2Image,n),this.addUIResource(Tt.suggestedVideo2Title,i)},r.addPlayReplayIcons=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.playIcon=e,this.replayIcon=t},r.setPlayReplayIcons=function(){this.addUIResource(Tt.playButtonImage,this.playIcon),this.addUIResource(Tt.replayButtonImage,this.replayIcon)},r.addUIResource=function(e,t){t&&(this.uiResources[e]=t)},t=e,(n=[{key:"autoPlay",get:function(){return this._autoPlay},set:function(e){this._autoPlay=e}},{key:"modernPlayerSupported",get:function(){return this._modernPlayerSupported},set:function(e){this._modernPlayerSupported=e}},{key:"showLandingPage",get:function(){return this._showLandingPage},set:function(e){this._showLandingPage=e,e&&this.setPlayReplayIcons()}}])&&kt(t.prototype,n),i&&kt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(wt,"FirstRunExperienceUISettings",null,[194]);var It=function(){this.remindMeLater=!1,this.completed=!1};Object(i.a)(It,"FirstRunExperienceViewData",null,[193]);var Pt=n(70),Ft=function(){function e(e,t,n){var i=this;this.firstRunExperienceHandler=function(e,t,n,r,a){return 2===n&&i._inProductMessagingUIManager.launchInProductMessagingControl(a),32},this.dimeLaunchHandler=function(e,t,n,r,a){return 2===n&&i._inProductMessagingUIManager.launchFreemiumUpsellDialog(a),32},this.inProductMessagingTabHandler=function(e,t,n,r,a){return 2===n?i._inProductMessagingUIManager.moveForwardOnTab():32},this.inProductMessagingShiftTabHandler=function(e,t,n,r,a){return 2===n?i._inProductMessagingUIManager.moveBackwardOnShiftTab():32},this._actionManager=e,this._activeFrame=t,this._inProductMessagingUIManager=n}return e.prototype.registerActions=function(){this._actionManager.addActionWithFlags(p.a.firstRunExperienceShowUI,_e.a.frame,this.firstRunExperienceHandler,64),this._actionManager.addAction(p.a.firstRunExperienceFocusForward,_e.a.frame,this.inProductMessagingTabHandler),this._actionManager.addAction(p.a.firstRunExperienceFocusBackward,_e.a.frame,this.inProductMessagingShiftTabHandler),this._actionManager.addAction(p.a.dimeLaunch,_e.a.frame,this.dimeLaunchHandler),this._actionManager.addAction(p.a.reportFreemiumUpsellDialogDisplayed,_e.a.frame,Pt.ActionManager.doNothingButReportHandler),this._actionManager.addAction(p.a.reportFreemiumUpsellDialogClicked,_e.a.frame,Pt.ActionManager.doNothingButReportHandler),this._actionManager.addAction(p.a.reportFreemiumUpsellDialogDismissed,_e.a.frame,Pt.ActionManager.doNothingButReportHandler),this._activeFrame&&this._activeFrame.updateCommandUI()},e}();Object(i.a)(Ft,"InProductMessagingActor",null,[]);var Et=function(){this.instance=null,this.launchConfig=null,this.taskCompleteAction=null,this.resolveAction=null,this.rejectAction=null};Object(i.a)(Et,"DimeExperienceUISettings",null,[]);var Ot=n(39),Mt=n(342),Lt=function(){function e(e,t,n,i,r){this.freemiumDependenciesLoaded=!1,this.dimeInstance=null,this._actionManager=e,this._uiWrapper=t,this._resourceDownloadManager=n,this._appType=i,this._appMode=r}var t=e.prototype;return t.initializeGoPremiumButton=function(e){if(Ot.b("getHeaderApi")){e.isFeatureEnabled("MsoPremiumBadge",!0).then((function(t){var n=e.isFreemiumUpsellEnabled();return n&&(appChrome.getHeaderApi().then((function(e){return e.updatePremiumStatus(t,n),null})),e.registerFeatureStateChangeCallback("MsoPremiumBadge",(function(e){appChrome.getHeaderApi().then((function(t){return t.updatePremiumStatus(e.isEnabled,n),null}))}))),null}))}else r.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")},t.launchInProductMessagingControl=function(e){var t=this;this._resourceDownloadManager.loadFirstRunExperienceDependenciesAsync().continueWith((function(n){t._uiWrapper.showUI(e)}))},t.launchFreemiumUpsellDialog=function(e){var t=e,n="gopremium",i=null,a=function(){};t?(t.experience&&""!==Object(F.a)(String,t.experience)&&(n=Object(F.a)(String,t.experience)),t.onTaskComplete&&(a=t.onTaskComplete),t.campaignId&&""!==Object(F.a)(String,t.campaignId)&&(i=Object(F.a)(String,t.campaignId))):r.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience"),this.launchDimeExperience(n,a,i)},t.launchDimeExperience=function(e,t,n){var i=this;if(void 0===n&&(n=null),this.freemiumDependenciesLoaded&&this.dimeInstance){var a={};a.experience=e||"gopremium",a.campaignId=n||Mt.b(this._appType,this._appMode,Object(F.a)(String,a.experience),!0),this._actionManager.processAction(p.a.reportFreemiumUpsellDialogDisplayed,2),r.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+a.experience);try{var o=Object.assign(new Et,{instance:this.dimeInstance,launchConfig:a,taskCompleteAction:t||function(){},resolveAction:function(e){r.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+e.status)},rejectAction:function(e){r.ULS.sendTraceTag(51675406,324,10,"Dime launch error"),i.freemiumDependenciesLoaded=!1,i.dimeInstance=null}});this._uiWrapper.showFreemiumUI(o)}catch(e){r.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+e.message),this.freemiumDependenciesLoaded=!1,this.dimeInstance=null,this._actionManager.processActionWithData(p.a.freemiumUpsellEligible,2,{experience:a.experience})}}else r.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this._actionManager.processActionWithData(p.a.freemiumUpsellEligible,2,{experience:e})},t.loadFreemiumUpsellDialogDependencies=function(){var e=this;this._resourceDownloadManager.loadFreemiumDependenciesAsync().continueWith((function(t){try{var n=Ze.a.toLower(s.AFrameworkApplication.uiCulture),i=Mt.c(e._appType);if(!i)return void r.ULS.sendTraceTag(51675409,324,15,"App not supported");var a={};a.partnerId=i,a.language=n,a.sessionId=s.AFrameworkApplication.userSessionId,a.authHint=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("UserPrincipalName");var o=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("Puid")||"";if(""!==o){var l={};l.puid=o,a.userInfo=l}e.dimeInstance=new Dime(a),e.freemiumDependenciesLoaded=!0,r.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}catch(e){r.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+e.message)}}),3)},t.moveForwardOnTab=function(){return this._uiWrapper.moveForwardOnTab()},t.moveBackwardOnShiftTab=function(){return this._uiWrapper.moveBackwardOnShiftTab()},e}();Object(i.a)(Lt,"InProductMessagingUIManager",null,[192]);var Rt=function(){function e(){this._traceCategory=0,this._levelMap=new Array(5),this._levelMap[0]=10,this._levelMap[1]=15,this._levelMap[2]=50,this._levelMap[3]=100,this._levelMap[4]=200}var t=e.prototype;return t.Init=function(e){this._traceCategory=e},t.SendTrace=function(e,t){r.ULS.sendTraceTag(34182235,this._traceCategory,this._levelMap[e],"{0}",t)},e}();Object(i.a)(Rt,"DefaultNetworkingManager",null,[211]);var Dt=n(89),xt=n(106),Bt=n(35);function Ut(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ht=function(){function e(e){this._isFreOverlayVisible=!1,this._focusManager=e}var t,n,i,r=e.prototype;return r.showUI=function(e){var t=e;t&&(InProductMessaging.Networking.NetworkingMgr=new Rt,InProductMessaging.Networking.NetworkingMgr.Init(387),this._isFreOverlayVisible=!0,InProductMessaging.Init(t.showLandingPage,t.modernPlayerSupported,t.autoPlay,t.mutePlayer,t.locale,Object(A.a)(this,this.onDismissFirstRunExperience,"onDismissFirstRunExperience"),t.uiResources),this.setFocusScope(Tt.overlayDiv,!0))},r.showFreemiumUI=function(e){var t=this,n=e;if(!(n&&n.instance&&n.launchConfig))throw Error.argument("DimeExperienceUISettings");var i=document.getElementById("wacDimeContainer");i||((i=document.createElement("div")).id="wacDimeContainer",document.body.appendChild(i)),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DimeFocusManagerIsEnabled")&&this.setFocusScope("wacDimeContainer",!1),n.launchConfig.parentElementId="wacDimeContainer",n.instance.launch(n.launchConfig,n.taskCompleteAction).then((function(e){t.removeFocus(),document.body.removeChild(i),n.resolveAction(e)})).catch((function(e){t.removeFocus(),document.body.removeChild(i),n.rejectAction(e)}))},r.setFocusScope=function(e,t){if(this._focusManager&&e){var n=document.getElementById(e);this.initializeFocusLoop("InProductMessagingFocusId",n,!1);var i=this._focusManager.getRegion("InProductMessagingFocusId");if(i){var r=this._focusManager.currentScope;r&&"InProductMessagingFocusId"===r.name||this._focusManager.pushScope("InProductMessagingFocusId",!1),t&&this.rebindTabNavigationHandlers(i.scope)}}},r.initializeFocusLoop=function(e,t,n){void 0===n&&(n=!0);var i=this._focusManager.getScope(e);i.parent=Dt.AFrame.appFocusId;var r=new xt.DOMFocusListing((function(){return t}));r.rememberFirstElement=n,r.addValidTag(3),r.addValidTag(2),r.addValidTag(4);var a=this._focusManager.buildRegionWithDelegate((function(){return t}),i,r);a.rememberFocusStealers(),a.looped=!0,a.contained=!0},r.rebindTabNavigationHandlers=function(e){e.unBindAction(Bt.FocusManager.instance()._tabInput),e.unBindAction(Bt.FocusManager.instance()._tabShiftInput),e.bindAction(Bt.FocusManager.instance()._tabInput,p.a.firstRunExperienceFocusForward),e.bindAction(Bt.FocusManager.instance()._tabShiftInput,p.a.firstRunExperienceFocusBackward)},r.removeFocus=function(){this._focusManager&&(this._focusManager.popScope("InProductMessagingFocusId"),this._focusManager.removeScope("InProductMessagingFocusId"))},r.onDismissFirstRunExperience=function(e,t){this._isFreOverlayVisible=!1,this.removeFocus();var n=Object.assign(new It,{completed:e,remindMeLater:t});s.AFrameworkApplication.theActionManager.processActionWithData(p.a.firstRunExperienceCompleted,2,n)},r.onDismissFreemiumDialog=function(e){this._isFreOverlayVisible=!1,this.removeFocus(),e?s.AFrameworkApplication.theActionManager.processAction(p.a.reportFreemiumUpsellDialogClicked,2):s.AFrameworkApplication.theActionManager.processAction(p.a.reportFreemiumUpsellDialogDismissed,2)},r.moveForwardOnTab=function(){var e=document.activeElement,t=this._focusManager.getCurrentRegion();return e&&t&&t.listing&&e===t.listing.lastElement?(t.listing.trySetCurrentElement(e),t.moveForward()?32:8):4},r.moveBackwardOnShiftTab=function(){var e=document.activeElement,t=this._focusManager.getCurrentRegion();return e&&t&&t.listing&&e===t.listing.firstElement?(t.listing.trySetCurrentElement(e),t.moveBackward()?32:8):4},t=e,(n=[{key:"isFreOverlayVisible",get:function(){return this._isFreOverlayVisible}}])&&Ut(t.prototype,n),i&&Ut(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Nt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Ht,"InProductMessagingUIWrapper",null,[191]);var Wt=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){e.register(Ct,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").singleInstance().usingFactory((function(){return new Ct})),e.register(Ht,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").singleInstance().usingFactory((function(){return new Ht(Bt.FocusManager.instance())})),e.register(Lt,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").singleInstance().usingFactory((function(){return new Lt(s.AFrameworkApplication.theActionManager,e.resolve("Common.IInProductMessagingUIWrapper"),e.resolve("Common.App.InProductMessaging.IDependencyDownloader"),s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppMode)})),e.register(Ft,"Common.App.InProductMessaging.InProductMessagingActor").singleInstance().usingFactory((function(){return new Ft(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame,e.resolve("Common.IInProductMessagingUIManager"))})),e.register(wt,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").singleInstance().usingFactory((function(){return new wt})),e.register(It,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").singleInstance().usingFactory((function(){return new It})),this._container=e},r.init=function(){var e=this;this._container.resolve("Common.App.InProductMessaging.InProductMessagingActor").registerActions(),s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled&&Fe.a.get_instance().executeWhen(15,(function(){e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(t){e._container.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").initializeGoPremiumButton(t)}))})),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("FreemiumUpsellShowDialogIsEnabled")&&Mt.a()&&!z.a.isInternetExplorer&&1!==s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&e._container.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(t){t.isFeatureEnabled("MsoPremiumBadge",!0).then((function(n){return!n&&t.isFreemiumUpsellEnabled()&&e._container.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").loadFreemiumUpsellDialogDependencies(),null}))}))}))},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.InProductMessaging"}}])&&Nt(t.prototype,n),i&&Nt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Wt,"InProductMessagingPackage",null,[2,3]);var jt=function(){function e(e){this._allowedDomainEndings=e}return e.prototype.isDomainAllowed=function(e){if(!this._allowedDomainEndings)return!0;var t=O.a.getHost(e);if(!t)return!1;t=t.toLowerCase();for(var n=0;n<this._allowedDomainEndings.length;n++)if(t.endsWith(this._allowedDomainEndings[n]))return!0;return!1},e}();function Vt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(jt,"DomainAllowListManager",null,[]);var qt=function(){function e(e,t){this.customText=null,this._timings=e,this.url=t}var t,n,i,r=e.prototype;return r.toUsageData=function(){var e={},t=this.timings;return e.a=this.usageReadyUrl,e.b=this.round(t.navigationStart),e.c=this.round(t.unloadEventStart),e.d=this.round(t.unloadEventEnd),e.e=this.round(t.redirectStart),e.f=this.round(t.redirectEnd),e.g=this.round(t.fetchStart),e.h=this.round(t.domainLookupStart),e.i=this.round(t.domainLookupEnd),e.j=this.round(t.connectStart),e.k=this.round(t.connectEnd),e.l=void 0!==t.secureConnectionStart&&null!==t.secureConnectionStart?this.round(t.secureConnectionStart):0,e.m=this.round(t.requestStart),e.n=this.round(t.responseStart),e.o=this.round(t.responseEnd),e.q=this.round(t.domInteractive),e.r=this.round(t.domContentLoadedEventStart),e.s=this.round(t.domContentLoadedEventEnd),e.t=this.round(t.domComplete),e.u=this.round(t.loadEventStart),e.v=this.round(t.loadEventEnd),e.w=this.customText,e},r.round=function(e){return Math.round(1e3*e)/1e3},t=e,(n=[{key:"usageReadyUrl",get:function(){return O.a.removeAllUrlParameters(this.url)}},{key:"timings",get:function(){return this._timings}}])&&Vt(t.prototype,n),i&&Vt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(qt,"PerformanceTimingEntry",null,[]);var Gt=function(e,t){var n,i,r={},a=function(e,t){null!=t&&(r[e]=t)},o=null;switch(e){case 0:var s=t;o="ResourceTiming",a("Url",s.a),a("InitiatorType",s.b),a("RedirectStart",null==s.c?null:s.c.toString()),a("RedirectEnd",null==s.d?null:s.d.toString()),a("FetchStart",null==s.e?null:s.e.toString()),a("DomainLookupStart",null==s.f?null:s.f.toString()),a("DomainLookupEnd",null==s.g?null:s.g.toString()),a("ConnectStart",null==s.h?null:s.h.toString()),a("ConnectEnd",null==s.i?null:s.i.toString()),a("SecureConnectionStart",null==s.j?null:s.j.toString()),a("RequestStart",null==s.k?null:s.k.toString()),a("ResponseStart",null==s.l?null:s.l.toString()),a("ResponseEnd",null==s.m?null:s.m.toString()),a("CustomText",s.n),a("DecodedBodySize",null==s.o?null:s.o.toString()),a("EncodedBodySize",null==s.p?null:s.p.toString()),a("TransferSize",null==s.q?null:s.q.toString()),a("responseStatus",null!==(i=null===(n=s.r)||void 0===n?void 0:n.toString())&&void 0!==i?i:null);break;case 1:var l=t;o="PerformanceTiming",a("Url",l.a),a("NavigationStart",null==l.b?null:l.b.toString()),a("UnloadEventStart",null==l.c?null:l.c.toString()),a("UnloadEventEnd",null==l.d?null:l.d.toString()),a("RedirectStart",null==l.e?null:l.e.toString()),a("RedirectEnd",null==l.f?null:l.f.toString()),a("FetchStart",null==l.g?null:l.g.toString()),a("DomainLookupStart",null==l.h?null:l.h.toString()),a("DomainLookupEnd",null==l.i?null:l.i.toString()),a("ConnectStart",null==l.j?null:l.j.toString()),a("ConnectEnd",null==l.k?null:l.k.toString()),a("SecureConnectionStart",null==l.l?null:l.l.toString()),a("RequestStart",null==l.m?null:l.m.toString()),a("ResponseStart",null==l.n?null:l.n.toString()),a("ResponseEnd",null==l.o?null:l.o.toString()),a("DomLoading",null==l.p?null:l.p.toString()),a("DomInteractive",null==l.q?null:l.q.toString()),a("DomContentLoadedEventStart",null==l.r?null:l.r.toString()),a("DomContentLoadedEventEnd",null==l.s?null:l.s.toString()),a("DomComplete",null==l.t?null:l.t.toString()),a("LoadEventStart",null==l.u?null:l.u.toString()),a("LoadEventEnd",null==l.v?null:l.v.toString()),a("CustomText",l.w)}return r.Table=o,Sys.Serialization.JavaScriptSerializer.serialize(r)},Kt=n(25),zt=n(113),Xt=n(95);function Jt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Qt=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),this._pageLoadPerfRecorder=e,this.usageLogger=this,this._getCurrentUrlDelegate=t||function(){return window.location.href},this._domainAllowListManager=new jt(n)}var t,n,i,a=e.prototype;return a.run=function(){if(e.browserSupportsPerformanceTiming(window.performance))try{var t,n=this._getCurrentUrlDelegate();if(!e._transportRegEx.exec(n))return;if(!this._domainAllowListManager.isDomainAllowed(n))return;var i=new qt(window.performance.timing,n);Xt.a.instance.recordBrowserFetchStart(i.timings.fetchStart),Xt.a.instance.recordBrowserNavigationStart(i.timings.navigationStart),Xt.a.instance.measureMarks(Kt.a.frameConnect,"connectStart","requestStart"),Xt.a.instance.measureMarks(Kt.a.frameRequest,"requestStart","responseStart"),Xt.a.instance.measureMarks(Kt.a.frameResponse,"responseStart","responseEnd"),this.usageLogger.logData(1,i.toUsageData()),this._pageLoadPerfRecorder.addMetric(Kt.a.frameFetchStart,i.timings.fetchStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameDomainLookupStart,i.timings.domainLookupStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameDomainLookupEnd,i.timings.domainLookupEnd),this._pageLoadPerfRecorder.addMetric(Kt.a.frameConnectStart,i.timings.connectStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameSecureConnectionStart,i.timings.secureConnectionStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameConnectEnd,i.timings.connectEnd),this._pageLoadPerfRecorder.addMetric(Kt.a.frameRequestStart,i.timings.requestStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameResponseStart,i.timings.responseStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameDownloadDuration,i.timings.responseEnd-i.timings.responseStart),this._pageLoadPerfRecorder.addMetric(Kt.a.frameRequestStartToFirstByteDuration,i.timings.responseStart-i.timings.requestStart);var a,o,s;(t=this.tryNavigationSize(n),a=t.transferSize,o=t.encodedSize,s=t.decodedSize,t).returnValue&&(this._pageLoadPerfRecorder.addMetric(Kt.a.frameTransferSize,a),this._pageLoadPerfRecorder.addMetric(Kt.a.frameDecodedSize,s),this._pageLoadPerfRecorder.addMetric(Kt.a.frameEncodedSize,o)),this._pageLoadPerfRecorder.addMetric(Kt.a.frameNavigationStart,i.timings.navigationStart)}catch(e){r.ULS.sendTraceTag(4551814,306,10,"Exception caught in PerformanceTimingLogger.Run: {0}",e)}},a.tryNavigationSize=function(e){var t,n,i;if(t=-1,n=-1,i=-1,void 0===window.performance.getEntriesByName||null===window.performance.getEntriesByName)return{returnValue:!1,transferSize:t,encodedSize:n,decodedSize:i};var r=window.performance.getEntriesByName(e,"navigation");if(null==r||1!==r.length)return{returnValue:!1,transferSize:t,encodedSize:n,decodedSize:i};var a=r[0],o=a.transferSize;null!=t&&(t=o);var s=a.decodedBodySize;null!=s&&(i=s);var l=a.encodedBodySize;return null!=l&&(n=l),{returnValue:!0,transferSize:t,encodedSize:n,decodedSize:i}},a.logData=function(e,t,n){void 0===n&&(n=!1),r.ULS.sendTraceTag(4551815,306,50,Gt(e,t))},e.browserSupportsPerformanceTiming=function(e){return!(null==e||void 0===e.timing||null===e.timing)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e(zt.a.instance,null,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PerfTimingLoggerFilterDomainsIsEnabled")?s.AFrameworkApplication.appSettingsManager.getListAppSetting("ResourceLoggerDomainAllowList"):null))}}],(n=null)&&Jt(t.prototype,n),i&&Jt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Zt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Qt._instance=null,Qt._transportRegEx=new RegExp("^https?://.*","i"),Object(i.a)(Qt,"PerformanceTimingLogger",null,[190]);var Yt=function(){function e(e,t){this.customText=null,this._timings=e,this.behavior=t,this.url=this.timings.name}var t,n,i,r=e.prototype;return r.toUsageData=function(){var t={},n=this.timings;return t.a=this.usageReadyUrl,t.b=n.initiatorType,t.c=this.round(n.redirectStart),t.d=this.round(n.redirectEnd),t.e=this.round(n.fetchStart),t.f=this.round(n.domainLookupStart),t.g=this.round(n.domainLookupEnd),t.h=this.round(n.connectStart),t.i=this.round(n.connectEnd),t.j=void 0!==n.secureConnectionStart&&null!==n.secureConnectionStart?this.round(n.secureConnectionStart):0,t.k=this.round(n.requestStart),t.l=this.round(n.responseStart),t.m=this.round(n.responseEnd),t.o=this.round(e.getRawField(n,"decodedBodySize")),t.p=this.round(e.getRawField(n,"encodedBodySize")),t.q=this.round(e.getRawField(n,"transferSize")),t.n=this.customText,t.r=e.getRawField(n,"responseStatus")||0,t},r.round=function(e){return Math.round(1e3*e)/1e3},e.getRawField=function(e,t){return e[t]},t=e,(n=[{key:"usageReadyUrl",get:function(){return 2===this.behavior?this.url:O.a.removeAllUrlParameters(this.url)}},{key:"timings",get:function(){return this._timings}}])&&Zt(t.prototype,n),i&&Zt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Yt,"ResourceTimingEntry",null,[212]);var $t=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=100),this._appMonitoredStaticResources=e,this._staticResourceHostAllowList=t,this._aggregatedStaticResourceMetrics={},this._cacheThresholdInMs=n,this._advancedLoggingEnabled=s.AFrameworkApplication&&s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableAdvancedNetworkLogging",!1)}var t=e.prototype;return t.tryAggregateResourceTiming=function(e){var t=e.name.toLowerCase(),n=O.a.getPageName(t);if(this.resourceTimingShouldBeAggregated(n,t)){if(n in this._aggregatedStaticResourceMetrics)return r.ULS.sendTraceTag(51652509,306,50,"AppStaticResourceManager: file downloaded multiple times {0}",n),!1;var i={};return i.fetchstart=e.fetchStart,i.responseend=e.responseEnd,i.iscached=this.isTimingCached(e),i.encodedsize=Yt.getRawField(e,"encodedBodySize"),i.decodedsize=Yt.getRawField(e,"decodedBodySize"),this._aggregatedStaticResourceMetrics[n]=i,!0}return!1},t.tryAggregateResourceTimingV2=function(e){var t=e.name.toLowerCase(),n=O.a.getPageName(t);if(this.resourceTimingShouldBeAggregatedV2(n,t)){if(n in this._aggregatedStaticResourceMetrics)return r.ULS.sendTraceTag(508925201,306,50,"AppStaticResourceManager: file downloaded multiple times for filename: {0}",n),!1;var i={};return i.fetchstart=e.fetchStart,i.responseend=e.responseEnd,i.iscached=this.isTimingCached(e),i.encodedsize=Yt.getRawField(e,"encodedBodySize"),i.decodedsize=Yt.getRawField(e,"decodedBodySize"),i.it=e.initiatorType,i.ress=e.responseStart,i.cs=e.connectStart,i.ce=e.connectEnd,i.dls=e.domainLookupStart,i.dle=e.domainLookupEnd,i.rs=e.redirectStart,i.re=e.redirectEnd,i.reqs=e.requestStart,i.scs=e.secureConnectionStart,this._aggregatedStaticResourceMetrics[n]=i,!0}return!1},t.resourceTimingShouldBeAggregated=function(e,t){if(this._appMonitoredStaticResources)return Array.contains(this._appMonitoredStaticResources,e);if(this._staticResourceHostAllowList)for(var n=O.a.getHostname(t),i=0;i<this._staticResourceHostAllowList.length;i++)if(this._staticResourceHostAllowList[i]&&n.endsWith(this._staticResourceHostAllowList[i]))return!0;return!1},t.resourceTimingShouldBeAggregatedV2=function(e,t){return!!this.resourceTimingShouldBeAggregated(e,t)&&(e.endsWith(".js")||e.endsWith(".css"))},t.isTimingCached=function(e){try{var t=Yt.getRawField(e,"transferSize");return null!=t?!t:(r.ULS.sendTraceTag(51652510,306,50,"AppStaticResourceManager: No transfersize found, basing cache status from duration"),e.responseEnd-e.fetchStart<this._cacheThresholdInMs)}catch(e){r.ULS.sendTraceTag(51652511,306,50,"AppStaticResourceManager: Error attempting to get cache value of resource [error: {0}]",e.message)}return!1},t.getAggregatedResourceMetrics=function(){return this._aggregatedStaticResourceMetrics},t.recordStaticResourcesMetricsInKpi=function(){if(X.a.isNullOrEmpty(this._aggregatedStaticResourceMetrics))r.ULS.sendTraceTag(575931855,306,15,"Aggregated Static Resource Metric Dictionary is null or empty");else{var e=s.AFrameworkApplication.flightId?s.AFrameworkApplication.flightId.split(";"):new Array(0),t=Object.assign(new Z.a,{extendedProperties:G.a.createExtendedPropertiesMap()});t.extendedProperties.set("Flights",H.c(e)),this.logKpi(t,this._aggregatedStaticResourceMetrics,l.Health.instance)}},t.getAggregatedNetworkMetrics=function(e){var t=0,n=0,i=0,r=0,a=0,o=this._aggregatedStaticResourceMetrics;for(var l in o){var c={key:l,value:o[l]};if(c.key.endsWith(".js")){var u=Object(F.a)(Object,c.value);if(u.responseend<e){t+=1,n+=u.decodedsize,r+=u.encodedsize,i+=u.iscached?0:u.encodedsize;var d=c.key.toLowerCase();this._advancedLoggingEnabled&&(s.AFrameworkApplication.appSettingsManager.getStringAppSetting("Slice1Name").toLowerCase().endsWith(d)?a|=1:d.endsWith(".common.js")||d.endsWith(".othercommon.js")||d.endsWith(".ext.js")?a|=2:d.endsWith("common50.min.js")&&(a|=4))}}}var p={};return p.filesLoaded=t,p.decodedBytes=n,p.transferredBytes=i,p.encodedBytes=r,this._advancedLoggingEnabled&&(p.lazyChunksLoaded=a),p},t.logKpi=function(e,t,n){if(t){var i=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,h=0,g=0;for(var m in t){var f={key:m,value:t[m]};try{var v=Object(F.a)(Object,f.value);if(!v)continue;var _=!!v.iscached&&Boolean.parse(v.iscached.toString()),y=v.fetchstart?this.parseFloat(v.fetchstart.toString()):0,S=(v.responseend?this.parseFloat(v.responseend.toString()):0)-y,b=v.encodedsize?this.parseFloat(v.encodedsize.toString()):0,A=v.decodedsize?this.parseFloat(v.decodedsize.toString()):0;i+=S,s+=b,u+=A,h++,_?(o+=S,c+=b,p+=A,g++):(a+=S,l+=b,d+=A)}catch(e){r.ULS.sendTraceTag(575931856,306,10,"AppStaticResourceManager: Error attempting to log KPI [error: {0}]",e.message)}}e.extendedProperties.set("StaticResources",H.c(t)),e.extendedProperties.set("TotalResourceDownloadLatency",i.toString()),e.extendedProperties.set("TotalResourceDownloadLatencyForCacheMiss",a.toString()),e.extendedProperties.set("TotalResourceDownloadLatencyForCacheHit",o.toString()),e.extendedProperties.set("TotalSizeOfEncodedDataDownloaded",s.toString()),e.extendedProperties.set("TotalSizeOfEncodedDataDownloadedForCacheMiss",l.toString()),e.extendedProperties.set("TotalSizeOfEncodedDataDownloadedForCacheHit",c.toString()),e.extendedProperties.set("TotalSizeOfDecodedDataDownloaded",u.toString()),e.extendedProperties.set("TotalSizeOfDecodedDataDownloadedForCacheMiss",d.toString()),e.extendedProperties.set("TotalSizeOfDecodedDataDownloadedForCacheHit",p.toString()),e.extendedProperties.set("TotalNumberOfResourcesDownloaded",h.toString()),e.extendedProperties.set("TotalNumberOfCachedResourcesDownloaded",g.toString()),n.recordKpiUsageForAlertableKpi("StaticResourceDownloadLatencyAggregated","wacbootmonitoring",null),n.recordKpiSuccess("StaticResourceDownloadLatencyAggregated",e)}},t.parseFloat=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){if(!e)return 0;var t=parseFloat(e);return isNaN(t)?0:t})),e}();function en(e,t){return(en=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)($t,"AppStaticResourceManager",null,[]);var tn=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).entries=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,en(t,n),i}(Sys.EventArgs);function nn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(tn,"EntriesAvailableEventArgs",Sys.EventArgs,[]);var rn=function(){function e(e,t,n,i,r,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=100),void 0===o&&(o=!1),this._isTaskSet=!1,this._task=null,this._currentEntryIndex=0,this._eventSource=new a.a,this._appStaticResourceManager=null,this._isActive=!1,this._timerInterval=0,this._taskManager=e,this._defaultBehavior=0,this.usageLogger=this,this._domainAllowListManager=new jt(n),this._performance=t,i&&(this._appStaticResourceManager=new $t(null,i,r)),this._aggregateResourceTimingV2Enabled=o}var t,n,i,o=e.prototype;return o.add_entriesAvailable=function(t){this._eventSource.addHandler(e.entriesAvailableEventKey,t)},o.remove_entriesAvailable=function(t){this._eventSource.removeHandler(e.entriesAvailableEventKey,t)},o.configure=function(e,t){var n=this.timerInterval!==e;this._timerInterval=e,this.isActive&&this._taskManager&&n&&(this.deleteTask(),this.addTask()),this._defaultBehavior=t},o.activate=function(){this.isActive||this.browserSupportsPerformanceTimeline&&(this.addTask(),this._isActive=!0)},o.deactivate=function(e){this.isActive&&(this.deleteTask(),e&&this.flush(),this._isActive=!1)},o.flush=function(){if(this.isActive&&this.browserSupportsPerformanceTimeline)try{var t=window.performance.getEntriesByType("resource");t.length-this._currentEntryIndex>0&&r.ULS.sendTraceTag(19506833,306,100,"ResourceTimingLogger.Flush: Start executing command. Number of new entries to flash: {0}",t.length-this._currentEntryIndex);var n=!(void 0===window.performance.clearResourceTimings||null===window.performance.clearResourceTimings);n&&(window.performance.clearResourceTimings(),this._currentEntryIndex=0);for(var i=[],a=this._currentEntryIndex;a<t.length;a++)this._domainAllowListManager.isDomainAllowed(t[a].name)&&(this._appStaticResourceManager&&(this._aggregateResourceTimingV2Enabled?this._appStaticResourceManager.tryAggregateResourceTimingV2(t[a]):this._appStaticResourceManager.tryAggregateResourceTiming(t[a])),i.push(new Yt(t[a],this.defaultBehavior)));n||(this._currentEntryIndex=t.length),this._eventSource.raiseEvent(e.entriesAvailableEventKey,new tn(i));for(var o=0;o<i.length;o++)0!==i[o].behavior&&2!==i[o].behavior||this.usageLogger.logData(0,i[o].toUsageData());i.length>0&&r.ULS.sendTraceTag(19506834,306,100,"ResourceTimingLogger.Flush: Successfully ended. Number of new logged entries: {0}",i.length)}catch(e){r.ULS.sendTraceTag(4310803,306,10,"Exception caught in ResourceTimingLogger.Flush: {0}",e)}},o.logData=function(e,t,n){void 0===n&&(n=!1),r.ULS.sendTraceTag(4310804,306,50,Gt(e,t))},o.getAppResourceTimingMetrics=function(){return this._appStaticResourceManager.getAggregatedResourceMetrics()},o.recordAppResourceTimingMetricsToKpi=function(){this._appStaticResourceManager.recordStaticResourcesMetricsInKpi()},o.getAggregatedNetworkMetrics=function(e){return this._appStaticResourceManager.getAggregatedNetworkMetrics(e)},o.addTask=function(){var e=this;this._taskManager&&this.timerInterval>0&&(this._task=new u.a(3,2,1e3*this.timerInterval,(function(){e.flush()}),5),this._taskManager.addTask(this._task),this._isTaskSet=!0)},o.deleteTask=function(){this._isTaskSet&&(this._taskManager.deleteTask(this._task),this._task=null,this._isTaskSet=!1)},t=e,(n=[{key:"browserSupportsPerformanceTimeline",get:function(){try{return!(void 0===this._performance||null===this._performance||void 0===this._performance.getEntriesByType||null===this._performance.getEntriesByType)}catch(e){return r.ULS.sendTraceTag(50873240,306,10,"Exception caught in ResourceTimingLogger.BrowserSupportsPerformanceTimeline: {0}",e),!1}}},{key:"defaultBehavior",get:function(){return this._defaultBehavior}},{key:"isActive",get:function(){return this._isActive}},{key:"timerInterval",get:function(){return this._timerInterval}}])&&nn(t.prototype,n),i&&nn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function an(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}rn.entriesAvailableEventKey="EntriesAvailable",Object(i.a)(rn,"ResourceTimingLogger",null,[175,190]);var on=function(){function e(){this._container=null}var t,n,i,a=e.prototype;return a.init=function(){this._container.resolve("Common.NetworkTiming.IResourceTimingLogger"),Qt.instance.run()},a.dispose=function(){},a.configure=function(e){this._container=e;var t=null;if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ResourceLoggerFilterDomainsIsEnabled"))try{t=s.AFrameworkApplication.appSettingsManager.getListAppSetting("ResourceLoggerDomainAllowList")}catch(e){r.ULS.sendTraceTag(51652512,306,50,"ResourceTimingPackage - failed to get logger domain allowlist")}var n=[];n.push(O.a.getHostname(vt.a.staticContentHost).toLowerCase()),n.push(O.a.getHostname(vt.a.sharedStaticContentHost).toLowerCase());var i=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("AppStaticResourceMonitorCacheThresholdInMs",100),a=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("PPTAggregateResourceTimingV2Enabled");e.register(175,"Common.NetworkTiming.IResourceTimingLogger").singleInstance().usingFactory((function(){return new rn(s.AFrameworkApplication.theTaskManager,window.performance,t,n,i,a)}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.ResourceTiming"}}])&&an(t.prototype,n),i&&an(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(on,"ResourceTimingPackage",null,[2,3]);var sn,ln=n(477),cn=function(){function e(){this._activeEventReceivers={}}var t=e.prototype;return t.activateEventReceiver=function(e){this._activeEventReceivers[e.id.toString()]=e},t.notifyAndDeactivateActiveEventReceivers=function(e){var t=this._activeEventReceivers;for(var n in t){({key:n,value:t[n]}).value.notify(e,!1)}this._activeEventReceivers={}},t.queryForResult=function(e,t){return t&&this.activateEventReceiver(t),this.onResultRequested(e,t)},t.emitDeferredResultToWaitingReceivers=function(e){this.notifyAndDeactivateActiveEventReceivers(e)},t.emitAvailableResultToReceiver=function(e,t){e.notify(t,!0)},e}();function un(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(cn,"AEventEmitter",null,[188]),function(e){e[e.notStarted=0]="notStarted",e[e.waiting=1]="waiting",e[e.shouldRetry=2]="shouldRetry",e[e.complete=3]="complete"}(sn||(sn={})),Object(i.b)("EventResultState",sn);var dn=function(){function e(){this._state=0}var t,n,i;return t=e,(n=[{key:"state",get:function(){return this._state},set:function(e){r.ULS.sendTraceTag(5849616,202,50,"Changing event result state. {0}",{OldState:sn[this._state],NewState:sn[e]},"ResultType",this.getResultLogString()),this._state=e}}])&&un(t.prototype,n),i&&un(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function hn(e,t){return(hn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(dn,"AEventResult",null,[234]);var gn=function(e){var t,n,i,r,a;function o(){var t;return(t=e.call(this)||this)._personalFileStorageUrl=null,t._storageServiceDisplayName=null,t.state=0,t._instantiatingPersonalStorage=!1,t._invalidResponse=!1,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,hn(t,n),o.prototype.getResultLogString=function(){return"GetMoreInfo Result"},i=o,(r=[{key:"personalFileStorageUrl",get:function(){return this._personalFileStorageUrl}},{key:"storageServiceDisplayName",get:function(){return this._storageServiceDisplayName}},{key:"instantiatingPersonalStorage",get:function(){return this._instantiatingPersonalStorage}},{key:"invalidResponse",get:function(){return this._invalidResponse}}])&&pn(i.prototype,r),a&&pn(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(dn);Object(i.a)(gn,"GetMoreInfoResult",dn,[250,234]);var mn=n(80),fn=n(473),vn=n(470);function _n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var yn=function(){function e(e,t,n,i,a,o,l,c){var u=this;this.openUrlInNewTab=function(e,t,n,i,a){var o=a;if(a&&o.MenuItemId){r.ULS.sendTraceTag(5849678,202,50,"Opening new tab {0}",{Id:o.SourceControlId,AppType:vn.a[u.newAndOpenOfficeAppType]});var s=o.MenuItemId.toString();ut.a.safelyOpenWindow(s,"_blank",void 0,"NewAndOpenCommonHelpers:OpenUrlInNewTab")}return 32},this.openDocumentUrl=function(e,t,n,i,a){var o=a;if(a&&o.MenuItemId){var l=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacInTabOpenMRUIsEnabledForUiHost"),c=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures");if(r.ULS.sendTraceTag(592237459,202,50,"[InTabOpenMRUIsEnabledForUiEmbed: {0}][UiEmbedSupportsDocReboot: {1}]",l,c),l&&c){r.ULS.sendTraceTag(592237458,202,50,"Opening new tab {0}",{Id:o.SourceControlId,AppType:vn.a[u.newAndOpenOfficeAppType]});var p=o.MenuItemId.toString(),h={};h[mn.a.rebootMode]="1",h[mn.a.documentUrl]=p,h[mn.a.reason]=fn.a.open,r.ULS.sendTraceTag(592237460,202,50,"Send PostMessage to the Ui host to reboot a document"),s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.documentRefresh,h)}))}else u.openUrlInNewTab(e,t,n,i,a)}return 32},this.documentLoaded=function(e,t,n,i,r){return u.logNewAndOpenPerfStats(),32},this._actionManager=e,this._clientRequestManager=t,this._appFrame=n,this._appType=i,this._taskManager=a,this._getCurrentTime=o,this._handlerUrlPrefix=l,this._supportsGetMoreInfoForPersonalStorage=c}var t,n,i,a=e.prototype;return a.registerCommonActions=function(){this.newAndOpenActionManager.addAction(p.a.openUrlInNewTab,_e.a.frame,this.openUrlInNewTab),this.newAndOpenActionManager.addAction(p.a.openDocumentUrl,_e.a.frame,this.openDocumentUrl),s.AFrameworkApplication.documentLoadedTime?this.logNewAndOpenPerfStats():this.newAndOpenActionManager.addActionWithFlags(p.a.documentLoaded,_e.a.frame,this.documentLoaded,96)},a.logRequest=function(e,t,n){if(void 0===n&&(n=""),t&&t.invokedTime){var i=pt.a[t.status],a=t.invokedTime.getTime(),o=this.getCurrentTime()-a;r.ULS.sendTraceTag(5849679,202,50,"Making request to the WAC server {0}",{Caller:e,RequestStatus:i,ElapsedMs:o,StartTime:a,Notes:n})}else r.ULS.sendTraceTag(5849680,202,50,"Attempted to make a request to the WAC server with null request item {0}",{Caller:e})},a.logNewAndOpenPerfStats=function(){var e=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("QPGVCI"),t=O.a.getParameterValue(document.URL,"wdNewAndOpenCt",e);if(t){var n=parseInt(t),i=O.a.getParameterValue(document.URL,"wdPreviousSession",e),a=O.a.getParameterValue(document.URL,"wdPreviousCorrelation",e),o=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NAOPLP");if(s.AFrameworkApplication.documentLoadedTime){var l=s.AFrameworkApplication.documentLoadedTime.getTime();!n||n>l?r.ULS.sendTraceTag(5849682,202,15,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Invalid timestamp {0}",{ClickTimestamp:n,DocumentLoadedTime:l,SessionId:i,Correlation:a}):r.ULS.sendTraceTag(5849683,202,o?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Click-to-load perf {0}",{ClickToLoadTime:l-n,ClickTimestamp:n,SessionId:i,Correlation:a})}else r.ULS.sendTraceTag(5849681,202,o?15:50,"NewAndOpenCommonHelpers.LogNewAndOpenPerfStats: Not logging because document loaded time has not been set {0}",{ClickTimestamp:n,SessionId:i,Correlation:a})}},e.getAnInstanceWithResolvedDependencies=function(){return new e(new ln.a((function(){return s.AFrameworkApplication.theActionManager})),new ln.a((function(){return s.AFrameworkApplication.theClientRequestManager})),new ln.a((function(){return s.AFrameworkApplication.activeFrame})),new ln.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType})),new ln.a((function(){return s.AFrameworkApplication.theTaskManager})),(function(){return(new Date).getTime()}),new ln.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.newAndOpenHandlerUrlPrefix})),new ln.a((function(){return s.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage})))},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependencies())}}],(n=[{key:"newAndOpenActionManager",get:function(){return this._actionManager.value}},{key:"newAndOpenClientRequestManager",get:function(){return this._clientRequestManager.value}},{key:"newAndOpenAppFrame",get:function(){return this._appFrame.value}},{key:"newAndOpenOfficeAppType",get:function(){return this._appType.value}},{key:"newAndOpenTaskManager",get:function(){return this._taskManager.value}},{key:"getCurrentTime",get:function(){return this._getCurrentTime}},{key:"newAndOpenHandlerUrlPrefix",get:function(){return this._handlerUrlPrefix.value}},{key:"supportsGetMoreInfoForPersonalStorage",get:function(){return this._supportsGetMoreInfoForPersonalStorage.value}}])&&_n(t.prototype,n),i&&_n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Sn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}yn._instance=null,Object(i.a)(yn,"NewAndOpenCommonHelpers",null,[187]);var bn=function(){function e(e,t,n){this._task=null,this._serverRetryIntervalsInMsIntList=null,this._retryIndex=0,this._serverRetryIntervalsInMsString=e,this._taskManager=t,this._descriptionString=n}var t,n,i,a=e.prototype;return a.advanceRetryIndex=function(){this._retryIndex=this.retryIndex+1},a.resetRetryState=function(e){this._task&&(this._taskManager.deleteTask(this._task),this._task=null),e&&(this._retryIndex=0)},a.startNextRetryTask=function(e){var t=this.timeUntilNextRetryInMs,n=t>=0;return n?(this.advanceRetryIndex(),this.resetRetryState(!1),this._task=new u.a(4,1,t,e,107),this._taskManager.addTask(this._task)):(this.resetRetryState(!0),r.ULS.sendTraceTag(5849676,202,50,"Retries exhausted {0}",{Action:this._descriptionString})),n},t=e,(n=[{key:"retryIndex",get:function(){return this._retryIndex}},{key:"timeUntilNextRetryInMs",get:function(){return this.retryIndex>=this.serverRetryIntervalsInMsIntList.length?-1:this.serverRetryIntervalsInMsIntList[this.retryIndex]}},{key:"serverRetryIntervalsInMsIntList",get:function(){if(!this._serverRetryIntervalsInMsIntList){var e=(this._serverRetryIntervalsInMsString.value||"0").split(",");this._serverRetryIntervalsInMsIntList=[];for(var t=0;t<e.length;t++){var n=parseInt(e[t]);isNaN(n)?r.ULS.sendTraceTag(5849677,202,15,"Retry interval list contains non-number element {0}",{Action:this._descriptionString,Entry:e[t]}):Array.add(this._serverRetryIntervalsInMsIntList,n)}}return this._serverRetryIntervalsInMsIntList}}])&&Sn(t.prototype,n),i&&Sn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function An(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Cn(e,t){return(Cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(bn,"RetryHelper",null,[]);var Tn=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this)._newAndOpenCommonHelpers=t,i._retryHelper=new bn(n,i.moreInfoNewAndOpenCommonHelpers.newAndOpenTaskManager,"GetMoreInfo"),i._result=new gn,i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Cn(t,n);var a,o,l,c=i.prototype;return c.makeGetMoreInfoRequestOpenDocumentTrigger=function(){this.makeGetMoreInfoRequestInternal("Document opened")},c.createMakeGetMoreInfoRequestRetryTask=function(e){var t=this;return function(n){t.makeGetMoreInfoRequestInternal(e,!0)}},c.onResultRequested=function(e,t){return void 0===t&&(t=null),r.ULS.sendTraceTag(5849617,202,50,"Attempting to get GetMoreInfo properties {0}",{Trigger:e}),3===this._result.state?(t&&this.emitAvailableResultToReceiver(t,this._result),r.ULS.sendTraceTag(5849619,202,50,"GetMoreInfo already populated. {0}",{Trigger:e})):this.makeGetMoreInfoRequestInternal(e),this._result},c.makeGetMoreInfoRequestInternal=function(e,t){if(void 0===t&&(t=!1),this._retryHelper.resetRetryState(!t),1!==this._result.state){r.ULS.sendTraceTag(5849621,202,50,"Making GetMoreInfo request {0}",{Trigger:e,RetryIndex:this._retryHelper.retryIndex}),this._result.state=1;var n=String.format("{0}GetMoreInfoHandler.ashx?{1}",this.moreInfoNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion);this.moreInfoNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequestWithHeaderForwarding(n,1,null,null,[i._personalFileStorageUrlHeaderName,i._storageServiceDisplayNameHeaderName],!1,5,this.createGetMoreInfoFromServerSuccessCallback(e),this.createGetMoreInfoFromServerFailureCallback(e),null)}else r.ULS.sendTraceTag(5849620,202,50,"Not starting new request, because one is already in progress {0}",{Trigger:e,RetryIndex:this._retryHelper.retryIndex})},c.createGetMoreInfoFromServerSuccessCallback=function(e){var t=this;return function(e){var n,a=!1,o=!1,l=!1,c=null;if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("GetMoreInfoDataFromResponseBody"))if(e.data.responseData)if((n=H.d(e.data.responseData),c=n.deserialized,n).returnValue){var u=c;u?(l=!0,t._result._storageServiceDisplayName=u.StorageServiceDisplayName,t._result._personalFileStorageUrl=i.isValidStorageHostUrl(u.PersonalFileStorageUrl)?u.PersonalFileStorageUrl:"",""===t._result.personalFileStorageUrl&&"SharePointOnlineConsumer"===s.AFrameworkApplication.appSettingsManager.getStringAppSetting("FileSource")&&(t._result._personalFileStorageUrl=O.a.removeAllUrlParameters(s.AFrameworkApplication.breadcrumbFolderUrl)),a=""===t._result.personalFileStorageUrl&&""!==t._result.storageServiceDisplayName):r.ULS.sendTraceTag(25298113,202,15,"Response body could not be casted into a GetMoreInfoResponseData type. Will fallback to reading the data from the headers")}else r.ULS.sendTraceTag(25298112,202,15,"Failed to deserialize GetMoreInfo response body. Will fallback to reading the data from the headers");else r.ULS.sendTraceTag(25298083,202,15,"Could not find GetMoreInfo data on the response body. Will fallback to reading the data from the headers");if(!l){var d=e.data.responseHeaders;if(d){t._result._storageServiceDisplayName=(d[i._storageServiceDisplayNameHeaderName]||"").toString();var p=(d[i._personalFileStorageUrlHeaderName]||"").toString();t._result._personalFileStorageUrl=i.isValidStorageHostUrl(p)?p:"",""===t._result.personalFileStorageUrl&&"SharePointOnlineConsumer"===s.AFrameworkApplication.appSettingsManager.getStringAppSetting("FileSource")?(t._result._personalFileStorageUrl=O.a.removeAllUrlParameters(s.AFrameworkApplication.breadcrumbFolderUrl),a=""===t._result.personalFileStorageUrl&&""!==t._result.storageServiceDisplayName):a=""===p&&""!==t._result.storageServiceDisplayName}else r.ULS.sendTraceTag(5849622,202,50,"Null response headers received."),o=!0}var h=String.format("Success at RetryIndex: {0}, InvalidResponse: {1}, InstantiatingPersonalStorage: {2}, InfoFoundInResponseBody: {3}",t._retryHelper.retryIndex,o,a,l);t.moreInfoNewAndOpenCommonHelpers.logRequest("GetMoreInfoActor.CreateGetMoreInfoFromServerSuccessCallback",e.data,h),t.setAndEmitResultState(3,a,o)}},c.createGetMoreInfoFromServerFailureCallback=function(e){var t=this;return function(n){t.moreInfoNewAndOpenCommonHelpers.logRequest("GetMoreInfoActor.CreateGetMoreInfoFromServerFailureCallback",n.data,"Failure"),t.setAndEmitResultState(2),t._retryHelper.startNextRetryTask(t.createMakeGetMoreInfoRequestRetryTask(e))}},c.setAndEmitResultState=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),this._result.state=e,this._result._instantiatingPersonalStorage=t,this._result._invalidResponse=n,this.emitDeferredResultToWaitingReceivers(this._result)},i.getAnInstanceWithResolvedDependencies=function(){return new i(new ln.a((function(){return yn.instance})),new ln.a((function(){return s.AFrameworkApplication.getMoreInfoRetryIntervalsInMs})))},i.isValidStorageHostUrl=function(e){return e?!!Ze.a.toLower(e).startsWith("https://")||(r.ULS.sendTraceTag(5849625,202,10,"StorageUrl has invalid scheme."),!1):(r.ULS.sendTraceTag(5849624,202,50,"Attempted to check an empty url for validity as a StorageHostUrl."),!1)},a=i,l=[{key:"instance",get:function(){return i._instance||(i._instance=i.getAnInstanceWithResolvedDependencies())}}],(o=[{key:"moreInfoNewAndOpenCommonHelpers",get:function(){return this._newAndOpenCommonHelpers.value}}])&&An(a.prototype,o),l&&An(a,l),Object.defineProperty(a,"prototype",{writable:!1}),i}(cn);function kn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Tn._personalFileStorageUrlHeaderName="PersonalFileStorageUrl",Tn._storageServiceDisplayNameHeaderName="StorageServiceDisplayName",Tn._instance=null,Object(i.a)(Tn,"GetMoreInfoActor",cn,[]);var wn=function(){function e(e,t,n,i,r){this._inactivityCheckInterval=6e4,this.inactiveActionId="inactive",this.activeActionId="active",this._isActive=!0,this._taskManager=e,this._getLatestActivityTime=t,this._getCurrentTime=n,this._timeUntilInactiveInMs=i,this._eventSource=new a.a,r&&this.startInactiveLoop(),this._lastActivityTime=this.getLatestActivityTime()}var t,n,i,o=e.prototype;return o.addBackFromInactiveAction=function(e){this._eventSource.addHandler(this.activeActionId,e)},o.addOnInactiveAction=function(e){this._eventSource.addHandler(this.inactiveActionId,e)},o.startInactiveLoop=function(){var e=new u.a(5,2,this._inactivityCheckInterval,Object(A.a)(this,this.inactiveLoop,"inactiveLoop"),108);this.inactivityTaskManager.addTask(e)},o.inactiveLoop=function(e){var t=this.getLatestActivityTime(),n=this.getCurrentTime()-t;n>this.timeUntilInactiveInMs&&this._isActive&&(r.ULS.sendTraceTag(5849626,202,50,"User went inactive {0}",{TimeSinceLastActive:n}),this._isActive=!1,this._eventSource.raiseEvent(this.inactiveActionId)),t-this._lastActivityTime>this.timeUntilInactiveInMs&&(this._isActive=!0,this._eventSource.raiseEvent(this.activeActionId)),this._lastActivityTime=t},e.getAnInstanceWithResolvedDependencies=function(){return new e(new ln.a((function(){return S.TaskManager.instance})),(function(){return s.AFrameworkApplication.latestActivityTime.getTime()}),(function(){return(new Date).getTime()}),new ln.a((function(){return s.AFrameworkApplication.timeUntilInactiveInMs})),!0)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependencies())}}],(n=[{key:"inactivityTaskManager",get:function(){return this._taskManager.value}},{key:"getLatestActivityTime",get:function(){return this._getLatestActivityTime}},{key:"getCurrentTime",get:function(){return this._getCurrentTime}},{key:"timeUntilInactiveInMs",get:function(){return this._timeUntilInactiveInMs.value}}])&&kn(t.prototype,n),i&&kn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();wn._instance=null,Object(i.a)(wn,"InactivityManager",null,[]);var In=function(e){if(!e)return null;var t;try{t=H.b(e)}catch(e){t=null,r.ULS.sendTraceTag(578352835,202,15,"MruActor.TryDeserializeMruV2Response: SecureDeserialize Exception: {0}",e)}return t},Pn=function(e,t){var n=new Array(0);if(e.breadcrumbs&&e.breadcrumbs.length>0)n=e.breadcrumbs;else{var i=e.service_info;i&&i.friendly_service_name&&Array.add(n,i.friendly_service_name),e.display_path&&Array.addRange(n,e.display_path)}return n.join(t?" \xab ":" \u200f\xbb ")};function Fn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function En(e,t){return(En=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var On=function(e){var t,n,i,r,a;function o(){var t;return(t=e.call(this)||this)._mruEntries=null,t._mruPlaces=null,t._mruDocuments=null,t._timestampOfLastUpdate=0,t.state=0,t._invalidResponse=!1,t}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,En(t,n),o.prototype.getResultLogString=function(){return"MruActor Result"},i=o,(r=[{key:"mruEntries",get:function(){return this._mruEntries}},{key:"mruPlaces",get:function(){return this._mruPlaces}},{key:"mruDocuments",get:function(){return this._mruDocuments}},{key:"timestampOfLastUpdate",get:function(){return this._timestampOfLastUpdate}},{key:"invalidResponse",get:function(){return this._invalidResponse}}])&&Fn(i.prototype,r),a&&Fn(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(dn);function Mn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(On,"MruResult",dn,[233,234]);var Ln=function(){function e(e,t,n){this.task=null,this.initialRetryInterval=e,this.maxRetries=t,this.taskManager=n,this.internalRetryCount=0,this.retryCount=0,this.lastHttpStatusCode=null,this._previousError=null}var t,n,i,a=e.prototype;return a.isPermanentError=function(e,t){return e===M.a.forbidden_403||20===t||18===t||3===t},a.isRetriableOnceError=function(e){return 3===e||5===e||6===e||7===e||9===e||10===e||11===e||12===e||13===e||14===e||15===e||16===e||23===e||26===e||27===e||28===e},a.reset=function(){this.retryCount=0,this.internalRetryCount=0,this.lastHttpStatusCode=null,this._previousError=null,this.task&&(this.taskManager.deleteTask(this.task),this.task=null)},a.initiateRetry=function(e,t,n,i){if(this._previousError=String.format("{0}_{1}",n,i),this.retryCount>=this.maxRetries)return r.ULS.sendTraceTag(562656907,202,50,"Max retries exceeded"),!1;if(this.isPermanentError(n,i))return r.ULS.sendTraceTag(562656908,202,50,"Encountered permanent error. Not retrying"),!1;if(this.isRetriableOnceError(i)&&this.internalRetryCount>=1)return this.lastHttpStatusCode=n,!1;var a=Math.max(t,this.initialRetryInterval*Math.pow(2,this.internalRetryCount));return 26===i?a=Math.max(a,3e4):27!==i&&28!==i||(a=Math.max(a,6e4)),9===i||412===n&&(null==this.lastHttpStatusCode||412!==this.lastHttpStatusCode)?a=500:this.internalRetryCount=this.internalRetryCount+1,this.lastHttpStatusCode=n,this.retryCount=this.retryCount+1,this.task&&this.taskManager.deleteTask(this.task),r.ULS.sendTraceTag(562656909,202,50,"Scheduling next retry after {0} ms.",a),this.task=new u.a(2,1,a,e,107),this.taskManager.addTask(this.task),!0},t=e,(n=[{key:"previousError",get:function(){return this._previousError}}])&&Mn(t.prototype,n),i&&Mn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ln,"RetryManager",null,[]);var Rn=function(){this.documentUrl=null,this.folderName=null,this.documentName=null,this.documentExt=null,this.app=null,this.mruItemId=null};Object(i.a)(Rn,"WriteOptions",null,[]);var Dn=n(209);function xn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Bn(e,t){return(Bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Un=function(e){var t,n;function i(t,n,i,r,a,o,c){var u;return(u=e.call(this)||this).writeMruV2EntryOnServerSuccessCallback=function(e){u.handleMruV2WriteSuccess(e.data)},u.createWriteMruV2EntryOnServerFailureCallback=function(e){if(e.data.httpStatus!==M.a.created_201){var t=e.data.httpStatus===M.a.preconditionFailed_412,n=G.a.createExtendedPropertiesMap();u.handleRetryOnFailure(u._writeRetryManager,e,u.createV2WriteRetryTask(),n),n&&(n.set("StatusCode",e.data.httpStatus.toString()),t||u.addDiagnosticDataToKpi(e.data,n)),l.Health.instance.recordKpiFailure("WriteMru",String.format("RequestFailed_{0}",e.data.httpStatus),t,!1,Object.assign(new Z.a,{extendedProperties:n}))}else u.handleMruV2WriteSuccess(e.data)},u.getMruV2FromServerSuccessCallback=function(e){u.getMruV2FromServerWhenSuccess(e)},u.getMruV2ForRecentLinksFromServerSuccessCallback=function(e){u.getMruV2FromServerWhenSuccess(e,!0)},u.getMruFromServerFailureCallback=function(e){u.getMruFromServerWhenFailure(e)},u.getMruForRecentLinksFromServerFailureCallback=function(e){u.getMruFromServerWhenFailure(e,!0)},u._newAndOpenCommonHelpers=t,u._localeName=n,u._readRetryManager=new Ln(s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruReadRetryIntervalMs",5e3),s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruMaxReadRetry",3),u.openMenuNewAndOpenCommonHelpers.newAndOpenTaskManager),u._writeRetryManager=new Ln(s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruWriteRetryIntervalMs",15e3),s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruMaxWriteRetry",3),u.openMenuNewAndOpenCommonHelpers.newAndOpenTaskManager),u._readPlacesFromMru=i,u._writeFileIdInHeader=r,u._writeHeaders={},u._mruResult=new On,u._getClientUrl=a,u._mruItemId="",u._docPropertiesProvider=o,u._encodeUrl=c,u._recentLinksMruJson="",u._recentLinksCount=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("WordRecentLinksCount",25),u}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Bn(t,n);var a,o,c,u=i.prototype;return u.registerWriteMruActions=function(){this.openMenuNewAndOpenCommonHelpers.newAndOpenActionManager.addAction(p.a.renameMostRecentlyUsedFileEntry,_e.a.frame,Object(A.a)(this,this.renameMruEntry,"renameMruEntry"))},u.renameMruEntry=function(e,t,n,i,r){return this.writeToMruV2Internal("Rename")},u.makeUpdateMruRequestOpenTrigger=function(){this.makeUpdateMruRequestInternal("File Opened")},u.makeUpdateMruTask=function(e){this.makeUpdateMruRequestInternal("IntervalUpdate")},u.makeUpdateMruRequestInternal=function(e){r.ULS.sendTraceTag(5849670,202,50,"Starting update of MRU entry {0}",{Trigger:e}),this.writeToMruV2Internal(e)},u.getFileExtension=function(e){var t=Ze.a.getFileExtension(e);return t&&t.startsWith(".")&&(t=t.substring(1,t.length)),t},u.getAppName=function(){switch(this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType){case 3:return"Word";case 1:return"Excel";case 2:return"PowerPoint";case 5:return"Visio";case 4:return"OneNote";default:return"Unknown"}},u.getV2WriteBody=function(e){var t=this._getClientUrl();if(!t)return null;var n=new Rn;this._encodeUrl.value?n.documentUrl=encodeURI(t):n.documentUrl=t,n.mruItemId=this._mruItemId,n.app=this.getAppName();var i=this._docPropertiesProvider();if(i){n.folderName=i.breadcrumbFolderName;var r=i.breadcrumbDocName;n.documentName=Ze.a.getFileNameWithoutExtension(r),n.documentExt=this.getFileExtension(r)}return e&&(n.documentName?n.documentName.length?n.documentName.length>=255?e.set("DocumentNameLength","Long"):n.documentName.length>=2084&&e.set("DocumentNameLength","VeryLong"):e.set("DocumentNameLength","0"):e.set("DocumentNameLength","Null")),JSON.stringify(n)},u.writeToMruV2Internal=function(e,t){if(void 0===t&&(t=!1),4===this.openMenuNewAndOpenCommonHelpers.newAndOpenOfficeAppType&&!s.AFrameworkApplication.documentIsFolder)return 2;var n=G.a.createExtendedPropertiesMap();n&&(n.set("Trigger",e),n.set("IsRetry",t?"true":"false"),n.set("MruIdSent",this._mruItemId?"true":"false"),n.set("URLEncoded",this._encodeUrl.value?"true":"false")),l.Health.instance.recordKpiUsage("WriteMru",0,"smartfio",n);var i=this.getV2WriteBody(n);if(!i){var r=!s.AFrameworkApplication.webEditingEnabled;return n&&(n.set("WebEditingIsEnabled",s.AFrameworkApplication.webEditingEnabled?"true":"false"),n.set("ProtectedFile",s.AFrameworkApplication.protectFile?"true":"false")),l.Health.instance.recordKpiFailure("WriteMru","MissingDocumentUrl",r,!1,Object.assign(new Z.a,{extendedProperties:n})),2}this._writeRetryManager&&!t&&this._writeRetryManager.reset();var a=String.format("{0}MruV2ServiceHandler.ashx?rs={1}",this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix,this.localeName);return this._writeFileIdInHeader?this.writeHeaders["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:a+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),s.AFrameworkApplication.sessionStartInfoSettings&&(this.writeHeaders["X-Office-AudienceGroup"]=Object(F.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.AudienceGroup)||""),this.writeHeaders["X-Timeout"]=15e3,this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(a,2,i,this.writeHeaders,!0,5,this.writeMruV2EntryOnServerSuccessCallback,this.createWriteMruV2EntryOnServerFailureCallback,null,void 0,void 0,void 0,void 0,"4")},u.handleMruV2WriteSuccess=function(e){var t=G.a.createExtendedPropertiesMap();this._writeRetryManager&&(t&&this._writeRetryManager.previousError&&(t.set("LastError",this._writeRetryManager.previousError),t.set("NumRetries",this._writeRetryManager.retryCount.toString())),this._writeRetryManager.reset());var n=In(e.responseData);n&&n.diagnostics_data&&(this._mruItemId=n.diagnostics_data.mru_id);var i=+e.completedTime-+e.invokedTime;t&&t.set("RequestDuration",i.toString()),l.Health.instance.recordKpiSuccess("WriteMru",Object.assign(new Z.a,{extendedProperties:t}))},u.createV2WriteRetryTask=function(){var e=this;return function(t){e.writeToMruV2Internal("Retry",!0)}},u.getMruFromServerTask=function(e){this.makeGetMruRequestInternal("Polling")},u.getMruFromServerRetryTask=function(e){this.makeGetMruRequestInternal("Retry",!0)},u.makeGetMruRequestOpenTrigger=function(){this.makeGetMruRequestInternal("Open")},u.makeGetMruRequestActivityTrigger=function(){this.makeGetMruRequestInternal("Activity")},u.makeGetMruForRecentLinksRequestActivityTrigger=function(){this.makeGetMruRequestInternal("ActivityRecentLinks",!1,!0)},u.makeGetMruRequestInternal=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),r.ULS.sendTraceTag(5849674,202,50,"Making GetMru request {0}",{Trigger:e});var i=G.a.createExtendedPropertiesMap();i&&(i.set("Trigger",e),i.set("IsRetry",t?"true":"false"),n&&i.set("RecentLinks","true")),l.Health.instance.recordKpiUsage("GetMru",0,"smartfio",i),this._readRetryManager&&!t&&this._readRetryManager.reset(),n?this.createGetMruServerRequest(this.getMruV2ForRecentLinksFromServerSuccessCallback,this.getMruForRecentLinksFromServerFailureCallback,!0):this.createGetMruServerRequest(this.getMruV2FromServerSuccessCallback,this.getMruFromServerFailureCallback)},u.addDiagnosticDataToKpi=function(e,t){if(e&&e.responseHeaders){var n=e.responseHeaders["X-CorrelationId"];n&&t.set("ServerCorrelationId",n)}},u.logGetMruKpiSuccess=function(e,t){if(e){if(t){var n=+e.completedTime-+e.invokedTime;t.set("RequestDuration",n.toString())}l.Health.instance.recordKpiSuccess("GetMru",Object.assign(new Z.a,{extendedProperties:t}))}},u.getMruV2FromServerWhenSuccess=function(e,t){void 0===t&&(t=!1);var n="",i=null,a=null,o=null,c=In(e.data.responseData);c&&(i=c.places?c.places.items:[],a=c.documents?c.documents.items:[],(o=function(e,t){if(void 0===t&&(t=!1),!e)return[];if(!e.documents)return r.ULS.sendTraceTag(578352838,202,15,"missing documents object"),[];if(!e.documents.items)return r.ULS.sendTraceTag(578352839,202,15,"missing items object"),[];for(var n,i,a=e.documents.items,o=new te.a,l=0;l<a.length;l++){var c=a[l],u=c.web_url;if(!u){if(r.ULS.sendTraceTag(578320064,202,15,"Empty web_url"),!c.url){r.ULS.sendTraceTag(578140248,202,15,"Empty url");continue}u=String.format("{0}?web=1",c.url)}var d={};d.DocumentUrl=u,d.MruId=c.mru_id,d.FileName=(i=void 0,(i=(n=c).title)?(n.extension&&(i=String.format("{0}.{1}",i,n.extension)),i):(r.ULS.sendTraceTag(578352837,202,15,"empty file title"),"")),d.IsPinned=c.is_pinned,d.Path=Pn(c,s.AFrameworkApplication.isRtl),t&&(d.App=c.app,d.TimeStamp=c.time_stamp),o.add(d)}return o.toArray()}(c,t))&&(n=H.c(o))),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactFileMenuUxEnabled&&Ot.c()&&(t?this._recentLinksMruJson=n:appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson(n,!0)));var u=G.a.createExtendedPropertiesMap();this._readRetryManager&&(u&&this._readRetryManager.previousError&&(u.set("LastError",this._readRetryManager.previousError),u.set("NumRetries",this._readRetryManager.retryCount.toString())),this._readRetryManager.reset()),t&&u&&u.set("RecentLinks","true"),o||i||a?(t?this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2ForRecentLinksFromServerSuccessCallback",e.data,"Success"):this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2FromServerSuccessCallback",e.data,"Success"),this.updateMruResultState(3,o,i,a),this.logGetMruKpiSuccess(e.data,u)):(t?this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2ForRecentLinksFromServerSuccessCallback",e.data,"Failure: Invalid JSON"):this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruV2FromServerSuccessCallback",e.data,"Failure: Invalid JSON"),u&&this.addDiagnosticDataToKpi(e.data,u),l.Health.instance.recordKpiFailure("GetMru","JsonParseFailed",!1,!1,Object.assign(new Z.a,{extendedProperties:u})),this.updateMruResultState(3,null,null,null,!0)),this.emitDeferredResultToWaitingReceivers(this._mruResult)},u.handleRetryOnFailure=function(e,t,n,i){var r=0,a=0,o=In(t.data.responseData);if(o&&(null!=o.response_code&&(r=o.response_code,i&&i.set("MruResponseCode",r.toString()),9===r&&(this._mruItemId="")),o.error_data&&null!=o.error_data.retry_after_ms&&(a=o.error_data.retry_after_ms,i&&i.set("ExpectedRetryAfter",a.toString()))),e){var s=e.initiateRetry(n,a,t.data.httpStatus,r);i&&(i.set("CurrentRetryCount",e.retryCount.toString()),i.set("RetryScheduled",s?"true":"false"))}},u.getMruFromServerWhenFailure=function(e,t){void 0===t&&(t=!1);var n=e.data.httpStatus===M.a.preconditionFailed_412,i=G.a.createExtendedPropertiesMap();i&&(i.set("StatusCode",e.data.httpStatus.toString()),t&&i.set("RecentLinks","true"),n||this.addDiagnosticDataToKpi(e.data,i)),t?this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruForRecentLinksFromServerFailureCallback",e.data,"Failure"):this.openMenuNewAndOpenCommonHelpers.logRequest("MruActor.GetMruFromServerFailureCallback",e.data,"Failure"),this.updateMruResultState(2),this.handleRetryOnFailure(this._readRetryManager,e,Object(A.a)(this,this.getMruFromServerRetryTask,"getMruFromServerRetryTask"),i),l.Health.instance.recordKpiFailure("GetMru",String.format("RequestFailed_{0}",e.data.httpStatus),n,!1,Object.assign(new Z.a,{extendedProperties:i})),this.emitDeferredResultToWaitingReceivers(this._mruResult),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactFileMenuUxEnabled&&Ot.c()&&(appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson("",!1)),t?this._recentLinksMruJson=null:appChrome.api.dispatch(appChrome.actions.setFileMenuMRUJson("",!1)))},u.updateMruResultState=function(e,t,n,i,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=!1),3===this._mruResult.state&&3!==e||(this._mruResult._mruEntries=t,this._mruResult._mruPlaces=n,this._mruResult._mruDocuments=i,this._mruResult.state=e,this._mruResult._invalidResponse=r,this._mruResult._timestampOfLastUpdate=this.openMenuNewAndOpenCommonHelpers.getCurrentTime())},u.onResultRequested=function(e,t){return r.ULS.sendTraceTag(6029918,202,50,"MRU result requested {0}",{Trigger:e,ResultState:this._mruResult.state}),t&&3===this._mruResult.state&&this.emitAvailableResultToReceiver(t,this._mruResult),this._mruResult},u.createGetMruServerRequest=function(e,t,n){var i;void 0===n&&(n=!1),this.updateMruResultState(1);var r={};i=n?String.format(this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix+"MruV2ServiceHandler.ashx?sort=Date&show={0}&apps={1}&rs={2}&cap={3}",this._recentLinksCount,"OfficeSuite",this.localeName,"ClassicMru"):String.format(this.openMenuNewAndOpenCommonHelpers.newAndOpenHandlerUrlPrefix+"MruV2ServiceHandler.ashx?sort=Date&show={0}&apps={1}&rs={2}",10,this.getAppName(),this.localeName),this._readPlacesFromMru.value||(i+="&entity=docs"),s.AFrameworkApplication.sessionStartInfoSettings&&(r["X-Office-AudienceGroup"]=Object(F.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.AudienceGroup)||""),n&&(r["X-Office-Application"]="147"),this._writeFileIdInHeader?r["X-FileId"]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion:i+=String.format("&{0}",s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion),this.openMenuNewAndOpenCommonHelpers.newAndOpenClientRequestManager.addRequest(i,1,null,r,!0,5,e,t,null)},u.tryDeserializeJson=function(e){var t;try{t=H.b(e)}catch(e){t=null,r.ULS.sendTraceTag(5849675,202,10,"MruActor.TryDeserializeJson: Exception thrown from JsonSerializer.SecureDeserialize Exception: {0}",e)}return t},i.getAnInstanceWithResolvedDependencies=function(){return new i(new ln.a((function(){return yn.instance})),new ln.a((function(){return Dn.a.getCultureInfo(s.AFrameworkApplication.lcid).name})),new ln.a((function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled})),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MruWriteFileIdInHeader"),(function(){return s.AFrameworkApplication.activeFrame.applicationInstance.clientUrl}),(function(){return s.AFrameworkApplication.docPropertiesProvider}),new ln.a((function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled")})))},a=i,c=[{key:"instance",get:function(){return i._instance||(i._instance=i.getAnInstanceWithResolvedDependencies())}}],(o=[{key:"writeHeaders",get:function(){return this._writeHeaders}},{key:"openMenuNewAndOpenCommonHelpers",get:function(){return this._newAndOpenCommonHelpers.value}},{key:"localeName",get:function(){return this._localeName.value}}])&&xn(a.prototype,o),c&&xn(a,c),Object.defineProperty(a,"prototype",{writable:!1}),i}(cn);function Hn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Un.currentDocumentDAVUrlHeaderName="CurrentDocumentDAVUrl",Un.newDocumentDAVUrlHeaderName="NewDocumentDAVUrl",Un.newFileNameHeaderName="NewFileName",Un._instance=null,Object(i.a)(Un,"MruActor",cn,[]);var Nn=function(){function e(){var e=this;this._container=null,this._readFromMruTask=null,this._updateMruTask=null,this._isDisposed=!1,this.deleteGetMruFromServerTask=function(){S.TaskManager.instance.deleteTask(e.mruReadTask)},this.addGetMruFromServerTask=function(){S.TaskManager.instance.addTask(e.mruReadTask)}}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,e.register(187,"Common.INewAndOpenCommonHelpers").singleInstance().usingFactory((function(){return yn.instance})),e.register(188,"Common.IEventEmitter<Common.IGetMoreInfoResult>").singleInstance().usingFactory((function(){return Tn.instance})),e.register(188,"Common.IEventEmitter<Common.IMruResult>").singleInstance().usingFactory((function(){return Un.instance}))},r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("Common.INewAndOpenCommonHelpers"),this._container.resolve("Common.IEventEmitter<Common.IGetMoreInfoResult>"),this._container.resolve("Common.IEventEmitter<Common.IMruResult>");var e=!1;if(yn.instance.registerCommonActions(),s.AFrameworkApplication.newDocumentDestinationHost&&(e=!0),s.AFrameworkApplication.readFromMruIsEnabled&&(Un.instance.makeGetMruRequestOpenTrigger(),s.AFrameworkApplication.mruPollingIntervalInMs>0&&this.addGetMruFromServerTask(),this.setupReadFromMruInactivityActions(),e=!0),s.AFrameworkApplication.supportsGetMoreInfoForPersonalStorage&&e&&Tn.instance.makeGetMoreInfoRequestOpenDocumentTrigger(),s.AFrameworkApplication.updateMruIsEnabled){var t=Un.instance;t.registerWriteMruActions(),t.makeUpdateMruRequestOpenTrigger(),S.TaskManager.instance.addTask(this.updateMruTask)}},r.setupReadFromMruInactivityActions=function(){wn.instance.addBackFromInactiveAction(Object(A.a)(Un.instance,Un.instance.makeGetMruRequestActivityTrigger,"makeGetMruRequestActivityTrigger")),wn.instance.addBackFromInactiveAction(this.addGetMruFromServerTask),wn.instance.addOnInactiveAction(this.deleteGetMruFromServerTask)},r.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._updateMruTask&&(S.TaskManager.instance.deleteTask(this._updateMruTask),this._updateMruTask=null))},t=e,(n=[{key:"name",get:function(){return"Common.App.NewAndOpen.Core"}},{key:"mruReadTask",get:function(){return this._readFromMruTask||(this._readFromMruTask=new u.a(5,2,s.AFrameworkApplication.mruPollingIntervalInMs,Object(A.a)(Un.instance,Un.instance.getMruFromServerTask,"getMruFromServerTask"),109))}},{key:"updateMruTask",get:function(){return this._updateMruTask||(this._updateMruTask=new u.a(2,2,6e4*s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.SharedOnline.MruUpdateIntervalInMinutes",1440),Object(A.a)(Un.instance,Un.instance.makeUpdateMruTask,"makeUpdateMruTask"),197))}}])&&Hn(t.prototype,n),i&&Hn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Nn,"CorePackageManager",null,[2,3,10]);var Wn=function(){function e(){}return e.truncateIfNecessary=function(e){if(!e)return"{NULL}";var t=e.length;if(t<=600)return e;var n=t-195;return e.substring(0,400)+"[...]"+e.substring(n,t)},e}();function jn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Wn,"LogUtils",null,[]);var Vn=function(){function e(t,n,i){var a=this;this._shellDataJsonStr=null,this._shellDataObject=null,this._shellServiceInfoStringAsyncTcs=new b.a,this.onSuccessCallback=function(e){var t=null;if(t&&t.length||!e||!e.data||(t=e.data.responseData),t&&t.length)try{var n,i=H.a(t);if(a._shellDataJsonStr=i.NavBarDataJson,r.ULS.sendTraceTag(41551899,215,50,"Skipping call to TryLoadResources for React Shared Header."),!a._shellDataJsonStr)return r.ULS.sendTraceTag(9000737,215,15,"ShellData is null"),void a._shellServiceInfoStringAsyncTcs.setCanceled();if(!(n=H.d(i.NavBarDataJson),a._shellDataObject=n.deserialized,n).returnValue)return r.ULS.sendTraceTag(7660113,215,10,"Failed to deserialize : {0}",{ShellData:Wn.truncateIfNecessary(a._shellDataJsonStr)}),void a._shellServiceInfoStringAsyncTcs.setCanceled();a.logNavBarData(a._shellDataObject),a._shellServiceInfoStringAsyncTcs.setResult(a._shellDataObject)}catch(e){r.ULS.sendTraceTag(6362370,215,10,"Unable to parse the response from O365ShellServiceProxy."),a._shellServiceInfoStringAsyncTcs.setCanceled()}else r.ULS.sendTraceTag(6362369,215,10,"Response from O365ShellServiceProxy is null.")},this.onFailureCallback=function(e){a._shellServiceInfoStringAsyncTcs.setCanceled(),r.ULS.sendTraceTag(7608091,215,10,"Call to O365ShellServiceProxy failed.")},this._clientRequestManager=t,this._officeAppType=i,this._webServiceBase=n.appSettings[e.webServiceBaseSettingName]||""}var t,n,i,a=e.prototype;return a.requestShellServiceInfo=function(){var t={};t[e.handlerQuerySigatureHeaderName]=s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,t["Content-Type"]="application/json; charset=utf-8",r.ULS.sendTraceTag(6612806,215,50,"Client is sending a request to get the code for the O365 switcher");var n=O.a.addOrReplaceParameterValue(this._webServiceBase+e.shellServiceProxyName,e.officeAppTypeParameterName,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType.toString());this.clientRequestManager.addRequest(n,1,"",t,!0,2,this.onSuccessCallback,this.onFailureCallback,null,void 0,void 0,void 0,void 0,"20")},a.logNavBarData=function(e){try{var t={};t.FlightName=e.FlightName,t.SessionID=e.SessionID,r.ULS.sendTraceTag(594883776,215,50,H.c(t))}catch(e){r.ULS.sendTraceTag(594883747,215,10,"Unable to log NavBarData")}},e.getAnInstanceWithResolvedDependecies=function(){return new e(new ln.a((function(){return s.AFrameworkApplication.theClientRequestManager})),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getAnInstanceWithResolvedDependecies())}}],(n=[{key:"shellServiceDataAsync",get:function(){return this._shellServiceInfoStringAsyncTcs.task}},{key:"clientRequestManager",get:function(){return this._clientRequestManager.value}}])&&jn(t.prototype,n),i&&jn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function qn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Vn.handlerQuerySigatureHeaderName="X-qs",Vn.officeAppTypeParameterName="at",Vn.shellServiceProxyName="O365ShellServiceProxy.ashx",Vn._instance=null,Vn.webServiceBaseSettingName="ShellWebServiceBase",Object(i.a)(Vn,"O365ShellActor",null,[189]);var Gn=function(){function e(){var e=this;this._container=null,this.onFullAppSettingsReady=function(){s.AFrameworkApplication.useO365ShellService&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactSharedHeaderUxEnabled&&e._container.resolve("Common.App.O365Shell.O365ShellActor").requestShellServiceInfo()}}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,this._container.register(Vn,"Common.App.O365Shell.O365ShellActor").as("Common.App.O365Shell.IO365ShellActor").singleInstance().usingFactory((function(){return new Vn(new ln.a((function(){return s.AFrameworkApplication.theClientRequestManager})),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)}))},r.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(this.onFullAppSettingsReady)},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.O365Shell"}}])&&qn(t.prototype,n),i&&qn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Gn,"PackageManager",null,[2,3]);var Kn=n(77);function zn(e,t){return(zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Xn=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).buttonsOption=0,t.setButtonText(1,CommonUIStrings.l_DialogClose),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,zn(t,n);var r=i.prototype;return r.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError,null)},r.displayWarning=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_OneDriveContactError,null,!0)},i}(Kn.StandardDialog);Object(i.a)(Xn,"ErrorDialog",Kn.StandardDialog,[199]);var Jn=function(){function e(){}return e.prototype.getApiEndpoint=function(){r.ULS.sendTraceTag(24134234,352,50,"Returning endpoint for ODC");var e=new b.a;return e.setResult("api.onedrive.com"),e.task},e}();Object(i.a)(Jn,"OneDriveConsumerEndpointHelper",null,[174]);var Qn=n(24);function Zn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Yn=function(){function e(e,t,n,i){this.onFilePickerClosedCallback=null,this._onApiReadyCallback=null,this._setup=!1,this._settingUp=!1,this._oneDriveApiScript=null,this._appSettingsManager=e,this._appEnvironment=t,this._limitedEdit=n,this._errorDialogFactory=i}var t,n,i,a=e.prototype;return a.getOneDriveApi=function(){return this._oneDriveApiScript||(this._oneDriveApiScript=this.oneDriveApiUrl?oe.a.create(this.oneDriveApiUrl,null,null,null,!1):null),this._oneDriveApiScript},a.setup=function(e){var t=this;if(this._onApiReadyCallback=e,this._setup||this._settingUp)this._setup&&this._onApiReadyCallback&&this._onApiReadyCallback(!0);else{var n=this.getOneDriveApi();if(!n)return r.ULS.sendTraceTag(20509837,352,15,"Failure with OneDrive API download as the onedrive url received is empty."),void this._onApiReadyCallback(!1);this._settingUp=!0,n.loadFinishedTask.continueWith((function(e){t.onOneDriveApiScriptLoaded(e)})),ae.a.enqueueResourceWithoutEnabling(n)}},a.onJsDownloadFail=function(e){r.ULS.sendTraceTag(20509838,352,15,"Failure during OneDrive API download: {0}",e.exception?e.exception.toString():"No error detail.")},a.onOneDriveApiScriptLoaded=function(e){if(this._settingUp=!1,e.isFaulted)return this.onJsDownloadFail(e),void this._onApiReadyCallback(!1);try{this._setup=!0,r.ULS.sendTraceTag(17909022,352,50,"Initializing OneDrive API"),this.initializeApi(),r.ULS.sendTraceTag(17909023,352,50,"OneDrive API is initialized."),this._onApiReadyCallback(!0)}catch(e){r.ULS.sendTraceTag(20555412,352,10,"Failed during OneDrive API init: {0}",e.toString()),this._onApiReadyCallback(!1)}},a.startPicker=function(e){this.onFilePickerClosedCallback=e,this._limitedEdit?r.ULS.sendTraceTag(23881878,216,50,"In limited edit mode, will not show Picker."):(r.ULS.sendTraceTag(23881877,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(A.a)(this,this.onApiReady,"onApiReady")))},a.onApiReady=function(e){e?this.launchFilePicker():this.showErrorDialog()},a.showErrorDialog=function(){this._errorDialogFactory().displayError(Qn.a.oneDriveFilePickerNotJSON)},a.onSuccess=function(e){r.ULS.sendTraceTag(17909057,352,50,"Success Callback called. Calling callback function."),this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!0,e)},a.dispose=function(){this._oneDriveApiScript&&this._oneDriveApiScript.dispose()},t=e,(n=[{key:"appEnvironment",get:function(){return this._appEnvironment}},{key:"appSettingsManager",get:function(){return this._appSettingsManager}}])&&Zn(t.prototype,n),i&&Zn(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ei(e,t){return(ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Yn,"AOneDriveFilePickerApiManager",null,[213,10]);var ti=function(e){var t,n;function i(t,n,i,r,a,o){var s;return(s=e.call(this,n,i,r,o)||this)._options=null,s._signOutResponse=t,s._showRequireSignInDialog=a,s}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ei(t,n);var a,o,s,l=i.prototype;return l.start=function(e,t){this._options=e,this.startPicker(t)},l.initializeApi=function(){var e=1===this.appEnvironment||2===this.appEnvironment?{client_id:this.appSettingsManager.appSettings.UploadToSkyDriveClientId}:{client_id:this.appSettingsManager.appSettings.UploadToSkyDriveClientId,env:"INT"};WL.init(e)},l.startPicker=function(e){this.onFilePickerClosedCallback=e,!this._limitedEdit&&this._signOutResponse.isAuthenticated?(r.ULS.sendTraceTag(17909025,352,50,"User is signed in. We will show file picker."),this.setup(Object(A.a)(this,this.onApiReady,"onApiReady"))):(r.ULS.sendTraceTag(17909026,352,50,"User is not signed in. show need to sign in dialog."),this._showRequireSignInDialog())},l.launchFilePicker=function(){try{r.ULS.sendTraceTag(17909027,352,50,"Launching file dialogue"),WL.fileDialog(this._options).then(Object(A.a)(this,this.onSuccess,"onSuccess"),Object(A.a)(this,this.onFailure,"onFailure"))}catch(e){r.ULS.sendTraceTag(17909056,352,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},l.onFailure=function(e){var t=e;if(e&&t.error){if("user_canceled"===t.error.code)return void r.ULS.sendTraceTag(17909058,352,50,"User canceled.");r.ULS.sendTraceTag(17909059,352,50,"File Dialog returned with error code:{0}, and error message: {1}",t.error.code,t.error.message)}else r.ULS.sendTraceTag(17909060,352,50,"File Dialog returned with no response");this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e),this.showErrorDialog()},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiUrl")}}])&&$n(a.prototype,o),s&&$n(a,s),Object.defineProperty(a,"prototype",{writable:!1}),i}(Yn);function ni(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ii(e,t){return(ii=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ti,"OneDriveFilePickerApiManagerV5",Yn,[]);var ri=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this,t,n,i,r)||this)._oneDriveApiEndpoint=null,o._hostDivElement=null,o.toggleHostDivVisibility=function(){o._hostDivElement.style.visibility="hidden"===o._hostDivElement.style.visibility?"":"hidden"},o._endpointHelper=a,o.options={},o.options.clientId=o.appSettingsManager.getStringAppSetting("OneDriveApiV7ClientId"),o.options.cancel=o.toggleHostDivVisibility,o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ii(t,n);var a,o,s,l=i.prototype;return l.start=function(e,t){var n=this;this._hostDivElement=t;var i=this._endpointHelper.getApiEndpoint();i.continueWith((function(t){r.ULS.sendTraceTag(24134241,352,50,"Fetch endpoint task completed, attempting to start OneDrive picker"),n._oneDriveApiEndpoint=i.result,n.startPicker((function(t,i){n.toggleHostDivVisibility(),e(t,i)}))}),3),i.continueWith((function(e){r.ULS.sendTraceTag(24134242,352,15,i.exception.message),n.toggleHostDivVisibility()}),5)},l.initializeApi=function(){var e=this;this.options.success=function(t){var n={};n.data=t,e.onSuccess(n)},this.options.error=function(t){var n={};n.error=t,e.onFailure(n)},this.options.advanced={},this.options.advanced.linkType="share",this.options.advanced.endpointHint=this._oneDriveApiEndpoint,this.options.advanced.iframeParentDiv=this._hostDivElement},l.launchFilePicker=function(){try{r.ULS.sendTraceTag(22090007,352,50,"Launching OneDrive file picker dialog"),this.toggleHostDivVisibility(),OneDrive.open(this.options)}catch(e){r.ULS.sendTraceTag(22090008,352,10,"Opening OneDrive file picker threw an exception: {0}",e.message),this.showErrorDialog()}},l.onFailure=function(e){this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e),this.showErrorDialog()},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&ni(a.prototype,o),s&&ni(a,s),Object.defineProperty(a,"prototype",{writable:!1}),i}(Yn);function ai(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oi(e,t){return(oi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ri,"OneDriveFilePickerApiManagerV7",Yn,[]);var si=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this)._appSettingsManager$1=t,a.options={},a.options.advanced={},a.options.action="query",a.options.clientId=a.appSettingsManager.getStringAppSetting("OneDriveApiV72ClientId"),a.options.advanced.trapFocus=!0,a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,oi(t,n);var a,o,s,l=i.prototype;return l.start=function(e,t,n,i){this.options.advanced.iframeParentDiv=n,this.options.advanced.endpointHint=i,this.options.cancel=t,this._appSettingsManager$1.getBooleanAppSetting("OneDriveApiV72RecentsViewEnabled")&&(this.options.advanced.navigation={},this.options.advanced.navigation.entryLocation={},this.options.advanced.navigation.entryLocation.oneDrive={},this.options.advanced.navigation.entryLocation.oneDrive.recent={}),this.startPicker(e)},l.startPicker=function(e){this.onFilePickerClosedCallback=e,this._limitedEdit?r.ULS.sendTraceTag(24391838,216,50,"In limited edit mode, will not show Picker."):(r.ULS.sendTraceTag(24391837,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(A.a)(this,this.onApiReady,"onApiReady")))},l.initializeApi=function(){var e=this;this.options.success=function(t){var n={};n.data=t,e.onSuccess(n)},this.options.error=function(t){var n={};n.error=t,e.onFailure(n)}},l.launchFilePicker=function(){try{r.ULS.sendTraceTag(23881879,216,50,"Launching OneDrive file picker dialog"),OneDrive.save(this.options)}catch(e){r.ULS.sendTraceTag(23881880,216,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",e.message,e.stack),this.showErrorDialog()}},l.onJsDownloadFail=function(e){r.ULS.sendTraceTag(25180160,216,15,"Failure during OneDrive API download: {0}",e.exception?e.exception.toString():"No error detail."),ae.a.removeReferenceForRetryDownload(this.oneDriveApiUrl),this._oneDriveApiScript=null},l.showErrorDialog=function(){this._errorDialogFactory().displayWarning(Qn.a.saveAsToOneDriveFailed_FilePicker)},l.onFailure=function(e){this.onFilePickerClosedCallback&&this.onFilePickerClosedCallback(!1,e)},a=i,(o=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&ai(a.prototype,o),s&&ai(a,s),Object.defineProperty(a,"prototype",{writable:!1}),i}(Yn);Object(i.a)(si,"OneDriveFilePickerApiManagerV72",Yn,[]);var li=function(e){this.key=null,this.value=null,this.olsSessionId=null,this.olsSessionId=e};function ci(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ui(e,t){return(ui=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(li,"IExtraData",null,[]);var di=function(e){var t,n,i,a,o;function l(t,n,i,r){var a;return(a=e.call(this,t,n,i,r)||this).options.advanced.filter=t.getStringAppSetting("OneDriveApiV72Filter")||"folder,photo",a.options.advanced.linkType="download",a.options.multiSelect=s.AFrameworkApplication.appSupportsMultiInsertOnlinePictureFromHost,t.getBooleanAppSetting("OneDriveApiV72CommandModeEnabled")&&(a.options.commandMode=t.getStringAppSetting("OneDriveApiV72CommandMode")||"none"),t.getBooleanAppSetting("OneDriveApiV72QosExtraDataEnabled")&&(a.options.qosExtradata=new li(s.AFrameworkApplication.userSessionId)),a}return n=e,(t=l).prototype=Object.create(n.prototype),t.prototype.constructor=t,ui(t,n),l.prototype.launchFilePicker=function(){try{var e=this.options.qosExtradata?this.options.qosExtradata.olsSessionId:"";r.ULS.sendTraceTag(26071182,352,50,"Launching OneDrive file picker dialog with filter: {0}, commandMode: {1}, QosExtraData: {2} officeSessionId: {3}",this.options.advanced.filter,this.options.commandMode,e,s.AFrameworkApplication.userSessionId),OneDrive.open(this.options)}catch(e){r.ULS.sendTraceTag(26071183,352,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",e.message,e.stack),this.showErrorDialog()}},i=l,(a=[{key:"oneDriveApiUrl",get:function(){return this.appSettingsManager.getStringAppSetting("OneDriveApiV72Url")}}])&&ci(i.prototype,a),o&&ci(i,o),Object.defineProperty(i,"prototype",{writable:!1}),l}(si);Object(i.a)(di,"OneDriveFilePickerApiOpenManagerV72",si,[]);var pi=function(){function e(e){var t=this;this._tcs=null,this.getMoreInfoFailed=function(e){if(e.data.httpStatus===M.a.preconditionFailed_412&&"X-NewKey"in e.data.responseHeaders){r.ULS.sendTraceTag(24134236,352,50,"GetMoreInfo request failed due to bad canary. Updating with new canary and resending");var n={};n["X-Key"]=e.data.responseHeaders["X-NewKey"],t.sendGetMoreInfoRequest(n)}else t._retriesRemaining>0?(r.ULS.sendTraceTag(24134237,352,50,"GetMoreInfo request failed, attmepting again. {0} retries remaining",t._retriesRemaining),t._retriesRemaining--,t.sendGetMoreInfoRequest()):(r.ULS.sendTraceTag(24134238,352,50,"GetMoreInfo request failed, and no more retries remaining. Faulting task"),t._tcs.setException(Error.create("GetMoreInfo request failed and no more retries remain")))},this.getMoreInfoSucceeded=function(e){"PersonalFileStorageUrl"in e.data.responseHeaders&&""!==e.data.responseHeaders.PersonalFileStorageUrl?(r.ULS.sendTraceTag(24134239,352,50,"Successfully received an ODB endpoint"),t._tcs.setResult(e.data.responseHeaders.PersonalFileStorageUrl)):(r.ULS.sendTraceTag(24134240,352,50,"GetMoreInfo request was successful but didn't return an ODB endpoint"),t._tcs.setException(Error.create("GetMoreInfo request succeeded but did not have ODB endpoint")))},this._clientRequestManager=e,this._retriesRemaining=3}var t=e.prototype;return t.getApiEndpoint=function(){return this._tcs=new b.a,r.ULS.sendTraceTag(24134235,352,50,"Sending initial request for OneDrive for Business Endpoint"),this.sendGetMoreInfoRequest(),this._tcs.task},t.sendGetMoreInfoRequest=function(e){void 0===e&&(e=null);var t=String.format("GetMoreInfoHandler.ashx?{0}",s.AFrameworkApplication.currentFileBaseDocQuerySignatureWithoutVersion);this._clientRequestManager.addRequestWithHeaderForwarding(t,1,null,e,["PersonalFileStorageUrl","X-NewKey"],!1,2,this.getMoreInfoSucceeded,this.getMoreInfoFailed,null,void 0,void 0,void 0,void 0,"21")},e}();Object(i.a)(pi,"OneDriveForBusinessEndpointHelper",null,[174]);var hi=n(235);function gi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var mi=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){},r.dispose=function(){},r.configure=function(e){var t=this;this._container=e,this._container.register(ti,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV5").as("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager").singleInstance().usingFactory((function(){return new ti(hi.a.instance,s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,s.AFrameworkApplication.showRequiresSignInDialog,(function(){return new Xn}))})),s.AFrameworkApplication.isSkyDrive?this._container.register(174,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").singleInstance().usingFactory((function(){return new Jn})):this._container.register(174,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").singleInstance().usingFactory((function(){return new pi(s.AFrameworkApplication.theClientRequestManager)})),this._container.register(ri,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV7").singleInstance().usingFactory((function(){return new ri(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new Xn}),t._container.resolve("Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper"))})),this._container.register(si,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV72").singleInstance().usingFactory((function(){return new si(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new Xn}))})),this._container.register(di,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiOpenManagerV72").singleInstance().usingFactory((function(){return new di(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,s.AFrameworkApplication.limitedEdit,(function(){return new Xn}))}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.OneDriveFilePickerApi"}}])&&gi(t.prototype,n),i&&gi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(mi,"PackageManager",null,[2,3]);function fi(e,t){return(fi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var vi=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).buttonsOption=0,t.setButtonText(1,CommonUIStrings.l_DialogClose),t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,fi(t,n),i.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ErrorSavingToOneDrive,null)},i}(Kn.StandardDialog);Object(i.a)(vi,"ErrorDialog",Kn.StandardDialog,[151]);var _i=function(){};_i.default=0,Object(i.a)(_i,"SaveToCloudErrorCodes",null,[]);var yi=function(){};yi.saveToCloudStorage="SaveToCloudStorage",yi.saveACopy="SaveACopy",yi.ofuHost="Open From URL",Object(i.a)(yi,"SaveToCloudStorageConstants",null,[]);var Si=function(){function e(e,t,n,i,r,a){this._options=null,this._signInFactory=e,this._signOutResponse=t,this._uploadToCloudManager=n,this._appSettingsManager=i,this._appEnvironment=r,this._errorDialogFactory=a}var t=e.prototype;return t.start=function(e){this._options=e;var t=null!==this._options&&this._options.hasOwnProperty("SaveEntryPoint")&&this._options.SaveEntryPoint.toString()===yi.saveToCloudStorage;if("SharePointOnlineConsumer"===this._appSettingsManager.getStringAppSetting("FileSource")){var n=Q.a.instance.resolve("Common.App.SaveToSharePoint.ISaveToSharePointManager");if(n)return void n.start(null,e)}if(this._signOutResponse.isAuthenticated){var i=Object(F.a)(String,s.AFrameworkApplication.sessionStartInfoSettings.Host);s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&t&&("Open From URL"===i||s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SaveToOneDriveSkipFilePicker",!1))?(r.ULS.sendTraceTag(508852051,216,15,"User is signed in. We will initiate a save for this file to user's root OneDrive location"),this._uploadToCloudManager.startUpload("root","https://onedrive.live.com",null,this._options)):(r.ULS.sendTraceTag(6590559,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"User is signed in. We will show file picker."),this.callFilePicker())}else r.ULS.sendTraceTag(6590560,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"User is not signed in. We will show sign in dialog."),this.showSignInDialog()},t.showSignInDialog=function(){this._signInFactory.create().displayDialog()},t.showErrorDialog=function(){this._errorDialogFactory().displayError(_i.default)},t.callFilePicker=function(){try{r.ULS.sendTraceTag(6590561,216,50,"Initializing OneDrive API");var e={client_id:this._appSettingsManager.appSettings.UploadToSkyDriveClientId,env:"INT"};1!==this._appEnvironment&&2!==this._appEnvironment||(e={client_id:this._appSettingsManager.appSettings.UploadToSkyDriveClientId});var t={mode:"save",lightbox:"grey"};WL.init(e),r.ULS.sendTraceTag(6590562,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"OneDrive API is initialized. Launching file dialogue"),WL.fileDialog(t).then(Object(A.a)(this,this.onSuccess,"onSuccess"),Object(A.a)(this,this.onFailure,"onFailure"))}catch(e){r.ULS.sendTraceTag(6590563,216,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",e,e.stack),this.showErrorDialog()}},t.onSuccess=function(e){r.ULS.sendTraceTag(6590592,216,50,"Success Callback called. Calling UploadToCloudManger to start upload."),e&&e.data&&e.data.folders&&this._uploadToCloudManager.startUpload(e.data.folders[0].id,e.data.folders[0].urls.viewInBrowser,null,this._options)},t.onFailure=function(e){if(e&&e.error){if("user_canceled"===e.error.code)return void r.ULS.sendTraceTag(6590593,216,50,"User cancelled upload to their OneDrive.");r.ULS.sendTraceTag(6590594,216,50,"File Dialog returned with error code:{0}, and error message: {1}",e.error.code,e.error.message)}else r.ULS.sendTraceTag(6590595,216,50,"File Dialog returned with no response");this.showErrorDialog()},e}();Object(i.a)(Si,"SaveToCloudManager",null,[150]);var bi=n(285),Ai=n(618),Ci=function(){function e(e,t,n,i){this._responseTimeToSaveToOneDriveAction=null,this._saveToCloudManager=e,this._appSettingsManager=n,this._oneDriveFilePickerApiManager=t,this._loadApiTaskCompletionSource=new b.a,this._stopwatchBuilder=i}var t=e.prototype;return t.isUIEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")},t.getActionId=function(){return p.a.saveToCloudStorage},t.callDownloadQueueActionsForOneDriveApi=function(){ae.a.registerDispatchHandler(Object(A.a)(this,this.saveToCloudActionDispatcher,"saveToCloudActionDispatcher")),ae.a.enqueueActions([new Ai.a(p.a.saveToCloudStorage,_e.a.frame,0)],this._oneDriveFilePickerApiManager.getOneDriveApi())},t.registerActions=function(){var e=this,t=this._oneDriveFilePickerApiManager.getOneDriveApi();t?(t.add_loadFinished((function(t,n){e._loadApiTaskCompletionSource.setResult(!0)})),this.callDownloadQueueActionsForOneDriveApi()):r.ULS.sendTraceTag(6590596,216,15,"Failure with OneDrive API download as the onedrive url received is empty ")},t.recordExecuteTrace=function(){r.ULS.sendTraceTag(6590597,216,50,"User clicked on SaveToOneDrive button")},t.saveToCloudActionDispatcher=function(e,t,n,i,a){var o=this,l=s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType,c="";switch(e){case p.a.saveToCloudStorage:c=yi.saveToCloudStorage;break;case p.a.saveACopy:c=yi.saveACopy;break;default:r.ULS.sendTraceTag(508372377,216,50,"SaveToCloudStorageActor Entry Point other than SaveToCloudStorage or SaveACopy")}if(t.contextId!==_e.a.frame||e!==this.getActionId())return 2;if(!this.isUIEnabled())return 8;if(1===n)return bi.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed||s.AFrameworkApplication.isMandatoryLabellingMode?8:32;if(2===n){this.recordExecuteTrace();var u=l&&c===yi.saveToCloudStorage&&null===a&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("FilePickerSkip_AfterSignIn_Fix")?{}:a;return u&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("EntryPoint_SaveToCloudStorage")&&(u.SaveEntryPoint=c),u&&u.FileDownloadUrl&&r.ULS.sendTraceTag(50708835,216,50,"SaveToCloudStorageActor FileDownloadUrl is there"),this._stopwatchBuilder&&(this._responseTimeToSaveToOneDriveAction=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown","SaveToOneDriveReponseTime")),this._loadApiTaskCompletionSource.task.continueWith((function(e){o._responseTimeToSaveToOneDriveAction&&(o._responseTimeToSaveToOneDriveAction.stop(),o._responseTimeToSaveToOneDriveAction=null),o._saveToCloudManager.start(u)})),32}return 8},e}();function Ti(e,t){return(Ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ci,"SaveToCloudStorageActor",null,[149]);var ki=function(e){var t,n;function i(t,n,i){var a;return(a=e.call(this)||this).inputHandler=function(e,t){if(0===e)return r.ULS.sendTraceTag(6590598,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"User dismissed SignIn Dialog."),void a.hide();a.performSignIn()},a.onSignIn=function(e,t){a.isShowing&&a.hide(),r.ULS.sendTraceTag(7143885,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"User signed in successfully. Calling Savetocloudstorage action handler"),a._actionManager.processAction(p.a.saveToCloudStorage,2)},a._actionManager=t,a._signOutResponse=n,a._aframeApplication=i,a._hideOnButtonClick=!1,a.buttonsOption=1,a.setDefaultButton(1),a.setButtonText(1,CommonUIStrings.l_SignIn),a.setButtonText(0,CommonUIStrings.l_SignInToSaveDialogCancelButton),a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ti(t,n);var a=i.prototype;return a.displayDialog=function(){this._signOutResponse.add_authenticationRestored(this.onSignIn),this.messageBox(CommonUIStrings.l_SignInToSaveDialogTitle,CommonUIStrings.l_SaveToCloudSignInDialog,0,this.inputHandler)},a.checkApp=function(){var e="2";if(this._aframeApplication)switch(this._aframeApplication.officeAppType){case 3:e="0";break;case 2:e="3";break;case 1:e="1"}return e},a.hide=function(){this._signOutResponse.remove_authenticationRestored(this.onSignIn),e.prototype.hide.call(this)},a.performSignIn=function(){var e=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SignInAspxInWebAppsPortalIsEnabled")?"/start/signin.aspx":"Signin.aspx",t=new K.QueryStringBuilder(e);t.addParam("prompt","1"),t.addParam("cbcxt",this.checkApp()),s.AFrameworkApplication.addCommonUrlParameters(t),ut.a.safelyOpenWindow(t.toString(),"LoginWindow",void 0,"SignInDialog")},i}(Kn.StandardDialog);Object(i.a)(ki,"SignInDialog",Kn.StandardDialog,[167]);var wi=function(){function e(e,t,n){this._actionManager=e,this._signOutResponse=t,this._aframeApplication=n}return e.prototype.create=function(){return new ki(this._actionManager,this._signOutResponse,this._aframeApplication)},e}();Object(i.a)(wi,"SignInDialogFactory",null,[148]);var Ii=n(413),Pi=function(){function e(e,t,n,i,r,a,o){this._webServiceBase=e,this._fileName=t,this._fileNewName=n,this._folderId=i,this._querySig=r,this._handlerName=a,this._options=o}return e.prototype.execute=function(e,t){if(!s.AFrameworkApplication.isShuttingDown&&s.AFrameworkApplication.theClientRequestManager){var n={"Content-Type":"application/json; charset=utf-8"};Ii.a.logUniqueUsage("ib994913;b48ce942");var i=s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseGraphFileUploaderForSkyDriveUploadHandler",!1),a=s.AFrameworkApplication.theClientRequestManager.wacaadToken,o=!!a,l=i&&o;l?(n["X-UseGraphFileUploader"]="1",n["X-AADToken"]=a):(this._webServiceBase="/start/",this._handlerName.startsWith("/start/")&&(this._handlerName=this._handlerName.substring(7))),r.ULS.sendTraceTag(507908319,216,50,"Use GraphFileUploader:{0}, flight enabled:{1}, token available:{2}",l,i,o);var c=this._webServiceBase+this._handlerName;c=O.a.addOrReplaceParameterValue(c,"fo",Ze.a.urlKeyValueEncode(this._folderId)),c=O.a.addOrReplaceParameterValue(c,"fn",Ze.a.urlKeyValueEncode(this._fileName)),c=O.a.addOrReplaceParameterValue(c,"qs",Ze.a.urlKeyValueEncode(this._querySig)),c=O.a.addOrReplaceParameterValue(c,"n",Ze.a.urlKeyValueEncode((new Date).getTime().toString())),this._options&&this._options.FileDownloadUrl&&(c=O.a.addOrReplaceParameterValue(c,"furl",Ze.a.urlKeyValueEncode(this._options.FileDownloadUrl))),this._fileNewName&&(c=O.a.addOrReplaceParameterValue(c,"fnn",Ze.a.urlKeyValueEncode(this._fileNewName))),s.AFrameworkApplication.theClientRequestManager.addRequest(c,1,"",n,!1,2,e,t,null)}},e}();Object(i.a)(Pi,"SkyDriveUploadCaller",null,[166]);var Fi=function(){function e(e){this._appSettingsManager=e,this._webServiceUrl=e.appSettings.SkyDriveUploadWebServiceBase,this._fileName=e.appSettings.FileName,this._handlerName=e.getStringAppSetting("SkyDriveUploadHandler")||"skydriveuploadhandler.ashx"}return e.prototype.create=function(e,t,n){return new Pi(this._webServiceUrl,this._fileName,t,e,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,this._handlerName,n)},e}();Object(i.a)(Fi,"SkydriveUploadCallerFactory",null,[147]);var Ei=function(){function e(e,t,n,i,r){this._caller=null,this._progressDialog=null,this._folderUrl=null,this._failedCanary=!1,this._uploadTimeStopwatch=null,this._options=null,this._uploadCallerFactory=e,this._progressDialogFactory=t,this._errorDialogFactory=n,this._activeFrame=i,this._stopwatchBuilder=r}var t=e.prototype;return t.showWaitUI=function(){this._activeFrame&&1===this._activeFrame.state||(this._progressDialog=this._progressDialogFactory(),this._progressDialog.message=CommonUIStrings.l_CommentProgressTooltip,this._progressDialog.buttonsOption=5,this._progressDialog.hasCloseGlyph=!1,this._progressDialog.showProgressDialog(CommonUIStrings.l_DefaultDialogTitle,null,null))},t.dismissWaitUI=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},t.showErrorUI=function(){1!==s.AFrameworkApplication.activeFrame.state&&this._errorDialogFactory().displayError(_i.default)},t.redirectToFolder=function(){r.ULS.sendTraceTag(6590599,216,50,"Redirecting to OneDrive Folder."),ut.a.safelyOpenWindow(this._folderUrl,ut.a.windowTargetToString(3),void 0,"UploadToCloudManager.RedirectToFolder")},t.redirectToEditUrl=function(e){var t=null!==this._options&&this._options.hasOwnProperty("SaveEntryPoint")&&this._options.SaveEntryPoint.toString()===yi.saveToCloudStorage;s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&t&&(e+="&wdsvodm=true");var n=!1,i=!1;if(s.AFrameworkApplication.appSettingsManager&&(n=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveACopyIsEnabledForUiHost"),i=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UiHostSupportsDocRebootFeatures")),r.ULS.sendTraceTag(6654163,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"Redirecting to edit url {0}. IsEnabledForUiHost {1}",e,n),n&&i){r.ULS.sendTraceTag(594929733,216,50,"UploadToCloudManager.RedirectToEditUrl: Sending DocumentRefresh post message.");var a={};a[mn.a.rebootMode]="1",a[mn.a.documentUrl]=e,s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.documentRefresh,a)}))}else ut.a.safelyOpenWindow(e,ut.a.windowTargetToString(3),void 0,"UploadToCloudManager.RedirectToEditUrl")},t.startUpload=function(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null),r.ULS.sendTraceTag(7143886,216,50,"Starting to upload file"),this._stopwatchBuilder&&(this._uploadTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("DialogShown","SaveToOneDriveUploadTime")),this.showWaitUI(),this._folderUrl=t,this._caller=this._uploadCallerFactory.create(e,n,i),this._options=i,this.executeUpload()},t.executeUpload=function(){r.ULS.sendTraceTag(6590600,216,50,"Calling SkydriveUploadHandler."),this._caller.execute(Object(A.a)(this,this.onSaveToCloudUploadFinished,"onSaveToCloudUploadFinished"),Object(A.a)(this,this.onSaveToCloudUploadFailed,"onSaveToCloudUploadFailed"))},t.onSaveToCloudUploadFinished=function(e){var t,n;if(this.dismissWaitUI(),this._failedCanary=!1,!e||!e.data||!e.data.responseData)return r.ULS.sendTraceTag(6590601,216,10,"UploadToCloudManager upload failure. Response data is null"),void this.showErrorUI();if(!(t=H.d(e.data.responseData),n=t.deserialized,t).returnValue)return r.ULS.sendTraceTag(7660114,216,10,"Failed to deserialize : {0}",{ResponseData:Wn.truncateIfNecessary(e.data.responseData)}),void this.showErrorUI();var i=n;if(i.StatusCode!==M.a.OK_200&&i.StatusCode!==M.a.created_201)return r.ULS.sendTraceTag(6590602,216,10,"UploadToCloudManager upload failure. Response data is not JSON."),void this.showErrorUI();r.ULS.sendTraceTag(6590603,216,s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance&&1===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?15:50,"UploadToCloudManager upload success.");try{i.NewDocumentUrl&&""!==i.NewDocumentUrl?this.redirectToEditUrl(i.NewDocumentUrl):this.redirectToFolder()}catch(e){r.ULS.sendTraceTag(37025728,216,15,"Redirect failed with exception: {0}",e.toString())}this.perfWatchStop()},t.onSaveToCloudUploadFailed=function(e){5!==e.data.status&&12!==e.data.status||this._failedCanary?(r.ULS.sendTraceTag(6590605,216,10,"UploadToCloudManager HTTP failure with code: {0}",e.data.status),this.dismissWaitUI(),this.showErrorUI(),this.perfWatchStop()):(r.ULS.sendTraceTag(6590604,216,10,"UploadToCloudManager failure. Retrying."),this._failedCanary=!0,this.executeUpload())},t.perfWatchStop=function(){this._uploadTimeStopwatch&&(this._uploadTimeStopwatch.stop(),this._uploadTimeStopwatch=null)},e}();Object(i.a)(Ei,"UploadToCloudManager",null,[146]);var Oi=n(343);function Mi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Li=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SaveToCloudStorageUIIsEnabled")&&this._container.resolve("Common.App.SaveToCloudStorage.SaveToCloudStorageActor").registerActions()},r.dispose=function(){},r.configure=function(e){this._container=e,this._container.register(wi,"Common.App.SaveToCloudStorage.SignInDialogFactory").as("Common.App.SaveToCloudStorage.ISignInDialogFactory").usingFactory((function(){return new wi(s.AFrameworkApplication.theActionManager,hi.a.instance,s.AFrameworkApplication.activeFrame.applicationInstance)})).singleInstance(),this._container.register(Fi,"Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory").as("Common.App.SaveToCloudStorage.ISkydriveUploadCallerFactory").usingFactory((function(){return new Fi(s.AFrameworkApplication.appSettingsManager)})).singleInstance(),this._container.register(Ci,"Common.App.SaveToCloudStorage.SaveToCloudStorageActor").usingFactory((function(){return new Ci(e.resolve("Common.App.SaveToCloudStorage.SaveToCloudManager"),e.resolve("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager"),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})).singleInstance(),this._container.register(Ei,"Common.App.SaveToCloudStorage.UploadToCloudManager").usingFactory((function(){return new Ei(e.resolve("Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory"),(function(){return(new Oi.a).create()}),(function(){return new vi}),s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.activeFrame.theStopwatchBuilder)})).singleInstance(),this._container.register(Si,"Common.App.SaveToCloudStorage.SaveToCloudManager").usingFactory((function(){return new Si(e.resolve("Common.App.SaveToCloudStorage.SignInDialogFactory"),hi.a.instance,e.resolve("Common.App.SaveToCloudStorage.UploadToCloudManager"),s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.environment,(function(){return new vi}))})).singleInstance()},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SaveToCloudStorage"}}])&&Mi(t.prototype,n),i&&Mi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Li,"PackageManager",null,[2,3]);var Ri=n(124),Di=function(){function e(e){this._eventSource=new a.a,this._appFrame=e}var t=e.prototype;return t.add_onSessionExpired=function(t){this._eventSource.addHandler(e.sessionExpiredEventKey,t)},t.remove_onSessionExpired=function(t){this._eventSource.removeHandler(e.sessionExpiredEventKey,t)},t.add_onSessionExpiring=function(t){this._eventSource.addHandler(e.sessionExpiringEventKey,t)},t.remove_onSessionExpiring=function(t){this._eventSource.removeHandler(e.sessionExpiringEventKey,t)},t.add_onTokenRefreshed=function(t){this._eventSource.addHandler(e.tokenRefreshedEventKey,t)},t.remove_onTokenRefreshed=function(t){this._eventSource.removeHandler(e.tokenRefreshedEventKey,t)},t.add_onWaitingForTokenRefresh=function(t){this._eventSource.addHandler(e.tokenRefreshPollingEventKey,t)},t.remove_onWaitingForTokenRefresh=function(t){this._eventSource.removeHandler(e.tokenRefreshPollingEventKey,t)},t.showDialogOnKickout=function(t){this._eventSource.raiseEvent(e.sessionExpiredEventKey)},t.showDialogOnExpiring=function(t){this._eventSource.raiseEvent(e.sessionExpiringEventKey)},t.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return Ri.a.instance.isSessionExpired(e)},e}();Di.sessionExpiredEventKey="SE",Di.sessionExpiringEventKey="SEP",Di.tokenRefreshedEventKey="SER",Di.tokenRefreshPollingEventKey="TRP",Object(i.a)(Di,"NullSessionExpirationManager",null,[125,126]);var xi=function(){function e(){var e=this;this._sessionExpiredDialogAlreadyDisplayed=!1,this._sessionExpiringDialogAlreadyDisplayed=!1,this.onSessionExpiredDetected=function(t,n){Ri.a.instance.remove_sessionExpiredDetected(e.onSessionExpiredDetected),r.ULS.sendTraceTag(19247381,217,50,"SessionExpiredDetected"),e.handleSessionExpired()},this.onSessionExpiringDetected=function(t,n){Ri.a.instance.remove_sessionAboutToExpireDetected(e.onSessionExpiringDetected),e._sessionExpiringDialogAlreadyDisplayed||e._sessionExpiredDialogAlreadyDisplayed||(r.ULS.sendTraceTag(20492680,217,50,"SessionExpiringDetected - Showing expiring dialog."),e._sessionExpiringDialogAlreadyDisplayed=!0,e.showSessionExpiringDialog())};var t=s.AFrameworkApplication.accessTokenTtl;if(!(t<=0)){this.accessTokenTtl=t;var n=new Date;r.ULS.sendTraceTag(17581890,217,50,"Initializing SessionExpirationManager. {0}",{AccessTokenTtl:this.accessTokenTtl,NowGetTime:n.getTime(),BootTime:s.AFrameworkApplication.bootTime}),Ri.a.instance.add_sessionExpiredDetected(this.onSessionExpiredDetected),Ri.a.instance.add_sessionAboutToExpireDetected(this.onSessionExpiringDetected)}}return e.prototype.handleSessionExpired=function(){this._sessionExpiredDialogAlreadyDisplayed||(s.AFrameworkApplication.reportError(Qn.a.sessionAccessTokenExpired),this._sessionExpiredDialogAlreadyDisplayed=!0,this.showSessionExpiredDialog())},e}();Object(i.a)(xi,"ASessionExpirationManager",null,[]);var Bi=n(87),Ui=n(321),Hi=function(){function e(e,t,n,i){this.textToDisplay="",this._accessTokenTtl=e,this._sessionRefreshCallback=n,this._sessionDisposeCallback=i,this._isExpiredDialog=t;var r=new Date(this._accessTokenTtl).format(s.AFrameworkApplication.shortTimeFormat);this._isExpiredDialog?this.textToDisplay=String.format(CommonUIStrings.l_SessionExpiredMessage):this.textToDisplay=String.format(CommonUIStrings.l_SessionExpiringMessage,r)}var t=e.prototype;return t.sessionExpirationDialogHandler=function(e){1===e?this._sessionRefreshCallback&&this._sessionRefreshCallback(this._isExpiredDialog):0===e&&s.AFrameworkApplication.theActionManager.processActionWithData(p.a.close,2,Ui.g)},t.dispose=function(){this._sessionDisposeCallback&&this._sessionDisposeCallback()},e}();Hi.id="SessionExpirationDialog",Object(i.a)(Hi,"SessionExpirationDialogSharedProperties",null,[]);var Ni=function(){};function Wi(e,t){return(Wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Ni.dialogHtml="<div class='WACDialogRow' id='SessionExpirationBlock'> <label id='WACSessionExpirationText' class='WACDialogLabel' >Session Expiration</label> </div>",Object(i.a)(Ni,"SessionExpirationDialogHtml",null,[]);var ji=function(e){var t,n;function i(t,n,i,r){var a,o={};return(a=e.call(this,n)||this)._sessionExpirationDialogSharedProperties=new Hi(t,n,i,r),a.dialogId=Hi.id,s.AFrameworkApplication.canExecuteCloseAction?(a.buttonsOption=1,a.setButtonText(0,CommonUIStrings.l_DialogClose)):(a.buttonsOption=0,a.hasCloseGlyph=!1),n||1===s.AFrameworkApplication.activeFrame.mode?a.setButtonText(1,CommonUIStrings.l_SessionExpirationRefreshButton):a.setButtonText(1,CommonUIStrings.l_SessionExpiringSaveAndRefreshButton),a.dialogHtml=Ni.dialogHtml,o.WACSessionExpirationText=a._sessionExpirationDialogSharedProperties.textToDisplay,a.initializeAndShow(CommonUIStrings.l_DefaultDialogTitle,Object(A.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a),a.sessionExpirationDialogHandler,"sessionExpirationDialogHandler"),o),a.setDescribedByForDialog(a.myId("WACSessionExpirationText")),a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Wi(t,n);var r=i.prototype;return r.sessionExpirationDialogHandler=function(e,t){void 0===t&&(t=null),this._sessionExpirationDialogSharedProperties.sessionExpirationDialogHandler(e)},r.isDialogShowing=function(){return this.isShowing},r.hideDialog=function(){this.hide()},r.dispose=function(){e.prototype.dispose.call(this),this._sessionExpirationDialogSharedProperties&&this._sessionExpirationDialogSharedProperties.dispose()},i}(Bi.a);function Vi(e,t){return(Vi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ji,"LegacySessionExpirationDialog",Bi.a,[206]);var qi=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this,n)||this)._sessionExpirationDialogSharedProperties=new Hi(t,n,i,r),a.dialogId=Hi.id,s.AFrameworkApplication.canExecuteCloseAction?(a.buttonsOption=1,a.setButtonText(0,CommonUIStrings.l_DialogClose)):(a.buttonsOption=0,a.hasCloseGlyph=!1),n||1===s.AFrameworkApplication.activeFrame.mode?a.setButtonText(1,CommonUIStrings.l_SessionExpirationRefreshButton):a.setButtonText(1,CommonUIStrings.l_SessionExpiringSaveAndRefreshButton),a.messageBox(CommonUIStrings.l_DefaultDialogTitle,a._sessionExpirationDialogSharedProperties.textToDisplay,0,Object(A.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a),a.sessionExpirationDialogHandler,"sessionExpirationDialogHandler")),a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vi(t,n);var r=i.prototype;return r.sessionExpirationDialogHandler=function(e,t){void 0===t&&(t=!1),this._sessionExpirationDialogSharedProperties.sessionExpirationDialogHandler(e)},r.isDialogShowing=function(){return this.isShowing},r.hideDialog=function(){this.hide()},r.dispose=function(){e.prototype.dispose.call(this),this._sessionExpirationDialogSharedProperties&&this._sessionExpirationDialogSharedProperties.dispose()},i}(Kn.StandardDialog);Object(i.a)(qi,"SessionExpirationDialog",Kn.StandardDialog,[206]);var Gi=function(e,t,n,i){return s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ReactStandardSessionExpirationDialogIsEnabled")?new qi(e,t,n,i):new ji(e,t,n,i)},Ki=n(115);function zi(e,t){return(zi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Xi=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._showDialogOnKickout=!0,n._showDialogOnExpiring=!0,n._sessionExpirationDialog=null,n._eventSource=new a.a,n.disposeCallback=function(){n._sessionExpirationDialog=null},n.sessionExpirationHandler=function(e){(e||n._appFrame.beforeRefreshDocument())&&n._appFrame.refreshDocument(null)},n._appFrame=t,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,zi(t,n);var r=i.prototype;return r.add_onSessionExpired=function(e){this._eventSource.addHandler(i.sessionExpiredEventKey,e)},r.remove_onSessionExpired=function(e){this._eventSource.removeHandler(i.sessionExpiredEventKey,e)},r.add_onSessionExpiring=function(e){this._eventSource.addHandler(i.sessionExpiringEventKey,e)},r.remove_onSessionExpiring=function(e){this._eventSource.removeHandler(i.sessionExpiringEventKey,e)},r.add_onTokenRefreshed=function(e){this._eventSource.addHandler(i.tokenRefreshedEventKey,e)},r.remove_onTokenRefreshed=function(e){this._eventSource.removeHandler(i.tokenRefreshedEventKey,e)},r.add_onWaitingForTokenRefresh=function(e){this._eventSource.addHandler(i.tokenRefreshPollingEventKey,e)},r.remove_onWaitingForTokenRefresh=function(e){this._eventSource.removeHandler(i.tokenRefreshPollingEventKey,e)},r.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return Ri.a.instance.isSessionExpired(e)},r.showDialogOnKickout=function(e){this._showDialogOnKickout=e},r.showDialogOnExpiring=function(e){this._showDialogOnExpiring=e},r.showSessionExpiringDialog=function(){if(!this._sessionExpirationDialog&&!Ki.a.currentDialog){if(this._showDialogOnExpiring){var e=this.disposeCallback;this._sessionExpirationDialog=Gi(this.accessTokenTtl,!1,this.sessionExpirationHandler,e)}this._eventSource.raiseEvent(i.sessionExpiringEventKey)}},r.showSessionExpiredDialog=function(){if(this._sessionExpirationDialog&&(this._sessionExpirationDialog.isDialogShowing()&&this._sessionExpirationDialog.hideDialog(),this._sessionExpirationDialog=null),this._showDialogOnKickout){var e=this.disposeCallback;this._sessionExpirationDialog=Gi(this.accessTokenTtl,!0,this.sessionExpirationHandler,e)}this._eventSource.raiseEvent(i.sessionExpiredEventKey)},i}(xi);Xi.sessionExpiredEventKey="SE",Xi.sessionExpiringEventKey="SEP",Xi.tokenRefreshedEventKey="SER",Xi.tokenRefreshPollingEventKey="TRP",Object(i.a)(Xi,"SessionExpirationManager",xi,[125,126]);var Ji=function(){};function Qi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ji.aborting="Aborting",Ji.activityDuration="ActivityDuration",Ji.aggregateDictionaryName="Aggregate",Ji.currentDictionaryName="Current",Ji.error="Error",Ji.errorsCount="Errors",Ji.failed="Failed",Ji.firstActivity="FirstActivity",Ji.initialized="Initialized",Ji.kickedOut="KickedOut",Ji.lastActivity="LastActivity",Ji.retryOverride="RetryOverride",Ji.requestGroups="RequestGroups",Ji.requests="Requests",Ji.responses="Responses",Ji.sessionDuration="SessionDuration",Ji.status="Status",Ji.success="Success",Ji.successful="Successful",Ji.tokens="Tokens",Ji.pollingDuration="PollingDuration",Object(i.a)(Ji,"SessionExpirationStrings",null,[]);var Zi=function(){function e(e){var t=this;this._current={},this._aggregate={},this._polling={},this.logIntervalInMinutes=15,this._isStopped=!1,this._sessionStart=new Date,this._lastActivity=new Date,this._pollStartTime=new Date,this.writeMeasures=function(e){r.ULS.sendTraceTag(41964821,217,50,r.ULS.jsonSerialize({Aggregate:t._aggregate,Current:t._current}))},this._taskManager=e,this._taskItem=new u.a(2,2,60*this.logIntervalInMinutes*1e3,this.writeMeasures,135,"SL",!1),this._taskManager.addTask(this._taskItem),this.initializeMeasures()}var t,n,i,a=e.prototype;return a.initializeMeasures=function(){this._aggregate[Ji.requestGroups]=0,this._aggregate[Ji.requests]=0,this._aggregate[Ji.responses]=0,this._aggregate[Ji.status]=Ji.initialized,this._aggregate[Ji.firstActivity]=new Date,this._aggregate[Ji.sessionDuration]=0,this._aggregate[Ji.activityDuration]=0,this._aggregate[Ji.sessionDuration]=0,this._current[Ji.sessionDuration]=0,this._aggregate[Ji.activityDuration]=0,this._current[Ji.activityDuration]=0},a.incrementACounter=function(e,t){var n=e[t],i=n||0;i++,e[t]=i,this.setLastActivity(e)},a.setLastActivity=function(e){var t=new Date;e[Ji.activityDuration]=+t-+this._lastActivity,this._lastActivity=t,e[Ji.sessionDuration]=+this._lastActivity-+this._sessionStart,e[Ji.lastActivity]=this._lastActivity},a.setMeasure=function(e,t){this._current[e]=t,this.setLastActivity(this._current)},a.setCounter=function(e,t){this._current[e]=t,this.setLastActivity(this._current)},a.incrementCounter=function(e){this.incrementACounter(this._current,e),this.incrementACounter(this._aggregate,e),this.incrementACounter(this._polling,e)},a.flush=function(){this._isStopped||(this._aggregate[Ji.status]=this._current[Ji.status],this.writeMeasures(this._taskItem),this._taskManager.resetInterval(this._taskItem,60*this.logIntervalInMinutes*1e3))},a.resetGroup=function(){var e=this._current[Ji.status];e&&(this._aggregate[Ji.status]=e),this._current={}},a.resetPolling=function(){this._polling={},this._polling[Ji.pollingDuration]=0,this._polling[Ji.firstActivity]=new Date},a.stop=function(){r.ULS.sendTraceTag(41964822,217,100,"Stopping logger. Flushing one last time"),this.flush(),this._isStopped=!0,this._taskManager.deleteTask(this._taskItem)},t=e,(n=[{key:"aggregateMeasures",get:function(){return this._aggregate}},{key:"currentMeasures",get:function(){return this._current}},{key:"pollingMeasures",get:function(){return this._polling[Ji.pollingDuration]=+new Date-+this._polling[Ji.firstActivity],this._polling}}])&&Qi(t.prototype,n),i&&Qi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Yi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Zi,"SessionLogger",null,[121]);var $i=function(){function e(e,t){this._tokens=e,this._errors=t}var t,n,i;return t=e,(n=[{key:"tokens",get:function(){return this._tokens}},{key:"errors",get:function(){return this._errors}}])&&Yi(t.prototype,n),i&&Yi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function er(e,t){return(er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)($i,"TokenRefreshArgs",null,[141]);var tr=function(e){var t,n;function i(t,n,i,r,a,o,s){var l;return(l=e.call(this)||this)._polling=t,l.pollDuration=n,l.pollStartTime=i,l.requestGroups=r,l.failed=a,l.requests=o,l.responses=s,l}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,er(t,n),i}(Sys.EventArgs);Object(i.a)(tr,"WaitingForTokenRefreshPollingArgs",Sys.EventArgs,[]);var nr=n(71);function ir(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var ar=function(){function e(t,n,i){var o=this;void 0===n&&(n=null),void 0===i&&(i=null),this._sessionExpiredDialogAlreadyDisplayed=!1,this._sessionExpiringDialogAlreadyDisplayed=!1,this._showDialogOnKickout=!0,this._showDialogOnExpiring=!0,this._eventSource=new a.a,this._refreshingTokens=!1,this._lastAttemptToRefreshFailed=!1,this._shouldAbort=!1,this._pollingTask=null,this._pollIntervalInSec=10,this._isPollingStarted=!1,this._isPollingEnabled=!1,this._reportLastKnownErrorEnabled=!1,this.refreshAccessTokenWhenSessionExpired=function(){return o.handleTokenRefresh(!1),!Ri.a.instance.isSessionExpired(s.AFrameworkApplication.accessTokenTtl)},this.aSessionExpirationManagerWithRefresh_OnSessionExpired=function(e,t){Ri.a.instance.isSessionExpiredDueToScheduledShutdown||o.shouldBlockTokenRefresh()?o.onSessionExpiredDetected(e,t):o._isTokenRefreshWhenExpiredEnabled?(o._lastAttemptToRefreshFailed=!1,o.handleTokenRefresh(!1)):(o._sessionExpiredDialogAlreadyDisplayed||r.ULS.sendTraceTag(520954892,217,15,"Detected session expiry before token refresh got blocked"),o.onSessionExpiredDetected(e,t))},this.aSessionExpirationManagerWithRefresh_OnSessionExpiringNetworkResumed=function(e,t){Ri.a.instance.isSessionAboutToExpireDueToScheduledShutdown||o.shouldBlockTokenRefresh()?o.onSessionExpiringDetected(e,t):(nr.b(512247769,306,50,"Refreshing tokens since the user has network and session is expiring."),o._lastAttemptToRefreshFailed=!1,o.handleTokenRefresh(!0))},this.aSessionExpirationManagerWithRefresh_OnSessionExpiring=function(e,t){Ri.a.instance.isSessionAboutToExpireDueToScheduledShutdown||o.shouldBlockTokenRefresh()?o.onSessionExpiringDetected(e,t):o.handleTokenRefresh(!0)},this.onSessionExpiredDetected=function(e,t){o._isTokenRefreshWhenExpiredEnabled||Ri.a.instance.remove_sessionExpiredDetected(o.onSessionExpiredDetected),r.ULS.sendTraceTag(39408094,217,50,"SessionExpiredDetected"),o.handleSessionExpired(Ri.a.instance.isSessionExpiredDueToScheduledShutdown)},this.tokenRefreshPolling=function(t){var n=o._logger.pollingMeasures;r.ULS.sendTraceTag(555255521,217,50,"{0}",H.c(n)),o._eventSource.raiseEvent(e.tokenRefreshPollingEventKey,new tr(n,n[Ji.pollingDuration],n[Ji.firstActivity],n[Ji.requestGroups],n[Ji.failed],n[Ji.requests],n[Ji.responses]))},this.preemptiveTokenRefresh=function(e,t){+new Date-+o._lastKnownSuccessTokenRefresh>3e5?(r.ULS.sendTraceTag(528867867,217,50,"Attempting pre-emptive token refresh."),o.handleTokenRefresh(!1)):r.ULS.sendTraceTag(528867868,217,50,"Last Token Refresh was performed less than 5 mins ago. Not refreshing token.")},this._tokenRefreshManager=t,this._isTokenRefreshWhenExpiredEnabled=s.AFrameworkApplication.isWopiTokenRefreshWhenSessionExpiredEnabled,this._taskManager=S.TaskManager.instance;var l=new Date;r.ULS.sendTraceTag(39408093,217,50,"Initializing SessionExpirationManagerWithRefresh. {0}",{AccessTokenTtl:s.AFrameworkApplication.accessTokenTtl,NowGetTime:l.getTime(),BootTime:s.AFrameworkApplication.bootTime}),this._logger=n||new Zi(S.TaskManager.instance),this._statusManager=i,Ri.a.instance.add_sessionExpiredDetected(this.aSessionExpirationManagerWithRefresh_OnSessionExpired),Ri.a.instance.add_sessionAboutToExpireDetected(this.aSessionExpirationManagerWithRefresh_OnSessionExpiring),bi.SessionStatusManager.instance.add_onSessionExpiringNetworkResumed(this.aSessionExpirationManagerWithRefresh_OnSessionExpiring),bi.SessionStatusManager.instance.add_preemptivelyTokenRefresh(this.preemptiveTokenRefresh),this._lastKnownSuccessTokenRefresh=new Date,s.AFrameworkApplication.isWopiTokenRefreshCancelExpirationEnabled&&(Ri.a.instance.cancelSessionExpiration=this.refreshAccessTokenWhenSessionExpired);var c=!1;s.AFrameworkApplication.appSettingsManager&&(this._isPollingEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.TokenRefreshPollingIsEnabled",!1),this._pollIntervalInSec=s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.WordOnline.TokenRefreshPollInterval",10),this._reportLastKnownErrorEnabled=s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.ReportLastKnownTokenRefreshError",!1),c=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WopiTokenRefreshWhenNetworkResumed")),c?bi.SessionStatusManager.instance.add_onSessionExpiringNetworkResumed(this.aSessionExpirationManagerWithRefresh_OnSessionExpiringNetworkResumed):bi.SessionStatusManager.instance.add_onSessionExpiringNetworkResumed(this.aSessionExpirationManagerWithRefresh_OnSessionExpiring)}var t=e.prototype;return t.add_onSessionExpired=function(t){this._eventSource.addHandler(e.sessionExpiredEventKey,t)},t.remove_onSessionExpired=function(t){this._eventSource.removeHandler(e.sessionExpiredEventKey,t)},t.add_onSessionExpiring=function(t){this._eventSource.addHandler(e.sessionExpiringEventKey,t)},t.remove_onSessionExpiring=function(t){this._eventSource.removeHandler(e.sessionExpiringEventKey,t)},t.add_onTokenRefreshed=function(t){this._eventSource.addHandler(e.tokenRefreshedEventKey,t)},t.remove_onTokenRefreshed=function(t){this._eventSource.removeHandler(e.tokenRefreshedEventKey,t)},t.add_onWaitingForTokenRefresh=function(t){this._eventSource.addHandler(e.tokenRefreshPollingEventKey,t)},t.remove_onWaitingForTokenRefresh=function(t){this._eventSource.removeHandler(e.tokenRefreshPollingEventKey,t)},t.hasSessionExpired=function(){var e=s.AFrameworkApplication.accessTokenTtl;return Ri.a.instance.isSessionExpired(e)},t.shouldBlockTokenRefresh=function(){return!1},t.shouldDiscardDocumentLevelAccessToken=function(e){return!1},t.handleDiscardedDocumentLevelAccessToken=function(){},t.handleTokenRefresh=function(t){var n=this;if(!this._refreshingTokens&&!this._lastAttemptToRefreshFailed){if(this._statusManager&&this._statusManager.isKickedOut)return this._shouldAbort=!0,this._logger.setMeasure(Ji.status,Ji.kickedOut),this._logger.flush(),void this._logger.stop();if(r.ULS.sendTraceTag(40420955,217,50,"HandleTokenRefresh, IsExpiring:{0}. ShouldAbort: {1}",t,this._shouldAbort),this._shouldAbort)this.showSessionExpiredDialog();else{this._logger.flush(),this._logger.resetGroup(),this._logger.incrementCounter(Ji.requestGroups),this._refreshingTokens=!0,this._isPollingStarted||(this._logger.resetPolling(),this._isPollingStarted=!0,this.createAndRunTokenRefreshPollingTask());var i=this._tokenRefreshManager.refreshTokens(t);i.continueWith((function(a){if(!i.result.errors.count&&n.shouldDiscardDocumentLevelAccessToken(i.result.tokens))return n.handleDiscardedDocumentLevelAccessToken(),void(n._refreshingTokens=!1);if(n._tokenRefreshManager.processTokensOrErrors(i))n._logger.incrementCounter(Ji.successful),n._logger.setMeasure(Ji.status,Ji.success),n._showDialogOnExpiring=!1,n._isTokenRefreshWhenExpiredEnabled&&(n._showDialogOnKickout=!1),n._lastAttemptToRefreshFailed=!1,n._lastKnownSuccessTokenRefresh=new Date,n.stopPolling(),n._eventSource.raiseEvent(e.tokenRefreshedEventKey,new $i(i.result.tokens,null));else{var o=i.result.errors;n._logger.incrementCounter(Ji.failed),n._logger.setMeasure(Ji.status,Ji.failed),t||(n._shouldAbort=n._tokenRefreshManager.isPermanentErrors(o)),n._shouldAbort&&(n._logger.setMeasure(Ji.aborting,JSON.stringify(o)),r.ULS.sendTraceTag(520954891,217,15,"Aborting token refresh")),n._lastAttemptToRefreshFailed=!0,n._eventSource.raiseEvent(e.tokenRefreshedEventKey,new $i(null,o))}n._logger.flush(),n._refreshingTokens=!1}))}}},t.onSessionExpiringDetected=function(e,t){this._sessionExpiringDialogAlreadyDisplayed||this._sessionExpiredDialogAlreadyDisplayed||(r.ULS.sendTraceTag(39408095,217,50,"SessionExpiringDetected - Showing expiring dialog."),this._sessionExpiringDialogAlreadyDisplayed=!0,this.showSessionExpiringDialog(Ri.a.instance.isSessionAboutToExpireDueToScheduledShutdown))},t.handleSessionExpired=function(e){if(!this._sessionExpiredDialogAlreadyDisplayed){var t;t=e?Qn.a.sessionExpiredDueToScheduledShutdown:Qn.a.sessionAccessTokenExpired;var n=Object.assign(new Z.a,{extendedProperties:new Map});if(n.extendedProperties.set("ErrorCode",String.format("{0}",t)),s.AFrameworkApplication.reportError(t,void 0,["SessionExpired"],n),!e){var i=new Date,a=new Date(s.AFrameworkApplication.bootTime);r.ULS.sendTraceTag(51642974,217,50,"Sending data to QoS. BootTime=[{0}], Now=[{1}], Duration=[{2}]",a,i,+i-+a),+i-+a<864e5&&l.Health.instance.recordQosError("SessionAccessTokenExpiredInLessThanOneDay",["SessionExpired"],!0,!0,!1,!0,n),+i-+a<2592e5&&l.Health.instance.recordQosError("SessionAccessTokenExpiredInLessThanThreeDays",["SessionExpired"],!0,!0,!1,!0,n)}this._sessionExpiredDialogAlreadyDisplayed=!0,this.showSessionExpiredDialog()}},t.stopPolling=function(){this._isPollingStarted&&(this._taskManager.deleteTask(this._pollingTask),this._isPollingStarted=!1)},t.createAndRunTokenRefreshPollingTask=function(){this._pollingTask=new u.a(2,2,1e3*this._pollIntervalInSec,this.tokenRefreshPolling,135),this._taskManager.addTask(this._pollingTask)},t.getTokenRefreshErrorDictionaryFromError=function(e){for(var t,n=new te.a,i=ir(e.Errors);!(t=i()).done;){var r=t.value,a={};a.Id=r.Id,a.Details=r.Details,n.add(a)}return n},e}();function or(e,t){return(or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}ar.sessionExpiredEventKey="SE",ar.sessionExpiringEventKey="SEP",ar.tokenRefreshedEventKey="SER",ar.tokenRefreshPollingEventKey="TRP",Object(i.a)(ar,"ASessionExpirationManagerWithRefresh",null,[]);var sr=function(e){var t,n;function i(t,n,i,r){var a;return void 0===i&&(i=null),void 0===r&&(r=null),(a=e.call(this,n,i,r)||this)._sessionExpirationDialog=null,a.disposeCallback=function(){a._sessionExpirationDialog=null},a.sessionExpirationHandler=function(e){(e||a._appFrame.beforeRefreshDocument())&&a._appFrame.refreshDocument(null)},a._appFrame=t,a}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,or(t,n);var a=i.prototype;return a.showDialogOnKickout=function(e){this._showDialogOnKickout=e},a.showDialogOnExpiring=function(e){this._showDialogOnExpiring=e},a.showSessionExpiringDialog=function(e){if(!this._sessionExpirationDialog&&!Ki.a.currentDialog){if(e){var t=this.disposeCallback;this._sessionExpirationDialog=Gi(s.AFrameworkApplication.scheduledShutdownTtl,!1,this.sessionExpirationHandler,t)}else if(this._showDialogOnExpiring){if(this._refreshingTokens)return;var n=this.disposeCallback;this._sessionExpirationDialog=Gi(s.AFrameworkApplication.accessTokenTtl,!1,this.sessionExpirationHandler,n)}r.ULS.sendTraceTag(39408096,217,50,"Raising event: [{0}] IsScheduledShutdown: [{1}]",ar.sessionExpiringEventKey,e),this._eventSource.raiseEvent(ar.sessionExpiringEventKey)}},a.showSessionExpiredDialog=function(){if(this._sessionExpirationDialog&&(this._sessionExpirationDialog.isDialogShowing()&&this._sessionExpirationDialog.hideDialog(),this._sessionExpirationDialog=null),this._showDialogOnKickout){if(this._logger.stop(),this._statusManager&&this._statusManager.isKickedOut)return;var e=this.disposeCallback;this._sessionExpirationDialog=Gi(s.AFrameworkApplication.accessTokenTtl,!0,this.sessionExpirationHandler,e)}r.ULS.sendTraceTag(39408097,217,50,"Raising event {0}",ar.sessionExpiredEventKey),this._eventSource.raiseEvent(ar.sessionExpiredEventKey)},i}(ar);Object(i.a)(sr,"SessionExpirationManagerWithRefresh",ar,[125,126]);var lr=function(){function e(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null),this._useApplicationProvidedManager=!1,this._instance=null,this._frame=e,this._manager=t,this._logger=n||new Zi(S.TaskManager.instance),this._statusManager=i}return e.prototype.create=function(){if(this._useApplicationProvidedManager=s.AFrameworkApplication.isWopiTokenRefreshEnabled,!this._useApplicationProvidedManager)return new Xi(this._frame);if(r.ULS.sendTraceTag(39408088,217,50,"App has requested custom Session Expiration Manager"),!this._instance)switch(s.AFrameworkApplication.wopiTokenExpirationPolicy){case 1:r.ULS.sendTraceTag(39408090,217,50,"Creating new NullSessionExpirationManager"),this._instance=new Di(this._frame);break;case 2:r.ULS.sendTraceTag(39408091,217,50,"Creating new SessionExpirationManagerWithRefresh"),this._instance=new sr(this._frame,this._manager,this._logger,this._statusManager);break;default:r.ULS.sendTraceTag(39408092,217,50,"Creating new legacy SessionExpirationManager"),this._instance=new Xi(this._frame)}return r.ULS.sendTraceTag(39408089,217,50,"Returning instance of Session Expiration Manager: {0}",Object.getType(this._instance).getName()),this._instance},e}();Object(i.a)(lr,"SessionExpirationManagerFactory",null,[124]);var cr=n(74),ur=function(){};Object(i.a)(ur,"Error",null,[]);var dr=function(){};function pr(e,t){return(pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(dr,"NamedResult",null,[]);var hr=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,pr(t,n),i}(dr);Object(i.a)(hr,"ErrorInfo",dr,[]);var gr=n(350);function mr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return fr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var vr="WACTokenRefresh",_r=function(){function e(e,t,n,i,r,a,o,s,l,c,u){var p=this;void 0===i&&(i=null),void 0===r&&(r=!1),void 0===a&&(a=null),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=!1),this._retryCount=0,this._task=null,this._taskId=null,this._tokens=new te.a,this._errors=new te.a,this._tcs=null,this._isTokenExpiring=!1,this._tokenRefreshResolve=null,this._tokenRefreshReject=null,this.requestTokensOnce=function(e){p.requestTokensOnceSync()},this._taskManager=e,this._postmessengerFuture=t,this._postmessengerFuture.execute((function(e){e.registerCallback(d.a.hostRefreshSessionInfo,Object(A.a)(p,p.onHostResponseReceived,"onHostResponseReceived"))})),this._refreshPolicy=n,this._tokenRefreshStopwatch=new gr.a("WebServiceCall","TokenRefresh"),this._logger=i||new Zi(e),this._sendSynchronousMessage=r,this._sessionStatusManager=a||bi.SessionStatusManager.instance,this._enableErrorReporting=o,this._enableSyncMessageWithTimeout=s,this._shouldAddAllowAADPopupInPostMessage=l,this._shouldAllowAADPopupForTokenRefresh=c,this._shouldAllowMessageForTokenRefreshError=u}var t=e.prototype;return t.onHostResponseReceived=function(e){if(e.MessageId===d.a.hostRefreshSessionInfo){var t=new te.a,n=new te.a;this._logger.incrementCounter(Ji.responses);var i=e.Values[mn.a.sessionInfo_TokenNamesField];(!i||i.length<=0)&&(nr.b(40122317,306,15,"Found no tokens in the dictionary"),i=e.Values),nr.b(40122318,306,100,"The Tokens array contains {0} tokens",i.length),this._logger.setMeasure("Correlation",e.CorrelationId);for(var r="",a=0;a<i.length;a++){this._logger.setCounter(Ji.tokens,i.length);var o=i[a],c=o;if(c&&c.Name){this._logger.incrementCounter(c.Name);var u=o;if(u&&u.Value)nr.b(39408128,306,100,"Received token with name: {0}",u.Name),t.add(u),this._tokens.add(u),this._enableSyncMessageWithTimeout||this._logger.setMeasure(Ji.status,Ji.success),this._enableErrorReporting&&this._sessionStatusManager&&this._sessionStatusManager.resetTokenRefreshErrors();else{var p=this.getScrubbedErrorInfo(o);if(nr.b(39408129,306,15,"Received error for token {0}. Creating error object from {1}, TaskId {2}",c.Name,JSON.stringify(p),this._taskId),n.add(p),this._enableSyncMessageWithTimeout||(this._errors.add(p),r=JSON.stringify(p),this._logger.setMeasure(Ji.error,JSON.stringify(p)),this._logger.setMeasure(Ji.status,Ji.failed)),this._enableErrorReporting)for(var h,g=mr(p.Errors);!(h=g()).done;){var m=h.value,f=this.getErrorBucketToVeto(m);this._sessionStatusManager&&this._sessionStatusManager.addTokenRefreshErrorToMap(f)}}}}if(this._enableSyncMessageWithTimeout)n.count>0?this._tokenRefreshReject?this._tokenRefreshReject(new $i(t,n)):nr.b(512267295,306,15,"Received errors but the promise has completed"):this._tokenRefreshResolve?this._tokenRefreshResolve(new $i(t,n)):nr.b(512267294,306,15,"Received valid tokens but the promise has completed"),nr.b(512344162,306,50,"Received new tokens response. {0} tokens and {1} errors. Correlation {2}, TaskId {3}",t.count,n.count,e.CorrelationId,this._taskId);else{if(n.count>0&&""!==r){var v=Object.assign(new Z.a,{extendedProperties:new Map});v.extendedProperties.set("Errors",r),v.extendedProperties.set("RetryCount",this._retryCount.toString()),v.extendedProperties.set("NavigatorOnline",window.navigator.onLine.toString()),v.extendedProperties.set("IsTokenExpiring",this._isTokenExpiring.toString()),this.isRestartTaskmanagerGateEnabled()&&v.extendedProperties.set("IsAppShuttingDown",s.AFrameworkApplication.isShuttingDown.toString()),l.Health.instance.recordKpiFailure(vr,"TokenRefreshFailed",!1,!1,v)}else l.Health.instance.recordKpiSuccess(vr,null);if(nr.b(39408130,306,50,"Received new tokens response. {0} tokens and {1} errors. Correlation {2}, TaskId {3}",t.count,n.count,e.CorrelationId,this._taskId),n.count>0&&!this.isPermanentErrors(n)){var _=this._refreshPolicy.getRetryIntervalOverride(n);return void(_!==this._refreshPolicy.retryInterval&&(this._logger.setCounter(Ji.retryOverride,_),this._taskManager.resetInterval(this._task,_)))}this._logger.flush(),this._task&&(nr.b(39408131,306,100,"Deleting task {0} from task manager",this._task.name),this._taskManager.deleteTask(this._task)),this._tcs&&!this._tcs.task.isCompleted?this._tcs.setResult(new $i(t,n)):nr.b(512267293,306,15,"Received results but the task has completed")}0}else nr.b(39408099,306,15,"Unexpected message.")},t.getScrubbedErrorInfo=function(e){if(!e)return null;for(var t,n=Object.assign(new hr,{Name:e.Name,Errors:new Array(0),SPCorrelationId:e.SPCorrelationId}),i=mr(e.Errors);!(t=i()).done;){var r=t.value,a=new ur;a.Id=r.Id,a.Details=L.a.getScrubbedHttpErrorDetails(r.Details,500),n.Errors.push(a)}return n},t.requestTokensOnceSync=function(){if(s.AFrameworkApplication.logUniqueExperimentFlightsUsage("SendSynchronousPostMessage;SendSynchronousPostMessageIsEnabledCf"),this._retryCount>=this._refreshPolicy.maxRetryAttempts)return nr.b(39408132,306,15,"Too many attempts to refresh tokens. Aborting. TaskId {0}",this._taskId),void this.createErrorAndSetResult(this._tcs,"TOO_MANY_ATTEMPTS","We did not receive a new token from the host after the maximum allowed number of attempts");l.Health.instance.recordKpiUsage(vr,1,"wwrelfc",null),this.sendAppRefreshSessionInfoPostMessage()},t.sendAppRefreshSessionInfoPostMessage=function(){var e={};e[mn.a.sessionInfo_TokenNamesField]=this._refreshPolicy.tokens,this._shouldAddAllowAADPopupInPostMessage&&(e[mn.a.sessionInfo_AllowAADPopup]=this._shouldAllowAADPopupForTokenRefresh);var t=J.a.create().toString();nr.b(39408133,306,50,"Refreshing tokens {0}. Attempt {1}. Correlation {2}. TaskId {3}.",JSON.stringify(this._refreshPolicy.tokens),this._retryCount+1,t,this._taskId),this._postmessengerFuture.execute((function(n){n.sendMessage(d.a.appRefreshSessionInfo,e,t)})),this._retryCount++,this._logger.incrementCounter(Ji.requests)},t.createErrorAndSetResult=function(e,t,n){for(var i=new te.a,r=0;r<this._refreshPolicy.tokens.length;r++){var a=Object.assign(new hr,{Name:this._refreshPolicy.tokens[r],Errors:[Object.assign(new ur,{Id:t,Details:n})]});i.add(a),this._errors.add(a)}this._taskManager.deleteTask(this._task),this._logger.setMeasure(Ji.errorsCount,JSON.stringify(this._errors)),this._logger.setMeasure(Ji.status,Ji.failed),e&&!e.task.isCompleted&&e.setResult(new $i(new te.a,this._errors))},t.isRestartTaskmanagerGateEnabled=function(){return s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.isChangeGateEnabled("SkipSessionExpiredVetoForShutdown")},t.refreshTokens=function(e,t){var n=this;void 0===t&&(t=null),s.AFrameworkApplication.logUniqueExperimentFlightsUsage("ej4if276;fheca743"),s.AFrameworkApplication.logUniqueExperimentFlightsUsage("5d4fi128;abe10395"),this._tokenRefreshStopwatch.start(),this.isRestartTaskmanagerGateEnabled()&&this._taskManager.hasStopped&&(nr.b(508351137,306,15,"Restarting taskmanager, is shutting down {0}",s.AFrameworkApplication.isShuttingDown),this._taskManager.restart()),this._isTokenExpiring=e,this._taskId=J.a.create().toString(),nr.b(41755338,306,50,"RefreshTokens Start, TaskId: [{0}]. IsTokenExpiring: [{1}].",this._taskId,this._isTokenExpiring),this._retryCount=0,this._errors.clear(),this._tokens.clear();var i=new b.a;(this._tcs=i,t&&t.R((function(){var e=!!i&&!i.task.isCompleted;nr.b(588096223,306,50,"RefreshTokens Cancelled, TaskId: [{0}]. IsTokenExpiring: [{1}]. isTaskStillRunning [{2}].",n._taskId,n._isTokenExpiring,e),e&&n.createErrorAndSetResult(i,"ABORTED_BY_CALLER","The refresh was aborted by the caller")})),this._enableSyncMessageWithTimeout)?this.requestTokensWithTimeout(this._refreshPolicy.maxRetryAttempts).then((function(e){n._tcs&&!n._tcs.task.isCompleted&&n._tcs.setResult(e),n._tokenRefreshResolve=null,n._tokenRefreshReject=null,n._logger.setMeasure(Ji.errorsCount,JSON.stringify(n._errors)),n._logger.setMeasure(Ji.status,Ji.success),n._logger.flush()})).catch((function(e){n._tcs&&!n._tcs.task.isCompleted&&n._tcs.setResult(Object(F.a)(141,e)),n._tokenRefreshResolve=null,n._tokenRefreshReject=null,n._logger.setMeasure(Ji.errorsCount,JSON.stringify(n._errors)),n._logger.setMeasure(Ji.status,Ji.failed),n._logger.flush()})):(this._task=new u.a(this._refreshPolicy.priority,2,this._refreshPolicy.retryInterval,this.requestTokensOnce,98,d.a.appRefreshSessionInfo,!0),this._sendSynchronousMessage&&this.requestTokensOnceSync(),this._taskManager.addTask(this._task));return this._tcs.task},t.requestTokensWithTimeout=function(e){var t=this,n=new Promise((function(e,n){t._tokenRefreshResolve=e,t._tokenRefreshReject=n,l.Health.instance.recordKpiUsage(vr,1,"wwrelfc",null),t.sendAppRefreshSessionInfoPostMessage()})),i=this,r=new Promise((function(e,t){window.setTimeout((function(){t(i.createFailedTokenRefreshArgs("TIMEOUT","We did not receive a new token from the host after the maximum allowed time"))}),i._refreshPolicy.retryInterval)})),a=e,o=this;return new Promise((function(e,t){a--,Promise.race([n,r]).then((function(t){l.Health.instance.recordKpiSuccess(vr,null),e(t)})).catch((function(n){var i=o._refreshPolicy.retryInterval;if(Object(cr.a)(141,n)){var r=Object(F.a)(141,n);if(r.errors.count>0){if(o.logErrorInKPI(r.errors),o.addErrors(r.errors),o.isPermanentErrors(r.errors))return void t(r);var s=o._refreshPolicy.getRetryIntervalOverride(r.errors);s!==o._refreshPolicy.retryInterval?(o._logger.setCounter(Ji.retryOverride,s),i=s):o.isTimeout(r.errors)&&(i=0)}}if(!a){var l=o.createFailedTokenRefreshArgs("TOO_MANY_ATTEMPTS","We did not receive a new token from the host after the maximum allowed number of attempts");return o.addErrors(l.errors),t(l),void nr.b(512267292,306,15,"Too many attempts to refresh tokens. Aborting. TaskId {0}",o._taskId)}window.setTimeout((function(){o.requestTokensWithTimeout(a).then(e).catch(t)}),i)}))}))},t.addErrors=function(e){for(var t,n=mr(e);!(t=n()).done;){var i=t.value;this._errors.add(i)}},t.isTimeout=function(e){if(!e.count)return!1;var t=e.get_item(e.count-1);return!!t.Errors.length&&"TIMEOUT"==t.Errors[0].Id},t.createFailedTokenRefreshArgs=function(e,t){for(var n=new te.a,i=0;i<this._refreshPolicy.tokens.length;i++){var r=this.createErrorInfo(this._refreshPolicy.tokens[i],e,t);n.add(r)}return new $i(new te.a,n)},t.createErrorInfo=function(e,t,n){return Object.assign(new hr,{Name:e,Errors:[Object.assign(new ur,{Id:t,Details:n})]})},t.logErrorInKPI=function(e){if(e.count){var t=e.get_item(e.count-1),n=JSON.stringify(t),i=Object.assign(new Z.a,{extendedProperties:new Map});i.extendedProperties.set("Errors",n),i.extendedProperties.set("RetryCount",this._retryCount.toString()),i.extendedProperties.set("NavigatorOnline",window.navigator.onLine.toString()),i.extendedProperties.set("IsTokenExpiring",this._isTokenExpiring.toString()),this.isRestartTaskmanagerGateEnabled()&&i.extendedProperties.set("IsAppShuttingDown",s.AFrameworkApplication.isShuttingDown.toString()),l.Health.instance.recordKpiFailure(vr,"TokenRefreshFailed",!1,!1,i),this._logger.setMeasure(Ji.error,n),this._logger.setMeasure(Ji.status,Ji.failed)}},t.processTokensOrErrors=function(e){this._tokenRefreshStopwatch.stop();var t=this.hasErrors(e.result.errors);return r.ULS.sendTraceTag(41755339,217,50,"ProcessTokensOrErrors: TokenRefreshResult:{0},TaskId:{1},IsTriggerByTokenExpiring:{2},RetryCount:{3},TotalErrorCount:{4},LastErrorName:{5},LastErrorId:{6},LastErrorDetail:{7}",!t,this._taskId,this._isTokenExpiring,this._retryCount,this._errors.count,e.result.errors.count>0?e.result.errors.get_item(0).Name:"",e.result.errors.count>0&&e.result.errors.get_item(0).Errors.length>0?e.result.errors.get_item(0).Errors[0].Id:"",e.result.errors.count>0&&e.result.errors.get_item(0).Errors.length>0?e.result.errors.get_item(0).Errors[0].Details:""),!t&&this.processTokens(e.result.tokens)},t.isPermanentErrors=function(e){return this._refreshPolicy.isPermanentErrors(e)},t.processTokens=function(e){for(var t=0;t<e.count;t++){var n=e.get_item(t);if(n.Name===mn.a.accessToken){var i=(new Date).getTime();n.Expiry>s.AFrameworkApplication.accessTokenTtl?(r.ULS.sendTraceTag(39706827,217,50,"Updating AccessToken: {0}",{AccessTokenTtl:n.Expiry,NowGetTime:i,BootTime:s.AFrameworkApplication.bootTime},"PreviousAccessTokenTtl",s.AFrameworkApplication.accessTokenTtl),s.AFrameworkApplication.accessToken=n.Value,s.AFrameworkApplication.accessTokenTtl=Math.floor(n.Expiry),s.AFrameworkApplication.wopiTokenLastRefreshTime=i,s.AFrameworkApplication.accessTokenServerExpirationTime=Math.floor(n.Expiry)):r.ULS.sendTraceTag(39706828,217,15,"Ignoring AccessToken because it expires sooner than the current one: {0}",{AccessTokenTtl:n.Expiry,NowGetTime:i,BootTime:s.AFrameworkApplication.bootTime},"PreviousAccessTokenTtl",s.AFrameworkApplication.accessTokenTtl)}}return!0},t.hasErrors=function(e){for(var t=!1,n=0;n<e.count;n++){t=!0;var i=e.get_item(n);r.ULS.sendTraceTag(39706829,217,15,"Received error for token {0}. Errors: {1}. TaskId: {2}, SPCorrelationId: {3}",i.Name,JSON.stringify(i.Errors),this._taskId,i.SPCorrelationId)}return t},t.isTokenRevokedError=function(e){return!!e.includes("aadInteractionRequired")||(!!e.includes("sessionRevocation")||(!!e.includes("blockAccessForTenantRestrictions")||(!!e.includes("revoked")||!!e.includes("Due to organizational policies, you can't access these resources from this network location"))))},t.getErrorBucketToVeto=function(e){var t=Qn.a.sessionAccessTokenExpired,n=parseInt(e.Id),i=e.Details.toString();if(isNaN(n))t=Qn.a.wopiTokenRefreshFailed_Other;else{switch(n){case 401:t=Qn.a.wopiTokenRefreshFailed_Unauthorized,this._shouldAllowMessageForTokenRefreshError&&this.isTokenRevokedError(i)&&(t=Qn.a.wopiTokenRefreshFailed_Revoked);break;case 403:t=Qn.a.wopiTokenRefreshFailed_Forbidden,this._shouldAllowMessageForTokenRefreshError&&this.isTokenRevokedError(i)&&(t=Qn.a.wopiTokenRefreshFailed_Revoked);break;case 500:t=Qn.a.wopiTokenRefreshFailed_InternalServerError;break;case 503:t=Qn.a.wopiTokenRefreshFailed_ServiceUnavailable}t===Qn.a.sessionAccessTokenExpired&&(t=n>500?Qn.a.wopiTokenRefreshFailed_ServerError:Qn.a.wopiTokenRefreshFailed_ClientError)}return t},e}();function yr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Sr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(_r,"TokenRefreshManager",null,[123]);var br=function(){function e(){this.retryInterval=s.AFrameworkApplication.wopiTokenRefreshRetryeInterval,this.maxRetryAttempts=s.AFrameworkApplication.wopiTokenRefreshMaxRetryAttempts,this.tokens=s.AFrameworkApplication.get_wopiTokensToRefresh(),this.expirationPolicy=s.AFrameworkApplication.wopiTokenExpirationPolicy,this.priority=s.AFrameworkApplication.wopiTokenTaskItemPriority,this._retriableErrorInterval=this.setRetryIntervalForNetworkIssue(),this._wopiTokenRefreshPermanentHostErrorList=s.AFrameworkApplication.get_wopiTokenRefreshPermanentHostErrorIdList()}var t=e.prototype;return t.isPermanentErrors=function(e){var t=JSON.stringify(e);if(this._wopiTokenRefreshPermanentHostErrorList&&this._wopiTokenRefreshPermanentHostErrorList.length>0)for(var n,i=yr(this._wopiTokenRefreshPermanentHostErrorList);!(n=i()).done;){var r=n.value;if(r.length>0&&t.indexOf(r)>=0)return!0}return!1},t.getRetryIntervalOverride=function(e){try{if(e)for(var t,n=yr(e);!(t=n()).done;){var i=t.value;if(i.Errors)for(var a,o=yr(i.Errors);!(a=o()).done;){var s=a.value;if(s.Id in this._retriableErrorInterval)return Number.parseInvariant(this._retriableErrorInterval[s.Id].toString())}}}catch(e){r.ULS.sendTraceTag(41501720,217,50,"TokenRefreshPolicy:GetRetryIntervalOverride, exception:{0}",e.toString())}return this.retryInterval},t.setRetryIntervalForNetworkIssue=function(){var e={};try{if(!s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList()||s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList().length<=0||""===s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList()[0])return e;for(var t,n=yr(s.AFrameworkApplication.get_wopiTokenRefreshNetworkErrorIdList());!(t=n()).done;){var i=t.value;i.length>0&&(e[i]=s.AFrameworkApplication.wopiTokenRefreshRetryIntervalForClientNetworkIssue)}}catch(e){r.ULS.sendTraceTag(41755340,217,50,"TokenRefreshPolicy:SetRetryIntervalForNetworkIssue, exception:{0}",e.toString())}return e},e}();function Ar(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(br,"TokenRefreshPolicy",null,[122]);var Cr=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("Common.ISessionExpirationManagerFactory"),this._container.resolve("Common.ISessionExpirationManager"),this._container.resolve("Common.ISessionExpirationManagerWithDialog")},r.dispose=function(){},r.configure=function(e){this._container=e,e.register(121,"Common.App.SessionExpiration.ISessionLogger").singleInstance().usingFactory((function(){return new Zi(S.TaskManager.instance)})),e.register(122,"Common.App.SessionExpiration.ITokenRefreshPolicy").singleInstance().usingFactory((function(){return new br})),e.register(123,"Common.App.SessionExpiration.ITokenRefreshManager").singleInstance().usingFactory((function(){return new _r(S.TaskManager.instance,s.AFrameworkApplication.get_hostPostmessengerFuture(),e.resolve("Common.App.SessionExpiration.ITokenRefreshPolicy"),e.resolve("Common.App.SessionExpiration.ISessionLogger"),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WopiTokenRefreshSendTokenRequestWithoutTasks"),e.tryResolve("Common.ISessionStatus"),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WopiAllowTokenRefreshErrorTracking"),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WopiTokenRefreshSyncMessageWithTimeout"),s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.ShouldAddAllowAADPopupInPostMessage",!1),s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.ShouldAllowAADPopupForTokenRefresh",!1),s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.RevokedTokenExperiment",!1)&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ShowTokenRevocationErrorMessage"))})),e.register(124,"Common.ISessionExpirationManagerFactory").singleInstance().usingFactory((function(){return new lr(s.AFrameworkApplication.activeFrame,e.resolve("Common.App.SessionExpiration.ITokenRefreshManager"),e.resolve("Common.App.SessionExpiration.ISessionLogger"),e.tryResolve("Common.ISessionStatus"))})),e.register(125,"Common.ISessionExpirationManagerWithDialog").singleInstance().usingFactory((function(){return e.resolve("Common.ISessionExpirationManagerFactory").create()})),e.register(126,"Common.ISessionExpirationManager").singleInstance().usingFactory((function(){return e.resolve("Common.ISessionExpirationManagerWithDialog")}))},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.SessionExpiration"}}])&&Ar(t.prototype,n),i&&Ar(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Cr,"SessionExpirationPackage",null,[2,3]);function Tr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var kr=function(){function e(e,t,n){var i=this;this.onTryMacOffice=function(e,t,n,r,a){if(1===n)return 32;if(a){var o=a.SourceControlId;"btnjTryMacOfficeForWordEditor"===o?ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(12),"_blank",void 0,"MacOfficeOffer.TriggerFromWordEditor"):"PptJewel.About.TryMacOffice"===o&&ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(22),"_blank",void 0,"MacOfficeOffer.TriggerFromPPTEditor")}else i.launchMacOfficeTrialWindow();return 32},this.onTryMacOfficeFromViewer=function(e,t,n,i,r){if(1===n)return 32;switch(e){case p.a.tryMacOfficeFromWordViewer:ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(15),"_blank",void 0,"MacOfficeOffer.TriggerFromWordViewer");break;case p.a.tryMacOfficeFromPowerPointViewer:ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(25),"_blank",void 0,"MacOfficeOffer.TriggerFromPPTViewer")}return 32},this._actionManager=e,this._isMacOfficeTrialOfferEnabled=t,this._lcid=n}var t,n,i,r=e.prototype;return r.registerActions=function(){this._actionManager.addAction(p.a.tryMacOffice,_e.a.frame,this.onTryMacOffice),this._actionManager.addAction(p.a.tryMacOfficeFromWordViewer,_e.a.frame,this.onTryMacOfficeFromViewer),this._actionManager.addAction(p.a.tryMacOfficeFromPowerPointViewer,_e.a.frame,this.onTryMacOfficeFromViewer)},r.launchMacOfficeTrialWindow=function(t){void 0===t&&(t=null);var n=0;t&&(n=t);var i=2===n?"https://go.microsoft.com/fwlink/?LinkId=331579":e.macOfficeTrialTarget;ut.a.safelyOpenWindow(i,"_blank",void 0,"LaunchMacTrialWindow")},t=e,i=[{key:"macOfficeTrialTarget",get:function(){return O.a.getFwLinkUrl("522401")}}],(n=[{key:"shouldOfferMacOfficeTrial",get:function(){return this._isMacOfficeTrialOfferEnabled&&z.a.isMac&&!z.a.isPpcMac&&!MSOJS.ClientUtils.IsO14MacPluginInstalled()}},{key:"shouldOfferMacOfficeTrialInFileMenu",get:function(){var e=this.shouldOfferMacOfficeTrial;return e||s.AFrameworkApplication.theWsaClient.setBool(9124,1),e}},{key:"shouldOfferMacOfficeTrialInErrorDialog",get:function(){return this.shouldOfferMacOfficeTrial}}])&&Tr(t.prototype,n),i&&Tr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function wr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(kr,"MacOfficeOffer",null,[143]);var Ir=function(){function e(e,t,n){var i=this;this.onTryOffice=function(e,t,n,r,a){if(i._useApplicationFeatureHelperApi&&1===n)return i.isFreemiumUpsellEnabled&&i.shouldOfferOfficeTrial?32:8;if(2===n)if(a){var o=a.SourceControlId;"btnjTryOfficeForWordEditor"===o?ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(11),"_blank",void 0,"OfficeTrial.TriggerFromWordEditor"):"PptJewel.About.TryOffice"===o?ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(21),"_blank",void 0,"OfficeTrial.TriggerFromPPTViewer"):i.launchOffer()}else i.launchOffer();return 32},this.tryOfficeThroughTellMe=function(e,t,n,r,a){if(i._useApplicationFeatureHelperApi&&1===n)return i.isFreemiumUpsellEnabled&&i.shouldOfferOfficeTrial?32:8;if(2===n)if(a){var o=a.SourceControlId;ut.a.safelyOpenWindow(O.a.getFwLinkUrl("862405")+i.getParameterForTellMeFeatures(o),"_blank",void 0,"TryOfficeThroughTellMe.WithSourceControlId")}else ut.a.safelyOpenWindow(O.a.getFwLinkUrl("522402"),"_blank",void 0,"TryOfficeThroughTellMe.Legacy");return 32},this.tryOfficeThroughViewer=function(e,t,n,r,a){if(i._useApplicationFeatureHelperApi&&1===n)return i.isFreemiumUpsellEnabled&&i.shouldOfferOfficeTrial?32:8;if(2===n)switch(e){case p.a.tryOfficeFromWordViewer:ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(14),"_blank",void 0,"TryOfficeThroughViewer.Word");break;case p.a.tryOfficeFromPowerPointViewer:ut.a.safelyOpenWindow(O.a.getFwLinkForUpsellFeatures(24),"_blank",void 0,"TryOfficeThroughViewer.PPT")}return 32},this._actionManager=e,this._isOfficeTrialOfferEnabled=t,this._applicationFeatureHelper=null,this._useApplicationFeatureHelperApi=s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1),this._useApplicationFeatureHelperApi&&Q.a.instance.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute((function(e){i._applicationFeatureHelper=e})),this._lcid=n}var t,n,i,r=e.prototype;return r.registerActions=function(){this._actionManager.addAction(p.a.tryOffice,_e.a.frame,this.onTryOffice),this._actionManager.addAction(p.a.tryOfficeThroughTellMe,_e.a.frame,this.tryOfficeThroughTellMe),this._actionManager.addAction(p.a.tryOfficeFromWordViewer,_e.a.frame,this.tryOfficeThroughViewer),this._actionManager.addAction(p.a.tryOfficeFromPowerPointViewer,_e.a.frame,this.tryOfficeThroughViewer)},r.launchOffer=function(t){void 0===t&&(t=null);var n=0;t&&(n=t),ut.a.safelyOpenWindow(e.getLinkForPlatformAndApplication(n),"_blank",void 0,"LaunchOfficeOffer")},r.getParameterForTellMeFeatures=function(e){var t=0;switch(e){case"jbtnTryOfficeThroughTellMeForWordTrackChanges":t=1;break;case"jbtnTryOfficeThroughTellMeForWordShapes":t=2;break;case"jbtnTryOfficeThroughTellMeForWordLabel":t=3;break;case"jbtnTryOfficeThroughTellMeForWordCitations":t=4;break;case"jbtnTryOfficeThroughTellMeForWordTextBox":t=5;break;case"jbtnTryOfficeThroughTellMeForWordTableOfContent":t=6;break;case"jbtnTryOfficeThroughTellMeForWordSmartArt":t=7;break;case"jbtnTryOfficeThroughTellMeForWordWordArt":t=8;break;case"jbtnTryOfficeThroughTellMeForWordMultiColumnLayout":t=9;break;case"jbtnTryOfficeThroughTellMeForWordEquation":t=10;break;case"jbtnTryOfficeThroughTellMeForPPTGroupShapes":t=16;break;case"jbtnTryOfficeThroughTellMeForPPTWordArt":t=17;break;case"jbtnTryOfficeThroughTellMeForPPTSpellCheckDict":t=18;break;case"jbtnTryOfficeThroughTellMeForPPTInsertAudio":t=19;break;case"jbtnTryOfficeThroughTellMeForPPTInsertChart":t=20;break;case"TellMe.TryOfficeThroughTellMeForXLSSpellCheck":t=26;break;case"TellMe.TryOfficeThroughTellMeForXLSMacros":t=27;break;case"TellMe.TryOfficeThroughTellMeForXLSPivotTable":t=28;break;case"TellMe.TryOfficeThroughTellMeForXLSHeaderFooter":t=29}return 0===t?"":String.format("&pc={0:D}",t)},e.getLinkForPlatformAndApplication=function(e){if(z.a.isIPad)switch(e){case 1:return O.a.getFwLinkUrl("393806");case 2:return O.a.getFwLinkUrl("393810");case 3:return O.a.getFwLinkUrl("393809");case 5:return O.a.getFwLinkUrl("393805")}else if(z.a.isAndroid)switch(e){case 1:return O.a.getFwLinkUrl("521979");case 3:return O.a.getFwLinkUrl("521980");case 5:return O.a.getFwLinkUrl("521978");case 2:return O.a.getFwLinkUrl("522490")}else{if(2===e)return O.a.getFwLinkUrl("517778");if(1===e)return O.a.getFwLinkForUpsellFeatures(30)}return O.a.getFwLinkUrl("522402")},t=e,(n=[{key:"offerOfficeTrialInFileMenu",get:function(){return this.shouldOfferOfficeTrial}},{key:"offerOfficeTrialInDialog",get:function(){return this.shouldOfferOfficeTrial&&MSOJS.ClientUtils.OfferOfficeInDialog()}},{key:"shouldOfferOfficeTrial",get:function(){return this._isOfficeTrialOfferEnabled&&!z.a.isMac}},{key:"isFreemiumUpsellEnabled",get:function(){var e=!1;return this._applicationFeatureHelper&&(e=this._applicationFeatureHelper.isFreemiumUpsellEnabled()),e}}])&&wr(t.prototype,n),i&&wr(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ir,"OfficeTrialExperience",null,[139]);var Pr=function(){function e(){}return e.prototype.configure=function(e){e.register(Ir,"Common.App.OpenInClient.OfficeTrialExperience").as("Common.IOfficeTrialExperience").singleInstance().usingFactory((function(){return new Ir(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.isOfficeTrialOfferEnabled,s.AFrameworkApplication.lcid)})),e.register(kr,"Common.App.OpenInClient.MacOfficeOffer").as("Common.IMacOfficeOffer").singleInstance().usingFactory((function(){return new kr(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.isMacOfficeTrialOfferEnabled,s.AFrameworkApplication.lcid)}))},e}();Object(i.a)(Pr,"OpenInClientConfiguration",null,[3]);var Fr=n(26),Er=n(36),Or=n(12),Mr=n(6),Lr=n(22);function Rr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Dr(e,t){return(Dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var xr=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).commandsHeaderText=CommonUIStrings.l_AccHelpDialogCommandsHeaderText,n.shortcutHeaderText=CommonUIStrings.l_AccHelpDialogShortcutHeaderText,n._shortcutEntries=null,n._moreHelpLink=null,n._dialogTable=null,n._selectedRow=null,n.dialogBody=null,n.rowOnFocusHandler=function(e){e.target.setAttribute(Mr.a.ariaSelectedAttribute,Mr.a.ariaTrueValue),Sys.UI.DomElement.removeCssClass(n._selectedRow,"inactiveRowSelection"),n._selectedRow=e.target},n.rowOnBlurHandler=function(e){e.target.removeAttribute(Mr.a.ariaSelectedAttribute),Sys.UI.DomElement.addCssClass(e.target,"inactiveRowSelection")},n.cellOnFocusHandler=function(e){var t=e.target.parentNode;t&&t!==n._selectedRow&&n.setFocusOnElement(t)},n.tableOnKeyUpHandler=function(e){return e.innerEvent.keyCode===Er.a.vK_Enter&&(e.innerEvent.stopPropagation(),!0)},n.accHelpDialogKeydownHandler=function(e){if(!e.innerEvent)return!1;var t=e.innerEvent.keyCode;if(e.eventName===m.a.keyDown){var i=n.getIndexOfRow(n._selectedRow),r=-1,a=X.a.count(n.shortcutEntries)-1;t===Sys.UI.Key.down?r=i<a?i+1:0:t===Sys.UI.Key.up?r=i>0?i-1:a:t===Sys.UI.Key.home?r=0:t===Sys.UI.Key.end&&(r=a),-1!==r&&n.setFocusOnElement(n._dialogTable.tBodies[0].children[r])}return!0},n._focusManager=t,n.dialogHtml="<div id='AccessibilityHelpDialogBody'></div>",n.dialogId="AAccessibilityHelpDialog",n.buttonsOption=6,n.setButtonText(0,CommonUIStrings.l_DialogClose),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Dr(t,n);var r,a,o,s=i.prototype;return s.setDialogProperties=function(t){e.prototype.setDialogProperties.call(this,t),this.populateDialogBody()},s.showAndFocus=function(){this.showDialog(this.dialogTitle,Object(A.a)(this,this.accHelpDialogResultHandler,"accHelpDialogResultHandler")),this.rebindTabNavigationHandlers(),this.setFocus()},s.setFocus=function(){this._dialogTable?(this._selectedRow=this._dialogTable.tBodies[0].firstChild,this.setFocusOnElement(this._selectedRow)):this._btnAction&&"none"!==this._btnAction.style.display?this.setFocusOnElement(this._btnAction):this.setFocusOnElement(this._btnCancel)},s.attachDialogEvents=function(){if(this._keyInputManager.registerHandler(m.a.keyDown,this.dialogBody,this.accHelpDialogKeydownHandler),this._dialogTable){this._keyInputManager.registerHandler(m.a.keyUp,this._dialogTable,this.tableOnKeyUpHandler);for(var t=this._dialogTable.tBodies[0].children,n=0;n<t.length;n++)if(Be.a.addHandler(t[n],m.a.focus,this.rowOnFocusHandler),Be.a.addHandler(t[n],m.a.blur,this.rowOnBlurHandler),z.a.isInternetExplorerNonEdge)for(var i=t[n].children,r=0;r<i.length;r++)Be.a.addHandler(i[r],m.a.focus,this.cellOnFocusHandler)}e.prototype.attachDialogEvents.call(this)},s.detachDialogEvents=function(){if(this._keyInputManager&&(this._keyInputManager.unregisterHandler(m.a.keyDown,this.dialogBody,this.accHelpDialogKeydownHandler),this._dialogTable&&this._keyInputManager.unregisterHandler(m.a.keyUp,this._dialogTable,this.tableOnKeyUpHandler)),this._dialogTable)for(var t=this._dialogTable.tBodies[0].children,n=0;n<t.length;n++)if(Be.a.removeHandler(t[n],m.a.focus,this.rowOnFocusHandler),Be.a.removeHandler(t[n],m.a.blur,this.rowOnBlurHandler),z.a.isInternetExplorerNonEdge)for(var i=t[n].children,r=0;r<i.length;r++)Be.a.removeHandler(i[r],m.a.focus,this.cellOnFocusHandler);e.prototype.detachDialogEvents.call(this)},s.rebindTabNavigationHandlers=function(){this.currentFocusRegion.scope.unBindAction(this._focusManager._tabInput),this.currentFocusRegion.scope.unBindAction(this._focusManager._tabShiftInput),this.currentFocusRegion.scope.bindAction(this._focusManager._tabInput,p.a.accessibilityHelpDialogFocusForward),this.currentFocusRegion.scope.bindAction(this._focusManager._tabShiftInput,p.a.accessibilityHelpDialogFocusBackward)},s.handleTabFocus=function(e,t,n,i,r){if(!this.currentFocusRegion.listing||!this.currentFocusRegion.listing.currentElement)return 2;var a=this.currentFocusRegion.listing.currentElement;if(this._dialogTable&&(a===this._btnCancel&&e===p.a.accessibilityHelpDialogFocusForward||a===this._moreHelpLink&&e===p.a.accessibilityHelpDialogFocusBackward))this.setFocusOnElement(this._selectedRow);else if(a.id.startsWith("SelectableTableRow")){var o=null;e===p.a.accessibilityHelpDialogFocusForward?o=this._moreHelpLink:e===p.a.accessibilityHelpDialogFocusBackward&&(o=this._btnCancel),o&&this.setFocusOnElement(o)}else if(e===p.a.accessibilityHelpDialogFocusForward)this.currentFocusRegion.moveForward();else{if(e!==p.a.accessibilityHelpDialogFocusBackward)return 2;this.currentFocusRegion.moveBackward()}return 32},s.accHelpDialogResultHandler=function(e,t){},s.populateDialogBody=function(){this.dialogBody=document.getElementById("AccessibilityHelpDialogBody")||this._bodyPanel,this.createSubtitle(),this.createShortcutsTable(),this.createMoreHelpLink()},s.createSubtitle=function(){if(this.dialogSubtitle){var e=document.createElement("div");e.className="WACDialogSubtitle";var t=document.createElement("span");t.innerText=this.dialogSubtitle,e.appendChild(t),this._divMessageBoxTitle.appendChild(e)}},s.createShortcutsTable=function(){if(this.shortcutEntries&&!X.a.isEmpty(this.shortcutEntries)){this._dialogTable=document.createElement("table"),this._dialogTable.className="SelectableDialogTable";var e=document.createElement("thead"),t=document.createElement("tr");t.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaRowRole),e.appendChild(t);var n=Lr.a.createElementWithInnerTextSafe(14,this.commandsHeaderText);t.appendChild(n);var i=Lr.a.createElementWithInnerTextSafe(14,this.shortcutHeaderText);t.appendChild(i),this._dialogTable.appendChild(e);var r=document.createElement("tbody"),a=0,o=this.shortcutEntries;for(var s in o){var l={key:s,value:o[s]},c=document.createElement("tr");c.tabIndex=0,c.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaRowRole),c.id="SelectableTableRow"+a++;var u=Lr.a.createElementWithInnerTextSafe(15,l.key);c.appendChild(u);var d=Lr.a.createElementWithInnerTextSafe(15,l.value);c.appendChild(d),r.appendChild(c)}r.style.maxHeight=this.tableMaxHeight+"px",this._dialogTable.appendChild(r),this.dialogBody.appendChild(this._dialogTable)}},s.createMoreHelpLink=function(){if(this.moreHelpLinkText&&this.moreHelpLinkUrl){var e=document.createElement("div");e.className="WACDialogLearnMoreLinkContainer",this._moreHelpLink=document.createElement("a"),this._moreHelpLink.innerText=this.moreHelpLinkText,this._moreHelpLink.href=this.moreHelpLinkUrl,this._moreHelpLink.target="_blank",this._moreHelpLink.id=this.myId("AccessibilityHelpDialogLink"),this._moreHelpLink.className=Dt.AFrame.allowBrowserClickClassname,e.appendChild(this._moreHelpLink),this._divMessageBox.insertBefore(e,this._divMessageBox.lastChild)}},s.getIndexOfRow=function(e){var t="SelectableTableRow".length;return Number.parseInvariant(e.id.substr(t))},s.addCommandShortcutToDict=function(e,t,n,i){if(void 0===i&&(i=null),e&&t&&n){var r=i?String.format(n,i):n;e[t]=r}},s.getSpecialKeyForOS=function(e,t){return z.a.isMac?t:e},r=i,(a=[{key:"dialogSubtitle",get:function(){return null}},{key:"shortcutEntries",get:function(){return this._shortcutEntries||(this._shortcutEntries=this.initializeDictionary()),this._shortcutEntries}},{key:"tableMaxHeight",get:function(){return 300}},{key:"moreHelpLinkUrl",get:function(){return"https://go.microsoft.com/fwlink/p/?LinkId=325036"}},{key:"moreHelpLinkText",get:function(){return CommonUIStrings.l_AccHelpDialogMoreHelpLinkText}},{key:"currentFocusRegion",get:function(){return this._focusManager.getCurrentRegion()}}])&&Rr(r.prototype,a),o&&Rr(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(Bi.a);function Br(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ur(e,t){return(Ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(xr,"AAccessibilityHelpDialog",Bi.a,[161]);var Hr=function(e){var t,n,i,r,a;function o(t){return e.call(this,t)||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ur(t,n),o.prototype.initializeDictionary=function(){var e={};return e[CommonUIStrings.l_AccHelpDialogAccHelpCommand]=CommonUIStrings.l_AccHelpDialogAccHelpShortcut,e[CommonUIStrings.l_AccHelpDialogMoveInEditingAreaCommand]=CommonUIStrings.l_AccHelpDialogMoveInEditingAreaShortcut,s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("AccessibleMovingDialogsEnabled")&&(e[CommonUIStrings.l_AccHelpDialogOpenDialogMenuCommand]=CommonUIStrings.l_AccHelpDialogOpenDialogMenuShortcut),e},i=o,(r=[{key:"dialogTitle",get:function(){return CommonUIStrings.l_AccHelpDialogAppViewerTitle}}])&&Br(i.prototype,r),a&&Br(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(xr);Object(i.a)(Hr,"PdfViewerAccessibilityHelpDialog",xr,[]);var Nr=n(9);function Wr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function jr(e,t){return(jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Vr=function(e){var t,n;function i(t,n){var i;return(i=e.call(this,n)||this)._actionManager=t,i.buttonsOption=1,i.setButtonText(1,WacWordviewerStrings.AccessibilityMode),i.setButtonText(0,CommonUIStrings.l_DialogClose),i}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,jr(t,n);var r,a,o,s=i.prototype;return s.populateDialogBody=function(){e.prototype.populateDialogBody.call(this);var t=document.createElement("div");t.style.maxWidth="550px";var n=Lr.a.createElementWithInnerTextSafe(12,WacWordviewerStrings.AccHelpDialogSwitchToAccessibleMode);t.appendChild(n),this.dialogBody.appendChild(t),this._divMessageBox.setAttribute(Mr.a.ariaDescribedByAttribute,"WACDialogText")},s.accHelpDialogResultHandler=function(e,t){1===e?this._actionManager.processAction(Nr.a.toggleViewMode,2):e||this.hide()},s.initializeDictionary=function(){return null},r=i,(a=[{key:"dialogTitle",get:function(){return CommonUIStrings.l_AccHelpDialogAppViewerTitle}}])&&Wr(r.prototype,a),o&&Wr(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(xr);Object(i.a)(Vr,"PngViewerAccessibilityHelpDialog",xr,[]);var qr=function(){function e(e,t){var n=this;this._dialog=null,this.showAccessibilityHelpDialog=function(e,t,i,a,o){return 1===i?32:(Or.App.instance.isAccessiblePdfMode?n._dialog=new Hr(n._focusManager):n._dialog=new Vr(n._actionManager,n._focusManager),n._dialog?(n._dialog.showAndFocus(),32):(r.ULS.sendTraceTag(21233674,334,10,"AccessibilityHelpDialog failed to initialize"),8))},this.accHelpDialogTabFocusHandler=function(e,t,i,r,a){return n._dialog?n._dialog.handleTabFocus(e,t,i,r,a):2},this._actionManager=e,this._focusManager=t}return e.prototype.registerActions=function(){if(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UIDiscoverabilityEnabled")&&Or.App.instance.userMayEnterAccessiblePdfMode){var e=Fr.KeyInputManager.hashKey(Er.a.VK_A,5);this._focusManager.getScope(Dt.AFrame.documentFocusID).unBindAction(e),this._focusManager.getScope(Dt.AFrame.mainAppFocusId).bindAction(e,p.a.showAccessibilityHelpDialog),this._actionManager.addAction(p.a.showAccessibilityHelpDialog,_e.a.frame,this.showAccessibilityHelpDialog),this._actionManager.addAction(p.a.accessibilityHelpDialogFocusForward,_e.a.frame,this.accHelpDialogTabFocusHandler),this._actionManager.addAction(p.a.accessibilityHelpDialogFocusBackward,_e.a.frame,this.accHelpDialogTabFocusHandler)}},e}();Object(i.a)(qr,"AccessibilityHelpDialogActor",null,[]);var Gr=n(76);function Kr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return zr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zr(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Xr=function(e,t){var n=new xe.a;return n.set_item("appSharingUrl",Jr(t)),n.set_item("appId",e),Zr(n)},Jr=function(e){var t=e,n=new K.QueryStringBuilder(t);n.addParam("auth","2"),n.addParam("flight","officeunihost"),n.addParam("source","TEAMS-ELECTRON.meetingStage.deeplink");var i=new xe.a;i.set_item("fileType",Ze.a.getFileExtension(s.AFrameworkApplication.fileName).substring(1,s.AFrameworkApplication.fileName.length)),i.set_item("objectUrl",s.AFrameworkApplication.appSettingsManager.getStringAppSetting("EditDocInClientUrl")),i.set_item("baseUrl",s.AFrameworkApplication.docPropertiesProvider.breadcrumbBrandUrl),i.set_item("fileId",Qr(s.AFrameworkApplication.appSettingsManager.getStringAppSetting("RootFileId")));var r=H.c(Zr(i));return n.addParam("subEntityId",r.substring(1,r.length-1)),n.toString()},Qr=function(e){for(var t=e,n=decodeURIComponent(t);t!==n;)t=n,n=decodeURIComponent(t);if(t.length<32)return r.ULS.sendTraceTag(509440723,230,15,"Decoded fileId does not match expected format. Decoded id: ${fullyDecodedId}"),"";var i=t.substring(t.length-32,t.length),a=i.substring(0,8)+"-"+i.substring(8,12)+"-"+i.substring(12,16)+"-"+i.substring(16,20)+"-"+i.substring(20,32);return new RegExp("^(\\{){0,1}[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{12}(\\}){0,1}$").test(a)?a:(r.ULS.sendTraceTag(509203084,230,15,"Unable to parse the fileId from the WOPISrc ParsedFileId: ${fileIdGuid}"),"")},Zr=function(e){for(var t,n=new Sys.StringBuilder,i=Kr(e.keys);!(t=i()).done;){var r=t.value;n.append(String.format('"{0}": "{1}"',r,e.get_item(r)))}return"{"+n.toString(",")+"}"},Yr=n(467);function $r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ea=function(){function e(e,t){var n=this;this._hostPostmessenger=null,this._hostPostmessengerReadyForDispatchFuture=null,this.onHostPostmessengerCreated=function(e){n._hostPostmessenger=e,n.m_handleRaceConditionInHostManagerInit&&(n._hostPostmessengerReadyForDispatchFuture.instance=e),r.ULS.sendTraceTag(536987589,306,n.hostPostmessenger?50:10,String.format("OnHostPostmessengerCreated - Setting OnHostPostmessengerCreated as null value = {0}",!n.hostPostmessenger))},this._actionManager=e,this._hostPostmessengerFuture=t,this.m_handleRaceConditionInHostManagerInit=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HandleRaceConditionInHostManagerInit"),this.m_handleRaceConditionInHostManagerInit&&(this._hostPostmessengerReadyForDispatchFuture=Yr.a.create()),this._systemInitiatedFeedback=Q.a.instance.resolveFuture("Common.ISystemInitiatedFeedback")}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addActionWithFlags(p.a.close,_e.a.frame,Object(A.a)(this,this.closeDocument,"closeDocument"),2176),this._actionManager.addActionWithFlags(p.a.fileProperties,_e.a.frame,Object(A.a)(this,this.fileProperties,"fileProperties"),128),this._actionManager.addAction(p.a.fileSharing,_e.a.frame,Object(A.a)(this,this.fileSharing,"fileSharing")),this._actionManager.addAction(p.a.coEditInTeams,_e.a.frame,Object(A.a)(this,this.coEditInTeams,"coEditInTeams")),this._actionManager.addActionWithFlags(p.a.copyAndEdit,_e.a.frame,Object(A.a)(this,this.copyAndEdit,"copyAndEdit"),128),this._actionManager.addActionWithFlags(p.a.replyWithChanges,_e.a.frame,Object(A.a)(this,this.replyWithChanges,"replyWithChanges"),128),this._actionManager.addActionWithFlags(p.a.showFileVersion,_e.a.frame,Object(A.a)(this,this.fileVersion,"fileVersion"),128),this._actionManager.addAction(p.a.downloadACopy,_e.a.frame,Object(A.a)(this,this.downloadACopy,"downloadACopy")),this._actionManager.addAction(p.a.downloadACopyDownloadButtonClick,_e.a.frame,Pt.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(p.a.reportAbuseLink,_e.a.frame,Object(A.a)(this,this.reportAbuseLink,"reportAbuseLink"),128),this._actionManager.addActionWithFlags(p.a.signIn,_e.a.frame,Object(A.a)(this,this.signInInternal,"signInInternal"),128),this._actionManager.addAction(p.a.workflow,_e.a.frame,Object(A.a)(this,this.workflow,"workflow")),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DocumentNameInJewelInfoMenuIsEnabled")&&this._actionManager.addActionWithFlags(p.a.queryBreadcrumbDocName,_e.a.frame,Object(A.a)(this,this.queryBreadcrumbDocName,"queryBreadcrumbDocName"),96),this._actionManager.addActionWithFlags(p.a.queryCopyAndEditButton,_e.a.frame,Object(A.a)(this,this.queryCopyAndEditButton,"queryCopyAndEditButton"),96),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("DiagnosticsInfoInJewelAboutMenuIsEnabled")&&(this._actionManager.addActionWithFlags(p.a.queryBuildVersion,_e.a.frame,Object(A.a)(this,this.queryBuildVersion,"queryBuildVersion"),2144),this._actionManager.addActionWithFlags(p.a.querySessionId,_e.a.frame,Object(A.a)(this,this.querySessionId,"querySessionId"),2144)),this._actionManager.addAction(p.a.conversation,_e.a.frame,Object(A.a)(this,this.conversation,"conversation")),this._hostPostmessengerFuture.execute(this.onHostPostmessengerCreated),r.ULS.sendTraceTag(536987588,306,50,"WebAppFrameCommandUIActor-RegisterActions done.")},a.closeDocument=function(e,t,n,i,r){var a=2===n,o=Ui.h;return r&&(o=r),t&&a&&!this.beforeCloseDocument(o)?8:this.closeDocumentInternal(a,o)},a.beforeCloseDocument=function(e){return!0},a.closeDocumentInternal=function(e,t){if(s.AFrameworkApplication.activeFrame.applicationInstance.shouldCommandBeHostControlled("3033402446"))return r.ULS.sendTraceTag(41231952,306,50,"CloseDocumentInternal - Sending FileClose postMessage to give the host control of closing the page"),this.sendPostmessage(e,d.a.fileClose,!0,{});if(s.AFrameworkApplication.reportAbuseUrl&&t&&t===Ui.f)return r.ULS.sendTraceTag(6070357,306,50,"CloseDocumentInternal - navigating to ReportAbuseUrl"),s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,s.AFrameworkApplication.reportAbuseUrl);if(s.AFrameworkApplication.isEmbedded)return e&&r.ULS.sendTraceTag(6070358,306,50,"CloseDocumentInternal - cannot close because application is embedded"),8;if(s.AFrameworkApplication.closeWindowOnAppClose){if(!e)return 32;r.ULS.sendTraceTag(6070359,306,50,"CloseDocumentInternal - closing the window");try{return window.top.close(),32}catch(e){return r.ULS.sendTraceTag(6070360,306,10,"CloseDocumentInternal - encountered unexpected exception: {0}",e),8}}var n,i=s.AFrameworkApplication.closeUrl;return i?(t||(t=Ui.h),t===Ui.c||t===Ui.h?s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i):s.AFrameworkApplication.replyWithChangesUrl?(e&&r.ULS.sendTraceTag(6070362,306,50,"CloseDocumentInternal - Using ReplyWithChanges postmessage"),32!==(n=t===Ui.d||t===Ui.b?this.sendPostmessage(e,d.a.replyWithChanges,s.AFrameworkApplication.useReplyWithChangesPostMessage,{event_source:t}):2)?(i=t?O.a.addOrReplaceParameterValue(s.AFrameworkApplication.replyWithChangesUrl,Ui.e,t):s.AFrameworkApplication.replyWithChangesUrl,s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i)):n):(e&&r.ULS.sendTraceTag(6070363,306,50,"CloseDocumentInternal - Using FileClose postmessage"),32!==(n=t===Ui.b?this.sendPostmessage(e,d.a.fileClose,s.AFrameworkApplication.useClosePostMessage,null):2)?s.AFrameworkApplication.activeFrame.navigateToHostUrl(e,i):n)):(e&&r.ULS.sendTraceTag(6070361,306,50,"CloseDocumentInternal - no closeUrl found"),8)},a.signInInternal=function(e,t,n,i,r){var a=r,o=this.sendPostmessage(2===n,d.a.signIn,!0,a);return 8===o&&(window.top.location=s.AFrameworkApplication.signInUrl,o=32),o},a.fileProperties=function(e,t,n,i,r){var a=this.sendPostmessage(2===n,d.a.fileProperties,s.AFrameworkApplication.useFilePropertiesPostMessage,null);return 32!==a?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.filePropertiesUrl):a},a.fileSharing=function(t,n,i,a,o){if(1===i)return bi.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32;var l,u=o,h=p.a.shareDocument,g=J.a.create().toString(),m={};m.event_source=u,m[mn.a.shareCorrelation]=g;var f=o,v=f?f.nav:null;v&&(m[mn.a.shareNavId]=v),m[mn.a.shareScenarioId]=null==f?void 0:f.scenarioId,m[mn.a.shareContextualSharingContext]=null==f?void 0:f.contextualSharingContext,m[mn.a.shareContextualSharingLocation]=null==f?void 0:f.contextualSharingLocation,!f||"CopyLink"!==f.SourceControlId&&"CopyLinkFileMenu"!==f.SourceControlId||(f.mode="copy",h=p.a.shareCopyLink),f&&"ManageAccess"===f.SourceControlId&&(f.mode="manageAccess",h=p.a.shareManageAccess),f&&"ShareTopBar"===f.SourceControlId&&s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.isTUIEnabledOnShare",!1)&&e.eventSource.raiseEvent(e.checkEditorSuggestions);var _=f?f.mode:null;if(_&&(m[mn.a.shareMode]=_),!!f&&f.shareOverrideDefaultPermission&&(m[mn.a.shareOverrideDefaultPermission]=!0),s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.ShareWithSummaryIsEnabled",!1)){var y=f?f.additionalData:null;y&&(m[mn.a.additionalDataJSON]=y)}if(2===i){var S={};S[mn.a.shareCorrelation]=g,_&&(S.mode=_),r.ULS.sendTraceTag(38278995,306,50,H.c(S))}var b=this.sendPostmessage(2===i,d.a.sharing,s.AFrameworkApplication.useFileSharingPostMessage,m);if(32!==b){if(s.AFrameworkApplication.fileSharingUrl)return l=u?O.a.addOrReplaceParameterValue(s.AFrameworkApplication.fileSharingUrl,Ui.e,u):s.AFrameworkApplication.fileSharingUrl,s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===i,l,!0);r.ULS.sendTraceTag(7985242,306,50,"Sharing PostMessage didn't succeed but there is no FileSharingURL to fallback to.",{Result:b})}var A=ge.a.getBool("PPTIsSimplifiedRibbonOn",!1);return r.ULS.sendTraceTag(509441175,306,15,"ActionName=FileSharing;SimplifiedRibbonMode={0}",A),c.c(h),!this._systemInitiatedFeedback||s.AFrameworkApplication.activeFrame.applicationInstance.isBusinessUser||s.AFrameworkApplication.activeFrame.applicationInstance.isEduUser||this._systemInitiatedFeedback.execute((function(e){e.logActivity("WordWebOnlineShareActivity",null)})),b},a.coEditInTeams=function(t,n,i,a,o){r.ULS.sendTraceTag(509613976,230,50,"Attempting to Launch the currently active document in the browser tab in a Word Live Teams Meeting");try{var l=J.a.create().toString(),c=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("LiveInTeamsWordAppSharingUrl"),u=function(e,t,n){var i=new K.QueryStringBuilder("https://teams.microsoft.com/l/meeting-share");return i.addParam("deeplinkId",e),i.addParam("lm","deeplink"),i.addParam("appContext",Xr(t,n)),i.toString()}(l,e.wordLiveTeamsAppId,c);return r.ULS.sendTraceTag(509138050,230,50,"Launched the currently active document in the browser tab in a Word Live Teams Meeting"),s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===i,u)}catch(e){return r.ULS.sendTraceTag(509138049,230,10,"Failed to launch the currently active document in a Word Live Teams Meeting {0}",e),8}},a.conversation=function(e,t,n,i,r){return this.sendPostmessage(2===n,d.a.conversation,!0,{})},a.workflow=function(e,t,n,i,a){var o=this.sendPostmessage(2===n,d.a.workflow,s.AFrameworkApplication.useWorkflowPostMessage,{WorkflowType:s.AFrameworkApplication.workflowTypeString});if(32!==o){if(s.AFrameworkApplication.workflowUrl)return s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.workflowUrl,!0);r.ULS.sendTraceTag(19781538,306,50,"Workflow PostMessage didn't succeed.",{Result:o})}return o},a.reportAbuseLink=function(e,t,n,i,r){var a=2===n;return t&&a&&!this.beforeCloseDocument(Ui.f)?8:s.AFrameworkApplication.activeFrame.navigateToHostUrl(a,s.AFrameworkApplication.reportAbuseUrl)},a.copyAndEdit=function(e,t,n,i,r){var a={};2===n&&(a=s.AFrameworkApplication.activeFrame.applicationInstance.getCopyAndEditParams());var o=this.sendPostmessage(2===n,d.a.copyAndEdit,s.AFrameworkApplication.useCopyAndEditPostMessage,a);return 32!==o?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.copyAndEditUrl,s.AFrameworkApplication.hideHeader):o},a.downloadACopy=function(e,t,n,i,r){return 1===n?s.AFrameworkApplication.protectedFile||s.AFrameworkApplication.isMandatoryLabellingMode||bi.SessionStatusManager.instance.hasEmergencyViewModeBeenDeployed?8:32:s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.downloadACopyUrl,!0)},a.replyWithChanges=function(e,t,n,i,r){var a=2===n;if(t&&a&&!this.beforeCloseDocument(Ui.d))return 8;var o=this.sendPostmessage(a,d.a.replyWithChanges,s.AFrameworkApplication.useReplyWithChangesPostMessage,{event_source:Ui.d});if(32!==o){var l=O.a.addOrReplaceParameterValue(s.AFrameworkApplication.replyWithChangesUrl,Ui.e,Ui.d);return s.AFrameworkApplication.activeFrame.navigateToHostUrl(a,l)}return o},a.fileVersion=function(e,t,n,i,r){var a=this.sendPostmessage(2===n,d.a.fileVersions,s.AFrameworkApplication.useFileVersionPostMessage,null);return 32!==a?s.AFrameworkApplication.activeFrame.navigateToHostUrl(2===n,s.AFrameworkApplication.fileVersionUrl):a},a.queryBreadcrumbDocName=function(e,t,n,i,r){if(2===n){if(!r)return 8;var a=r,o=s.AFrameworkApplication.docPropertiesProvider.breadcrumbDocName;a.Value=Ze.a.getFileNameWithoutExtension(o)}return 32},a.queryBuildVersion=function(e,t,n,i,r){if(2===n){if(!r)return 8;r.Text=s.AFrameworkApplication.instance.diagnosticsBuildVersion}return 32},a.querySessionId=function(e,t,n,i,r){if(2===n){if(!r)return 8;r.Text=s.AFrameworkApplication.instance.diagnosticsSessionId}return 32},a.sendPostmessage=function(e,t,n,i){return this.m_handleRaceConditionInHostManagerInit?this.sendPostmessageWhenHostReady(e,t,n,i):n?e?this.hostPostmessenger.sendMessage(t,i)?32:8:32:2},a.sendPostmessageWhenHostReady=function(e,t,n,i){var a=this;return n?e?this.hostPostmessenger?this.hostPostmessenger.sendMessage(t,i)?32:8:(r.ULS.sendTraceTag(528234241,306,15,"SendPostmessage called when HostPostmessenger was not initialized yet.Queueing the request."),this._hostPostmessengerReadyForDispatchFuture.execute((function(e){r.ULS.sendTraceTag(528234242,306,50,"HostPostmessenger now available. Executing the request."),a.hostPostmessenger.sendMessage(t,i)})),32):32:2},a.queryCopyAndEditButton=function(e,t,n,i,r){if(2===n){if(!r)return 8;var a=r;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsEditAndReplyFlow")&&(a.LabelText=CommonUIStrings.l_EditAndReply)}return 32},e.add_OnClickingShare=function(t){e.eventSource.addHandler(e.checkEditorSuggestions,t)},t=e,(n=[{key:"hostPostmessenger",get:function(){return this._hostPostmessenger}}])&&$r(t.prototype,n),i&&$r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();ea.eventSource=new a.a,ea.checkEditorSuggestions="CheckEditorSuggestions",ea.wordLiveTeamsAppId="d7958adf-f419-46fa-941b-1b946497ef84",Object(i.a)(ea,"WebAppFrameCommandUIActor",null,[]);var ta=n(672),na=n(64),ia=n(91),ra=function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t];n.style.position="relative",n.style.top=(n.parentNode.offsetHeight-n.offsetHeight)/2+"px"}},aa=function(e){return(e.innerEvent.keyCode===Er.a.vK_Enter||e.innerEvent.keyCode===Er.a.vK_Space)&&(e.sourceElement.click(),!0)},oa=function(e,t,n,i,r,a,o){var s=document.createElement("a");s.className="ProtocolLaunchingDialogButtonAnchor",s.className+=" OICDialog",s.id=e,s.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaButtonRole),s.style.padding="0",s.style.margin="0",i&&sa(r,t,n,i,s);var l=document.createElement("span");return l.className="ProtocolLaunchingDialogButtonLabel",l.innerText=r,s.appendChild(l),s.tabIndex=0,a&&ia.a.instance.registerHandler(m.a.click,s,a),o&&Fr.KeyInputManager.instance.registerHandler(m.a.keyUp,s,o),s},sa=function(e,t,n,i,r){var a=document.createElement("img");a.alt=e,a.className=na.getImageClassWithCluster(n,i),a.src=t,a.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaPresentationRole);var o=document.createElement("span");o.className="ProtocolLaunchingDialogImg32Container",o.appendChild(a);var s=document.createElement("span");s.className="ProtocolLaunchingDialogIconContainer",s.appendChild(o),r.appendChild(s)};function la(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ca=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return Bi.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_OICLaunchDialogTitle)}}],(n=null)&&la(t.prototype,n),i&&la(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ua(e,t){return(ua=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}ca.dialogHtmlFormat="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='OICDialogRow' id='OICDialog'> <div class='OICDialogButtons' id='Buttons'> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonLaunchRichClient'> <div id='OICLaunchRichClient' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonReturn'> <div id='OICReturnToApp' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",Object(i.a)(ca,"OICLaunchDialogHtml",null,[]);var da=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._btnRichClient=null,n._btnReturn=null,n._disposed$4=!1,n.onReturnButtonClick=function(e){return n.hide(),n._operation.restartApplication(),!0},n.onRichClientButtonClick=function(e){return r.ULS.sendTraceTag(22140866,211,50,"OIC dialog: launch rich client"),n.hide(),s.AFrameworkApplication.theActionManager.processAction(p.a.retryOpenInClient,2),!0},n.oicLaunchDialogResultHandler=function(e,t){n._operation.restartApplication()},n._operation=t,n.dialogHtml=ca.dialogHtml,n.autoSize=!0,n.buttonsOption=5,n.dialogId="OICLaunchDialog",n.showDialog("",n.oicLaunchDialogResultHandler),n.setLabelledByForDialog("ProtocolLaunchingDialogTitle"),n.setDescribedByForDialog("ProtocolLaunchingDialogTitle"),4!==s.AFrameworkApplication.activeFrame.applicationInstance.editMode&&(document.getElementById("ProtocolLaunchingDialogTitle").innerText=CommonUIStrings.l_OICLaunchDialogTitleForView),n.setFocusOnElement(n._btnRichClient),r.ULS.sendTraceTag(22140865,211,50,"OIC launch dialog opened"),document.getElementById("WACDialogTitlePanel").className+=" OICDialog",n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ua(t,n);var a=i.prototype;return a.onInnerHtmlSet=function(){this._btnRichClient=oa("BtnRichClient",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnGetRichClient,CommonUIStrings.l_OICLaunchRichClient,this.onRichClientButtonClick,aa),document.getElementById("OICLaunchRichClient").appendChild(this._btnRichClient),ra(this._btnRichClient),this._btnReturn=oa("BtnReturn",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnEdit,CommonUIStrings.l_OICReturnToOnlineClient,this.onReturnButtonClick,aa),document.getElementById("OICReturnToApp").appendChild(this._btnReturn),ra(this._btnReturn)},a.dispose=function(){this._disposed$4||(this._btnRichClient&&(ia.a.instance.unregisterHandler(m.a.click,this._btnRichClient,this.onRichClientButtonClick),Fr.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._btnRichClient,aa)),this._btnReturn&&(ia.a.instance.unregisterHandler(m.a.click,this._btnReturn,this.onReturnButtonClick),Fr.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._btnReturn,aa)),e.prototype.dispose.call(this),this._disposed$4=!0)},i}(Bi.a);function pa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(da,"OICLaunchDialog",Bi.a,[]);var ha=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return 0!==s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.Excel.PromoteOpenInDesktop",0)?Bi.a.formatHtml(e.dialogHtmlFormatWithDownloadApp,CommonUIStrings.l_OICDialogTitle):Bi.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_OICDialogTitle)}}],(n=null)&&pa(t.prototype,n),i&&pa(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();ha.dialogHtmlFormat="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='ProtocolLaunchingDialogIssues OICDialog' id='ProtocolhandlerGetHelp'> <div class='UIFontDialogText OICDialog' id='Issues'> </div> <div class='ProtocolLaunchingDialogHelpButtons' id='Buttons'> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonEdit'> <div id='ProtocolHandlerDialogEditInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonGiveFeedback'> <div id='ProtocolHandlerDialogGiveFeedbackInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br/> <div class='ProtocolLaunchingDialogButton' id='ButtonRetryOIC'> <div id='ProtocolHandlerDialogRetryOIC' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",ha.dialogHtmlFormatWithDownloadApp="<div class='ProtocolLaunchingDialogBody' id='PLDDlgBody'> <div class='ProtocolLaunchingDialogTitle UIFontDialogTitle OICDialog' id='ProtocolLaunchingDialogTitle'> <div class='WACDialogSectionTitle'>{0}</div> </div> <div class='ProtocolLaunchingDialogIssues OICDialog' id='ProtocolhandlerGetHelp'> <div class='UIFontDialogText OICDialog' id='Issues'></div> <div class='ProtocolLaunchingDialogHelpButtons' id='Buttons'> <br /> <div class='ProtocolLaunchingDialogButton' id='ButtonEdit'> <div id='ProtocolHandlerDialogEditInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br /> <div class='ProtocolLaunchingDialogButton' id='ButtonDownloadClientApp'> <div id='ProtocolHandlerDialogDownloadClientApp' class='UIFontDialogButton WACGlyph'></div> </div> <br /> <div class='ProtocolLaunchingDialogButton' id='ButtonGiveFeedback'> <div id='ProtocolHandlerDialogGiveFeedbackInApp' class='UIFontDialogButton WACGlyph'></div> </div> <br /> <div class='ProtocolLaunchingDialogButton' id='ButtonRetryOIC'> <div id='ProtocolHandlerDialogRetryOIC' class='UIFontDialogButton WACGlyph OICDialog'></div> </div> </div> </div> </div>",Object(i.a)(ha,"ProtocolLaunchingDialogV2Html",null,[]);var ga=n(133);function ma(e,t){return(ma=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var fa=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._btnEdit=null,n._btnGiveFeedback=null,n._btnDownloadClientApp=null,n._disposed$4=!1,n._btnRetryOIC=null,n.onEditKeyUp=function(e){return n.onBtnKeyUp(e,0)},n.onDownloadClientAppKeyUp=function(e){return n.onBtnKeyUp(e,3)},n.onGiveFeedbackKeyUp=function(e){return n.onBtnKeyUp(e,2)},n.onRetryOICKeyUp=function(e){return n.onBtnKeyUp(e,1)},n.onEditClick=function(e){return n.hide(),4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?(r.ULS.sendTraceTag(18715411,211,50,"Restart the App and continue editing"),n._operation.restartApplication()):(r.ULS.sendTraceTag(18715412,211,50,"Switch to edit doc in browser"),n._operation.handleEditInBrowser()),!0},n.onDownloadClientAppClick=function(e){return r.ULS.sendTraceTag(0,211,50,"Open download client app page"),n._operation.handleDownloadClientApplication(),!0},n.onGiveFeedbackClick=function(e){return r.ULS.sendTraceTag(37339423,211,50,"Open give feedback dialog"),n._operation.handleGiveFeedback(),!0},n.onRetryOICClick=function(e){return r.ULS.sendTraceTag(19239263,211,50,"OIC dialog retry"),document.getElementById("WACDialogPanel").style.display="none",s.AFrameworkApplication.theActionManager.processAction(p.a.retryOpenInClient,2),!0},n.protocolLaunchingDialogResultHandler=function(e,t){n._operation.restartApplication()},n._operation=t,n.dialogHtml=ha.dialogHtml,n.autoSize=!0,n.buttonsOption=5,n.dialogId="ProtocolLaunchingDialog",n._customCssClass="OICRetryDialog",s.AFrameworkApplication.theTaskManager.hasStopped&&s.AFrameworkApplication.theTaskManager.restart(),s.AFrameworkApplication.theTaskManager.addTask(new u.a(2,1,5e3,(function(e){n.switchToBackupMode()}),101)),n.showDialog("",n.protocolLaunchingDialogResultHandler),n.setLabelledByForDialog("ProtocolLaunchingDialogTitle"),n.setDescribedByForDialog("Issues"),n.focusOnEditButton(),r.ULS.sendTraceTag(19239262,211,50,"OIC dialog launched"),document.getElementById("WACDialogTitlePanel").className+=" OICDialog",n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ma(t,n);var a=i.prototype;return a.onInnerHtmlSet=function(){var e=document.getElementById("Issues");if(e){sa("",this._operation.dlgImgClusterPath,this._operation.imgClusterName,this._operation.imgBtnGetRichClient,e);var t=document.createElement("span");t.className="WACDialogSectionTitle",t.innerText=5===this._operation.openDocumentMode?CommonUIStrings.l_OICBrowserDialogTitle:CommonUIStrings.l_OICDialogSectionTitle,e.appendChild(t),ra(e),e.style.display="none"}if(0!==s.AFrameworkApplication.appSettingsManager.getIntFeatureGate("Microsoft.Office.Excel.PromoteOpenInDesktop",0)){var n=CommonUIStrings.l_OICDialogSectionDownloadClientApp;this._btnDownloadClientApp=oa("DownloadClientApp",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",n,this.onDownloadClientAppClick,this.onDownloadClientAppKeyUp),document.getElementById("ProtocolHandlerDialogDownloadClientApp").appendChild(this._btnDownloadClientApp),ra(this._btnDownloadClientApp)}if(s.AFrameworkApplication.activeFrame.applicationInstance.giveFeedbackOnOpenClient){var i=CommonUIStrings.l_OICDialogSectionGiveFeedback;this._btnGiveFeedback=oa("GiveFeedback",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",i,this.onGiveFeedbackClick,this.onGiveFeedbackKeyUp),document.getElementById("ProtocolHandlerDialogGiveFeedbackInApp").appendChild(this._btnGiveFeedback),ra(this._btnGiveFeedback)}else document.getElementById("ButtonGiveFeedback").style.display="none";if(0===s.AFrameworkApplication.activeFrame.applicationInstance.editMode||s.AFrameworkApplication.disableEditIfAndroid)document.getElementById("ButtonEdit").style.display="none";else{var r=null;r=2===s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType?4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?CommonUIStrings.l_OICResumeEditing:CommonUIStrings.l_OICReturnToOnlineClient:4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode?CommonUIStrings.l_OICResumeEditing:CommonUIStrings.l_OICContinueInBrowser,this._btnEdit=oa("Edit",this._operation.dlgImgClusterPath,this._operation.imgClusterName,"",r,this.onEditClick,this.onEditKeyUp),document.getElementById("ProtocolHandlerDialogEditInApp").appendChild(this._btnEdit),ra(this._btnEdit)}0!==s.AFrameworkApplication.activeFrame.applicationInstance.editMode||s.AFrameworkApplication.isOfficeTrialOfferEnabled||e&&(e.style.display="none")},a.focusOnRetryButton=function(){return!!this._btnRetryOIC&&(this.setFocusOnElement(this._btnRetryOIC),!0)},a.focusOnEditButton=function(){return!!this._btnEdit&&(this.setFocusOnElement(this._btnEdit),!0)},a.onFinishedClick=function(e){return this._operation.closeApplication(),!0},a.onBtnKeyUp=function(e,t){var n=!1;if(e.innerEvent.keyCode===Er.a.vK_Enter||e.innerEvent.keyCode===Er.a.vK_Space)e.sourceElement.click(),n=!0;else if(e.innerEvent.keyCode===Sys.UI.Key.down||e.innerEvent.keyCode===Sys.UI.Key.up)switch(t){case 1:n=this.focusOnEditButton();break;case 0:n=this.focusOnRetryButton()}return n},a.onGetRichClientClick=function(e){var t=Q.a.instance.resolve("Common.IOfficeTrialExperience");var n=Q.a.instance.resolve("Common.IMacOfficeOffer");return z.a.isMac?n.launchMacOfficeTrialWindow(this._operation.application):t.launchOffer(this._operation.application),!0},a.onLearnMoreClick=function(e){return ga.Redirect.showHelp("OICFailure"),!0},a.switchToBackupMode=function(){var e=document.getElementById("ProtocolLaunchingDialogTitle");if(e){e.innerText=CommonUIStrings.l_OICDialog2ndTitle;var t=document.getElementById("Issues");t&&(t.style.display="block");var n=document.getElementById("ProtocolHandlerDialogRetryOIC");n&&!n.children.length&&(this._btnRetryOIC=oa("RetryOIC","","","",CommonUIStrings.l_OICDialogRetry,this.onRetryOICClick,this.onRetryOICKeyUp),n.appendChild(this._btnRetryOIC),ra(this._btnRetryOIC),this._btnEdit||this.focusOnRetryButton())}},a.dispose=function(){this._disposed$4||(this._btnEdit&&(ia.a.instance.unregisterHandler(m.a.click,this._btnEdit,this.onEditClick),Fr.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._btnEdit,this.onEditKeyUp)),this._btnDownloadClientApp&&(ia.a.instance.unregisterHandler(m.a.click,this._btnDownloadClientApp,this.onDownloadClientAppClick),Fr.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._btnDownloadClientApp,this.onDownloadClientAppKeyUp)),this._btnGiveFeedback&&(ia.a.instance.unregisterHandler(m.a.click,this._btnGiveFeedback,this.onGiveFeedbackClick),Fr.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._btnGiveFeedback,this.onGiveFeedbackKeyUp)),this._btnRetryOIC&&(ia.a.instance.unregisterHandler(m.a.click,this._btnRetryOIC,this.onRetryOICClick),Fr.KeyInputManager.instance.unregisterHandler(m.a.keyUp,this._btnRetryOIC,this.onRetryOICKeyUp)),e.prototype.dispose.call(this),this._disposed$4=!0)},i}(Bi.a);function va(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _a(e,t){return(_a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(fa,"ProtocolLaunchingDialog",Bi.a,[]);var ya=function(e){var t,n;function i(t){var n;(n=e.call(this)||this).onGiveFeedbackClick=function(e){r.ULS.sendTraceTag(595342858,211,50,"Open give feedback dialog"),n.onFeedbackClickHandler(e)},n.onRetryOICClick=function(){r.ULS.sendTraceTag(595342857,211,50,"OIC dialog retry"),s.AFrameworkApplication.theActionManager.processAction(p.a.retryOpenInClient,2)},n.protocolLaunchingDialogResultHandler=function(e,t){i.hasCloseAction?3===e?n.retryOICClick():2===e||0===e?n.continueEditing():1===e&&n.closeDocument():2===e?n.retryOICClick():1!==e&&0!==e||n.continueEditing()},n._operation=t,n.dialogId="ProtocolLaunchingDialog",s.AFrameworkApplication.theTaskManager.hasStopped&&s.AFrameworkApplication.theTaskManager.restart(),s.AFrameworkApplication.activeFrame.applicationInstance.giveFeedbackOnOpenClient&&n.addFeedbackLink(CommonUIStrings.l_OICStandardDialogSectionGiveFeedback,n.onGiveFeedbackClick),i.hasCloseAction?(n.buttonsOption=12,n.setButtonText(1,CommonUIStrings.l_CloseFile),n.setButtonText(2,CommonUIStrings.l_OICDialogContinueHere),n.setButtonText(3,CommonUIStrings.l_OICDialogLaunchAgain)):(n.buttonsOption=4,n.setButtonText(1,CommonUIStrings.l_OICDialogContinueHere),n.setButtonText(2,CommonUIStrings.l_OICDialogLaunchAgain));var a=5===n._operation.openDocumentMode?CommonUIStrings.l_OICBrowserDialogTitle:CommonUIStrings.l_OICStandardDialogSectionTitle;return n.messageBoxImpl(CommonUIStrings.l_OICDialog2ndTitle,a,null,null,n.protocolLaunchingDialogResultHandler,null),n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,_a(t,n);var a,o,l,c=i.prototype;return c.closeDocument=function(){r.ULS.sendTraceTag(577783557,211,50,"Closing the document"),s.AFrameworkApplication.theActionManager.processActionWithData(p.a.close,2,Ui.a)},c.retryOICClick=function(){r.ULS.sendTraceTag(593602691,211,50,"OIC dialog retry"),window.setTimeout(this.onRetryOICClick,0)},c.continueEditing=function(){4===s.AFrameworkApplication.activeFrame.applicationInstance.editMode||s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordConsumptionViewToEditRedirectIsEnabled")&&1===s.AFrameworkApplication.activeFrame.mode?(r.ULS.sendTraceTag(593602690,211,50,"Restart the App and continue editing"),this._operation.restartApplication()):(r.ULS.sendTraceTag(593602689,211,50,"Switch to edit doc in browser"),this._operation.handleEditInBrowser())},a=i,l=[{key:"hasCloseAction",get:function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICDialogThreeActions")&&32===s.AFrameworkApplication.theActionManager.processAction(p.a.close,1)}}],(o=null)&&va(a.prototype,o),l&&va(a,l),Object.defineProperty(a,"prototype",{writable:!1}),i}(Kn.StandardDialog);Object(i.a)(ya,"StandardProtocolLaunchingDialog",Kn.StandardDialog,[]);var Sa=n(297),ba=function(){};function Aa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ba,"EditDocumentInClientParams",null,[]);var Ca=function(){function e(){}var t,n,i;return e.editDocumentInClient=function(e,t,n,i,r,a,o,s,l,c,u,d,p,h,g,m){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===l&&(l=""),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===d&&(d=!1),void 0===p&&(p=""),void 0===h&&(h=""),void 0===g&&(g=""),void 0===m&&(m="");var f=new ba;f.DocumentUrl=e,f.DocumentExtension=m,f.Mode=t,f.Options=n,f.Application=i,f.SilentExternalHandler=o,f.EncodeUrl=s,f.CorrelationIdForWinClient=l,f.NavigateUsingWindowOpen=c,f.DescriptiveUnattemptedEnums=u,f.NoBrowserModalDialogs=d,f.SessionOrigin=p,f.CorrelationId=h,f.ClickTime=g,MSOJS.ClientUtils.EditDocumentInClient(f,r,a)},t=e,i=[{key:"isWLSIAInstalled",get:function(){try{if(new ActiveXObject("IDBHO.IDBHOCtrl"))return!0}catch(e){}return!1}},{key:"officeVersionInstalledSupportsOIC",get:function(){return MSOJS.ClientUtils.OfficeVersionInstalled()>11}}],(n=null)&&Aa(t.prototype,n),i&&Aa(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ca,"ClientUtils",null,[]);var Ta=n(345),ka=n(416),wa=n(32);function Ia(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Pa=function(){function e(e){var t=this;this._clientUrl=null,this._downloadUrl=null,this._postmessengerlazy=null,this._forceClose=!1,this._officeTrialExperience=null,this._macOfficeOffer=null,this._documentExtension=null,this._sessionOrigin="",this._correlationId="",this._clickTime="",this._mode=0,this.application=0,this.suppressClose=!1,this.suppressRestart=!1,this.retryOpenInClientAction=function(e,n,i,r,a){return n.contextId!==_e.a.frame?2:1===i?32:t.retryOpenInClient()},this.oicErrorDialogHandlerCloseForced=function(e){t.closeApplication()},this.oicErrorDialogHandlerNoCloseForced=function(e){t.restartApplication()},this.onLaunchDownload=function(e){t.launchDownload()},this.iHaveOfficeButtonHandler=function(e){return t.directInvokeHandler(!0)},this.useLaunchDialog=e&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICLaunchDialogIsEnabled"),s.AFrameworkApplication.theActionManager.getActionMetadata(p.a.retryOpenInClient)||s.AFrameworkApplication.theActionManager.addAction(p.a.retryOpenInClient,_e.a.frame,this.retryOpenInClientAction),this.silentExternalHandler=!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SilentExternalHandler")}var t,n,i,a=e.prototype;return a.setTelemetryData=function(e,t,n){void 0===t&&(t=""),void 0===n&&(n=""),this._correlationId=n||J.a.create().toString(),this._sessionOrigin=t||Ta.a.getNormalizedSessionOrigin(),this._clickTime=e},a.supportsTopTargetNavigation=function(){return!(2===this.application&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsEmbeddedScenario"))},a.closeApplication=function(){this.suppressClose||this.executeCloseApplication()},a.restartApplication=function(){this.suppressRestart||this.executeRestartApplication()},a.readyForClientLaunch=function(e){return this.useLaunchDialog&&z.a.isIPad?(new da(this),32):this.completeClientLaunch(e)},a.completeClientLaunch=function(e){var t,n,i=(t=this.launchClient(e),n=t.trackingLog,t).returnValue;return r.ULS.sendTraceTag(34198736,211,50,"OICLaunchClient,{0},{1}",32===i,n),i},a.begin=function(e,t,n,i,r,a,o){return void 0===o&&(o=""),this._clientUrl=e,this._documentExtension=o,this._downloadUrl=t,this._postmessengerlazy=a,this.application=n,this._mode=i,s.AFrameworkApplication.downloadCopyOnOpenInClient?(this.launchDownload(),32):s.AFrameworkApplication.limitedEdit&&!s.AFrameworkApplication.hostAuthenticatesUsersDuringOpenInClient?(s.AFrameworkApplication.showRequiresSignInDialog(),8):this.beforeClientLaunch(r)},a.retryOpenInClient=function(){return this.oicAshaLoggingIsEnabled&&this.logAshaRetryOpenInClient(),this.completeClientLaunch(this._forceClose)},a.sendOICPostMessage=function(){var e=new ka.a(d.a.openInClient);return e.Values["ui-language"]=s.AFrameworkApplication.lcid.toString(),e.Values[Sa.a.currentSessionParamName]=s.AFrameworkApplication.userSessionId,this._postmessengerlazy.value.send(e)?32:8},a.logAshaRetryOpenInClient=function(){l.Health.instance.recordQosError("UserClickedRetryOpenInDesktop",["OpenInClientFailed"],!1,!1,!1,!1,Object.assign(new Z.a,{inStaging:!1}))},a.sendTelemetryPostMessage=function(e){var t=new ka.a(d.a.wacActionComplete);t.Values["ui-language"]=s.AFrameworkApplication.lcid.toString(),t.Values[Sa.a.currentSessionParamName]=s.AFrameworkApplication.userSessionId,t.Values[mn.a.wacAction]=e,this._postmessengerlazy.value.send(t)},a.launchClient=function(t){return this._forceClose=t,this.sendTelemetryPostMessage(5===this._mode?e.openInBrowserAction:e.openInDesktopAction),5===this._mode?this.launchBrowser():this.launchDesktop()},a.launchBrowser=function(){return"",this.launchProtocolDialog(),"HostEditUrl,",{returnValue:32,trackingLog:"HostEditUrl,"}},a.launchDesktop=function(){var e;e="";var t="";s.AFrameworkApplication.addSessionIdToClientUrl&&(t="|f|"+s.AFrameworkApplication.userSessionId);var n,i=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsAssignmentMode")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UseWindowOpenForOpenInClientInChromeAssignmentsIsEnabled")||s.AFrameworkApplication.isUnifiedHostMode||z.a.isTeamsElectron,a=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("UnattemptedEnumIsEnabled"),o=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NoBrowserModalDialogs"),l=s.AFrameworkApplication.theActionManager.getTelemetryData(3588168074);if(l&&this.setTelemetryData(l.epochClickTime,l.sessionOrigin,l.correlationId),this.logOnSuccess(),s.AFrameworkApplication.preferPostMessageOverCommandUrlForOpenInClient){e+="NewOrder,";var c=8;return this._postmessengerlazy&&this._postmessengerlazy.value&&this._postmessengerlazy.value.isEnabled()&&s.AFrameworkApplication.useOpenInClientPostMessage&&(e+="Post,",c=this.sendOICPostMessage()),32===c?{returnValue:c,trackingLog:e}:(r.ULS.sendTraceTag(4994821,211,50,"AOpenInclientOperation.LaunchClient: cannot send postmessage"),s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl?(r.ULS.shipAssertTag(5566816,211,!!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),e+="HostUrl,",{returnValue:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),trackingLog:e}):this._clientUrl?(r.ULS.sendTraceTag(18715405,211,15,"Try to open doc in rich client, SessionId {0}",s.AFrameworkApplication.userSessionId),e+="DocUrl,",Ca.editDocumentInClient(this._clientUrl,this._mode,this.options,this.application,Object(A.a)(this,this.onEditInClientSuccess,"onEditInClientSuccess"),Object(A.a)(this,this.onEditInClientFailure,"onEditInClientFailure"),this.silentExternalHandler,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled"),t,i,a,o,this._sessionOrigin,this._correlationId,this._clickTime,this._documentExtension),{returnValue:32,trackingLog:e}):{returnValue:8,trackingLog:e})}return e+="OldOrder,",!this._clientUrl&&s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl?(this._postmessengerlazy&&this._postmessengerlazy.value&&this._postmessengerlazy.value.isEnabled()&&s.AFrameworkApplication.useOpenInClientPostMessage?(e+="Post,",n=this.sendOICPostMessage()):(r.ULS.sendTraceTag(22595483,211,50,"AOpenInclientOperation.LaunchClient: cannot send postmessage"),n=8),32!==n?(r.ULS.shipAssertTag(22595484,211,!!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),e+="HostUrl,",{returnValue:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl),trackingLog:e}):{returnValue:n,trackingLog:e}):(r.ULS.sendTraceTag(22595485,211,15,"Try to open doc in rich client, SessionId {0}",s.AFrameworkApplication.userSessionId),e+="DocUrl,",Ca.editDocumentInClient(this._clientUrl,this._mode,this.options,this.application,Object(A.a)(this,this.onEditInClientSuccess,"onEditInClientSuccess"),Object(A.a)(this,this.onEditInClientFailure,"onEditInClientFailure"),this.silentExternalHandler,s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OICEncodeUrlIsEnabled"),t,i,a,o,this._sessionOrigin,this._correlationId,this._clickTime,this._documentExtension),{returnValue:32,trackingLog:e})},a.reportControlUsed=function(e){s.AFrameworkApplication.theWsaClient.setDw(8981,e)},a.onEditInClientSuccess=function(e){this.reportControlUsed(e),r.ULS.sendTraceTag(18715406,211,50,"Open in rich client succeed"),6===e&&MSOJS.ClientUtils.ShouldShowDialog()?(this.suppressProtocolHandlerDialog||this.launchProtocolDialog(),this.logOnSuccess()):this.suppressClose||this.closeApplication()},a.onEditInClientFailure=function(e,t){if(void 0===t&&(t=0),r.ULS.sendTraceTag(18715407,211,10,"Fail to open doc in rich client. Failure Type: {0:D2}, Application: {1}",e,t),5===e)alert(CommonUIStrings.l_OICErrorPopupBlockerForSafari);else{var n=!!this._downloadUrl&&!this._forceClose,i=0;1===e&&(i=2),e>=6&&e<=13&&(i=1,1===t&&(this.suppressClose=!0)),this.theOfficeTrialExperience.offerOfficeTrialInDialog?(r.ULS.sendTraceTag(18715408,211,50,"Open OICErrorDialogWithTrial. Dialog cause: {0}",i),ta.a.instance.createOICErrorDialogWithTrial(this._forceClose?this.oicErrorDialogHandlerCloseForced:this.oicErrorDialogHandlerNoCloseForced,n?this.onLaunchDownload:null,this.directInvokeHandler(!1)?this.iHaveOfficeButtonHandler:null,null,i,t)):(r.ULS.sendTraceTag(18715409,211,50,"Open OICErrorDialog. Dialog cause: {0}",i),ta.a.instance.createOICErrorDialog(this._forceClose?this.oicErrorDialogHandlerCloseForced:this.oicErrorDialogHandlerNoCloseForced,n?this.onLaunchDownload:null,null,i))}},a.logOnSuccess=function(){try{var e=[Object.assign(new wa.a,{name:"CorrelationId",string:this._correlationId}),Object.assign(new wa.a,{name:"SessionOrigin",string:this._sessionOrigin}),Object.assign(new wa.a,{name:"ClickTime",string:this._clickTime}),Object.assign(new wa.a,{name:"ProtocolHandlerFinishedTimestamp",double:(new Date).getTime()})];c.a("OpenInClientCompleted",!0,0,e)}catch(e){r.ULS.sendTraceTag(537773316,306,15,"Record OIC attempt failed: "+e.toString())}},a.launchProtocolDialog=function(){s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("StandardProtocolDialogIsEnabled")?new ya(this):new fa(this)},a.directInvokeHandler=function(e){var t=(z.a.isInternetExplorer10Up||z.a.isInternetExplorerEdge)&&!!s.AFrameworkApplication.directInvokeDAVUrl;return t&&e&&(ut.a.safelyOpenWindow(s.AFrameworkApplication.directInvokeDAVUrl,"_blank",void 0,"OpenInClient"),this.closeApplication()),t},t=e,(n=[{key:"openDocumentMode",get:function(){return this._mode}},{key:"options",get:function(){var e=0;return s.AFrameworkApplication.requiresCheckout&&(e|=1),s.AFrameworkApplication.openInClientEditOnly&&(e|=4),this.supportsTopTargetNavigation()&&(e|=64),e}},{key:"openInClientCommandString",get:function(){return null}},{key:"dlgImgClusterPath",get:function(){return s.AFrameworkApplication.imageClusterPath}},{key:"imgClusterName",get:function(){return s.AFrameworkApplication.imageClusterName}},{key:"imgBtnFinished",get:function(){return"ImFinished_32x32x32"}},{key:"imgBtnEdit",get:function(){return""}},{key:"imgBtnGetRichClient",get:function(){return""}},{key:"suppressProtocolHandlerDialog",get:function(){return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("OneNoteMobileViewerIsEnabled")}},{key:"theOfficeTrialExperience",get:function(){return this._officeTrialExperience||(this._officeTrialExperience=Q.a.instance.resolve("Common.IOfficeTrialExperience"))}},{key:"theMacOfficeOffer",get:function(){return this._macOfficeOffer||(this._macOfficeOffer=Q.a.instance.resolve("Common.IMacOfficeOffer"))}},{key:"oicAshaLoggingIsEnabled",get:function(){return!!s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OicAshaLoggingIsEnabled",!1)}}])&&Ia(t.prototype,n),i&&Ia(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Fa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ea(e,t){return(Ea=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Pa.openInDesktopAction="OpenInDesktop",Pa.openInBrowserAction="OpenInBrowser",Object(i.a)(Pa,"AOpenInClientOperation",null,[]);var Oa=function(e){var t,n;function i(t,n,i){var r;return void 0===i&&(i=!1),(r=e.call(this,i)||this)._imgBtnGetRichClient=t,r._imgBtnEdit=n,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ea(t,n);var a,o,l,c=i.prototype;return c.executeCloseApplication=function(){s.AFrameworkApplication.theActionManager.processActionWithData(p.a.close,2,Ui.a)},c.executeRestartApplication=function(){},c.beforeClientLaunch=function(e){return this.readyForClientLaunch(e)},c.launchDownload=function(){r.ULS.shipAssertTag(5566817,211,!!this._downloadUrl),s.AFrameworkApplication.isCloseable?s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,this._downloadUrl):ut.a.safelyOpenWindow(this._downloadUrl,void 0,void 0,"LaunchDownload")},c.handleEditInBrowser=function(){s.AFrameworkApplication.activeFrame.applicationInstance.handleEditInBrowser()},c.handleGiveFeedback=function(){s.AFrameworkApplication.activeFrame.applicationInstance.handleGiveFeedback()},c.handleDownloadClientApplication=function(){},a=i,(o=[{key:"imgBtnEdit",get:function(){return this._imgBtnEdit}},{key:"imgBtnGetRichClient",get:function(){return this._imgBtnGetRichClient}}])&&Fa(a.prototype,o),l&&Fa(a,l),Object.defineProperty(a,"prototype",{writable:!1}),i}(Pa);Object(i.a)(Oa,"OpenInClientOperation",Pa,[]);var Ma=n(108),La=n(37);function Ra(e,t){return(Ra=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Da=function(e){var t,n;function i(t,n,a){var o;return(o=e.call(this,t,n)||this).switchToUnifiedReadMode=function(e,t,n,r,a){if(1===n)return 32;l.Health.instance.recordKpiUsage("SwitchToUnifiedReadMode",0,i.featureCrewAlias,null);var o=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("ClassicViewModePreferenceCookieName"),c={};c[mn.a.hostKey]=o,c[mn.a.hostValue]="false",s.AFrameworkApplication.get_hostPostmessengerFuture().execute((function(e){e.sendMessage(d.a.storeHostKeyValue,c)}));var u={unifiedRead:!0};return s.AFrameworkApplication.theActionManager.processActionWithData(Nr.a.switchToEditMode,2,u)},o.onModeSwitch=function(e,t,n,i,a){if(t.contextId!==La.a.application)return 2;var l=s.AFrameworkApplication.activeFrame;switch(r.ULS.shipAssertTag(4776161,201,!!l),e){case Nr.a.switchToEditMode:return s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordConsumptionViewToEditRedirectIsEnabled")&&a&&Object===Object.getType(a)&&"unifiedRead"in a?l.switchIntoEditMode(n,o.hostPostmessenger,o._shouldNavigateOuterFrameFunc(),!0):l.switchIntoEditMode(n,o.hostPostmessenger,o._shouldNavigateOuterFrameFunc());case Nr.a.toggleViewMode:return o.toggleViewMode(n);default:return 2}},o.onEditInClient=function(e,t,n,i,a){if(t.contextId!==La.a.application)return 2;var l=s.AFrameworkApplication.activeFrame;if(r.ULS.shipAssertTag(4776192,201,!!l),!l.clientEditDocumentUrl&&!s.AFrameworkApplication.docPropertiesProvider.openInClientCommandUrl&&!s.AFrameworkApplication.useOpenInClientPostMessage)return 8;if(1===n)return 32;var c=!1;if((null!=a&&(c=a),Or.App.instance.isBroadcastMode)&&o.hostPostmessenger.sendMessage(d.a.broadcastOpenInClient,null))return 32;return new Oa("Word_32x32x32","EditInWordWebApp_32x32x32").begin(l.clientEditDocumentUrl,s.AFrameworkApplication.downloadACopyUrl,5,2,c,new ln.a((function(){return o.hostPostmessenger})))},o.queryAccessibleModeButtonToggledState=function(e,t,n,i,a){return 1===n?Or.App.instance.userMayEnterAccessiblePdfMode?32:8:(r.ULS.shipAssertTag(20451533,301,!!a),a[Gr.a.On]=Or.App.instance.isAccessiblePdfMode,32)},o.onShowPdfCopyAndEditDialog=function(e,t,n,r,a){if(1===n)return Or.App.instance.isProtectedPdf?8:32;var o=new Kn.StandardDialog;return o.buttonsOption=1,o.setDefaultButton(0),o.showInformation(CommonUIStrings.l_DefaultDialogTitle,CommonUIStrings.l_ConversionDialogPdf,i.pdfCopyAndEditDialogHandler),32},o.openInBrowser=function(e,t,n,i,r){return 2===n&&o.sendPostmessage(!0,d.a.openInBrowser,!0,{}),32},o._shouldNavigateOuterFrameFunc=a,o}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ra(t,n);var a=i.prototype;return a.registerActions=function(){e.prototype.registerActions.call(this),this._actionManager.addAction(Nr.a.switchToEditMode,La.a.application,this.onModeSwitch),this._actionManager.addAction(Nr.a.openInClient,La.a.application,this.onEditInClient),this._actionManager.setActionFlags(Nr.a.openInClient,12288),this._actionManager.addAction(Nr.a.showPdfCopyAndEditDialog,La.a.application,this.onShowPdfCopyAndEditDialog),this._actionManager.addAction(p.a.openInBrowser,_e.a.frame,this.openInBrowser),this._actionManager.addAction(Nr.a.switchToUnifiedReadMode,La.a.application,this.switchToUnifiedReadMode),Or.App.instance.userMayEnterAccessiblePdfMode&&(this._actionManager.addAction(Nr.a.toggleViewMode,La.a.application,this.onModeSwitch),this._actionManager.addActionWithFlags(Nr.a.queryAccessibleModeButtonToggledState,La.a.application,this.queryAccessibleModeButtonToggledState,96))},a.toggleViewMode=function(e){if(1===e)return Or.App.instance.userMayEnterAccessiblePdfMode?32:8;if(2!==e)return r.ULS.sendTraceTag(20235094,301,15,"Unexpected ActionBehavior {0} for switching view modes",e),2;var t=!Or.App.instance.isAccessiblePdfMode;Or.App.instance.setAccessiblePdfModeCookie(t),r.ULS.sendTraceTag(20451532,301,50,"User has toggled into {0} mode.",t?"accessible PDF":"PNG"),t?c.a("WordViewerAccessibilityButtonToggled",void 0,void 0,[Object.assign(new wa.a,{name:"UserToggledToPDF"})]):c.a("WordViewerAccessibilityButtonToggled",void 0,void 0,[Object.assign(new wa.a,{name:"UserToggledToPNG"})]);var n=s.AFrameworkApplication.isEmbedded?s.AFrameworkApplication.hostEmbeddedViewUrl:window.self.location.href,i=Or.App.getUrlParametersForAccessiblePdfMode(t);return Ma.b(s.AFrameworkApplication.appSettingsManager)?Ma.f("view",i,Ma.d):(n=O.a.addOrReplaceParametersValue(n,i),ut.a.openWindow(1,n,void 0,void 0,void 0,s.AFrameworkApplication.isEmbedded&&this.isSharePointHost())),32},a.isSharePointHost=function(){return s.AFrameworkApplication.sessionStartInfoSettings&&"SharePoint Online"===s.AFrameworkApplication.sessionStartInfoSettings.Host},i.pdfCopyAndEditDialogHandler=function(e,t){1===e&&s.AFrameworkApplication.theActionManager.processAction(p.a.copyAndEdit,2)},i}(ea);Da.featureCrewAlias="wwaengidc",Object(i.a)(Da,"AppFrameCommandUIActor",ea,[]);var xa=n(111),Ba=n(144);function Ua(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ha=function(){function e(){}var t,n,i;return e.initialize=function(t,n,i){Or.App.instance.isBroadcastMode&&!e._initialized&&n&&(e._actionManager=t,e._messenger=n,e._theWsaClient=i,e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastInSync),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastNavigateToPage),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastOutOfSync),e._messenger.addAllowedFreeReceivingMessage(d.a.queryLoadingStatus),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastLinkedNotesInfo),e._messenger.addAllowedFreeReceivingMessage(d.a.broadcastGlobalId),e._messenger.registerCallback(d.a.broadcastNavigateToPage,e.navigateHandler),e._messenger.registerCallback(d.a.queryLoadingStatus,e.onQueryAppLoadingStatus),e._messenger.registerCallback(d.a.broadcastInSync,e.onBroadcastInSync),e._messenger.registerCallback(d.a.broadcastOutOfSync,e.onBroadcastOutOfSync),e._messenger.registerCallback(d.a.broadcastLinkedNotesInfo,e.linkedNotesInfoHandler),e._messenger.registerCallback(d.a.broadcastGlobalId,e.writeSqmBroadcastSessionID),e._actionManager.addActionWithFlags(Nr.a.queryPresenterPageLabel,La.a.application,e.onQueryPresenterPageLabel,96),window.setTimeout((function(){e._presenterPageLabelPolled||(e._presenterPageLabelPolled=!0,e.refreshStatusBar())}),10),e._initialized=!0)},e.suppressNavigateMessagesForAnimationDuration=function(){e._animationBeginTime=new Date},e.navigateHandler=function(t){if(2===Or.App.instance.status&&!(ut.a.isFieldNullOrUndefined(t,"Values")||ut.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigateSequence)||ut.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigatePage)||ut.a.isFieldNullOrUndefined(t.Values,e.broadcastNavigateYOffset))){var n=-1,i=-1,r=-1;try{n=t.Values[e.broadcastNavigateSequence],i=t.Values[e.broadcastNavigatePage],r=t.Values[e.broadcastNavigateYOffset]}catch(e){return void 0}e._waitingSequence!==n&&(e._waitingSequence=n,e.scrollControl.scrollToPageOffset(i,r))}},e.sendNavigationMessage=function(t,n,i){if(2===Or.App.instance.status){var r=e.zoomControl.currentZoom,a=n.scrollTop-xa.a.instance.getPageTopAtZoom(t,r),o=Math.round(100*a/xa.a.instance.getPageHeightAtZoom(t,r)),s=n.scrollTop+e.scrollControl.getClientHeight(),l=xa.a.instance.getPageFromScrollTop(s,r),c=s-xa.a.instance.getPageTopAtZoom(l,r),u=Math.round(100*c/xa.a.instance.getPageHeightAtZoom(l,r)),p=(new Date).getTime()-e._animationBeginTime.getTime(),h={};if(2!==i&&p>=0&&p<=e.scrollAnimationRunTime){if(!i)return;if(-999===e._waitingSequence)return;h[e.appNavigatedSource]=e._waitingSequence,e._waitingSequence=-999}else e._animationBeginTime=new Date(0),h[e.appNavigatedSource]=e.appNavigatedSourceUser;h[e.broadcastNavigatePage]=t,h[e.broadcastNavigateYOffset]=o,h[e.broadcastNavigateBottomPage]=l,h[e.broadcastNavigateBottomOffset]=u,e._messenger.sendMessage(d.a.appNavigated,h)}},e.onQueryAppLoadingStatus=function(t){e.sendAppLoadingStatus()},e.sendAppLoadingStatus=function(){var t={};t[e.appLoaded]=!Or.App.instance.status||1===Or.App.instance.status||2===Or.App.instance.status,t[e.documentLoaded]=2===Or.App.instance.status,e._messenger.sendMessage(d.a.appLoadingStatus,t)},e.onBroadcastInSync=function(t){2===Or.App.instance.status&&(e._outOfSyncEntry&&(Or.App.get_activeAppFrame().notificationBar.removeEntry(e._outOfSyncEntry),e._outOfSyncEntry=null),e._isBroadcastSynced=!0,e.refreshStatusBar())},e.refreshStatusBar=function(){Or.App.get_activeAppFrame().statusBarUser&&Or.App.get_activeAppFrame().statusBarUser.pollControl(Ba.a.presenterPageLabel),Or.App.get_activeAppFrame().ribbonUser&&Or.App.get_activeAppFrame().ribbonUser.poll()},e.onBroadcastOutOfSync=function(t){2===Or.App.instance.status&&(e._isBroadcastSynced&&(e._outOfSyncEntry=Or.App.get_activeAppFrame().notificationBar.createEntry(WacWordviewerStrings.BroadcastOutOfSync,!1),Or.App.get_activeAppFrame().notificationBar.addEntry(e._outOfSyncEntry)),e._isBroadcastSynced=!1,e.refreshStatusBar())},e.linkedNotesInfoHandler=function(t){if(2===Or.App.instance.status&&!ut.a.isFieldNullOrUndefined(t,"Values")&&!ut.a.isFieldNullOrUndefined(t.Values,e.linkedNotesEnabled)){var n,i;try{n=t.Values[e.linkedNotesEnabled],i=t.Values[e.linkedNotesUrl]}catch(e){return void 0}0,e._isSharedNotesEnabled=n,e._sharedNotesUrl=i,Or.App.get_activeAppFrame().ribbonUser&&Or.App.get_activeAppFrame().ribbonUser.poll()}},e.writeSqmBroadcastSessionID=function(t){if(!ut.a.isFieldNullOrUndefined(t,"Values")&&!ut.a.isFieldNullOrUndefined(t.Values,e.id)){var n;try{n=t.Values[e.id]}catch(e){return void 0}e._theWsaClient.setDw(e.DATAID_GLOBALBROADCASTID,n)}},e.onQueryPresenterPageLabel=function(t,n,i,r,a){if(1===i)return 32;var o=a;return o[ye.a.Value]=e._isBroadcastSynced?WacWordviewerStrings.SyncedWithPresenter:WacWordviewerStrings.BroadcastOutOfSync,o[Se.a.labelText]=o[ye.a.Value],e._presenterPageLabelPolled=!0,32},t=e,i=[{key:"zoomControl",get:function(){return e._zoomControl||(e._zoomControl=Q.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return e._scrollControl||(e._scrollControl=Q.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"scrollAnimationRunTime",get:function(){return e._scrollAnimationRunTime+500},set:function(t){e._scrollAnimationRunTime=t}},{key:"isBroadcastSynced",get:function(){return e._isBroadcastSynced},set:function(t){e._isBroadcastSynced=t}},{key:"isSharedNotesEnabled",get:function(){return e._isSharedNotesEnabled},set:function(t){e._isSharedNotesEnabled=t}},{key:"sharedNotesUrl",get:function(){return e._sharedNotesUrl},set:function(t){e._sharedNotesUrl=t}}],(n=null)&&Ua(t.prototype,n),i&&Ua(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Na(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ha.broadcastNavigateSequence="Sequence",Ha.broadcastNavigatePage="Page",Ha.broadcastNavigateYOffset="YOffset",Ha.broadcastNavigateBottomPage="BottomPage",Ha.broadcastNavigateBottomOffset="BottomOffset",Ha.appNavigatedSource="Source",Ha.appNavigatedSourceUser="User",Ha.appLoaded="AppLoaded",Ha.documentLoaded="DocumentLoaded",Ha.linkedNotesEnabled="Enabled",Ha.linkedNotesUrl="NotesUrl",Ha.id="Id",Ha.DATAID_GLOBALBROADCASTID=9975,Ha._initialized=!1,Ha._waitingSequence=-999,Ha._animationBeginTime=new Date(0),Ha._isBroadcastSynced=!0,Ha._isSharedNotesEnabled=!1,Ha._sharedNotesUrl=null,Ha._outOfSyncEntry=null,Ha._scrollAnimationRunTime=0,Ha._presenterPageLabelPolled=!1,Ha._theWsaClient=null,Ha._actionManager=null,Ha._messenger=null,Ha._zoomControl=null,Ha._scrollControl=null,Object(i.a)(Ha,"BroadcastMessengerHelper",null,[]);var Wa=function(){function e(e,t,n){var i=this;this.onAppReady=function(e,t,n,i,r){return t.contextId!==La.a.application?2:1===n?Or.App.instance.isBroadcastMode&&Ha.isBroadcastSynced?8:32:(Ha.sendAppLoadingStatus(),32)},this.onSyncToPresenter=function(e,t,n,r,a){if(t.contextId!==La.a.application)return 2;if(1===n)return Or.App.instance.isBroadcastMode&&Ha.isBroadcastSynced?8:32;if(Or.App.instance.isBroadcastMode&&i._messenger&&i._messenger.sendMessage(d.a.broadcastSyncToPresenter,null))return 32;return 8},this.onOpenSharedNotes=function(e,t,n,i,r){return t.contextId!==La.a.application?2:1===n?Or.App.instance.isBroadcastMode&&!Ha.isSharedNotesEnabled?8:32:(ut.a.safelyOpenWindow(Ha.sharedNotesUrl,void 0,void 0,"OpenSharedNotes"),32)},this.beforeAnimateScroll=function(e,t,n,i,r){return t.contextId!==La.a.application?2:1===n?Or.App.instance.isBroadcastMode&&Ha.isBroadcastSynced?8:32:(Ha.suppressNavigateMessagesForAnimationDuration(),32)},this.animateScrollStarted=function(e,t,n,i,r){return t.contextId!==La.a.application?2:1===n?Or.App.instance.isBroadcastMode&&Ha.isBroadcastSynced?8:32:(Ha.scrollAnimationRunTime=r,32)},this.broadcastOnScroll=function(e,t,n,i,r){if(t.contextId!==La.a.application)return 2;if(1===n)return Or.App.instance.isBroadcastMode&&Ha.isBroadcastSynced?8:32;var a=r;return Ha.sendNavigationMessage(a.page,a.data,a.source),32},this._actionManager=e,this._messenger=t,this._theWsaClient=n}var t,n,i;return e.prototype.registerActions=function(){Or.App.instance.isBroadcastMode&&(Ha.initialize(this._actionManager,this._messenger,this._theWsaClient),this._actionManager.addActionWithFlags(Nr.a.onAppReady,La.a.application,this.onAppReady,96),this._actionManager.addActionWithFlags(Nr.a.syncToPresenter,La.a.application,this.onSyncToPresenter,96),this._actionManager.addActionWithFlags(Nr.a.openSharedNotes,La.a.application,this.onOpenSharedNotes,96),this._actionManager.addActionWithFlags(Nr.a.beforeAnimateScroll,La.a.application,this.beforeAnimateScroll,96),this._actionManager.addActionWithFlags(Nr.a.animateScrollStarted,La.a.application,this.animateScrollStarted,96),this._actionManager.addActionWithFlags(Nr.a.broadcastOnScroll,La.a.application,this.broadcastOnScroll,96),Ha.sendAppLoadingStatus())},e.getInstanceWithResolvedDependencies=function(){var t=Q.a.instance.resolve("Common.App.Postmessengers.HostIntegrationMessenger");return new e(s.AFrameworkApplication.theActionManager,t,s.AFrameworkApplication.theWsaClient)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getInstanceWithResolvedDependencies())}}],(n=null)&&Na(t.prototype,n),i&&Na(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ja(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Wa._instance=null,Object(i.a)(Wa,"BroadcastActor",null,[]);var Va=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e.initOnFullAppSettingsReady()}))},r.initOnFullAppSettingsReady=function(){this._container.resolve("WordViewer.Actors.AccessibilityHelpDialogActor").registerActions(),this._container.resolve("WordViewer.Actors.AppFrameCommandUIActor").registerActions(),Wa.instance.registerActions(),Q.a.instance.resolve("Common.IOfficeTrialExperience").registerActions(),Q.a.instance.resolve("Common.IMacOfficeOffer").registerActions()},r.dispose=function(){},r.configure=function(e){this._container=e,e.registerFactory("WordViewer.Actors.AppFrameCommandUIActor",(function(){return new Da(s.AFrameworkApplication.theActionManager,e.resolveFuture("Postmessage.IHostPostmessenger"),(function(){var e=Ri.a.instance;return e.isSessionExpired(s.AFrameworkApplication.accessTokenTtl)||e.isSessionAboutToExpire(s.AFrameworkApplication.accessTokenTtl,s.AFrameworkApplication.accessTokenExpirationPromptSeconds)}))})).singleInstance(),e.registerFactory("WordViewer.Actors.AccessibilityHelpDialogActor",(function(){return new qr(s.AFrameworkApplication.theActionManager,Bt.FocusManager.instance())})).singleInstance(),(new Pr).configure(e)},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"WordViewer.Actors"}}])&&ja(t.prototype,n),i&&ja(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function qa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Va,"WordViewerActorsPackage",null,[2,3]);var Ga=function(){function e(){}var t,n,i;return t=e,i=[{key:"dialogHtml",get:function(){return Bi.a.formatHtml(e.dialogHtmlFormat,CommonUIStrings.l_EmbedCodeText)}}],(n=null)&&qa(t.prototype,n),i&&qa(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Ga.dialogHtmlFormat="<div class='WACDialogRow' id='EmbedLabelBlock'> <label id='embedCode' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='EmbedTextAreaBlock'> <textarea id='txtEmbedCode' class='EmbedCodeTextArea' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>",Object(i.a)(Ga,"ReembedDialogHtml",null,[]);var Ka=function(){};Ka.dialogHtml="<div class='EmbedDialog' id='embeddialog'> <div class='EmbedPreviewPane' id='embedpreviewpane'> </div> <div class='EmbedOptionPane' id='embedoptionpane'> </div> </div>",Object(i.a)(Ka,"EmbedDialogHtml",null,[]);var za=function(e,t,n,i){this.optionElement=e,this.imageElement=t,this.optionHolderElement=n,this.value=i};Object(i.a)(za,"OptionInfo",null,[]);var Xa=function(e,t,n){this.sectionElement=e,this.imageHolder=t,this.imageElement=n};Object(i.a)(Xa,"SectionInfo",null,[]);var Ja=n(150);function Qa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Za(e,t){return(Za=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Ya='<a target="_blank" href="{0}">{1}</a>',$a=function(e){var t,n;function i(t,n){var r;return void 0===n&&(n=!1),(r=e.call(this,!1,!1,n)||this)._embedWidth=476,r._embedHeight=288,r._dialogWidth=798,r._previewPanelWidth=476,r._previewFrameHeight=288,r.paramToOptionInfo={},r.sectionInfoList=[],r._previewPane=null,r._optionPane=null,r._dimensionSection=null,r._optionSection=null,r._previewFrame=null,r._embedCodeTextArea=null,r.arrowClickHandler=function(e){return r.changeArrowState(e),!0},r.arrowKeyHandler=function(e){return r.keyHandlerWithAction(e,r.changeArrowState)},r.changeArrowState=function(e){var t=e.userData;"visible"===t.sectionElement.style.visibility?(t.sectionElement.style.visibility="hidden",t.imageElement.className=na.getImageClass(i._downArrowIconCssClass),t.imageElement.title=CommonUIStrings.l_Expand,t.imageHolder.title=CommonUIStrings.l_Expand):(t.sectionElement.style.visibility="visible",t.imageElement.className=na.getImageClass(i._upArrowIconCssClass),t.imageElement.title=CommonUIStrings.l_Collapse,t.imageHolder.title=CommonUIStrings.l_Collapse)},r.optionClickHandler=function(e){return r.optionHandler(e),!0},r.optionKeyHandler=function(e){return r.keyHandlerWithAction(e,r.optionHandler)},r.optionHandler=function(e){var t=r.paramToOptionInfo[e.userData.toString()];t.value?(t.value=0,t.imageElement.className=na.getImageClass(i._uncheckedIconCssClass),t.optionHolderElement.setAttribute(Mr.a.ariaCheckedAttribute,Mr.a.ariaFalseValue)):(t.value=1,t.imageElement.className=na.getImageClass(i._checkedIconCssClass),t.optionHolderElement.setAttribute(Mr.a.ariaCheckedAttribute,Mr.a.ariaTrueValue)),r.updateEmbedUrlAndRefresh(e.userData.toString(),t.value.toString())},r.textAreaOnFocusHandler=function(e){r._embedCodeTextArea.select()},r._embedUrl=s.AFrameworkApplication.hostEmbeddedViewUrl,r._previewUrl=t,r._optionClickHandler=r.optionClickHandler,r._optionKeyHandler=r.optionKeyHandler,r._arrowClickHandler=r.arrowClickHandler,r._arrowKeyHandler=r.arrowKeyHandler,r._textAreafocusHandler=r.textAreaOnFocusHandler,r._isReactDialog=n,r.dialogHtml=Ka.dialogHtml,r.buttonsOption=0,r.dialogId="EmbedDialog",r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Za(t,n);var r,a,o,l=i.prototype;return l.showReactEmbedDialog=function(e){for(var t={id:this.dialogId,bodyControls:{},embedPreviewSectionTitle:CommonUIStrings.l_Preview,embedCodeSectionTitle:CommonUIStrings.l_EmbedCode,dimensionsSectionTitle:CommonUIStrings.l_Dimensions,interactionSectionTitle:CommonUIStrings.l_Interaction,initialPreviewUrl:O.a.addOrReplaceParameterValue(this._previewUrl,"wdPreview","1"),initialEmbedUrl:this._embedUrl,getEmbedCode:i.getEmbedCode,codeCopiedText:CommonUIStrings.l_EmbedCodeCopied},n=0,r=Object.keys(e);n<r.length;n++){var a=r[n];t[a]=e[a]}this.buttonsOption=1,this.setButtonText(1,CommonUIStrings.l_CopyAction),this.setButtonText(0,CommonUIStrings.l_Close),this.initializeAndShow(CommonUIStrings.l_Embed,null,t)},l.showEmbedDialog=function(){if(this._isReactDialog)this.showReactEmbedDialog({});else{this.showDialog(CommonUIStrings.l_Embed,null),this._previewPane=document.getElementById("embedpreviewpane"),this._optionPane=document.getElementById("embedoptionpane"),this._previewPane.style.width=String.format("{0}px",this._previewPanelWidth),this._previewFrame=document.createElement("iframe"),this._previewFrame.className=i._previewFrameCssClass,this._previewFrame.frameBorder="0",this._previewFrame.style.height=String.format("{0}px",this._previewFrameHeight),this._previewFrame.tabIndex=-1,this._previewPane.appendChild(this.createSectionHeader(CommonUIStrings.l_Preview,this._previewFrame,i._previewId,i._previewHeaderId,i._previewId,!0)),this._embedCodeTextArea=document.createElement("textarea"),this._embedCodeTextArea.className=i._embedCodeCssClass,Sys.UI.DomElement.addCssClass(this._embedCodeTextArea,Ja.a.allowBrowserContextMenu),this._embedCodeTextArea.id=i._embedcodeTextAreaId,z.a.isIPad||(this._embedCodeTextArea.readOnly=!0),this._embedCodeTextArea.rows=4,this._embedCodeTextArea.style.fontFamily=CommonUIStrings.l_UserInterfaceFontName,this._embedCodeTextArea.style.fontSize=CommonUIStrings.l_UserInterfaceFontSize,this._embedCodeTextArea.setAttribute(Mr.a.ariaLabelledByAttribute,String.format("{0} {1}",i._embedCodeHeaderId,i._embedCodeFooterId)),this._previewPane.appendChild(this.createSectionHeader(CommonUIStrings.l_EmbedCode,this._embedCodeTextArea,i._embedCodeHeaderId)),Be.a.addHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler);var e=document.createElement("span");e.className=i._footerCssClass,e.innerText=CommonUIStrings.l_CopyText,e.id=i._embedCodeFooterId,this._previewPane.appendChild(e),this._dimensionSection=document.createElement("div"),this._dimensionSection.className=i._dimensionSectionCssClass,this._optionPane.appendChild(this.createSectionHeader(CommonUIStrings.l_Dimensions,this._dimensionSection)),this._optionSection=document.createElement("div"),this._optionPane.appendChild(this.createCollapsibleSectionHeader(i._optionsId,CommonUIStrings.l_Interaction,this._optionSection)),this.buttonsOption=0,this.setButtonText(1,CommonUIStrings.l_Close),this.updateEmbedCode(),this.updatePreview(),z.a.isIPad||this._embedCodeTextArea.focus()}},l.dispose=function(){if(this.paramToOptionInfo){var t=this.paramToOptionInfo;for(var n in t){var i={key:n,value:t[n]}.value;this._clickManager.unregisterHandler(m.a.click,i.optionElement,this._optionClickHandler),this._keyInputManager.unregisterHandler(m.a.keyDown,i.optionElement,this._optionKeyHandler),this._keyInputManager.unregisterHandler(m.a.keyUp,i.optionElement,this._optionKeyHandler)}this.paramToOptionInfo=null,this._optionClickHandler=null,this._optionKeyHandler=null}if(this.sectionInfoList){for(var r=0;r<this.sectionInfoList.length;++r)this._clickManager.unregisterHandler(m.a.click,this.sectionInfoList[r].imageHolder,this._arrowClickHandler),this._keyInputManager.unregisterHandler(m.a.keyDown,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(m.a.keyPress,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler),this._keyInputManager.unregisterHandler(m.a.keyUp,this.sectionInfoList[r].imageHolder,this._arrowKeyHandler);this.sectionInfoList=null,this._arrowClickHandler=null,this._keyInputManager=null}this._textAreafocusHandler&&this._embedCodeTextArea&&(Be.a.removeHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler),this._textAreafocusHandler=null),this._previewPane=null,this._optionPane=null,this._dimensionSection=null,this._optionSection=null,this._previewFrame=null,this._embedCodeTextArea=null,e.prototype.dispose.call(this)},l.reSizeDialog=function(){e.prototype.reSizeDialog.call(this),this._divMessageBox.style.width=String.format("{0}px",this._dialogWidth),this.centerDialog()},l.updateEmbedUrl=function(e,t){var n=O.a.addOrReplaceParameterValue(this._embedUrl,e,t);return this._embedUrl!==n&&(this._embedUrl=n,this._previewUrl=O.a.addOrReplaceParameterValue(this._previewUrl,e,t),!0)},l.updateEmbedCode=function(){this._embedCodeTextArea&&(this._embedCodeTextArea.innerText=i.getEmbedCode(this._embedUrl,this._embedWidth,this._embedHeight))},l.updatePreview=function(){this._previewFrame&&this._previewFrame.contentWindow.location.replace(O.a.addOrReplaceParameterValue(this._previewUrl,"wdPreview","1"))},l.updateEmbedUrlAndRefresh=function(e,t){this.updateEmbedUrl(e,t)&&(this.updateEmbedCode(),this.updatePreview())},l.createSectionHeader=function(e,t,n,r,a,o){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=!1);var s=document.createElement("div");s.className=i._sectionHeaderCssClass,r&&(s.id=r),a&&s.setAttribute(Mr.a.ariaLabelledByAttribute,a),o&&(s.tabIndex=0);var l=document.createElement("span");return l.className=i._sectionNameCssClass,l.innerText=e,n&&(l.id=n),s.appendChild(l),s.appendChild(t),s},l.createCollapsibleSectionHeader=function(e,t,n){var r=this.createSectionHeader(t,n),a=this._document.createElement("div");a.className=i._arrowHolderCssClass,a.id=i._arrowId+e,a.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaButtonRole),a.tabIndex=0,r.insertBefore(a,n);var o=na.createClusteredImage(16,16,i._arrowIconName,i._arrowImageCssClass,!0,"");a.appendChild(o);var s=o.childNodes[0];s.className=na.getImageClass(i._downArrowIconCssClass),s.title=CommonUIStrings.l_Expand,a.title=CommonUIStrings.l_Expand,n.style.visibility="hidden";var l=new Xa(n,a,s);return Array.add(this.sectionInfoList,l),this._clickManager.registerHandlerWithData(m.a.click,a,this._arrowClickHandler,l),this._keyInputManager.registerHandlerWithData(m.a.keyDown,a,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(m.a.keyPress,a,this._arrowKeyHandler,l),this._keyInputManager.registerHandlerWithData(m.a.keyUp,a,this._arrowKeyHandler,l),r},l.createCheckBox=function(e,t,n){var r=document.createElement("div");r.className=i._optionCssClass,r.id=e+i._optionId;var a=this._document.createElement("div");a.tabIndex=0,a.className=i._checkBoxHolderCssClass,a.id=e+i._checkId,a.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaCheckBoxRole),a.setAttribute(Mr.a.ariaCheckedAttribute,n?Mr.a.ariaTrueValue:Mr.a.ariaFalseValue),a.setAttribute(Mr.a.ariaLabelledByAttribute,e+i._descriptionCssClass),r.appendChild(a),r.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaPresentationRole);var o=na.createClusteredImage(16,16,i._checkboxIconName,i._checkboxCssClass,!0,"");a.appendChild(o);var s=o.childNodes[0];s.id=e+i._optionImageId,s.className=na.getImageClass(n?i._checkedIconCssClass:i._uncheckedIconCssClass);var l=new za(r,s,a,n?1:0);this.paramToOptionInfo[e]=l,this._clickManager.registerHandlerWithData(m.a.click,r,this._optionClickHandler,e);var c=document.createElement("span");return c.className=i._descriptionCssClass,c.innerText=t,c.id=e+i._descriptionCssClass,r.appendChild(c),this._keyInputManager.registerHandlerWithData(m.a.keyDown,r,this._optionKeyHandler,e),this._keyInputManager.registerHandlerWithData(m.a.keyUp,r,this._optionKeyHandler,e),r},i.getEmbedCode=function(e,t,n){if(!i._noFramesText){var r=String.format(Ya,Ze.a.htmlAttributeEncode("https://office.com"),CommonUIStrings.l_Office),a=String.format(Ya,Ze.a.htmlAttributeEncode("https://office.com/webapps"),CommonUIStrings.l_WebAppName);i._noFramesText=String.format(CommonUIStrings.l_NoFrames,r,a)}return String.format('<iframe src="{0}" width="{1}px" height="{2}px" frameborder="0">{3}</iframe>',Ze.a.htmlAttributeEncode(e),t,n,i._noFramesText)},r=i,(a=[{key:"_width$4",get:function(){return this._embedWidth},set:function(e){this._embedWidth=e}},{key:"_height",get:function(){return this._embedHeight},set:function(e){this._embedHeight=e}}])&&Qa(r.prototype,a),o&&Qa(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(Bi.a);function eo(e,t){return(eo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}$a._noFramesText=null,$a._checkedIconCssClass="CheckboxChecked_16x16x32",$a._uncheckedIconCssClass="CheckboxUnchecked_16x16x32",$a._upArrowIconCssClass="OutlookSearchChevronUp_16x16x32",$a._downArrowIconCssClass="OutlookSearchChevronDown_16x16x32",$a._checkboxIconName="CommentChecked",$a._arrowIconName="UpArrowServer",$a._descriptionCssClass="EmbedDescription",$a._sectionHeaderCssClass="EmbedSectionHeader",$a._sectionNameCssClass="EmbedSectionName UIFontBold",$a._footerCssClass="EmbedCodeFooter",$a._checkboxCssClass="EmbedOptionImage",$a._previewFrameCssClass="EmbedPreviewFrame",$a._embedCodeCssClass="EmbedCodeTextArea",$a._optionCssClass="EmbedOption",$a._dimensionSectionCssClass="EmbedDimensionSection",$a._arrowImageCssClass="EmbedArrowIcon",$a._arrowHolderCssClass="WACGlyph EmbedArrowHolder",$a._checkBoxHolderCssClass="EmbedCheckBoxHolder",$a._optionId="Option",$a._optionImageId="OptionImage",$a._embedcodeTextAreaId="EmbedCode",$a._embedCodeHeaderId="EmbedCodeHeader",$a._previewId="Preview",$a._previewHeaderId="PreviewHeader",$a._codeId="Code",$a._dimensionId="Dim",$a._optionsId="Options",$a._arrowId="Arrow",$a._checkId="Check",$a._embedCodeFooterId="EmbedCodeFooter",Object(i.a)($a,"EmbedDialog",Bi.a,[]);var to=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).textAreaOnFocusHandler=function(e){n._embedCodeTextArea.select()},n.dialogHtml=Ga.dialogHtml,n.buttonsOption=0,n.dialogId="ReembedDialog",n.showDialog(CommonUIStrings.l_EmbedDialogTitle,null),n._embedCodeTextArea=document.getElementById("txtEmbedCode"),Sys.UI.DomElement.addCssClass(n._embedCodeTextArea,Ja.a.allowBrowserContextMenu),z.a.isIPad||(n._embedCodeTextArea.readOnly=!0),n._embedCodeTextArea.rows=4,n._embedCodeTextArea.style.fontFamily=CommonUIStrings.l_UserInterfaceFontName,n._embedCodeTextArea.style.fontSize=CommonUIStrings.l_UserInterfaceFontSize,n._embedCodeTextArea.innerText=$a.getEmbedCode(t,Ki.a.pageWidth,Ki.a.pageHeight),Mr.a.setAriaAttribute(n._embedCodeTextArea,Mr.a.ariaLabelledByAttribute,"embedCode"),n._textAreafocusHandler=n.textAreaOnFocusHandler,Be.a.addHandler(n._embedCodeTextArea,"focus",n._textAreafocusHandler),n.centerDialog(),z.a.isIPad||n._embedCodeTextArea.focus(),n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,eo(t,n),i.prototype.dispose=function(){this._textAreafocusHandler&&(Be.a.removeHandler(this._embedCodeTextArea,"focus",this._textAreafocusHandler),this._textAreafocusHandler=null),this._embedCodeTextArea=null,e.prototype.dispose.call(this)},i}(Bi.a);Object(i.a)(to,"ReembedDialog",Bi.a,[]);var no=function(){};Object(i.a)(no,"WordEmbedDialogStrings",null,[]);var io=n(482);function ro(e,t){return(ro=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var ao=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this,t,n,i,r)||this).inputElement=a,o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ro(t,n),i}(za);function oo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function so(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lo(e,t){return(lo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ao,"OptionInputInfo",za,[]);var co=function(e){var t,n;function i(t,n){var r;return(r=e.call(this,t,i.useReactDialog)||this)._startOnOptionInfo=null,r._dimensionElements=[],r._startOnOptionClickHandler=Object(A.a)(so(r),r.startOnOptionClickHandler,"startOnOptionClickHandler"),r._startOnOptionKeyHandler=Object(A.a)(so(r),r.startOnOptionKeyHandler,"startOnOptionKeyHandler"),r._pageNumberChangedHandler=Object(A.a)(so(r),r.onPageNumberChanged,"onPageNumberChanged"),r._dimensionChangedHandler=Object(A.a)(so(r),r.onDimensionChanged,"onDimensionChanged"),r._dialogStrings=n,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,lo(t,n);var r,a,o,l=i.prototype;return l.showEmbedDialog=function(){if(i.useReactDialog){var t=i.reactUrlTransformFunctionOnChange,n=[];n.push({id:"wdPrint",checkboxInitialValue:!0,checkboxLabel:this._dialogStrings.printOptionText,urlTransformFunctionOnChange:t},{id:"wdEmbedCode",checkboxInitialValue:!0,checkboxLabel:this._dialogStrings.reembedOptionText,urlTransformFunctionOnChange:t},{id:"wdStartOn",checkboxInitialValue:!1,checkboxLabel:this._dialogStrings.startOptionText,urlTransformFunctionOnChange:t,textInputProps:{title:this._dialogStrings.startPageText}});var r={dimensionsOptions:{isMultipleChoice:!1,defaultWidth:this._embedWidth,defaultHeight:this._embedHeight,minWidth:375,minHeight:250,widthLabel:this._dialogStrings.widthText,heightLabel:this._dialogStrings.heightText},interactionOptions:n};this.showReactEmbedDialog(r)}else if(e.prototype.showEmbedDialog.call(this),this.addDimensionControl(this._dialogStrings.widthText,"EmbedWidthInput",this._embedWidth),this.addDimensionControl(this._dialogStrings.heightText,"EmbedHeightInput",this._embedHeight),this._optionSection.appendChild(this.createCheckBox("wdPrint",this._dialogStrings.printOptionText,!0)),this._optionSection.appendChild(this.createCheckBox("wdEmbedCode",this._dialogStrings.reembedOptionText,!0)),this.addCheckBoxWithInput(this._dialogStrings.startOptionText,!1),this.centerDialog(),Bt.FocusManager.usable()){var a=Bt.FocusManager.instance(),o=[document.getElementById($a._embedcodeTextAreaId),document.getElementById("EmbedWidthInput"),document.getElementById("EmbedHeightInput"),document.getElementById($a._arrowId+$a._optionsId),document.getElementById("wdPrint"+$a._checkId),document.getElementById("wdEmbedCode"+$a._checkId),document.getElementById("wdStartOn"+$a._checkId),document.getElementById("wdStartOnText"),document.getElementById(Ki.a._actionButtonId),document.getElementById($a._previewHeaderId)],s=new io.a(o);a.getCurrentRegion().listing=s,z.a.isIPad?this.setFocusOnElement(document.getElementById(Ki.a._actionButtonId)):this._embedCodeTextArea.select()}},l.dispose=function(){if(i.useReactDialog)e.prototype.dispose.call(this);else{if(this._dimensionElements){for(var t=0;t<this._dimensionElements.length;++t)Be.a.removeHandler(this._dimensionElements[t],"change",this._dimensionChangedHandler);this._dimensionChangedHandler=null,this._dimensionElements=null}this._pageNumberChangedHandler&&(Be.a.removeHandler(this._startOnOptionInfo.inputElement,"change",this._pageNumberChangedHandler),this._pageNumberChangedHandler=null),this._startOnOptionClickHandler&&(this._clickManager.unregisterHandler(m.a.click,this._startOnOptionInfo.optionElement,this._startOnOptionClickHandler),this._startOnOptionClickHandler=null),this._startOnOptionKeyHandler&&(this._keyInputManager.unregisterHandler(m.a.keyDown,this._startOnOptionInfo.optionElement,this._startOnOptionKeyHandler),this._keyInputManager.unregisterHandler(m.a.keyUp,this._startOnOptionInfo.optionElement,this._startOnOptionKeyHandler),this._startOnOptionKeyHandler=null),this._startOnOptionInfo=null,e.prototype.dispose.call(this)}},l.addDimensionControl=function(e,t,n){var i=document.createElement("label");i.className="EmbedInputPrefix",i.innerText=e,this._dimensionSection.appendChild(i);var r=document.createElement("input");r.className=t,r.id=t,r.value=n.toString(),r.type="text",r.setAttribute("data-lpignore","true"),i.setAttribute("for",t),this._dimensionSection.appendChild(r),this._dimensionElements.push(r),Be.a.addHandler(r,"change",this._dimensionChangedHandler),this._dimensionSection.appendChild(document.createElement("br"))},l.onDimensionChanged=function(e){"EmbedWidthInput"===e.target.id?this._embedWidth=this.ensureMinValue(e.target,375):this._embedHeight=this.ensureMinValue(e.target,250),this.updateEmbedCode()},l.ensureMinValue=function(e,t){var n=parseInt(e.value);return(isNaN(n)||n<t)&&(n=t),e.value=n.toString(),n},l.onPageNumberChanged=function(e){var t=this.ensureMinValue(e.target,1);1===this._startOnOptionInfo.value&&this.updateEmbedUrlAndRefresh("wdStartOn",t.toString())},l.addCheckBoxWithInput=function(e,t){var n=document.createElement("div");n.className=$a._optionCssClass+" EmbedInlineOption",n.id="wdStartOn"+$a._optionId;var i=this._document.createElement("div");i.tabIndex=0,i.className=$a._checkBoxHolderCssClass,i.id="wdStartOn"+$a._checkId,i.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaCheckBoxRole),i.setAttribute(Mr.a.ariaCheckedAttribute,t?Mr.a.ariaTrueValue:Mr.a.ariaFalseValue),i.setAttribute(Mr.a.ariaLabelledByAttribute,"wdStartOn"+$a._descriptionCssClass),n.appendChild(i),n.setAttribute(Mr.a.ariaRoleAttribute,Mr.a.ariaPresentationRole);var r=na.createClusteredImage(16,16,$a._checkboxIconName,$a._checkboxCssClass,!0,"");i.appendChild(r);var a=r.childNodes[0];a.id="wdStartOn"+$a._optionImageId,a.className=na.getImageClass(t?$a._checkedIconCssClass:$a._uncheckedIconCssClass);var o=document.createElement("span");o.className=$a._descriptionCssClass,o.innerText=e,o.id="wdStartOn"+$a._descriptionCssClass,n.appendChild(o),this._optionSection.appendChild(n);var s=document.createElement("input");s.className="EmbedPageNumberInput",s.id="wdStartOnText",s.type="text",s.title=this._dialogStrings.startPageText,s.setAttribute("data-lpignore","true"),this._optionSection.appendChild(s),Be.a.addHandler(s,"change",this._pageNumberChangedHandler),this._startOnOptionInfo=new ao(n,a,i,t?1:0,s),this.updateEmbedUrlAndRefresh("wdStartOn","1"),this._clickManager.registerHandler(m.a.click,n,this._startOnOptionClickHandler),this._keyInputManager.registerHandler(m.a.keyDown,n,this._startOnOptionKeyHandler),this._keyInputManager.registerHandler(m.a.keyUp,n,this._startOnOptionKeyHandler)},l.startOnOptionClickHandler=function(e){return this.startOnOptionHandler(e),!0},l.startOnOptionKeyHandler=function(e){return this.keyHandlerWithAction(e,Object(A.a)(this,this.startOnOptionHandler,"startOnOptionHandler"))},l.startOnOptionHandler=function(e){var t=1;this._startOnOptionInfo.value?(this._startOnOptionInfo.value=0,this._startOnOptionInfo.imageElement.className=na.getImageClass($a._uncheckedIconCssClass),this._startOnOptionInfo.optionHolderElement.setAttribute(Mr.a.ariaCheckedAttribute,Mr.a.ariaFalseValue)):(this._startOnOptionInfo.value=1,this._startOnOptionInfo.imageElement.className=na.getImageClass($a._checkedIconCssClass),t=this.ensureMinValue(this._startOnOptionInfo.inputElement,1),this._startOnOptionInfo.optionHolderElement.setAttribute(Mr.a.ariaCheckedAttribute,Mr.a.ariaTrueValue)),this.updateEmbedUrlAndRefresh("wdStartOn",t.toString())},i.reactUrlTransformFunctionOnChange=function(e,t,n,i){if(void 0===i&&(i=null),"wdPrint"===t||"wdEmbedCode"===t)return O.a.addOrReplaceParameterValue(e,t,n?"1":"0");if("wdStartOn"===t){var r="1";if(n&&i){var a=parseInt(i);!isNaN(a)&&a>=1&&(r=a.toString())}return O.a.addOrReplaceParameterValue(e,t,n?r:"1")}return e},r=i,o=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}}],(a=null)&&oo(r.prototype,a),o&&oo(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}($a);Object(i.a)(co,"WordEmbedDialog",$a,[]);var uo=function(){function e(e,t,n,i,r){this._hostPostmessenger=null,this._actionManager=e,this._hostPostmessengerFuture=t,this._actionId=n,this._dialogStrings=i,this._app=r}var t=e.prototype;return t.registerActions=function(){this._actionManager.addAction(this._actionId,_e.a.frame,Object(A.a)(this,this.showEmbedCode,"showEmbedCode")),this._hostPostmessengerFuture.execute(Object(A.a)(this,this.onHostPostmessengerCreated,"onHostPostmessengerCreated"))},t.onHostPostmessengerCreated=function(e){r.ULS.shipAssertTag(4994850,332,!!e),this._hostPostmessenger=e,s.AFrameworkApplication.isEmbedded||(this._hostPostmessenger.addAllowedReceivingMessage(d.a.canEmbed),this._hostPostmessenger.registerCallback(d.a.canEmbed,Object(A.a)(this,this.showEmbedDialog,"showEmbedDialog")))},t.showEmbedDialog=function(e){var t=e.Values.HostEmbeddedViewUrl.toString();s.AFrameworkApplication.hostEmbeddedViewUrl=t,this._app.embedPreviewUrl=t,new co(t,this._dialogStrings).showEmbedDialog()},t.showEmbedCode=function(t,n,i,r,a){if(2===i){if(!s.AFrameworkApplication.hostEmbeddedViewUrl)return s.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WORDWAC_EMBEDWITHOUTURL,1),s.AFrameworkApplication.useFileEmbedCommandPostMessage&&this._hostPostmessenger.sendMessage(d.a.fileEmbed,null)?32:s.AFrameworkApplication.activeFrame.navigateToHostUrl(!0,s.AFrameworkApplication.fileEmbedCommandUrl);new co(this._app.embedPreviewUrl,this._dialogStrings).showEmbedDialog()}return 32},e}();uo.DATAID_WORDWAC_EMBEDWITHOUTURL=10381,Object(i.a)(uo,"EmbedActor",null,[]);var po=n(141);function ho(e,t){return(ho=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var go=function(e){var t,n;function i(t,n){var r;return(r=e.call(this,t,n,Nr.a.showFileEmbedInfo,Object.assign(new no,{widthText:WacWordviewerStrings.Width,heightText:WacWordviewerStrings.Height,printOptionText:WacWordviewerStrings.PrintOption,reembedOptionText:WacWordviewerStrings.ReembedOption,startOptionText:WacWordviewerStrings.StartOnOption,startPageText:WacWordviewerStrings.StartPage}),Or.App.instance)||this).showReembedCode=function(e,t,n,r,a){var o=s.AFrameworkApplication.hostEmbeddedViewUrl,l=!s.AFrameworkApplication.hostEmbeddedViewUrl;return 1===n?l?8:32:(2===n&&(Or.App.instance.showPrint||(o=O.a.addOrReplaceParameterValue(o,"wdPrint","0")),1!==Or.App.initialPageNumber&&(o=O.a.addOrReplaceParameterValue(o,"wdStartOn",Or.App.initialPageNumber.toString())),new to(o)),i._statusBarPolled=!0,32)},r}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ho(t,n),i.prototype.registerActions=function(){e.prototype.registerActions.call(this),this._actionManager.addAction(Nr.a.showReembedCode,_e.a.frame,this.showReembedCode),window.setTimeout((function(){i._statusBarPolled||(i._statusBarPolled=!0,Or.App.get_activeAppFrame().statusBarUser&&Or.App.get_activeAppFrame().statusBarUser.pollControl(po.a.documentInformationButton),Or.App.get_activeAppFrame().ribbonUser&&Or.App.get_activeAppFrame().ribbonUser.poll())}),10)},i}(uo);function mo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}go._statusBarPolled=!1,Object(i.a)(go,"EmbedActor",uo,[]);var fo=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,e.registerFactory("WordViewer.Embed.EmbedActor",(function(){return new go(s.AFrameworkApplication.theActionManager,e.resolveFuture("Postmessage.IHostPostmessenger"))})).singleInstance()},r.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady((function(){e._container.resolve("WordViewer.Embed.EmbedActor").registerActions()}))},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"WordViewer.Embed"}}])&&mo(t.prototype,n),i&&mo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(fo,"EmbedPackage",null,[2,3]);var vo=function(){this.LanguageRunsList=null,this.SelectionChunkIndex=0,this.SelectionCharIndex=0,this.LanguageRunsList=new te.a,this.SelectionChunkIndex=0,this.SelectionCharIndex=0};function _o(e,t){return(_o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(vo,"LearningToolsDocumentData",null,[]);var yo=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this)._errorDialogMessage=t,n.buttonsOption=0,n.setButtonText(1,CommonUIStrings.l_DialogClose),n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,_o(t,n),i.prototype.displayError=function(e){this.showError(e,CommonUIStrings.l_DefaultDialogTitle,this._errorDialogMessage,null,!1,!0)},i}(Kn.StandardDialog);Object(i.a)(yo,"ErrorDialog",Kn.StandardDialog,[142]);var So=function(){};function bo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(So,"LearningToolsExtraInfoContext",null,[140]);var Ao=function(){function e(){}var t,n,i;return e.requestFullscreen=function(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.requestFullscreen?e.requestFullscreen():r.ULS.sendTraceTag(7145619,210,50,"RequestFullscreen got invoked in unknown browser")},e.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen?document.exitFullscreen():r.ULS.sendTraceTag(7145620,210,50,"ExitFullscreen got invoked in unknown browser")},t=e,i=[{key:"fullscreenChangeEventName",get:function(){return document.webkitFullscreenEnabled?"webkitfullscreenchange":document.msFullscreenEnabled?"MSFullscreenChange":document.mozFullScreenEnabled?"mozfullscreenchange":document.fullscreenEnabled?"fullscreenchange":null}},{key:"fullscreenErrorEventName",get:function(){return void 0!==document.webkitFullscreenEnabled?"webkitfullscreenerror":void 0!==document.msFullscreenEnabled?"MSFullscreenError":void 0!==document.mozFullScreenEnabled?"mozfullscreenerror":void 0!==document.fullscreenEnabled?"fullscreenerror":null}},{key:"isFullScreenAvailable",get:function(){return document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.fullscreenEnabled}},{key:"isFullScreen",get:function(){return!!(document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.fullscreenElement)}},{key:"fullScreenElement",get:function(){var e=null;return(e=document.webkitFullscreenElement)||(e=document.msFullscreenElement)||(e=document.mozFullScreenElement)||(e=document.fullscreenElement)?e:null}}],(n=null)&&bo(t.prototype,n),i&&bo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ao,"FullscreenUtils",null,[]);var Co=n(471),To=function(){function e(e,t,n,i,a,o,s,l,c,u,p,h,g,m,f,v,_,y,S){var b=this;this._displayIframeStartTime=0,this._startToDisplayIFrameDuration=0,this._messageValueDictionary=null,this._container=null,this._iframe=null,this._progressDialog=null,this._errorDialog=null,this.messageHandler=function(e){if(e.data===d.a.exitLT)return r.ULS.sendTraceTag(20490002,306,50,"Postmessage sent with param: {0}",e.data),b.closeLearningTools(),!0;if(e.data===d.a.readyForStorageLT)return b._isStorageIdReady=!0,b.displayIframe(),b.triggerPostMessageIfReady(),!0;if(e.data===d.a.requestLTFullScreen)Ao.requestFullscreen(b._container);else if(e.data===d.a.exitLTFullScreen)Ao.exitFullscreen();else{var t=null;try{t=JSON.parse(e.data)}catch(e){return r.ULS.sendTraceTag(21320706,306,100,"Postmessage generated exception: "+e),!1}if(t){var n=t.storageIdReceivedToContentLoadedDurationInMs;if(n)return b._isContentLoaded=!0,b._contentLoadedDuration=n,r.ULS.sendTraceTag(22905240,306,50,"contentLoadedDuration:{0}",b._contentLoadedDuration),!0}}return r.ULS.sendTraceTag(20490003,306,100,"Postmessage fired with irrelevant param"),!1},this._title=e,this._msgEventHandler=t,this._clientRequestManager=n,this._webServiceBase=i,this._stopwatch=a,this._charCount=o,this._timeoutMs=s,this._textData=l,this._browserLcid=c,this._iFrameTitle=u,this._errorDialogMessage=p,this._isContentLoaded=!1,this._contentLoadedDuration=0,this._focusManager=g,this._learningToolsSessionId=J.a.create().toString(),this._learningToolsDocData=m,this._appId=_,this._staticReaderUrl=h+"?appId="+_,this._versionQueryParamEnabled=f,this._newDataFlowEnabled=v,this._useV2Api=y,this._sendDocxFile=S,this._isStorageIdReady=!1,this._browserLang=Dn.a.getCultureInfo(this._browserLcid).name,this._failedCanary=!1}var t=e.prototype;return t.showLoadingDialog=function(){var e=new Oi.a;this._progressDialog=e.create(),this._progressDialog.buttonsOption=5,this._progressDialog.hasCloseGlyph=!1,this._progressDialog.showProgressDialog(null,null,null)},t.closeLoadingDialog=function(){this._progressDialog&&(this._progressDialog.close(),this._progressDialog=null)},t.launchErrorDialog=function(){this._errorDialog=new yo(this._errorDialogMessage),this._errorDialog.displayError(Qn.a.learningToolsLaunchFailed)},t.launch=function(e){var t=this;r.ULS.sendTraceTag(2049e4,306,50,"Learning Tools service launched"),this._stopwatch.start(),this._displayIframeStartTime=(new Date).getTime(),this.showLoadingDialog();var n,i={};i.title=this._title,i.chunks=this._textData,i.StartingChunkIndex=this._learningToolsDocData.SelectionChunkIndex,i.StartingCharIndex=this._learningToolsDocData.SelectionCharIndex;var a="",o="",l="";if(this._useV2Api){var c={};c.data=i,n=H.c(c),a="&useV2Endpoint=1",this._sendDocxFile&&(o="&sendDocxFile=1",l="&startIndex="+this._learningToolsDocData.SelectionCharIndex)}else n=H.c(i);var u=this._webServiceBase+"OneNoteS2SHandler.ashx?action="+e+"&appId="+this._appId+"&enabledConfig=WordEditorLearningToolsIsEnabled&"+s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion+a+o+l,p={"Content-Type":"application/json; charset=utf-8"};p.LearningToolsSessionId=this._learningToolsSessionId,this._clientRequestManager.addRequest(u,2,n,p,!1,2,(function(e){t.onRequestSucceeded(e)}),(function(e){t.onRequestFailed(e)}),e,void 0,void 0,void 0,this._timeoutMs);var h=this._staticReaderUrl+"&exitCallback="+d.a.exitLT+"&omkt="+this._browserLang+"&sessionId="+this._learningToolsSessionId+"&showFeedback="+s.AFrameworkApplication.showFeedbackButton.toString();this._versionQueryParamEnabled&&(h+="&v=2"),this.launchIFrame(h)},t.onRequestSucceeded=function(t){var n=e.getJsonFromResponse(t.data.responseData);if(this._messageValueDictionary={},this._failedCanary=!1,this._newDataFlowEnabled)this._messageValueDictionary.readerModel=n;else{var i=Object(F.a)(String,n.url),r=Object(F.a)(String,n.storageId),a=Object(F.a)(String,n.version),o=Object(F.a)(String,n.processingHost);if(!i)return void nr.b(20259850,200,10,"{0}",{Desc:"NoUrl"});this._messageValueDictionary.storageId=r,this._messageValueDictionary.apiVersion=a,this._messageValueDictionary.processingHost=o}this.triggerPostMessageIfReady()},t.launchIFrame=function(t){s.AFrameworkApplication.isInImmersiveReaderMode=!0,this._container=document.createElement("div"),this._iframe=document.createElement("iframe"),this._container.appendChild(this._iframe),document.body.appendChild(this._container),e.setInitialElementStyle(this._container),e.setInitialElementStyle(this._iframe),this._iframe.id="ImmersiveReader-iframe",this._iframe.title=this._iFrameTitle,this._iframe.tabIndex=0,this._iframe.src=t,this._iframe.setAttribute("allowfullscreen","true"),this._iframe.setAttribute("aria-modal","true"),this.listenForPostMessage()},t.onRequestFailed=function(e){this.stopLearningToolsStopwatch(!1),r.ULS.sendTraceTag(20259852,201,10,"{0}",this.getFailureLogInfo(e)),this.closeLoadingDialog(),5!==e.data.status||this._failedCanary?this.launchErrorDialog():(this._failedCanary=!0,this.closeLearningTools(),this.launch(Object(F.a)(String,e.data.state)))},t.getFailureLogInfo=function(e){var t=-1;return e&&e.data&&(t=e.data.httpStatus),500===t?r.ULS.sendTraceTag(37065042,201,10,"Failed to load the immersive reader for app {0} due to a 500 internal server error response from the LT service with LearningToolsSessionId {1}",this._appId,this._learningToolsSessionId):408===t&&r.ULS.sendTraceTag(37065043,201,10,"Failed to load the immersive reader for app {0} due to a 408 request timeout from the LT service with LearningToolsSessionId {1}",this._appId,this._learningToolsSessionId),{desc:"LT failure",status:t,LearningToolsSessionId:this._learningToolsSessionId}},t.listenForPostMessage=function(){this._msgEventHandler.attachHandler(this.messageHandler,null)},t.triggerPostMessageIfReady=function(){var e=this;if(this._messageValueDictionary&&this._isStorageIdReady){this._focusManager.popScope("LearningToolsStaticReader"),this.stopLearningToolsStopwatch(!0),this._messageValueDictionary.launchToPostMessageSentDurationInMs=this._stopwatch.ageInMilliseconds;var t={},n="";if(this._newDataFlowEnabled)if(this._useV2Api){var i=this._messageValueDictionary.readerModel;i.launchToPostMessageSentDurationInMs=this._stopwatch.ageInMilliseconds,n="LinguisticModel",t.messageValue=i}else n="ReaderModel2",t.messageValue=this._messageValueDictionary;else n="Data",t.messageValue=this._messageValueDictionary;if(t.messageType=n,this.sendPostMessageDictionary(t),this._iframe){var r=this._focusManager.getScope("LearningTools");r.parent=Dt.AFrame.appFocusId,r.addOnFocus((function(t,n){e._iframe.focus()})),this._focusManager.pushScope("LearningTools",!1)}var a={messageType:"SetFocus"};this.sendPostMessageDictionary(a)}},t.sendPostMessageDictionary=function(e){if(this._iframe&&this._iframe.contentWindow){var t=O.a.getOrigin(this._iframe.src);this._iframe.contentWindow.postMessage(JSON.stringify(e),t)}},t.displayIframe=function(){var e=this;this.closeLoadingDialog();var t=this._focusManager.getScope("LearningToolsStaticReader");t.parent=Dt.AFrame.appFocusId,t.addOnFocus((function(t,n){e._iframe.focus()})),this._container.style.visibility="visible",this._iframe.style.visibility="visible",this._focusManager.pushScope("LearningToolsStaticReader",!1),r.ULS.sendTraceTag(20490001,306,50,"Learning Tools iFrame loaded"),this._startToDisplayIFrameDuration=(new Date).getTime()-this._displayIframeStartTime},t.stopLearningToolsStopwatch=function(e){var t=new Co.a,n=new So;e?(n.RequestSucceeded=!0,n.DocumentCharCount=this._charCount,n.StartToDisplayIFrameDuration=this._startToDisplayIFrameDuration):n.RequestSucceeded=!1,t.ExtraInfoContext=n,this._stopwatch.stopEx(t)},t.closeLearningTools=function(){Lr.a.removeElement(this._iframe),Lr.a.removeElement(this._container),this._msgEventHandler.detachHandler(this.messageHandler);var e={};e.learningToolsSessionDurationInMs=(new Date).getTime()-this._displayIframeStartTime,e.isContentLoaded=this._isContentLoaded,e.contentLoadedDuration=this._contentLoadedDuration,this._focusManager.popScope("LearningTools"),s.AFrameworkApplication.isInImmersiveReaderMode=!1,r.ULS.sendTraceTag(21320707,306,50,JSON.stringify(e))},e.setInitialElementStyle=function(e){e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.left="0",e.style.top="0",e.style.borderWidth="0",e.style.visibility="hidden",e.style.zIndex="1000",e.style.background="white"},e.getJsonFromResponse=function(e){var t,n,i=(t=H.d(e),n=t.deserialized,t).returnValue,r=Object(F.a)(Object,n);return r||(nr.b(20259851,200,10,"{0}",{desc:"CouldntParse",serialized:i}),null)},e}();Object(i.a)(To,"LearningToolsLauncher",null,[]);var ko=n(351),wo=n(31);function Io(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Po=function(){function e(){var e=this;this._msgEventHandler=null,this._clientRequestManager=null,this._webServiceBase=null,this._stopwatch=null,this._charCount=0,this._timeoutMs=0,this._browserLcid=0,this._iFrameTitle=null,this._staticUrl=null,this._focusManager=null,this._versionQueryParamIsEnabled=!1,this._newDataFlowIsEnabled=!1,this._useV2Api=!1,this.launchImmersiveReader=function(t,n,i,r,a){if(1===i)return wo.a.isDocumentEncrypted()?8:32;var o=new vo;return new To("",e._msgEventHandler,e._clientRequestManager,e._webServiceBase,e._stopwatch,e._charCount,e._timeoutMs,[],e._browserLcid,e._iFrameTitle,WacWordviewerStrings.LearningToolsErrorMessage,e._staticUrl,e._focusManager,o,e._versionQueryParamIsEnabled,e._newDataFlowIsEnabled,"Word Viewer",e._useV2Api,!1).launch("learningtoolsviewer"),32}}var t,n,i,r=e.prototype;return r.configure=function(e){},r.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WordViewerLearningToolsIsEnabled")&&(this.registerActions(),this._msgEventHandler=ko.a.instance,this._clientRequestManager=s.AFrameworkApplication.theClientRequestManager,this._webServiceBase=s.AFrameworkApplication.appSettingsManager.appSettings.WebServiceBase,this._stopwatch=s.AFrameworkApplication.activeFrame.theStopwatchBuilder.makeStopwatch("LoadResource","ImmersiveReader"),this._timeoutMs=s.AFrameworkApplication.appSettingsManager.getIntAppSetting("LearningToolsViewerTimeoutMs",47e3),this._browserLcid=s.AFrameworkApplication.lcid,this._staticUrl=s.AFrameworkApplication.appSettingsManager.getStringAppSetting("LearningToolsStaticUrl"),this._focusManager=Bt.FocusManager.instance(),this._newDataFlowIsEnabled=!0,this._iFrameTitle=WacWordviewerStrings.ImmersiveView,this._versionQueryParamIsEnabled=!1,this._useV2Api=s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("LearningToolsV2EndpointIsEnabled"))},r.dispose=function(){},r.registerActions=function(){s.AFrameworkApplication.theActionManager.addAction(Nr.a.launchImmersiveReader,La.a.application,this.launchImmersiveReader)},e.main=function(){s.AFrameworkApplication.disableWholeAppsForOfficeFeature||y.a.instance.registerPackage(new e,void 0)},t=e,(n=[{key:"name",get:function(){return"WordViewer.LearningToolsViewerLauncher"}}])&&Io(t.prototype,n),i&&Io(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Po,"LearningToolsViewerLauncherPackage",null,[2,3]);var Fo=n(656);function Eo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Oo=function(){function e(){}var t,n,i,r=e.prototype;return r.configure=function(e){},r.init=function(){if(Or.App.get_activeAppFrame()){var e=Fo.a.instance;Or.App.get_activeAppFrame().workspace.setSelectionManager(e)}},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"WordViewer.Selection"}}])&&Eo(t.prototype,n),i&&Eo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Oo,"SelectionPackage",null,[2,3]);var Mo=n(650);function Lo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ro=function(){function e(){this.onFullAppSettingsReady=function(){if(Or.App.get_activeAppFrame()&&Mo.SearchManager.instance){if(ae.a.registerDispatchHandler(e.dispatcher),!Or.App.instance.isSmallView&&!s.AFrameworkApplication.isNoChrome){var t=Mo.SearchManager.instance;Or.App.get_activeAppFrame().workspace.setSearchManager(t)}Or.App.get_activeAppFrame().ribbonUser&&Or.App.get_activeAppFrame().ribbonUser.poll()}}}var t,n,i,r=e.prototype;return r.configure=function(e){},r.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(this.onFullAppSettingsReady)},r.dispose=function(){},e.dispatcher=function(e,t,n,i,r){return e===Nr.a.showSearchPane?Mo.SearchManager.instance.showSearchPane(e,t,n,i,r):e===Nr.a.toggleSearchPane?Mo.SearchManager.instance.toggleSearchPane(e,t,n,i,r):2},t=e,(n=[{key:"name",get:function(){return"WordViewer.Search"}}])&&Lo(t.prototype,n),i&&Lo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ro,"SearchPackage",null,[2,3]);var Do=n(655),xo=n(648);function Bo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Uo,Ho=function(){function e(){this._id=0,this._request=null,this._dependency=null,this.batchedOperation=null,this.isPersistedSave=!1,this.hasClientAcceptedServerUpdate=!1,this.status=0,this.statusCode=1,this.corrrelation=null,this.httpStatusCode=0,this.requestEnqueueTime=null,this.invokedTime=null,this.invokedTimeTicks=0,this.completedTime=null,this.completedTimeTicks=0,this._responseObjects=null,this._httpHeaders=null,this.roundtripId=-1,this._createdTime=new Date,this.perfTag="Unknown",this._queryParameters=new xe.a}var t,n,i,r=e.prototype;return r.addResponse=function(e){this.responseObjects||(this._responseObjects=[]),this.responseObjects.push(e)},r.addHttpHeader=function(e,t){this.httpHeaders||(this._httpHeaders=new xe.a),this.httpHeaders.add(e,t)},r.getDiagnosticStateForLogging=function(){var e={};this.hasClientAcceptedServerUpdate&&(e.CASU=1),e.ID=this.id,e.RID=this.roundtripId,e.S=this.status,this.corrrelation&&(e.C=this.corrrelation),e.CRT=this.createdTime.toISOString();var t=null;return s.AFrameworkApplication.theClientRequestManager&&(t=s.AFrameworkApplication.theClientRequestManager.peekAtRequestQueue(this.roundtripId)),t?(e.HSC=t.httpStatus,e.RI=1,e.ST=t.status,t.enqueueTime&&(e.ET=t.enqueueTime.toISOString()),t.invokedTime&&(e.IT=t.invokedTime.toISOString()),t.completedTime&&(e.CT=t.completedTime.toISOString())):(e.HSC=this.httpStatusCode,e.RI=0,e.ST=this.statusCode,this.requestEnqueueTime&&(e.ET=this.requestEnqueueTime.toISOString()),this.invokedTime&&(e.IT=this.invokedTime.toISOString()),this.completedTime&&(e.CT=this.completedTime.toISOString())),e},t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._request&&(this._request.OperationId=e),this._id=e}},{key:"createdTime",get:function(){return this._createdTime}},{key:"queryParameters",get:function(){return this._queryParameters}},{key:"requestObject",get:function(){return this._request},set:function(e){e&&(e.OperationId=this.id),this._request=e}},{key:"responseObjects",get:function(){return this._responseObjects}},{key:"httpHeaders",get:function(){return this._httpHeaders}},{key:"dependency",get:function(){return this._dependency},set:function(e){this._dependency=e,e&&(this.requestObject.DependentOn=e.id)}}])&&Bo(t.prototype,n),i&&Bo(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Ho,"ServerOperation",null,[]),function(e){e[e.nil=0]="nil",e[e.requestReady=1]="requestReady",e[e.responseReady=2]="responseReady"}(Uo||(Uo={})),Object(i.b)("ServerOperationStatus",Uo);var No=function(){};No.batchedOperation="BatchedOperation",No.replication="Replication",No.typingProcessEvent="25",No.replicationEvent="9_"+No.batchedOperation+"_"+No.replication,Object(i.a)(No,"CpuMeterConstants",null,[]);var Wo=n(484),jo=n(40),Vo=n(169);function qo(e,t){return(qo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Go=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,qo(t,n),i}(Vo.ScriptSharpLegacyMap);function Ko(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return zo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zo(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function zo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(Go,"UIntDictionary",Vo.ScriptSharpLegacyMap,[]);var Xo=function(){function e(){this.Mode=0,this.srs=null}return e.addRequestToGroup=function(e,t){var n=[];n[0]=t.getClassId(),n[1]=t,e.push(n)},e.serialization=function(t,n){var i=new e;return i.Mode=n,i.srs=t,H.c(i)},e.construct=function(t,n){for(var i,r=[],a=Ko(t);!(i=a()).done;){var o=i.value.value;o&&e.addRequestToGroup(r,o.requestObject)}return e.serialization(r,n)},e.constructFromSingleRequest=function(t,n){var i=[];return e.addRequestToGroup(i,t),e.serialization(i,n)},e.constructFromArrayList=function(t,n){for(var i=[],r=0;r<t.length;++r)t[r]&&e.addRequestToGroup(i,t[r]);return e.serialization(i,n)},e}();Object(i.a)(Xo,"CommonServerRequestGroup",null,[]);var Jo=n(474);function Qo(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Qo=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof p?t:p,o=Object.create(a.prototype),s=new k(r||[]);return i(o,"_invoke",{value:b(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function p(){}function h(){}function g(){}var m={};l(m,a,(function(){return this}));var f=Object.getPrototypeOf,v=f&&f(f(w([])));v&&v!==t&&n.call(v,a)&&(m=v);var _=g.prototype=p.prototype=Object.create(m);function y(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){var r;i(this,"_invoke",{value:function(i,a){function o(){return new t((function(r,o){!function i(r,a,o,s){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}(i,a,r,o)}))}return r=r?r.then(o,o):o()}})}function b(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return I()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=A(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(e,t,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}function A(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=u(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=g,i(_,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:h,configurable:!0}),h.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,s,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},y(S.prototype),l(S.prototype,o,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new S(c(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(_),l(_,s,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=w,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;T(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:w(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function Zo(e,t,n,i,r,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,r)}function Yo(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){Zo(a,i,r,o,s,"next",e)}function s(e){Zo(a,i,r,o,s,"throw",e)}o(void 0)}))}}function $o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return es(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return es(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function es(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ts(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ns=function(){function e(e,t){this._operations=new Go,this._operationsAdded=0,this._operationsRemoved=0,this._requestId=0,this._cancelled=!1,this._hasResponse=!1,this._responseTime=null,this.invokedCallback=null,this._priority=e,this._onServerResponse=t,this.operationName="generic"}var t,n,i,a=e.prototype;return a.addOperation=function(e){e.id=++this._operationsAdded,e.batchedOperation=this,this._operations.set_item(this._operationsAdded,e)},a.removeOperation=function(e){this._operations.remove(e.id),e.id=0,e.batchedOperation=null,this._operationsRemoved++},a.dispatchRequest=function(e){void 0===e&&(e=null);var t=Xo.construct(this._operations,this.mode);if(t){var n=this.getRequestQueueTimeoutMs(),i=this.getRequestTimeoutMs(t.length),r=this.buildTargetUrl();0;var a={};this.addRequestHeaders(a);var o=e?e(this._operations):void 0;this._requestId=s.AFrameworkApplication.theClientRequestManager.addRequestWithHeaderForwarding(r,2,t,a,[],!1,this._priority,Object(A.a)(this,this.onSuccess,"onSuccess"),Object(A.a)(this,this.onFailure,"onFailure"),null,void 0,!1,n,i,No.batchedOperation+"_"+this.operationName,void 0,this.shouldProcessResponseSynchronously,void 0,void 0,o,this.invokedCallback);for(var l,c=$o(this._operations);!(l=c()).done;){l.value.value.roundtripId=this._requestId}this._requestId}},a.sendBatchRequestAsync=function(){var e=Yo(Qo().mark((function e(t){var n,i,r,a,o;return Qo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Xo.construct(this._operations,this.mode)){e.next=4;break}return e.abrupt("return");case 4:return i=this.getRequestTimeoutMs(n.length),r=this.buildTargetUrl(),a={},this.addRequestHeaders(a),e.next=11,t({url:r,verb:2,body:n,headers:a,sentTimeoutMs:i,name:No.batchedOperation+"_"+this.operationName});case 11:o=e.sent,this.onSuccessOrFailure(o,2===o.status);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.buildTargetUrl=function(){for(var e,t=this.webServiceBase+this.serviceName,n=new K.QueryStringBuilder(t),i=new xe.a,r=$o(this._operations);!(e=r()).done;){var a=e.value,o=a.value&&a.value.perfTag&&""!==a.value.perfTag?a.value.perfTag:"Unknown",s=i.tryGetValue(o,0).value;if(i.set_item(o,s+1),a.value&&a.value.queryParameters.count>0)for(var l,c=$o(a.value.queryParameters);!(l=c()).done;){var u=l.value;n.addParam(u.key,u.value)}}for(var d,p=new Sys.StringBuilder,h=!0,g=$o(i);!(d=g()).done;){var m=d.value;h||p.append(";"),h=!1,p.append(m.key),p.append("_"),p.append(m.value)}var f=p.toString();return n.addParam("perfTag",f),n.toString()},a.dispatchShutdownRequest=function(){var e=Xo.construct(this._operations,this.mode);if(e){var t=this.webServiceBase+this.serviceName;0;for(var n,i=$o(this._operations);!(n=i()).done;)n.value;s.AFrameworkApplication.theClientRequestManager.sendShuttingDownRequest(t,e)}},a.sendShutdownRequestAsync=function(){var e=Yo(Qo().mark((function e(t){var n,i,r,a;return Qo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Xo.construct(this._operations,this.mode)){e.next=4;break}return e.abrupt("return");case 4:for(i=this.buildTargetUrl(),r=$o(this._operations);!(a=r()).done;)a.value;return e.abrupt("return",t({url:i,body:n}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.createBootstrapResponse=function(){var e,t=null;if(1!==this.operationCount||!(e=this._operations.tryGetValue(this.operationCount,t),t=e.value,e).returnValue||!t||1!==t.requestObject.getClassId())return this.dispatchRequest(),null;var n=(new Date).getTime();zt.a.instance.addMetric(Kt.a.parseResponseStart,n),Xt.a.instance.addMark(Kt.a.parseResponseStart),this._requestId=s.AFrameworkApplication.theClientRequestManager.getNextRequestIdAndIncrement();var i=new Wo.a(this._requestId,0,null,null,!1,null,null,null);return i.status=2,this._hasResponse=!0,i},a.processBootstrapResponse=function(e){1===e.status&&r.ULS.sendTraceTag(42022656,306,15,"BootstrapRequest still executing"),this.parseServerResponse(e),this._onServerResponse&&this._onServerResponse(this)},a.prepareBootstrapResponse=function(){var e=this.createBootstrapResponse();e&&this.processBootstrapResponse(e)},a.cancel=function(){this._cancelled=!0,s.AFrameworkApplication.theClientRequestManager.abortRequest(this._requestId)},a.onSuccess=function(e){this.onSuccessOrFailure(e.data,!0)},a.onFailure=function(e){this.onSuccessOrFailure(e.data,!1)},a.onSuccessOrFailure=function(e,t){this._cancelled||(this._hasResponse=!0,this._responseTime=new Date,e&&1===e.status&&(t?r.ULS.sendTraceTag(541411098,306,15,"Successful request still executing"):r.ULS.sendTraceTag(541411099,306,15,"Failed request still executing")),this.parseServerResponse(e),this._onServerResponse&&this._onServerResponse(this))},a.getRequestTimeoutMs=function(e){return null},a.getRequestQueueTimeoutMs=function(){return null},a.parseServerResponse=function(e){var t=(e.responseHeaders?e.responseHeaders[jo.a.correlationIdHeaderName]:"")||this.correlation,n=null;e.responseObject?n=Jo.a.fromServerResponseObject(e.responseObject):n=Jo.a.tryDeserializeServerResponse(e.responseData).group;if(n)for(var i=0;i<n.Responses.length;i++){var a=n.Responses[i];0,a.requestInvokedTime=e.invokedTime,a.requestInvokedTimeTicks=e.invokedTimeTicks,a.requestCompletedTimeTicks=e.completedTimeTicks,a.correlation=t;var o=null;null!=(o=this._operations.tryGetValue(a.OperationId,o).value)&&o.addResponse(a)}else r.ULS.sendTraceTag(42022663,306,15,"Couldn't deserialize server response {0}",{Correlation:t,HttpStatus:e.httpStatus,Id:e.id,RequestEnqueueTime:e.enqueueTime?e.enqueueTime.getTime().toString():"NULL",RequestInvokedTime:e.invokedTime?e.invokedTime.getTime().toString():"NULL",RequestCompletedTime:e.completedTime?e.completedTime.getTime().toString():"NULL"});for(var s,l=$o(this._operations);!(s=l()).done;){var c=s.value.value;c.status=2,c.statusCode=e.status,c.corrrelation=t,c.httpStatusCode=e.httpStatus,c.requestEnqueueTime=e.enqueueTime,c.invokedTime=e.invokedTime,c.invokedTimeTicks=e.invokedTimeTicks,c.completedTime=e.completedTime,c.completedTimeTicks=e.completedTimeTicks}},a.addRequestHeaders=function(e){e["Content-Type"]="application/json; charset=utf-8";for(var t,n=$o(this._operations);!(t=n()).done;){var i=t.value.value;if(i.httpHeaders)for(var r,a=$o(i.httpHeaders);!(r=a()).done;){var o=r.value;e[o.key]=o.value}}},t=e,(n=[{key:"operations",get:function(){return this._operations}},{key:"operationCount",get:function(){return this._operationsAdded-this._operationsRemoved}},{key:"shouldProcessResponseSynchronously",get:function(){return!1}},{key:"hasResponse",get:function(){return this._hasResponse}},{key:"responseTime",get:function(){return this._responseTime},set:function(e){this._responseTime=e}},{key:"correlation",get:function(){return""}}])&&ts(t.prototype,n),i&&ts(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function is(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return rs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rs(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function rs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function as(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function os(e,t){return(os=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ns,"ABatchedServerOperation",null,[135]);var ss=function(e){var t,n;function i(t,n,i,r,a,o,s,l){var c;return void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),(c=e.call(this,t,n)||this).serviceName=i,c.mode=r,c.webServiceBase=a,c.amIAlone=o,c.responseTimeFetcher=s,c.requestItemProcessor=l,c}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,os(t,n);var r,a,o,s=i.prototype;return s.prepareBootstrapResponse=function(){var e=this.createBootstrapResponse();e&&(this.requestItemProcessor&&this.requestItemProcessor(e),this.responseTimeFetcher&&(this.responseTime=this.responseTimeFetcher()),this.processBootstrapResponse(e))},s.getRequestTimeoutMs=function(e){return 6e4},s.getRequestQueueTimeoutMs=function(){return 6e4},r=i,(a=[{key:"shouldProcessResponseSynchronously",get:function(){if(!this.amIAlone||this.amIAlone())return!1;for(var e,t=is(this.operations);!(e=t()).done;){var n=e.value.value;if(n){var i=n.requestObject;if(i&&(2===i.getClassId()||3===i.getClassId()))return!0}}return!1}}])&&as(r.prototype,a),o&&as(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(ns);Object(i.a)(ss,"BatchedServerOperation",ns,[135]);var ls=function(){function e(){}return e.prototype.getBatchedServerOperation=function(e,t){return new ss(e,t,"Comments.ashx",Or.App.mode,Or.App.webServiceBase)},e}();Object(i.a)(ls,"BatchedServerOperationFactory",null,[153]);var cs=n(346),us=n(30),ds=n(390),ps=function(){this.OperationId=0,this.DependentOn=0};function hs(e,t){return(hs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ps,"AServerRequest",null,[]);var gs=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.DocNormal=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,hs(t,n),i.prototype.getClassId=function(){return ds.a.beginCommenting},i.construct=function(e,t){var n=new i;return n.FileId=e,n.SharedLock=!1,n.DocNormal=t,n},i}(ps);function ms(e,t){return(ms=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(gs,"BeginCommentingRequest",ps,[]);var fs=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ms(t,n),i.prototype.getClassId=function(){return ds.a.endCommenting},i.construct=function(e,t){var n=new i;return n.FileId=e,n.SharedLock=t,n},i}(ps);Object(i.a)(fs,"EndCommentingRequest",ps,[]);var vs=n(322),_s=n(167),ys=n(367),Ss=n(652),bs=n(663),As=n(619),Cs=n(155);function Ts(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ks=function(){function e(t,n,i,r,a){var o=this;void 0===a&&(a=!0),this._commentIds=[],this._zoomControl=null,this.onHintClick=function(e){var t=new As.a(null,e.inputSource);return s.AFrameworkApplication.theActionManager.processActionWithData(p.a.showCommentPane,2,t),Do.a.instance.selectComment(o._commentIds[0]),s.AFrameworkApplication.theActionManager.processAction(p.a.commentHintClick,2),!0},this.onMouseOver=function(e){return o._imageElement.className=na.getImageClass("CommentHintHover_16x16x32"),!0},this.onMouseExit=function(e){return o._imageElement.className=na.getImageClass("CommentHint_16x16x32"),!0},this._pageNumber=n,this._top=i,this._commentIds.push(r),this._hintElement=document.createElement("span"),this._hintElement.className="CommentHint",this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,"1");var l=na.createClusteredImage(16,16,"CommentHint_16x16x32","",!0,CommonUIStrings.l_CommentHintTooltip);this._hintElement.appendChild(l),t.appendChild(this._hintElement),this._imageElement=l.firstChild,this.positionHint(a),Or.App.get_activeAppFrame().theClickInputManager.registerHandler(m.a.click,this._hintElement,this.onHintClick);var c=Or.App.get_activeAppFrame().theMouseInputManager;c.registerHandler(m.a.mouseOver,this._imageElement,this.onMouseOver,null),c.registerHandler(m.a.mouseOut,this._imageElement,this.onMouseExit,null)}var t,n,i,r=e.prototype;return r.repurposeFor=function(t,n,i,r){void 0===r&&(r=!0),this._pageNumber=t,this._top=n,Array.clear(this._commentIds),this._commentIds.push(i),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,"1"),this.positionHint(r)},r.dispose=function(){Or.App.get_activeAppFrame().theClickInputManager.unregisterHandler(m.a.click,this._hintElement,this.onHintClick),this._hintElement=null;var e=Or.App.get_activeAppFrame().theMouseInputManager;e.unregisterHandler(m.a.mouseOver,this._imageElement,this.onMouseOver),e.unregisterHandler(m.a.mouseOut,this._imageElement,this.onMouseExit),this._imageElement=null},r.registerForComment=function(t){this._commentIds.push(t),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,String.format("{0}",this._commentIds.length)),this._commentIds.sort()},r.unregisterCommentAndCheckValidity=function(t){return Array.remove(this._commentIds,t),this._hintElement.setAttribute(e.COUNT_ATTRIBUTE,String.format("{0}",this._commentIds.length)),!!this._commentIds.length||(this.removeFromView(),!1)},r.removeFromView=function(){this._hintElement.parentNode.removeChild(this._hintElement)},r.positionHint=function(t){void 0===t&&(t=!0);var n=this.zoomControl.currentZoom,i=xa.a.instance.getPageTopAtZoom(this._pageNumber,n)+Math.round(this._top*n),r=0;r=s.AFrameworkApplication.isRtl?e.HINT_OVERLAP-e.HINT_WIDTH+xa.a.instance.getPageLeftAtZoom(this._pageNumber,n,!1):xa.a.instance.getPageWidthAtZoom(this._pageNumber,n)-e.HINT_OVERLAP+xa.a.instance.getPageLeftAtZoom(this._pageNumber,n,!1),t?Cs.a.animateCommentHintPosition(this._hintElement,i,r):(Lr.a.setElementStyleLeftInPixels(this._hintElement,r),Lr.a.setElementStyleTopInPixels(this._hintElement,i))},t=e,(n=[{key:"top",get:function(){return this._top}},{key:"pageNumber",get:function(){return this._pageNumber}},{key:"commentIds",get:function(){return this._commentIds}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=Q.a.instance.resolve("WordViewer.Controls.IZoomControl"))}}])&&Ts(t.prototype,n),i&&Ts(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();ks.HINT_OVERLAP=22,ks.HINT_WIDTH=16,ks.HINT_HEIGHT=16,ks.COUNT_ATTRIBUTE="count",Object(i.a)(ks,"CommentHint",null,[10]);var ws=n(658);function Is(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ps=function(){function e(t,n){this._startKnown=!1,this._isEmpty=!1,this._currentFoundStartPage=0,this._currentFoundStartTextrunId=e.ID_UNKNOWN,this._currentFoundEndTextrunId=e.ID_UNKNOWN,this._anchorBoxes=[],this._anchorPageNumbers=[],this._commentId=t,this._pageNumber=n}var t,n,i,r=e.prototype;return r.trySetSingleBoxAnchorFromNode=function(t,n){var i,r;return!!(i=e.tryCreateBox(t),r=i.newBox,i).returnValue&&(this._anchorBoxes.push(r),this._anchorPageNumbers.push(n),!0)},r.insertBoxRange=function(e,t){if(!(t.length<1)){for(var n=t[0],i=[],r=[],a=0;a<this._anchorPageNumbers.length&&!(n<this._anchorPageNumbers[a]);)i.push(this._anchorBoxes[a]),r.push(this._anchorPageNumbers[a]),a++;for(i.push.apply(i,e),r.push.apply(r,t);a<this._anchorPageNumbers.length;a++)i.push(this._anchorBoxes[a]),r.push(this._anchorPageNumbers[a]);this._anchorBoxes=i,this._anchorPageNumbers=r}},r.cloneFor=function(t){var n=new e(t,this._pageNumber);return n._anchorBoxes=Array.clone(this._anchorBoxes),n._anchorPageNumbers=Array.clone(this._anchorPageNumbers),n._startKnown=this._startKnown,n._isEmpty=this._isEmpty,n},e.tryCreateBox=function(t){var n=null,i=parseFloat(wo.a.parseXmlAttribute(t,"l")),r=parseFloat(wo.a.parseXmlAttribute(t,"t")),a=parseFloat(wo.a.parseXmlAttribute(t,"w")),o=parseFloat(wo.a.parseXmlAttribute(t,"h"));return isNaN(i)||isNaN(r)||isNaN(a)||isNaN(o)?{returnValue:!1,newBox:n}:(a<8&&(a=8),o<e.MINIMUM_BOX_HEIGHT&&(o=e.MINIMUM_BOX_HEIGHT),{returnValue:!0,newBox:n=new ws.a(i,r,a,o)})},e.compare=function(e,t){var n=e,i=t;if(!n.isStartKnown||!i.isStartKnown)return 0;var r=n.anchorPageNumbers[0],a=i.anchorPageNumbers[0];if(r!==a)return r-a;var o=n.anchorBoxes[0],s=i.anchorBoxes[0];return o.top===s.top?0:o.top<s.top?-1:1},t=e,(n=[{key:"commentId",get:function(){return this._commentId}},{key:"firstPageNumber",get:function(){return this._pageNumber}},{key:"isStartKnown",get:function(){return this._startKnown},set:function(e){this._startKnown=e}},{key:"isEmpty",get:function(){return this._isEmpty},set:function(e){this._isEmpty=e}},{key:"needsProcessing",get:function(){return this.currentFoundStartTextrunId!==e.ID_UNKNOWN||this.currentFoundEndTextrunId!==e.ID_UNKNOWN}},{key:"currentFoundStartPage",get:function(){return this._currentFoundStartPage},set:function(e){this._currentFoundStartPage=e}},{key:"currentFoundStartTextrunId",get:function(){return this._currentFoundStartTextrunId},set:function(e){this._currentFoundStartTextrunId=e}},{key:"currentFoundEndTextrunId",get:function(){return this._currentFoundEndTextrunId},set:function(e){this._currentFoundEndTextrunId=e}},{key:"anchorBoxes",get:function(){return this._anchorBoxes}},{key:"anchorPageNumbers",get:function(){return this._anchorPageNumbers}}])&&Is(t.prototype,n),i&&Is(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Fs(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ps.ID_UNKNOWN=-1,Ps.MINIMUM_BOX_HEIGHT=10,Object(i.a)(Ps,"ViewerAnchorInfo",null,[165]);var Es=function(){function e(){var e=this;this._scrollerElement=null,this._commentToViewerAnchorInfo={},this._commentToHint={},this._unhintedComments=[],this._hints=[],this._activeHighlights=[],this._pagesAlreadyParsed={},this._anchorWaitingToHighlight=null,this._commentCurrentlyHighlighted=null,this._waitingToScrollToComment=!1,this._zoomControl=null,this._scrollControl=null,this.delayedHighlightTimer=function(t){e._anchorWaitingToHighlight&&e.highlightAndScrollToAnchor(e._anchorWaitingToHighlight,t.customData)},this.onWindowResize=function(){e.repositionHints(),e._commentCurrentlyHighlighted&&Ss.a.instance.needsManualRepositioning&&e.highlightComment(e._commentCurrentlyHighlighted,!1)},this.onRebuildCommentHints=function(t,n,i,r,a){return e.rebuildCommentHints(i,!0)},this.onRebuildCommentHintsWithoutAnimation=function(t,n,i,r,a){return e.rebuildCommentHints(i,!1)},this.onUpdateCommentHighlight=function(t,n,i,r,a){return 1===i||e._commentCurrentlyHighlighted&&e.highlightComment(e._commentCurrentlyHighlighted,!1),32},this.onXmlPageDownloaded2=function(t,n,i,r,a){if(1===i)return 32;e._initialCommentDataTask&&(s.AFrameworkApplication.theTaskManager.deleteTask(e._initialCommentDataTask),e._initialCommentDataTask=null);var o=a;return e.parseSelectionXmlForCommentData(o),e.createHints(),32},this.loadInitialSelectionXml=function(t){e._initialCommentDataTask=null;var n=Or.App.get_activeAppFrame().workspace.getCurrentPage();if(Or.App.get_activeAppFrame().thePageInfoCache.isPageCached(n)){var i=wo.a.getPageSetFromPage(n),r=new ys.a(wo.a.getStartPageFromPageSetXml(i),wo.a.getEndPageFromPageSetXml(i));e.parseSelectionXmlForCommentData(r),e.createHints()}},Or.App.instance.isSmallView||s.AFrameworkApplication.isNoChrome||(this._highlightWhenPageLoadedTask=new u.a(3,1,Or.App.instance.theConfig.highlightTaskDelay,this.delayedHighlightTimer),s.AFrameworkApplication.theActionManager.addActionWithFlags(Nr.a.xmlPageDownloaded2,La.a.application,this.onXmlPageDownloaded2,64),s.AFrameworkApplication.theActionManager.addActionWithFlags(Nr.a.rebuildCommentHints,La.a.application,this.onRebuildCommentHints,96),s.AFrameworkApplication.theActionManager.addActionWithFlags(Nr.a.rebuildCommentHintsWithoutAnimation,La.a.application,this.onRebuildCommentHintsWithoutAnimation,96),s.AFrameworkApplication.theActionManager.addActionWithFlags(Nr.a.updateCommentHighlight,La.a.application,this.onUpdateCommentHighlight,64),Or.App.get_activeAppFrame().add_onResize(this.onWindowResize),this._initialCommentDataTask=new u.a(3,1,1e3,this.loadInitialSelectionXml),s.AFrameworkApplication.theTaskManager.addTask(this._initialCommentDataTask))}var t,n,i,a=e.prototype;return a.initialize=function(e){this._scrollerElement=e},a.dispose=function(){this.removeCurrentHighlights();for(var e=0;e<this._hints.length;e++)this._hints[e].dispose();this._hints=[],this._commentToHint={},this._commentToViewerAnchorInfo={},this._unhintedComments=[],this._activeHighlights=[],this._commentCurrentlyHighlighted=null,Or.App.get_activeAppFrame().remove_onResize(this.onWindowResize)},a.highlightComment=function(e,t){this._commentCurrentlyHighlighted!==e&&(this._commentCurrentlyHighlighted=e,this._waitingToScrollToComment=!1,this._anchorWaitingToHighlight&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._highlightWhenPageLoadedTask),this._anchorWaitingToHighlight=null));var n=this._commentToViewerAnchorInfo[e.id];n&&n.isStartKnown?(this._waitingToScrollToComment=!1,this.highlightAndScrollToAnchor(n,t)):t&&(this.scrollControl.scrollToPage(e.groupNumber),this._waitingToScrollToComment=!0,this.removeCurrentHighlights())},a.clearHighlighting=function(){this.removeCurrentHighlights(),this._commentCurrentlyHighlighted=null,this._anchorWaitingToHighlight=null,this._waitingToScrollToComment=!1},a.removeCurrentHighlights=function(){for(var e=0;e<this._activeHighlights.length;e++){var t=this._activeHighlights[e];Ss.a.instance.removeFromParent(t)}this._activeHighlights=[]},a.createAnchorForSelectedParagraphs=function(t){var n=null,i=null,r=Fo.a.instance.selectionStart,a=Fo.a.instance.selectionEnd;if(r&&a||(r=Fo.a.instance.previousSelectionStart,a=Fo.a.instance.previousSelectionEnd),!r||!a){var o=Mo.SearchManager.instance,s=o?o.currentSelectedResult:null;if(s&&s.result){var l=s.result.page,c=s.result.paragraphTextrunId,u=Or.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(l);if(!u)return{returnValue:1,anchor:n};var d=u.selectSingleNode(e.getXPathForTextrun(l,c));if(!d)return{returnValue:1,anchor:n};r=new bs.a(null,d),a=new bs.a(null,d)}}if(!r||!a)return{returnValue:1,anchor:n};var p=Or.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(r.page).selectSingleNode(e.getXPathForTextrun(r.page,r.id));var h=p.selectSingleNode("preceding-sibling::T[last()]")||p,g=p.selectSingleNode("ancestor::P");var m=Or.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(a.page).selectSingleNode(e.getXPathForTextrun(a.page,a.id));var f=m.selectSingleNode("following-sibling::T[last()]")||m,v=m.selectSingleNode("ancestor::P");if(!e.isCommentablePara(g)||!e.isCommentablePara(v))return{returnValue:2,anchor:n};(i=new Ps(t.id,r.page)).currentFoundStartTextrunId=parseInt(wo.a.parseXmlAttribute(h,"id")),i.currentFoundEndTextrunId=parseInt(wo.a.parseXmlAttribute(f,"id")),i.currentFoundStartPage=r.page,i.isStartKnown=!0,t.anchorStartId=wo.a.parseXmlAttribute(g,"id"),t.anchorEndId=wo.a.parseXmlAttribute(v,"id");var _=[];return _.push(i),this.parseAnchorLocations(_),this._commentToViewerAnchorInfo[t.id]=i,this._unhintedComments.push(t.id),this.createHints(),{returnValue:0,anchor:n=i}},a.createAnchorForReply=function(e){var t=this._commentToViewerAnchorInfo[e.replyToId];if(t){var n=t.cloneFor(e.id);this._commentToViewerAnchorInfo[e.id]=n}},a.commentsDeleted=function(e){for(var t=0;t<e.length;t++){var n=e[t];this._commentToViewerAnchorInfo[n.id]=null;var i=this._commentToHint[n.id];i?i.unregisterCommentAndCheckValidity(n.id)||(Array.remove(this._hints,i),i.dispose(),this._commentToHint[n.id]=null):Array.contains(this._unhintedComments,n.id)&&Array.remove(this._unhintedComments,n.id)}},a.getAnchorForComment=function(e){return this._commentToViewerAnchorInfo[e.id]},a.parseSelectionXmlForCommentData=function(t){for(var n=[],i=t.firstPage;i<=t.lastPage;i++)if(!this._pagesAlreadyParsed[i.toString()]){0;var r=Or.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(i);if(r){if(i===t.firstPage){var a=r.selectNodes(e.getXPathForCommentContinueNodes(i));0,this.parseCommentContinues(i,r,a,n)}var o=r.selectNodes(e.getXPathForCommentBeginNodes(i));0,this.parseCommentMarkers(i,o,!0,n);var s=r.selectNodes(e.getXPathForCommentEndNodes(i));if(this.parseCommentMarkers(i,s,!1,n),this._pagesAlreadyParsed[i.toString()]=!0,i===t.lastPage)for(var l=Ps.ID_UNKNOWN,c=0;c<n.length;c++){var u=n[c];if(!u.isEmpty&&u.currentFoundEndTextrunId===Ps.ID_UNKNOWN){if(l===Ps.ID_UNKNOWN){var d=r.selectSingleNode(e.getXPathForLastTextrun(i));l=parseInt(wo.a.parseXmlAttribute(d,"id"))}u.currentFoundEndTextrunId=l}}}}if(this.parseAnchorLocations(n),this._commentCurrentlyHighlighted)for(var p=0;p<n.length;p++)if(this._commentCurrentlyHighlighted.id===n[p].commentId){0,this.highlightComment(this._commentCurrentlyHighlighted,this._waitingToScrollToComment);break}},a.parseCommentMarkers=function(e,t,n,i){for(var r=t.length,a=0;a<r;a++){var o=t[a],s=this.createViewerAnchorInfo(o,e,n);i.push(s)}},a.parseCommentContinues=function(t,n,i,r){if(i.length){var a=n.selectSingleNode(e.getXPathForFirstTextrun(t)),o=parseInt(wo.a.parseXmlAttribute(a,"id"));0;for(var s=i.length,l=0;l<s;l++){var c=i[l],u=wo.a.parseXmlAttribute(c,"id");0;var d=this.ensureAnchorForComment(t,u);d.currentFoundStartTextrunId=o,d.currentFoundStartPage=t,r.push(d)}}},a.createViewerAnchorInfo=function(t,n,i){var r=wo.a.parseXmlAttribute(t,"id");var a=this.ensureAnchorForComment(n,r);if(a.isEmpty)return a;for(var o=!1,s=t;s=i?s.nextSibling:s.previousSibling;){if("T"===s.nodeName){o=!0;var l=parseInt(wo.a.parseXmlAttribute(s,"id"));if(i){if(a.currentFoundStartTextrunId!==Ps.ID_UNKNOWN)return a;a.currentFoundStartTextrunId=l,a.currentFoundStartPage=n,a.isStartKnown=!0}else{if(a.currentFoundEndTextrunId!==Ps.ID_UNKNOWN)return a;a.currentFoundEndTextrunId=l}break}if(i&&"CE"===s.nodeName){if(r!==wo.a.parseXmlAttribute(s,"id"))continue;a.trySetSingleBoxAnchorFromNode(s,n)&&(o=!0,a.isEmpty=!0,a.isStartKnown=!0,a.currentFoundStartPage=n);break}i||s.nodeName!==e.COMMENT_BEGIN_NODENAME||wo.a.parseXmlAttribute(s,"id")}if(!o)if(i);else{for(s=t;s=s.nextSibling;)if("T"===s.nodeName){o=!0;var c=parseInt(wo.a.parseXmlAttribute(s,"id"));0,a.currentFoundEndTextrunId=c-1;break}0}return a},a.ensureAnchorForComment=function(e,t){var n=this._commentToViewerAnchorInfo[t];return n||(n=new Ps(t,e),this._commentToViewerAnchorInfo[t]=n,this._unhintedComments.push(t)),n},a.parseAnchorLocations=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.needsProcessing&&!i.isEmpty)if(i.currentFoundStartTextrunId!==Ps.ID_UNKNOWN)if(i.currentFoundEndTextrunId!==Ps.ID_UNKNOWN){if(!(i.currentFoundStartPage<=0)){var a=i.currentFoundStartPage,o=Or.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(a);0;for(var s=[],l=[],c=i.currentFoundStartTextrunId;c<=i.currentFoundEndTextrunId;c++){var u,d=null;do{if(d=o.selectSingleNode(e.getXPathForTextrun(a,c)))break;if(a++,!(o=Or.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(a))){0;break}}while(!d);if(!d){0;break}if("P"===d.parentNode.nodeName&&e.isMainDocumentContent(d.parentNode)){var p;(u=Ps.tryCreateBox(d),p=u.newBox,u).returnValue&&(s.push(p),l.push(a))}}s.length&&i.insertBoxRange(s,l),i.currentFoundStartPage=0,i.currentFoundEndTextrunId=Ps.ID_UNKNOWN,i.currentFoundStartTextrunId=Ps.ID_UNKNOWN}}else r.ULS.shipAssertTag(4468766,301,!1,"If we're trying to process a comment, we should always know where it ends.");else r.ULS.shipAssertTag(4468765,301,!1,"If we're trying to process a comment, we should always know where it starts.")}},a.createHints=function(){for(var e=this.zoomControl.currentZoom,t=0;t<this._unhintedComments.length;){var n=this._unhintedComments[t],i=this._commentToViewerAnchorInfo[n];if(i.isStartKnown)if(i.anchorBoxes.length){0;for(var r=i.anchorBoxes[0].top,a=i.anchorPageNumbers[0],o=null,s=0;s<this._hints.length;s++){var l=this._hints[s];if(!(a>l.pageNumber)){if(a<l.pageNumber){o=new ks(this._scrollerElement,a,r,i.commentId),Array.insert(this._hints,s,o);break}var c=(r-l.top)*e;if(!(c>=ks.HINT_HEIGHT)){if(Math.abs(c)<ks.HINT_HEIGHT){(o=l).registerForComment(n);break}if(c<0){o=new ks(this._scrollerElement,a,r,i.commentId),Array.insert(this._hints,s,o);break}0}}}o||(o=new ks(this._scrollerElement,a,r,i.commentId),this._hints.push(o)),this._commentToHint[i.commentId]=o,Array.removeAt(this._unhintedComments,t)}else Array.removeAt(this._unhintedComments,t);else t++}},a.ensureAnchorIsVisible=function(t,n){var i=this.zoomControl.currentZoom,r=this.scrollControl.getScrollTop(),a=r+this.scrollControl.getClientHeight(),o=this.scrollControl.getScrollLeft(),l=o+this.scrollControl.getWidth(),c=xa.a.instance.getPageTopAtZoom(n,i),u=xa.a.instance.getPageLeftAtZoom(n,i,!1),d=Math.round(c+t.top*i),p=d+Math.round(t.height*i),h=Math.round(u+t.left*i),g=Number.NaN,m=Number.NaN;if((r>d||a<p)&&(g=d-40),(o>h||l<h)&&(m=h-e.ANCHOR_SCROLL_SIDE_MARGIN),!isNaN(g)||!isNaN(m)){var f=new _s.a(g,m);s.AFrameworkApplication.theActionManager.processActionWithData(Nr.a.repositionScroller,2,f),Or.App.instance.isBroadcastMode&&s.AFrameworkApplication.theActionManager.processActionWithData(Nr.a.broadcastOnScroll,2,new vs.a(n,f,2))}},a.repositionHints=function(e){void 0===e&&(e=!0);for(var t=[],n=0;n<this._hints.length;n++){var i=this._hints[n];t.push.apply(t,i.commentIds)}for(var r=[],a=new Array(t.length),o=0;o<t.length;o++)a[o]=this._commentToViewerAnchorInfo[t[o]];a.sort(Ps.compare);for(var s=this.zoomControl.currentZoom,l=0,c=null,u=0;u<a.length;u++){var d=a[u],p=d.anchorBoxes[0];if(!c||c.pageNumber!==d.firstPageNumber||l<p.top*s){var h=void 0;this._hints.length>0?(h=this._hints[0],Array.removeAt(this._hints,0),h.repurposeFor(d.anchorPageNumbers[0],p.top,d.commentId,e)):h=new ks(this._scrollerElement,d.anchorPageNumbers[0],p.top,d.commentId,e),r.push(h),c=h,l=p.top*s+ks.HINT_HEIGHT,this._commentToHint[d.commentId]=h}else c.registerForComment(d.commentId),this._commentToHint[d.commentId]=c}for(var g=0;g<this._hints.length;g++){var m=this._hints[g];m.removeFromView(),m.dispose()}this._hints=r},a.highlightAndScrollToAnchor=function(t,n){this.removeCurrentHighlights();var i=this.zoomControl.currentZoom;for(var r=0;r<t.anchorBoxes.length;r++){var a=t.anchorBoxes[r],o=t.anchorPageNumbers[r];if(Ss.a.instance.isPageLoaded(o)){var l=Ss.a.instance.drawRectangle(a,3,e.makeHighlightId(r),o);l.setPosition(l.box,l.page,i),this._activeHighlights.push(l)}else if(!r&&n)return this._anchorWaitingToHighlight=t,this._highlightWhenPageLoadedTask.customData=n,s.AFrameworkApplication.theTaskManager.addTask(this._highlightWhenPageLoadedTask),void this.ensureAnchorIsVisible(a,o)}this._anchorWaitingToHighlight=null,n&&this._activeHighlights.length>0&&this.ensureAnchorIsVisible(this._activeHighlights[0].box,t.anchorPageNumbers[0])},a.rebuildCommentHints=function(e,t){return void 0===t&&(t=!0),1===e||this.repositionHints(t),32},e.getInstance=function(){return e.getInstanceWithResolvedDependencies()},e.getInstanceWithResolvedDependencies=function(){return new e},e.makeHighlightId=function(e){return"hi_"+e},e.getXPathForCommentBeginNodes=function(t){return String.format("/Pages/Page[@id='{0}']/descendant::P/"+e.COMMENT_BEGIN_NODENAME,t)},e.getXPathForCommentEndNodes=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::P/CE",e)},e.getXPathForCommentContinueNodes=function(e){return String.format("/Pages/Page[@id='{0}']/CC",e)},e.getXPathForTextrun=function(e,t){return String.format("/Pages/Page[@id='{0}']//T[@id='{1}']",e,t)},e.getXPathForFirstTextrun=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::T[1]",e)},e.getXPathForLastTextrun=function(e){return String.format("/Pages/Page[@id='{0}']/descendant::T[last()]",e)},e.isMainDocumentContent=function(e){return 1===parseInt(wo.a.parseXmlAttribute(e,"storyId"))},e.isCommentablePara=function(t){return!!e.isMainDocumentContent(t)&&(!t.firstChild||"CN"!==t.firstChild.nodeName)},t=e,(n=[{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=Q.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=Q.a.instance.resolve("WordViewer.Controls.IScrollControl"))}}])&&Fs(t.prototype,n),i&&Fs(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Es.ANCHOR_SCROLL_SIDE_MARGIN=40,Es.COMMENT_BEGIN_NODENAME="CB",Object(i.a)(Es,"ViewerCommentHintManager",null,[145,10]);var Os=n(654),Ms=n(661);function Ls(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rs=function(){function e(e,t){this._retriesLeft=5,this._comment=e,this._changeType=t,this._status=0}var t,n,i;return e.prototype.toString=function(){return String.format("Type:{0} State:{1} Com:[{2}] R:[{3}]",this._changeType,this._status,this._comment.toString(),this._retriesLeft)},t=e,(n=[{key:"comment",get:function(){return this._comment}},{key:"changeType",get:function(){return this._changeType},set:function(e){this._changeType=e}},{key:"status",get:function(){return this._status},set:function(e){this._status=e,this._comment.saveState=e}},{key:"retriesLeft",get:function(){return this._retriesLeft},set:function(e){this._retriesLeft=e}}])&&Ls(t.prototype,n),i&&Ls(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ds(e,t){return(Ds=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Rs,"CommentSaveRecord",null,[]);var xs=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.CommId=null,t.Time=0,t.Text=null,t.GuardParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ds(t,n),i.prototype.getClassId=function(){return ds.a.addCommentReply},i.construct=function(e,t,n,r,a,o){var s=new i;return s.FileId=e,s.GuardParaId=n,s.Time=r,s.Text=t,s.SharedLock=a,s.CommId=o,s},i}(ps);function Bs(e,t){return(Bs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(xs,"AddCommentReplyRequest",ps,[]);var Us=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.CommId=null,t.Time=0,t.Text=null,t.StartParaId=null,t.EndParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Bs(t,n),i.prototype.getClassId=function(){return ds.a.addComment},i.construct=function(e,t,n,r,a,o,s){var l=new i;return l.FileId=e,l.StartParaId=n,l.EndParaId=r,l.Time=a,l.Text=t,l.SharedLock=o,l.CommId=s,l},i}(ps);function Hs(e,t){return(Hs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Us,"AddCommentRequest",ps,[]);var Ns=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.GuardParaId=null,t.Done=!1,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Hs(t,n),i.prototype.getClassId=function(){return ds.a.changeCommentDoneStatus},i.construct=function(e,t,n,r){var a=new i;return a.FileId=e,a.GuardParaId=t,a.Done=n,a.SharedLock=r,a},i}(ps);function Ws(e,t){return(Ws=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ns,"ChangeCommentDoneStatusRequest",ps,[]);var js=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t.SharedLock=!1,t.GuardParaId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ws(t,n),i.prototype.getClassId=function(){return ds.a.deleteComment},i.construct=function(e,t,n){var r=new i;return r.FileId=e,r.GuardParaId=t,r.SharedLock=n,r},i}(ps);function Vs(e,t){return(Vs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(js,"DeleteCommentRequest",ps,[]);var qs=function(e){var t,n;function i(){var t;return(t=e.call(this)||this)._pendingSaves=[],t._serverOpToSaveRecord={},t._autosaveTask=null,t._onBeforeNavigateWebkitString=null,t._retryingBadCanary=!1,t._maxCommentsPerBatch=20,t._batchedOperationFactory=new ls,t.delayedSaveTimer=function(e){t._autosaveTask=null,t.saveSoonerOrLater()},t.saveCommentOperationResponseHandler=function(e){for(var n=!1,r=!1,a=0;a<t._changes.length;){3!==t._changes[a].status?a++:Array.removeAt(t._changes,a)}for(var o=0;o<t._pendingSaves.length;o++){var l=t._pendingSaves[o];0;var c=t._serverOpToSaveRecord[l.id.toString()];if(5===l.statusCode){if(t._retryingBadCanary){0,c.status=3,i.showSaveFailureDialog(WacWordviewerStrings.GenericErrorSave,us.a.commentSaveCanaryFailure),wo.a.propagateError(!1,"CommentSaveCanaryFailure",us.a.commentSaveCanaryFailure,WacWordviewerStrings.GenericErrorSave);continue}return t._retryingBadCanary=!0,void e.dispatchRequest()}if(2===l.statusCode&&l.responseObjects){0;var u=l.responseObjects[l.responseObjects.length-1];if(33!==u.StatusCode)if(46!==u.StatusCode&&59!==u.StatusCode){if(u.StatusCode){var d;c.status=3;var h,g=(d=i.getErrorInfoForSaveFailure(u.StatusCode),h=d.errorCode,d).returnValue;i.showSaveFailureDialog(g,h),wo.a.propagateError(!1,"CommentSaveFailed",h,g),61===u.StatusCode&&(t._commentManager.mode=0)}else if(s.AFrameworkApplication.theActionManager.processAction(p.a.commentSaveSucceeded,2),Q.a.instance.resolveFuture("Common.Interface.IEditNotificationManager").execute((function(e){e.editHappened()})),c.status=2,u.classId===ds.a.addCommentReply){var m=u,f=t.getComment(m.CommId);f&&(f.guardId=m.ParaId)}else if(u.classId===ds.a.addComment){var v=u,_=t.getComment(v.CommId);_&&(_.guardId=v.ParaId)}}else c.status=0,r=i.markForRetry(c)||r;else{if(t._maxCommentsPerBatch<=i.maxOperationsFromOneSaveRecord){0,c.status=3,i.showSaveFailureDialog(WacWordviewerStrings.GenericErrorSave,us.a.commentSaveRequestCountTooLarge),wo.a.propagateError(!1,"CommentSaveRequestCountTooLarge",us.a.commentSaveRequestCountTooLarge,WacWordviewerStrings.GenericErrorSave);continue}n||(n=!0,t._maxCommentsPerBatch=parseInt(String(Math.max(Math.floor(t._maxCommentsPerBatch/2),1)))),c.status=0,r=i.markForRetry(c)||r}}else s.AFrameworkApplication.theActionManager.processAction(p.a.commentSaveNetworkError,2),r=i.markForRetry(c)||r}for(t._pendingSaves=[],t._serverOpToSaveRecord={},t._retryingBadCanary=!1,a=0;a<t._changes.length;){var y=t._changes[a];2!==y.status&&4!==y.status?a++:Array.removeAt(t._changes,a)}(r||t.hasUnsavedChanges())&&t.startAutosaveTimer()},t.onBeforeAppClose=function(e){if(t._onBeforeNavigateWebkitString=null,t.hasUnsavedChanges()&&!Or.App.allowUnsafeAppClose)return t.okToReplicate()&&(s.AFrameworkApplication.isShuttingDown=!0,t.replicateChanges(),s.AFrameworkApplication.isShuttingDown=!1),t.hasUnsavedChanges()||t.lastSaveHadFailures()?(t._onBeforeNavigateWebkitString=CommonUIStrings.l_NavigateAway,void(e.eventObject.rawEvent.returnValue=CommonUIStrings.l_NavigateAway)):void 0},t.onBeforeNavigateWebkitString=function(){return t._onBeforeNavigateWebkitString},s.AFrameworkApplication.theActionManager.addAction(Nr.a.preventWarningsOnAppClose,La.a.application,i.preventWarningsOnAppClose),s.AFrameworkApplication.activeFrame.thePageManager.getOnBeforeNavigateWebkitString=t.onBeforeNavigateWebkitString,s.AFrameworkApplication.activeFrame.thePageManager.registerHandler(1,t.onBeforeAppClose,null),t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vs(t,n);var r=i.prototype;return r.updateContent=function(e){if(e){var t,n,i,r,a,o,s,l=e.selectNodes("/comments/comment"),c=l.length;this._comments=[];for(var u=0;u<c;u++){var d=l[u];t=wo.a.parseXmlAttribute(d,"id"),n=wo.a.parseXmlAttribute(d,"author"),i=wo.a.parseXmlAttribute(d,"date"),r=wo.a.parseXmlAttribute(d,"replyId"),a=wo.a.parseXmlAttribute(d,"done"),o=wo.a.parseXmlAttribute(d,"guardId"),s=wo.a.parseXmlAttribute(d,"page"),n||(n=CommonUIStrings.l_CommentAuthorUnknown);var p=d.selectNodes("p");0;for(var h=new Array(p.length),g=0;g<p.length;g++)h[g]=p[g].text;var m=null;i&&(m=new Date(parseInt(i))).setMinutes(m.getMinutes()+m.getTimezoneOffset());var f=!1;a&&"true"===a.toLowerCase()&&(f=!0);var v=-1;s&&(v=parseInt(s));var _=new Os.Comment(t,o,n,m,r,f,h,v);this._comments.push(_)}}},r.addCommentToModel=function(e,t){this._commentManager.mode=2,this._inProgress=e,e.groupNumber=t.firstPageNumber;for(var n=-1,i=0;i<this._comments.length;i++){var r=this._comments[i];if(!(r.groupNumber<e.groupNumber)){if(r.groupNumber===e.groupNumber){var a=this._commentManager.hintManager.getAnchorForComment(r);if(a&&a.isStartKnown){if(Ps.compare(a,t)<=0)continue}else 0}n=i;break}}-1===n&&(n=this._comments.length),Array.insert(this._comments,n,e)},r.recordChanges=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if((1!==i.commentType||3!==t)&&3!==i.saveState){var r=new Rs(i,t);r.status=0,this._changes.push(r)}}this.saveSoonerOrLater()},r.recordTaskChanges=function(e,t){0},r.saveSoonerOrLater=function(){this.okToReplicate()?(this._autosaveTask=null,this.replicateChanges()):this.startAutosaveTimer()},r.startAutosaveTimer=function(){this._autosaveTask?s.AFrameworkApplication.theTaskManager.resetInterval(this._autosaveTask,15e3):(this._autosaveTask=new u.a(4,1,15e3,this.delayedSaveTimer),s.AFrameworkApplication.theTaskManager.addTask(this._autosaveTask))},r.okToReplicate=function(){return!this._pendingSaves.length},r.replicateChanges=function(){this._changes.sort(i.sortCommentsById);for(var e=[],t=this._batchedOperationFactory.getBatchedServerOperation(2,this.saveCommentOperationResponseHandler),n=0;n<this._changes.length&&e.length<this._maxCommentsPerBatch-i.maxOperationsFromOneSaveRecord;){for(var r=this._changes[n].comment,a=0,o=new Array(7),s=0;s<7;s++)o[s]=[];for(;n<this._changes.length;){var l=this._changes[n];if(l.comment.id!==r.id)break;l.status||(Array.add(o[l.changeType],l),a++),n++}if(a>0){var c=this.createServerOpsForChanges(o,t,e);e.push.apply(e,c)}}e.length>0&&(this._pendingSaves=e,t.dispatchRequest())},r.createServerOpsForChanges=function(e,t,n){var i=[],r=this._commentManager.hasSharedLock;if(1===e[3].length){this.updateStatesTo(4,e[2]),this.updateStatesTo(4,e[0]),this.updateStatesTo(4,e[1]);var a=e[3][0];if(1===e[2].length)return this.updateStatesTo(4,e[3]),i;var o=this.createAndAddServerOp(t,3,a,r,n);return a.status=1,i.push(o),i}if(1===e[2].length){var s=e[2][0],l=this.createAndAddServerOp(t,2,s,r,n);l?(s.status=1,i.push(l)):s.status=0}var c=e[0].length,u=e[1].length;if(this.updateStatesTo(4,e[0]),this.updateStatesTo(4,e[1]),c!==u){var d=c>u?0:1,p=e[d][0],h=this.createAndAddServerOp(t,d,p,r,n);h?(p.status=1,i.push(h)):p.status=0}return i},r.updateStatesTo=function(e,t){for(var n=0;n<t.length;n++)t[n].status=e},r.createAndAddServerOp=function(e,t,n,i,r){var a=n.comment,o=new Ho;if(3===t)o.requestObject=js.construct(Or.App.instance.baseDocQueryParam,a.guardId,i);else if(t&&1!==t)if(2===t&&a.replyToId){var s=this.getComment(a.replyToId);if(!s.guardId)return 3===s.saveState?(n.status=3,null):null;for(var l=0;l<r.length;l++){var c=r[l];if(Object(cr.a)(xs,c.requestObject)&&c.requestObject.GuardParaId===s.guardId)return null}var u=a.text[0];o.requestObject=xs.construct(Or.App.instance.baseDocQueryParam,u,s.guardId,Ms.a.dateToLocalTime(a.date),i,a.id)}else{if(2!==t)return null;var d=a.text[0];o.requestObject=Us.construct(Or.App.instance.baseDocQueryParam,d,a.anchorStartId,a.anchorEndId,Ms.a.dateToLocalTime(a.date),i,a.id)}else{if(!a.guardId)return null;o.requestObject=Ns.construct(Or.App.instance.baseDocQueryParam,a.guardId||a.id,a.done,i)}return o.status=Uo.requestReady,e.addOperation(o),this._serverOpToSaveRecord[o.id.toString()]=n,o},r.hasUnsavedChanges=function(){for(var e=0;e<this._changes.length;e++){var t=this._changes[e];if(!t.status||1===t.status)return!0}return!1},r.lastSaveHadFailures=function(){for(var e=0;e<this._changes.length;e++){if(3===this._changes[e].status)return!0}return!1},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return new i},i.sortCommentsById=function(e,t){var n=e,i=t;return n.comment.id===i.comment.id?0:n.comment.id.toLowerCase().localeCompare(i.comment.id.toLowerCase())},i.markForRetry=function(e){return e.retriesLeft<=0?(e.status=3,i.showSaveFailureDialog(WacWordviewerStrings.GenericErrorSave,us.a.commentSaveRetryCountExceeded),wo.a.propagateError(!1,"CommentSaveRetryCountExceeded",us.a.commentSaveRetryCountExceeded,WacWordviewerStrings.GenericErrorSave),!1):(e.retriesLeft=e.retriesLeft-1,e.status=0,s.AFrameworkApplication.theActionManager.processAction(p.a.commentSaveRetry,2),!0)},i.showSaveFailureDialog=function(e,t){if(1!==s.AFrameworkApplication.activeFrame.state){var n=new Kn.StandardDialog;n.buttonsOption=0,n.showError(t,CommonUIStrings.l_DefaultDialogTitle,e,null)}},i.getErrorInfoForSaveFailure=function(e){var t;switch(e){case 1:return t=us.a.commentSaveInvalidPropertyData,{returnValue:WacWordviewerStrings.GenericErrorSave,errorCode:t};case 14:return t=us.a.commentSaveUnspecifiedFailure,{returnValue:WacWordviewerStrings.GenericErrorSave,errorCode:t};case 7:return t=us.a.commentSavePermissionDenied,{returnValue:WacWordviewerStrings.AccessDeniedSave,errorCode:t};case 36:return t=us.a.commentSaveOldProductDigitalSignature,{returnValue:WacWordviewerStrings.OldProductDigitalSignatureSave,errorCode:t};case 9:return t=us.a.commentSaveDocumentProtectionSettings,{returnValue:WacWordviewerStrings.DocumentProtectionSettingsCommentSave,errorCode:t};case 30:return t=us.a.commentSaveDocumentPasswordEncrypted,{returnValue:WacWordviewerStrings.DocumentPasswordEncryptedSave,errorCode:t};case 31:return t=us.a.commentSaveFileCheckedOut,{returnValue:WacWordviewerStrings.CheckedOutSave,errorCode:t};case 17:return t=us.a.commentSaveFileRequiresCheckout,{returnValue:WacWordviewerStrings.RequiresCheckoutSave,errorCode:t};case 16:return t=us.a.commentSaveFileLockedForOfflineCheckout,{returnValue:WacWordviewerStrings.LockedForOfflineCheckoutSave,errorCode:t};case 11:return t=us.a.commentSaveFileLockedByOtherInterface,{returnValue:WacWordviewerStrings.LockedByOtherInterfaceSave,errorCode:t};case 57:return t=us.a.commentSaveNumberOfCoauthorsReachedMax,{returnValue:WacWordviewerStrings.NumberOfCoauthorsReachedMaxSave,errorCode:t};case 47:return t=us.a.commentSaveWordFileVersionMismatch,{returnValue:WacWordviewerStrings.DocumentChangedErrorSave,errorCode:t};case 59:return t=us.a.commentSaveDocxCoherencyFailure,{returnValue:WacWordviewerStrings.DocxCoherencyErrorSave,errorCode:t};case 12:return t=us.a.commentSaveCorruptedFile,{returnValue:WacWordviewerStrings.CorruptFileSave,errorCode:t};case 61:return t=us.a.commentSaveDocumentMarkedFinal,{returnValue:WacWordviewerStrings.DocumentMarkedFinalSave,errorCode:t};case 38:return t=us.a.commentSavePreReleaseFile,{returnValue:WacWordviewerStrings.PreReleaseFile,errorCode:t};case 35:return t=us.a.commentSaveLockExpired,{returnValue:WacWordviewerStrings.GenericErrorSave,errorCode:t};case 39:return t=us.a.commentSaveFileEditedInRichClient,{returnValue:WacWordviewerStrings.GenericErrorSave,errorCode:t};case 33:return t=us.a.commentSaveRequestCountTooLarge,{returnValue:WacWordviewerStrings.GenericErrorSave,errorCode:t};default:return t=us.a.commentSaveUnspecifiedFailure,{returnValue:WacWordviewerStrings.GenericErrorSave,errorCode:t}}},i.preventWarningsOnAppClose=function(e,t,n,i,r){return Or.App.allowUnsafeAppClose=!0,32},i}(Ms.a);qs.maxOperationsFromOneSaveRecord=2,Object(i.a)(qs,"ViewerCommentModel",Ms.a,[]);var Gs=n(662),Ks=n(651),zs=n(657),Xs=n(199),Js=n(158),Qs=n(200),Zs=n(46),Ys=n(51);function $s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var el=function(){function e(t,n,i,r,a){var o=this;this._commentManager=null,this._headerControlsRow=null,this._closeButton=null,this._newCommentButton=null,this._addedDivider=!1,this._contentLoaded=!1,this._waitingToScrollTo=null,this._addCommentOnRender=!1,this._newCommentKeyEventHandler=null,this._closeCommentPaneKeyEventHandler=null,this.editCommentOnRender=!1,this._isVisible=!1,this._paneSurface=null,this._paneParent=null,this._pane=null,this.onAfterFadeIn=function(t){e.clearOpacity(t.element),e.removeAllAnimationClasses(t.element)},this.onAfterMove=function(t){t.element.style.marginTop="",e.removeAllAnimationClasses(t.element)},this.onAfterFadeOut=function(e){e.element.parentNode&&e.element.parentNode.removeChild(e.element),o.paneSurface.childNodes.length||o.showEmptyUI()},this.commentMoveFocusForTabsHandler=function(e,t,n,i,r){var a=o._commentManager.getCommentPaneFocusRegion().listing.currentElement,s=o._commentManager.model.selectedComment;if(!a){if(a=document.activeElement,o.pane.contains(a)||(a=s?s.containerElement:o._commentManager.pane.newCommentButton),!a)return 4;o._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(a)}return e===p.a.commentTabForward?o.moveForward(a,s):e===p.a.commentTabBackward?o.moveBackward(a,s):2},this.selectNextComment=function(e,t,n,i,r){return 1===n||o._commentManager.selectNextComment(),32},this.selectPrevComment=function(e,t,n,i,r){return 1===n||o._commentManager.selectPrevComment(),32},this._actionManager=t,this._clickInputManager=n,this._keyInputManager=i,this._focusManager=r,this._f6Manager=a,this._escapeKeyHash=Fr.KeyInputManager.hashKey(Er.a.vK_Escape,0)}var t,n,i,r=e.prototype;return r.initialize=function(e,t){this._commentManager=e,this._paneParent=t;var n=this.createPane();this.paneParent.appendChild(n),this.registerActions(),this.resizeCommentPane()},r.dispose=function(){this.shouldCreateHeader&&this._closeButton&&(this._clickInputManager.unregisterHandler(m.a.click,this._closeButton,Object(A.a)(this,this.onClosePaneClick,"onClosePaneClick")),this._keyInputManager.unregisterHandlerForAllKeyEvents(this._closeButton,this._closeCommentPaneKeyEventHandler)),this.shouldCreateHeaderControls&&this._newCommentButton&&(this._clickInputManager.unregisterHandler(m.a.click,this._newCommentButton,Object(A.a)(this,this.onNewCommentClick,"onNewCommentClick")),this._keyInputManager.unregisterHandlerForAllKeyEvents(this._newCommentButton,this._newCommentKeyEventHandler)),this.pane&&this._clickInputManager.unregisterHandler(m.a.click,this.pane,Object(A.a)(this,this.clearSelection,"clearSelection"));var e=this._focusManager.getScope(Dt.AFrame.commentPaneFocusId);e.unBindAction(this._escapeKeyHash),e.unBindAction(Bt.FocusManager.instance()._tabInput),e.unBindAction(Bt.FocusManager.instance()._tabShiftInput),this._pane=null,this._closeButton=null,this._paneSurface=null,this._newCommentButton=null},r.showEmptyUI=function(){this.paneSurface.innerText="";var e=Ks.a("div","","CommentPaneEmpty1");if(e.innerText=this.emptyUIStringPart1,this.paneSurface.appendChild(e),0!==this._commentManager.mode){var t=Ks.a("div","","CommentPaneEmpty2");t.innerText=this.emptyUIStringPart2,this.paneSurface.appendChild(t)}},r.showErrorUI=function(){this.paneSurface.innerText="";var e=Ks.a("div","","CommentPaneEmpty1");e.innerText=CommonUIStrings.l_CommentPaneError,this.paneSurface.appendChild(e)},r.showLoadingUI=function(){this.paneSurface.innerText="";var e=Ks.a("div","","");e.style.textAlign="center";var t=document.createElement("img");t.className="CommentPaneLoading",t.src=vt.a.commonImage("progress.gif"),e.appendChild(t);var n=Ks.a("div","","CommentPaneLoadingText");n.innerText=CommonUIStrings.l_CommentLoading,e.appendChild(n),this.paneSurface.appendChild(e)},r.showComments=function(e){if(Lr.a.clearElementHtml(this.paneSurface),e.length)for(var t=0;t<e.length;t++){var n=e[t],i=t?e[t-1]:null;(!t||i.groupNumber<n.groupNumber)&&this.paneSurface.appendChild(this.createGroupDivider(n)),this.paneSurface.appendChild(n.render())}else this.showEmptyUI();this._contentLoaded=!0,this.updateRenderedState(),this._waitingToScrollTo&&(this._waitingToScrollTo.focus(),this._waitingToScrollTo=null)},r.selectComment=function(e,t){void 0===t&&(t=1),this._contentLoaded?e.focus():this._waitingToScrollTo=e},r.isDifferentGroup=function(e,t){return!e||!t||e.groupNumber!==t.groupNumber},r.getPaneSurfaceOffsetTop=function(){var e=document.getElementById("CommentPaneHeader").offsetHeight;return this._headerControlsRow&&(e+=this._headerControlsRow.offsetHeight),e},r.renderNewComment=function(e){var t=this._commentManager.model.getCommentBefore(e,!1),n=this._commentManager.model.getCommentAfter(e,!1);t||n||Lr.a.clearElementHtml(this.paneSurface);var i=this.isDifferentGroup(t,e),r=this.isDifferentGroup(n,e),a=null;n&&(a=n.containerElement,r&&(a=a.previousSibling)),this.renderNewOrEditingComment(e,a,i&&r)},r.renderEditingComment=function(e){var t=e.containerElement.nextSibling;this.paneSurface.removeChild(e.containerElement),this.renderNewOrEditingComment(e,t,!1)},r.removeCommentsFromPane=function(t){for(var n=[],i=null,r=null,a=0;a<t.length;a++){var o=t[a];if(a||(r=o.containerElement.previousSibling),a===t.length-1){var s=o.containerElement.nextSibling;r&&Sys.UI.DomElement.containsCssClass(r,"CommentGroupDivider")&&(!s||Sys.UI.DomElement.containsCssClass(s,"CommentGroupDivider"))&&Array.add(n,r)}i=o.containerElement,Array.add(n,i)}var l=0,c=i.nextSibling;if(c){for(var u=c.offsetTop,d=0;d<n.length;d++)n[d].style.display="none";l=c.offsetTop-u;for(var p=0;p<n.length;p++)n[p].style.display=""}e.animateDeleteComments(n,c,l,this.onAfterFadeOut,this.onAfterMove)},r.registerActions=function(){this._actionManager.addAction(p.a.hideCommentPane,_e.a.frame,Object(A.a)(this,this.hideCommentPane,"hideCommentPane")),this._actionManager.addAction(p.a.editComment,_e.a.frame,Object(A.a)(this,this.editComment,"editComment")),this._actionManager.addAction(p.a.selectNextComment,_e.a.frame,this.selectNextComment),this._actionManager.addAction(p.a.selectPrevComment,_e.a.frame,this.selectPrevComment),this._actionManager.addActionWithFlags(p.a.queryToggleCommentPane,_e.a.frame,Object(A.a)(this,this.queryToggleCommentPane,"queryToggleCommentPane"),96),this._actionManager.addAction(p.a.commentTabForward,_e.a.frame,this.commentMoveFocusForTabsHandler),this._actionManager.addAction(p.a.commentTabBackward,_e.a.frame,this.commentMoveFocusForTabsHandler)},r.modeChanged=function(){this.updateRenderedState()},r.createPane=function(){var e=Ks.a("div",this.commentPaneBodyId,"CommentPane"),t=Ks.a("label",Gs.a.commentTabHelp,Gs.a.commentTabHelp);if(t.innerText=CommonUIStrings.l_CommentTabHelp,e.appendChild(t),this.shouldCreateHeader){var n=this.createHeaderDom();e.appendChild(n)}if(this.shouldCreateHeaderControls){var i=this.createHeaderControlsDom();e.appendChild(i)}var r=Ks.a("div","CommentPaneSurface","CommentPaneSurface");return this._commentManager.copyingEnabled||(Sys.UI.DomElement.addCssClass(e,"DisableSelection"),e.setAttribute("Unselectable","on")),e.appendChild(r),this._pane=e,this._paneSurface=r,this.updateRenderedState(),this.setupFocus(),this._clickInputManager.registerHandler(m.a.click,e,Object(A.a)(this,this.clearSelection,"clearSelection")),this.showLoadingUI(),e},r.createHeaderDom=function(){var e=Ks.b("div","CommentPaneHeader","CommentPaneHeader"),t=Ks.b("span","CommentPaneTitle","PaneTitle CommentPaneTitle UIFontLight");t.innerText=CommonUIStrings.L_OpenCommentPane;var n=zs.a.createButton("CloseCommentPane","CommentPaneCloseButton",CommonUIStrings.l_Close,"ClosePaneGlyph_16x16x32",!1);return Sys.UI.DomElement.addCssClass(n,s.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),this._clickInputManager.registerHandler(m.a.click,n,Object(A.a)(this,this.onClosePaneClick,"onClosePaneClick")),this._closeCommentPaneKeyEventHandler=this._keyInputManager.registerHandlerForAllKeyEvents(n,Object(A.a)(this,this.onClosePaneClick,"onClosePaneClick"),Er.a.vK_Enter),e.appendChild(t),e.appendChild(n),this._closeButton=n,e},r.createHeaderControlsDom=function(){this._headerControlsRow=Ks.b("div","CommentPaneControls","CommentPaneControls");var e=zs.a.createButton("CommentPaneNewComment","CommentPaneNewComment",CommonUIStrings.l_CommentNewCommentButton,"CommentNew_16x16x32");return this._headerControlsRow.appendChild(e),this._clickInputManager.registerHandler(m.a.click,e,Object(A.a)(this,this.onNewCommentClick,"onNewCommentClick")),this._newCommentKeyEventHandler=this._keyInputManager.registerHandlerForAllKeyEvents(e,Object(A.a)(this,this.onNewCommentClick,"onNewCommentClick"),Er.a.vK_Enter),this._newCommentButton=e,this._headerControlsRow},r.createGroupDivider=function(e){var t=Ks.a("div","","CommentGroupDivider");return this._addedDivider||Sys.UI.DomElement.addCssClass(t,"CommentGroupDividerFirst"),this._addedDivider=!0,t.innerText=this.getDividerLabel(e),t},r.updateRenderedState=function(){0===this._commentManager.mode||-1===this._commentManager.mode?(this._headerControlsRow&&(this._headerControlsRow.style.display="none"),Sys.UI.DomElement.addCssClass(this.paneSurface,"ReadOnly")):(Sys.UI.DomElement.removeCssClass(this.paneSurface,"ReadOnly"),this._headerControlsRow&&(this._headerControlsRow.style.display="inline-block"),this.isCurrentlyEditing||4===this._commentManager.mode?(Sys.UI.DomElement.addCssClass(this.paneSurface,"CommentInProgress"),Sys.UI.DomElement.removeCssClass(this.paneSurface,"Interactive"),this._newCommentButton&&this.setNewCommentButtonState(!1)):(Sys.UI.DomElement.addCssClass(this.paneSurface,"Interactive"),Sys.UI.DomElement.removeCssClass(this.paneSurface,"CommentInProgress"),this._newCommentButton&&this.setNewCommentButtonState(this._contentLoaded)))},r.setNewCommentButtonState=function(e){zs.a.setButtonEnabledState(this._newCommentButton,e)},r.setupFocus=function(){var e=this,t=this._focusManager.getScope(Dt.AFrame.commentPaneFocusId);t.parent=Dt.AFrame.appFocusId,this._clickInputManager.addFocusEvent(Dt.AFrame.commentPaneFocusId,this.pane),t.addSetFocus((function(){var t=null;(t=e._newCommentButton.disabled&&e._closeButton?e._closeButton:e._newCommentButton).focus(),e._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t),e._commentManager.getCommentPaneFocusRegion().listing.addValidTag(5)})),t.addOnBlur((function(){2!==e._commentManager.mode&&3!==e._commentManager.mode&&e._commentManager.clearSelection()})),this._f6Manager.addF6KeyBindings(Dt.AFrame.commentPaneFocusId),t.bindAction(Fr.KeyInputManager.hashKey(Er.a.vK_UpArrow,0),p.a.selectPrevComment),t.bindAction(Fr.KeyInputManager.hashKey(Er.a.vK_DownArrow,0),p.a.selectNextComment),t.bindAction(this._escapeKeyHash,p.a.hideCommentPane)},r.rebindTabNavigationHandlers=function(e){e.unBindAction(this._focusManager._tabInput),e.unBindAction(this._focusManager._tabShiftInput),e.bindAction(this._focusManager._tabInput,p.a.commentTabForward),e.bindAction(this._focusManager._tabShiftInput,p.a.commentTabBackward)},r.moveForward=function(e,t){var n=this.isCurrentlyEditing;if(e===this._newCommentButton&&this._commentManager.model.hasComments()&&!this.isCurrentlyEditing)return this._commentManager.selectNextComment(),32;if(t&&e===t.containerElement)this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(e.firstChild);else if(-1!==e.className.indexOf(Gs.a.commentDeleteButtonClassName)){if(t){if(this._commentManager.model.getCommentAfter(t,!1))return this._commentManager.selectNextComment(),32;n||this._commentManager.model.clearSelection(),this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement)}}else{if(-1!==e.className.indexOf(Gs.a.commentTextEntryClassName))return this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.commentViewObject.saveButtonElement),32;-1!==e.className.indexOf(Gs.a.commentSaveButtonClassName)&&this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement)}return this._commentManager.getCommentPaneFocusRegion().moveForward(),32},r.moveBackward=function(e,t){if(e===this._newCommentButton)return this._commentManager.getCommentPaneFocusRegion().moveBackward(),32;if(t){if(e===t.containerElement){var n=this.isCurrentlyEditing;if(this._commentManager.model.getCommentBefore(t,!1)){if(!n){this._commentManager.selectPrevComment();var i=this._commentManager.model.selectedComment.commentViewObject.deleteButtonElement;return i&&this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(i),32}}else n||this._commentManager.clearSelection()}else if(-1!==e.className.indexOf(Gs.a.commentReplyButtonClassName)||-1!==e.className.indexOf(Gs.a.commentCancelButtonClassName))return this._commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(t.containerElement),32}else if((-1!==e.className.indexOf(Gs.a.commentTaskPaneCloseClassName)||-1!==e.className.indexOf(Gs.a.commentPaneCloseButtonClassName))&&this._commentManager.model.hasComments())return this._commentManager.selectPrevComment(),32;return this._commentManager.getCommentPaneFocusRegion().moveBackward(),32},r.onClosePaneClick=function(e){return this._actionManager.processAction(p.a.hideCommentPane,2),!0},r.clearSelection=function(e){return this._focusManager.scopeChanged(Dt.AFrame.commentPaneFocusId),this._commentManager&&2!==this._commentManager.mode&&3!==this._commentManager.mode&&this._commentManager.clearSelection(),!0},r.onNewCommentClick=function(e){return this._newCommentButton.disabled||this.addNewCommentInternal(),!0},r.addNewCommentInternal=function(){this._focusManager.scopeChanged(Dt.AFrame.commentPaneFocusId),this._commentManager.addNewComment(null)},r.addNewComment=function(e,t,n,i,r){if(1===n)return this._commentManager&&1!==this._commentManager.mode?8:32;if(this.isVisible)this.addNewCommentInternal();else{var a=0;if(Object(cr.a)(As.a,r))a=r.inputMethod;var o=new As.a(r,a);this.addCommentOnRender=!0,this._actionManager.processActionWithData(p.a.showCommentPane,2,o)}return 32},r.editComment=function(e,t,n,i,r){if(1===n)return 1===this._commentManager.mode?32:8;if(this.isVisible){var a=this._commentManager.model.getComment(r);if(!a)return 8;a.onEdit()}else this.editCommentOnRender=!0,this._actionManager.processActionWithData(p.a.showCommentPane,2,r);return 32},r.renderNewOrEditingComment=function(t,n,i){var r=t.render(),a=[],o=0,s=0;if(n?(s=n.offsetTop,this.paneSurface.insertBefore(r,n)):this.paneSurface.appendChild(r),Array.add(a,r),i){var l=this.createGroupDivider(t);this.paneSurface.insertBefore(l,r),Array.add(a,l)}n&&(o=n.offsetTop-s),e.animateNewComment(a,n,o,this.onAfterFadeIn,this.onAfterMove),0!==t.commentType&&t.focus()},r.showWithoutFocus=function(){},e.animateNewComment=function(t,n,i,r,a){for(var o=0;o<t.length;o++){var s=t[o];n?Zs.WacAirSpace.setAnimationClass(s,"WAC_DelayShowClass"):Zs.WacAirSpace.setAnimationClass(s,"Shared_BasicClass");var l=new Qs.a(s);l.animateOpacity(0,1),Zs.WacAirSpace.animate(l,null,r)}if(n){var c=e.getExistingMarginTopOnElement(n);n.style.position="relative",Zs.WacAirSpace.setAnimationClass(n,"Shared_BasicClass");var u=new Js.a(n);u.animateY(c-i,c),Zs.WacAirSpace.animate(u,null,a)}},e.animateDeleteComments=function(t,n,i,r,a){for(var o=0;o<t.length;o++){var s=t[o];Zs.WacAirSpace.setAnimationClass(s,"Shared_BasicClass");var l=new Xs.a(s);l.animateOpacity(1,0),Zs.WacAirSpace.animate(l,null,r)}if(n){var c=e.getExistingMarginTopOnElement(n);n.style.position="relative",Zs.WacAirSpace.setAnimationClass(n,"WAC_DelayMoveClass");var u=new Js.a(n);u.animateY(c,i+c),Zs.WacAirSpace.animate(u,null,a)}},e.removeAllAnimationClasses=function(e){var t=e.className;if(t)for(var n=t.split(" "),i=0;i<n.length;i++){var r=n[i];r.startsWith(Zs.WacAirSpace.animationClassPrefix)&&Sys.UI.DomElement.removeCssClass(e,r)}},e.getExistingMarginTopOnElement=function(e){var t=Ys.a.getCurrentStyle(e),n=0;return t&&t.marginTop&&(n=parseInt(t.marginTop),n=isNaN(n)?0:n),n},e.clearOpacity=function(e){z.a.isNonStandardsCompliantIE?e.style.filter="":e.style.opacity=""},t=e,(n=[{key:"addCommentOnRender",get:function(){return this._addCommentOnRender},set:function(e){this._addCommentOnRender=e,e||this.addNewCommentInternal()}},{key:"commentPaneBodyId",get:function(){return"CommentPane"}},{key:"isVisible",get:function(){return this._isVisible},set:function(e){this._isVisible=e}},{key:"paneSurface",get:function(){return this._paneSurface}},{key:"newCommentButton",get:function(){return this._newCommentButton}},{key:"f6Manager",get:function(){return this._f6Manager}},{key:"paneParent",get:function(){return this._paneParent}},{key:"pane",get:function(){return this._pane}},{key:"shouldCreateHeader",get:function(){return!0}},{key:"shouldCreateHeaderControls",get:function(){return!0}},{key:"emptyUIStringPart1",get:function(){return CommonUIStrings.l_CommentPaneEmpty1}},{key:"emptyUIStringPart2",get:function(){return CommonUIStrings.l_CommentPaneEmpty2}},{key:"isCurrentlyEditing",get:function(){return 2===this._commentManager.mode||3===this._commentManager.mode}}])&&$s(t.prototype,n),i&&$s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function tl(e,t){return(tl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(el,"CommentPane",null,[10,160]);var nl=function(e){var t,n;function i(t,n,i,r,a,o,s){var l;return(l=e.call(this,n,r,a,o,s)||this).onAfterCommentPaneShow=function(e){l.pane.style.visibility="visible",Fo.a.instance.calculateOffset()},l.onAfterCommentPaneHide=function(e){l.pane.style.visibility="hidden",Fo.a.instance.calculateOffset()},t.add_onResize((function(){return l.resizeCommentPane()})),l}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,tl(t,n);var r=i.prototype;return r.resizeCommentPane=function(){var e=Or.App.instance.theConfig.commentPaneWidth-Or.App.instance.theConfig.commentPaneHorizontalBorderWidth;this.pane.style.width=e+"px",Or.App.get_activeAppFrame().isCommentPaneVisible&&(this.pane.style.visibility="visible"),this.pane.style.top="0",Or.App.get_activeAppFrame().isCommentPaneVisible?(Or.App.get_activeAppFrame().isCommentPaneTouchMode?Sys.UI.DomElement.addCssClass(this.pane,Dt.AFrame.dynamicTouchModeCssClass):Sys.UI.DomElement.removeCssClass(this.pane,Dt.AFrame.dynamicTouchModeCssClass),Cs.a.animateCommentPane(this.pane,!0,this.onAfterCommentPaneShow)):Cs.a.animateCommentPane(this.pane,!1,this.onAfterCommentPaneHide);var t=Or.App.get_activeAppFrame().workspace.getHeight(),n=this.paneSurface.offsetTop;this.paneSurface.style.height=t>n?t-n+"px":"0px"},r.showCommentPane=function(e,t,n,i,r){if(1===n)return Or.App.isReadyForRibbon()?32:8;if(!Or.App.get_activeAppFrame().isCommentPaneVisible){Fo.a.instance.hideSelection();var a=0;if(r)a=r.inputMethod;Or.App.get_activeAppFrame().showCommentPane(a)}this.isVisible=!0,s.AFrameworkApplication.activeFrame.theF6Manager.activateFocus(Dt.AFrame.commentPaneFocusId),this._commentManager.initiateCommentingSession();var o=Or.App.get_activeAppFrame();return(null==o?void 0:o.ribbonUser)&&o.ribbonUser.poll(),32},r.addNewComment=function(t,n,i,r,a){return Or.App.isReadyForRibbon()?e.prototype.addNewComment.call(this,t,n,i,r,a):8},r.hideCommentPane=function(e,t,n,i,r){if(1===n)return 32;var a=Or.App.get_activeAppFrame();a.isCommentPaneVisible&&(Fo.a.instance.hideSelection(),a.hideCommentPane(),this._commentManager.paneClosing());var o=Bt.FocusManager.instance();return o.currentScope&&o.currentScope.name===Dt.AFrame.commentPaneFocusId&&o.setScope(o.defaultScopeName),s.AFrameworkApplication.activeFrame.theF6Manager.deactivateFocus(Dt.AFrame.commentPaneFocusId),this.isVisible=!1,(null==a?void 0:a.ribbonUser)&&a.ribbonUser.poll(),32},r.toggleCommentPane=function(e,t,n,i,r){return this.isVisible?this.hideCommentPane(e,t,n,i,r):this.showCommentPane(e,t,n,i,r)},r.queryToggleCommentPane=function(e,t,n,i,r){return 1===n||(r[Gr.a.On]=Or.App.get_activeAppFrame().isCommentPaneVisible),32},r.getDividerLabel=function(e){return String.format(WacWordviewerStrings.CommentPanePageLabel,e.groupNumber)},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return new i(s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame.thePageManager,s.AFrameworkApplication.activeFrame.theClickInputManager,s.AFrameworkApplication.activeFrame.theKeyInputManager,s.AFrameworkApplication.activeFrame.theFocusManager,s.AFrameworkApplication.activeFrame.theF6Manager)},i}(el);function il(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function rl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function al(e,t){return(al=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(nl,"ViewerCommentPane",el,[]);var ol=function(e){var t,n;function i(t,n,r,a,o){var l;return(l=e.call(this,r)||this)._fetchCommentsDataRetried=!1,l._fetchCommentsDataFailed=!1,l._hasSharedLock=!1,l._inCommentingSession=!1,l._beginCommentingServerOp=null,l._refreshLockTask=null,l._refreshLockServerOp=null,l._networkStatusToast=null,l._retryingBadCanary=!1,l._sessionReady=!1,l._retryCountBeginCommentingBusy=0,l._commentsDataReady=!1,l.beginCommentingResponseHandler=function(e){if(!s.AFrameworkApplication.isShuttingDown){if(5===l._beginCommentingServerOp.statusCode){if(l._retryingBadCanary){0,l.mode=0,l._sessionReady=!0,l.populateCommentPane();var t=new Kn.StandardDialog;return t.buttonsOption=0,t.showError(us.a.commentBeginCanaryFailure,CommonUIStrings.l_DefaultDialogTitle,WacWordviewerStrings.GenericErrorOpen,null),void wo.a.propagateError(!1,"CommentBeginCanaryFailed",us.a.commentBeginCanaryFailure,WacWordviewerStrings.GenericErrorOpen)}return l._retryingBadCanary=!0,void e.dispatchRequest()}if(l._retryingBadCanary=!1,l._sessionReady=!0,2!==l._beginCommentingServerOp.statusCode||!l._beginCommentingServerOp.responseObjects){0,l.mode=0,l.populateCommentPane();var n=new Kn.StandardDialog;return n.buttonsOption=0,n.showError(us.a.commentBeginNetworkError,CommonUIStrings.l_DefaultDialogTitle,WacWordviewerStrings.GenericErrorOpen,null),void wo.a.propagateError(!1,"CommentBeginNetworkError",us.a.commentBeginNetworkError,WacWordviewerStrings.GenericErrorOpen)}0;var r=l._beginCommentingServerOp.responseObjects[l._beginCommentingServerOp.responseObjects.length-1];if(46===r.StatusCode&&l._retryCountBeginCommentingBusy++<i.maxRetryCountForBeginCommentingBusy)e.dispatchRequest();else if(r.StatusCode){var a,o,c;l.mode=0,l.populateCommentPane();var d=(a=i.getErrorInfoForBeginCommentFailure(r.StatusCode),o=a.helpMessage,c=a.errorCode,a).returnValue;if(d){var h=new Kn.StandardDialog;h.buttonsOption=0,o&&h.addHelpLink(WacWordviewerStrings.LearnMore,o),h.showError(c,CommonUIStrings.l_DefaultDialogTitle,d,null),wo.a.propagateError(!1,"CommentFailed",c,d)}else s.AFrameworkApplication.reportError(c)}else{if(r.Refresh){var g;switch(l.mode=0,l.populateCommentPane(),r.Refresh){case 1:case 2:g=WacWordviewerStrings.CommentingNeedsRefresh;break;default:0,g=WacWordviewerStrings.GenericErrorOpen}var m=new Kn.StandardDialog;return m.buttonsOption=1,m.setButtonText(1,WacWordviewerStrings.Reload),void m.showInformation(CommonUIStrings.l_DefaultDialogTitle,g,l.reloadDialogHandler)}0,l._hasSharedLock=r.SharedLock,l._inCommentingSession=!0,s.AFrameworkApplication.theActionManager.processAction(p.a.commentBeginSucceeded,2),l.populateCommentPane(),l._refreshLockTask||(l._refreshLockTask=new u.a(3,2,6e5,l.refreshLockTimer),s.AFrameworkApplication.theTaskManager.addTask(l._refreshLockTask))}}},l.reloadDialogHandler=function(e,t){1===e?(s.AFrameworkApplication.theActionManager.processAction(p.a.commentBeginRefresh,2),ut.a.openWindow(1,window.location.href)):(s.AFrameworkApplication.theActionManager.processAction(p.a.commentBeginRefreshRefused,2),l.mode=0)},l.onCommentRequestSucceeded=function(e){l._commentsDataReady=!0,e.data.responseXml?(l._commentModel.updateContent(e.data.responseXml),l.populateCommentPane()):(s.AFrameworkApplication.theActionManager.processAction(Nr.a.commentDownloadCorrupt,2),l.mode=0,l._commentPane.showErrorUI()),s.AFrameworkApplication.theActionManager.processAction(p.a.commentDownloadSucceeded,2)},l.onCommentRequestFail=function(e){if(l._fetchCommentsDataRetried)l.onFetchCommentsDataFail();else{l._fetchCommentsDataRetried=!0;var t=xo.a.urlForNamedObject("comments.xml"),n=new cs.a(l.onStatusRequestSuccess,t,xo.a.getHeaders());n.failureCallback=l.onStatusRequestFail,n.send()}},l.onStatusRequestSuccess=function(e){l.fetchCommentData()},l.onStatusRequestFail=function(){l.onFetchCommentsDataFail()},l.refreshLockTimer=function(e){var t=l._batchedServerOperationFactory.getBatchedServerOperation(3,l.refreshLockResponseHandler);l._refreshLockServerOp=new Ho,l._refreshLockServerOp.requestObject=gs.construct(Or.App.instance.baseDocQueryParam,xa.a.instance.isNormalized),l._refreshLockServerOp.status=Uo.requestReady,t.addOperation(l._refreshLockServerOp),t.dispatchRequest()},l.refreshLockResponseHandler=function(e){if(!s.AFrameworkApplication.isShuttingDown){if(5===l._refreshLockServerOp.statusCode)return l._retryingBadCanary?void l.showNetworkLostToast():(l._retryingBadCanary=!0,void e.dispatchRequest());if(l._retryingBadCanary=!1,2===l._refreshLockServerOp.statusCode&&l._refreshLockServerOp.responseObjects)0,l._refreshLockServerOp.responseObjects[0].StatusCode?l.showNetworkLostToast():l.hideNetworkLostToast();else l.showNetworkLostToast()}},l.copyingEnabled=Or.App.instance.copyingEnabled,l._currentMode=Or.App.instance.userCanComment&&!Or.App.instance.accessibleModeEnabled?1:0,r.addActionWithFlags(Nr.a.commentDownloadCorrupt,La.a.application,Pt.ActionManager.doNothingButReportHandler,64),r.addAction(p.a.commentHintClick,_e.a.frame,Pt.ActionManager.doNothingButReportHandler),l._commentPane=nl.getInstance(),l._commentModel=qs.getInstance(),l._hintManager=Es.getInstance(),l._hostPostmessengerLazy=a,l._commentPane.initialize(rl(l),t),l._commentModel.initialize(rl(l)),l._hintManager.initialize(n),l._focusManager=o,l._batchedServerOperationFactory=new ls,l.fetchCommentData(),Or.App.get_activeAppFrame().workspace.setCommentManagerDisposable(rl(l)),l}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,al(t,n);var a,o,l,c=i.prototype;return c.dispose=function(){e.prototype.dispose.call(this),this._networkStatusToast&&(this._networkStatusToast.dispose(),this._networkStatusToast=null)},c.addNewComment=function(t){void 0===t&&(t=null),e.prototype.addNewComment.call(this,t),Fo.a.instance.clearSelection()},c.selectComment=function(t,n){void 0===n&&(n=1),this.commentsDataReady&&!this._fetchCommentsDataFailed&&e.prototype.selectComment.call(this,t,n)},c.initiateCommentingSession=function(){if(this._inCommentingSession)this.pane.addCommentOnRender&&(this.pane.addCommentOnRender=!1);else{if(e.prototype.initiateCommentingSession.call(this),s.AFrameworkApplication.useRedeemForCommentingPostMessage){var t="wdcomments=1",n=Or.App.get_activeAppFrame().getTopParagraphId();n&&(t+="&wdparaid="+n),r.ULS.shipAssertTag(4994851,327,!!this._hostPostmessengerLazy.value),this._hostPostmessengerLazy.value.sendMessage(d.a.redeemForCommenting,{targetWacAction:"View",wdparams:t})||Or.App.get_activeAppFrame().navigateToHostUrl(!0,s.AFrameworkApplication.copyAndEditUrl),s.AFrameworkApplication.useRedeemForCommentingPostMessage=!1}if(this._currentMode){if(!this._beginCommentingServerOp){this._retryCountBeginCommentingBusy=0;var i=this._batchedServerOperationFactory.getBatchedServerOperation(0,this.beginCommentingResponseHandler);this._beginCommentingServerOp=new Ho,this._beginCommentingServerOp.requestObject=gs.construct(Or.App.instance.baseDocQueryParam,xa.a.instance.isNormalized),this._beginCommentingServerOp.status=Uo.requestReady,i.addOperation(this._beginCommentingServerOp),i.dispatchRequest()}}else this._sessionReady||(this._sessionReady=!0,this.populateCommentPane())}},c.endCommentingSession=function(){if(this._inCommentingSession){var e=this._batchedServerOperationFactory.getBatchedServerOperation(0,null),t=new Ho;t.requestObject=fs.construct(Or.App.instance.baseDocQueryParam,this._hasSharedLock),t.status=Uo.requestReady,e.addOperation(t),e.dispatchRequest(),this._inCommentingSession=!1,this._refreshLockTask&&!s.AFrameworkApplication.isShuttingDown&&(s.AFrameworkApplication.theTaskManager.deleteTask(this._refreshLockTask),this._refreshLockTask=null)}},c.fetchCommentData=function(){if(xa.a.instance.hasComments){var e=xo.a.urlForNamedObject("comments.xml");s.AFrameworkApplication.theClientRequestManager.addRequest(e,1,null,xo.a.getHeaders(),!0,2,this.onCommentRequestSucceeded,this.onCommentRequestFail,null)}else this._commentsDataReady=!0},c.onFetchCommentsDataFail=function(){this.mode=0,this._commentsDataReady=!0,this._fetchCommentsDataFailed=!0,this._commentPane.showErrorUI(),s.AFrameworkApplication.theActionManager.processAction(p.a.commentDownloadFailed,2)},c.showNetworkLostToast=function(){this._networkStatusToast||(this._networkStatusToast=Or.App.get_activeAppFrame().notificationBar.createEntry(CommonUIStrings.l_NetworkProblemToast,!0),Or.App.get_activeAppFrame().notificationBar.addEntry(this._networkStatusToast))},c.hideNetworkLostToast=function(){this._networkStatusToast&&(Or.App.get_activeAppFrame().notificationBar.removeEntry(this._networkStatusToast),this._networkStatusToast.dispose(),this._networkStatusToast=null)},c.populateCommentPane=function(){this.commentsDataReady&&this._sessionReady&&!this._fetchCommentsDataFailed&&(this._commentPane.showComments(this._commentModel.getAllComments()),this.pane.addCommentOnRender&&(this.pane.addCommentOnRender=!1))},i.getInstance=function(){return i.getInstanceWithResolvedDependencies()},i.getInstanceWithResolvedDependencies=function(){return Or.App.instance.fileTypeSupportsCommenting&&!s.AFrameworkApplication.isEmbedded&&!s.AFrameworkApplication.isNoChrome&&Or.App.get_activeAppFrame().workspace&&Or.App.get_activeAppFrame().workspace.appBaseDom&&Or.App.get_activeAppFrame().workspace.initialized?new i(Or.App.get_activeAppFrame().workspace.appBaseDom,Q.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller,s.AFrameworkApplication.theActionManager,Q.a.instance.resolveLazy("Postmessage.IHostPostmessenger"),Bt.FocusManager.instance()):null},i.getErrorInfoForBeginCommentFailure=function(e){var t,n;switch(n=null,e){case 1:return t=us.a.commentBeginInvalidPropertyData,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};case 7:return{returnValue:null,helpMessage:n,errorCode:t=us.a.commentBeginPermissionDenied};case 14:return t=us.a.commentBeginUnspecifiedFailure,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};case 36:return t=us.a.commentBeginOldProductDigitalSignature,{returnValue:WacWordviewerStrings.OldProductDigitalSignatureOpen,helpMessage:n,errorCode:t};case 9:return t=us.a.commentBeginDocumentProtectionSettings,{returnValue:WacWordviewerStrings.DocumentProtectionSettingsCommentOpen,helpMessage:n,errorCode:t};case 30:return t=us.a.commentBeginDocumentPasswordEncrypted,{returnValue:WacWordviewerStrings.DocumentPasswordEncryptedOpen,helpMessage:n,errorCode:t};case 31:return t=us.a.commentBeginFileCheckedOut,{returnValue:WacWordviewerStrings.CheckedOutOpen,helpMessage:n,errorCode:t};case 17:return t=us.a.commentBeginFileRequiresCheckout,{returnValue:WacWordviewerStrings.RequiresCheckoutOpen,helpMessage:n,errorCode:t};case 16:return t=us.a.commentBeginFileLockedForOfflineCheckout,{returnValue:WacWordviewerStrings.LockedForOfflineCheckoutOpen,helpMessage:n,errorCode:t};case 11:return t=us.a.commentBeginFileLockedByOtherInterface,n=WacWordviewerStrings.CoauthHelpContextId,{returnValue:WacWordviewerStrings.LockedByOtherInterfaceOpen,helpMessage:n,errorCode:t};case 12:return t=us.a.commentBeginCorruptedFile,{returnValue:WacWordviewerStrings.CorruptFileOpen,helpMessage:n,errorCode:t};case 57:return t=us.a.commentBeginNumberOfCoauthorsReachedMax,{returnValue:WacWordviewerStrings.NumberOfCoauthorsReachedMaxOpen,helpMessage:n,errorCode:t};case 61:return t=us.a.commentBeginDocumentMarkedFinal,{returnValue:WacWordviewerStrings.DocumentMarkedFinalOpen,helpMessage:n,errorCode:t};case 38:return t=us.a.commentBeginPreReleaseFile,{returnValue:WacWordviewerStrings.PreReleaseFile,helpMessage:n,errorCode:t};case 69:return t=us.a.commentBeginClientServerNormalizationConflict,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};case 35:return t=us.a.commentBeginLockExpired,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};case 47:return t=us.a.commentBeginWordFileVersionMismatch,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};case 39:return t=us.a.commentBeginFileEditedInRichClient,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};case 33:return t=us.a.commentBeginRequestCountTooLarge,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t};default:return t=us.a.commentBeginUnspecifiedFailure,{returnValue:WacWordviewerStrings.GenericErrorOpen,helpMessage:n,errorCode:t}}},a=i,(o=[{key:"hasSharedLock",get:function(){return this._hasSharedLock}},{key:"commentsDataReady",get:function(){return this._commentsDataReady}}])&&il(a.prototype,o),l&&il(a,l),Object.defineProperty(a,"prototype",{writable:!1}),i}(Do.a);function sl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ol.maxRetryCountForBeginCommentingBusy=2,Object(i.a)(ol,"ViewerCommentManager",Do.a,[]);var ll=function(){function e(){this.onFullAppSettingsReady=function(){Do.a.factory=ol.getInstance,ae.a.registerDispatchHandler(e.dispatcher),Do.a.instance,(s.AFrameworkApplication.appSettingsManager.appSettings.BootActivityNavigationId?s.AFrameworkApplication.appSettingsManager.appSettings.BootActivityNavigationId.toString():null)&&r.ULS.sendTraceTag(37291602,327,15,"Deep linking for word viewer."),Or.App.get_activeAppFrame()&&Or.App.get_activeAppFrame().ribbonUser&&Or.App.get_activeAppFrame().ribbonUser.poll()}}var t,n,i,a=e.prototype;return a.configure=function(e){},a.init=function(){s.AFrameworkApplication.appSettingsManager.invokeOrRegisterOnFullAppSettingsReady(this.onFullAppSettingsReady)},a.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},e.dispatcher=function(e,t,n,i,r){return e===p.a.showCommentPane?Do.a.instance.showCommentPane(e,t,n,i,r):e===Nr.a.toggleCommentPane?Do.a.instance.toggleCommentPane(e,t,n,i,r):2},t=e,(n=[{key:"name",get:function(){return"WordViewer.Comments"}}])&&sl(t.prototype,n),i&&sl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function cl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ll,"Program",null,[2,3]);var ul=function(){function e(){}var t,n,i;return e.prototype.clickHandler=function(e){return r.ULS.sendTraceTag(37034014,342,50,"User clicked on the Privacy statement."),ut.a.safelyOpenWindow(this.privacyLink,"_blank",void 0,"SendUsYourFileDialog.PrivacyLink"),!0},t=e,(n=[{key:"privacyLink",get:function(){return s.AFrameworkApplication.privacyUrl}}])&&cl(t.prototype,n),i&&cl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(ul,"PrivacyLinkHandler",null,[155]);var dl=function(){function e(e,t){this._onDone=null,this._sendUsYourFileManager=e,this._sendUsYourFileDialogFactory=t}var t=e.prototype;return t.showDialog=function(e){this._onDone=e,this._sendUsYourFileDialogFactory.create().initializeAndShow(Object(A.a)(this,this.handleDialog,"handleDialog"))},t.handleDialog=function(e,t){1===e&&this._sendUsYourFileManager.sendRequestToAcquireFile(),this._onDone(),this._onDone.prototype},e}();function pl(e,t){return(pl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(dl,"SendUsYourFileController",null,[131]);var hl=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this)._privacyLink=null,r._clickInputManager=t,r._privacyLinkHandler=n,r._dialogStrings=i,r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,pl(t,n);var a=i.prototype;return a.initializeAndShow=function(e){this.buttonsOption=1,this.setButtonText(1,this._dialogStrings.send),this.setButtonText(0,this._dialogStrings.noThanks),r.ULS.shipAssertTag(37034013,342,!this._privacyLink,"privacy anchor should be null before initializing it.");var t=this.dialogContent();this.messageBoxImpl(this._dialogStrings.appTitle,null,"CancelRequest_32x32x32",null,e,t),this.setDescribedByForDialog(this.myId(i.sendUsYourFileId))},a.dialogContent=function(){var e=document.createElement("span");e.innerText=this._dialogStrings.problemOpeningDocument;var t=document.createElement("span");t.innerText=this._dialogStrings.tellMicrosoftAboutThis,t.style.fontWeight=this._dialogStrings.userInterfaceFontWeightBold;var n=document.createElement("span");n.innerText=this._dialogStrings.sendUsYourFileDialogText;var r=this.constructPrivacyLinkSpan(),a=document.createElement("span");return a.id=this.myId(i.sendUsYourFileId),a.appendChild(e),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(t),a.appendChild(document.createElement("br")),a.appendChild(n),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(document.createElement("br")),a.appendChild(r),a},a.constructPrivacyLinkSpan=function(){var e=document.createElement("span"),t=document.createElement("a");return t.innerText=this._dialogStrings.privacyStatement,t.href=this._privacyLinkHandler.privacyLink||"",e.appendChild(t),this._privacyLink=t,this._clickInputManager.registerHandler(m.a.click,this._privacyLink,Object(A.a)(this._privacyLinkHandler,this._privacyLinkHandler.clickHandler,"clickHandler")),e},a.dispose=function(){this._privacyLink&&(this._clickInputManager.unregisterHandler(m.a.click,this._privacyLink,Object(A.a)(this._privacyLinkHandler,this._privacyLinkHandler.clickHandler,"clickHandler")),this._privacyLink=null),e.prototype.dispose.call(this)},i}(Kn.StandardDialog);hl.sendUsYourFileId="sendUsYourFileId",Object(i.a)(hl,"SendUsYourFileDialog",Kn.StandardDialog,[156]);var gl=function(){function e(){}return e.prototype.create=function(){return Q.a.instance.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileDialog")},e}();function ml(e,t){return(ml=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(gl,"Factory",null,[154]);var fl=function(e){var t,n;function i(){var t;return(t=e.call(this)||this).FileId=null,t}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ml(t,n),i.prototype.getClassId=function(){return 38},i.construct=function(e){var t=new i;return t.FileId=e,t},i}(ps);Object(i.a)(fl,"CreateSendUsYourFileRequest",ps,[]);var vl=function(){function e(e,t,n){this._batchedServerOperationFactory=e,this._getRootQuerySignature=t,this._logSendingRequest=n}var t=e.prototype;return t.sendRequestToAcquireFile=function(e){var t=this;if(void 0===e&&(e=!1),this._getRootQuerySignature){var n,i=fl.construct(this._getRootQuerySignature()),r=new Ho;if(r.requestObject=i,r.status=1,r.perfTag="BootErrorReport",e)n=this._batchedServerOperationFactory(null);else{n=this._batchedServerOperationFactory((function(e){t.responseHandler(r,e)}))}n.addOperation(r),n.dispatchRequest(),this._logSendingRequest()}},t.responseHandler=function(e,t){5===e.statusCode&&this.sendRequestToAcquireFile(!0)},e}();Object(i.a)(vl,"SendUsYourFileManager",null,[132]);var _l=function(){function e(e,t){this._container=null,this._dialogStrings=e,this._getRootQuerySignature=t}var t=e.prototype;return t.configure=function(e){var t=this;this._container=e,this._container.registerFactory("Wac.Common.SendUsYourFile.ISendUsYourFileDialogStrings",(function(){return t._dialogStrings})).singleInstance(),this._container.registerFactory("Wac.Common.SendUsYourFile.ISendUsYourFileDialog",(function(){return new hl(ia.a.instance,new ul,t._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileDialogStrings"))})),this._container.registerFactory("Wac.Common.SendUsYourFile.ISendUsYourFileManager",(function(){return new vl((function(e){return t.getBatchedServerOperation(0,e)}),t._getRootQuerySignature,(function(){r.ULS.sendTraceTag(42022664,342,50,"send us your file request is now sent.")}))})),this._container.registerFactory("Wac.Common.SendUsYourFile.ISendUsYourFileController",(function(){var e=new gl;return new dl(t._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileManager"),e)})).singleInstance()},t.init=function(){this._container.resolve("Wac.Common.SendUsYourFile.ISendUsYourFileController")},t.dispose=function(){},e}();Object(i.a)(_l,"SendUsYourFilePackageManager",null,[]);function yl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Sl=function(){function e(){}var t,n,i;return t=e,(n=[{key:"appTitle",get:function(){return CommonUIStrings.l_AppTitle}},{key:"send",get:function(){return CommonUIStrings.l_Send}},{key:"noThanks",get:function(){return CommonUIStrings.l_NoThanks}},{key:"problemOpeningDocument",get:function(){return WacWordviewerStrings.ProblemOpeningDocument}},{key:"tellMicrosoftAboutThis",get:function(){return WacWordviewerStrings.TellMicrosoftAboutThis}},{key:"userInterfaceFontWeightBold",get:function(){return CommonUIStrings.l_UserInterfaceFontWeightBold}},{key:"sendUsYourFileDialogText",get:function(){return WacWordviewerStrings.SendUsYourFileDialogText}},{key:"privacyStatement",get:function(){return CommonUIStrings.l_PrivacyStatement}}])&&yl(t.prototype,n),i&&yl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function bl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Al(e,t){return(Al=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Sl,"WordViewerSendUsYourFileDialogStrings",null,[119]);var Cl=function(e){var t,n,i,r,a;function o(){return e.call(this,new Sl,(function(){return Or.App.instance.baseDocQueryParam}))||this}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,Al(t,n),o.prototype.getBatchedServerOperation=function(e,t){return new ss(e,t,"SendUsYourFile.ashx",Or.App.mode,Or.App.webServiceBase)},o.main=function(){y.a.instance.registerPackage(new o)},i=o,(r=[{key:"name",get:function(){return"WordViewer.SendUsYourFile"}}])&&bl(i.prototype,r),a&&bl(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(_l);Object(i.a)(Cl,"PackageManager",_l,[2,3]);var Tl=function(){function e(){this._isAppFullyLoaded=!1}var t=e.prototype;return t.markAppAsFullyLoaded=function(){this._isAppFullyLoaded=!0,Fe.a.get_instance().setAppInitializationStatus(19)},t.isAppFullyLoaded=function(){return this._isAppFullyLoaded},e.getAnInstanceWithResolvedDependencies=function(){return new ln.a((function(){return new e}))},e.get_instance=function(){return e._instance.value},e}();function kl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Tl._instance=Tl.getAnInstanceWithResolvedDependencies(),Object(i.a)(Tl,"AppLoadStateTracker",null,[]);var wl=function(){function e(){}var t,n,i,r=e.prototype;return r.configure=function(e){},r.init=function(){s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.MarkAppFullyLoadedExplicitly",!1)||Tl.get_instance().markAppAsFullyLoaded()},r.dispose=function(){},t=e,(n=[{key:"name",get:function(){return"AppLoadStateTracker"}}])&&kl(t.prototype,n),i&&kl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(wl,"AppLoadStateTrackerPackage",null,[2,3]);var Il=n(156);function Pl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Fl=function(){function e(){}var t,n,i;return e.getAppStoreURL=function(t,n){switch(t){case 3:return e.getWordURLForPlatform(n);case 2:return e.getPPTURLForPlatform(n);case 1:return e.getExcelURLForPlatform(n)}return""},e.getWordURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkWordWac.toString()}return""},e.getPPTURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkPptWac.toString()}return""},e.getExcelURLForPlatform=function(e){switch(e){case 1:case 2:return s.AFrameworkApplication.appSettingsManager.appSettings.WildFireAdjustLinkExcelWac.toString()}return""},e.openInClient=function(t,n,i){(z.a.isIPad||z.a.isAndroid)&&(window.setTimeout((function(){e.redirectToStore(i,e.getWildFirePlatform())}),500),MSOJS.ClientUtils.OpenDocumentWithProtocolHandlerNoCallBack(e.appTypeToApplication(i),t,0,!1))},e.clientRedirect=function(t,n,i,r){n&&r&&r(),e.openInClient(t,n,i)},e.getWildFirePlatform=function(){return z.a.isIPad?1:z.a.isAndroid?2:z.a.isWindows?3:z.a.isMac?4:0},e.getWildFireConfigSettingName=function(e){switch(e){case 3:return"WildFireWordBizBar";case 2:return"WildFirePowerPointBizBar";case 1:return"WildFireExcelBizBar";default:return""}},e.getWildFireFlightSettingName=function(e){switch(e){case 3:return"WildFireWordBizBarFlight";case 2:return"WildFirePowerPointBizBarFlight";case 1:return"WildFireExcelBizBarFlight";default:return""}},e.redirectToStore=function(t,n){if(1===n){r.ULS.sendTraceTag(17151569,306,50,"User Directed to App Store");var i=e.getAppStoreURL(t,n);z.a.iPadOsVersion>8?ut.a.safelyOpenWindow(i,void 0,void 0,"RedirectToAppStore"):ut.a.followHyperlinkWithNoReferrer(i)}else{if(document.hidden)return;if(e.isLocaleChina){var a=s.AFrameworkApplication.appSettingsManager.appSettings.WildFireUrlChinaStoreAndroid.toString();a?(r.ULS.sendTraceTag(18088018,306,50,"User Directed to China Proxy Page"),ut.a.followHyperlinkWithNoReferrer(a)):r.ULS.sendTraceTag(18088019,306,50,"Empty Url in China Proxy Page BRS Setting")}else r.ULS.sendTraceTag(18088020,306,50,"User Directed to Play Store"),MSOJS.ClientUtils.NavigateToUrlUsingClickingOnATag(e.getAppStoreURL(t,n),null,null)}},e.appTypeToApplication=function(e){switch(e){case 3:return 5;case 2:return 3;case 1:return 1;default:return 0}},e.getBizBarDismissKeyForApplication=function(e){switch(e){case 3:return"WordBizBarDismiss";case 2:return"PptBizBarDismiss";case 1:return"ExcelBizBarDismiss";default:return""}},e.isLocalStorageValueTrue=function(t){var n=e.getItemFromLocalStore(t);return!(!n||""===n)&&Boolean.parse(n)},e.setTrueInLocalStore=function(t){e.setItemInLocalStore(t,"true")},e.getItemFromLocalStore=function(e){try{return localStorage.getItem(e)}catch(e){return r.ULS.sendTraceTag(18416668,306,50,"WildFire LocalStorage GetItem Failed with NullReferenceException : "+e.message),null}},e.setItemInLocalStore=function(e,t){try{localStorage.setItem(e,t)}catch(e){r.ULS.sendTraceTag(18416669,306,50,"WildFire LocalStorage SetItem Failed with exception : "+e.message)}},t=e,i=[{key:"isLocaleChina",get:function(){return"zh-CN"===window.navigator.language}},{key:"shouldUseChromeBar",get:function(){return(z.a.isWindows||z.a.isMac)&&z.a.isChrome}},{key:"shouldShowWildFireUI",get:function(){return z.a.isIPad||z.a.isAndroid}}],(n=null)&&Pl(t.prototype,n),i&&Pl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Fl.chomeExtensionBarDismissKey="ChromeExtensionBarDismiss",Object(i.a)(Fl,"WildFireUtilities",null,[]);var El=function(){function e(){}var t=e.prototype;return t.add=function(e,t){this.set_item(e,t)},t.get=function(e){return this.get_item(e)},t.getOrElse=function(e,t){var n,i;return(n=this.tryGetValue(e),i=n.value,n).returnValue?i:t},t.logString=function(e,t){void 0===e&&(e=" "),void 0===t&&(t=":");var n=!0,i=new Sys.StringBuilder;return this.forEach((function(r,a){return n?n=!1:i.append(e),i.append(r?r.toString():""),i.append(t),i.append(a?a.toString():""),!0})),i.toString()},e}();Object(i.a)(El,"AXDictionary",null,[205]);var Ol=function(e,t){this.key=e,this.value=t};Object(i.a)(Ol,"XDictionaryEntry",null,[]);var Ml=function(){function e(){}var t=e.prototype;return t.any=function(e){void 0===e&&(e=null);for(var t=0;t<this.length;t++)if(!e||e(this.get_item(t)))return!0;return!1},t.contains=function(e,t){var n=!1;return this.forEach((function(i){return!t(e,i)||(n=!0,!1)})),n},t.getItemAt=function(e){return this.get_item(e)},t.last=function(){return this.get_item(this.length-1)},t.forEach=function(e){for(var t=0;t<this.length&&e(this.get_item(t));t++);},t.areEqual=function(e,t){if(!e)return!1;if(e.length!==this.length)return!1;for(var n=0;n<this.length;n++)if(!t(this.get_item(n),e.get_item(n)))return!1;return!0},t.isInsertionIndexInvalid=function(e){return e<0||e>this.length},t.fillHashSet=function(e){this.forEach((function(t){return e.add(t),!0}))},t.logString=function(e){void 0===e&&(e=" ");var t=!0,n=new Sys.StringBuilder;return this.forEach((function(i){return t?t=!1:n.append(e),n.append(i?i.toString():""),!0})),n.toString()},e}();Object(i.a)(Ml,"AXList",null,[220]);var Ll=function(){function e(){}return e.prototype.containsAll=function(e){var t=this;if(!e)return!0;var n=!0;return e.forEach((function(e){return n=t.contains(e)})),n},e}();function Rl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Dl(e,t){return(Dl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Ll,"AXHashSet",null,[246]);var xl=function(e){var t,n;function i(){var t;return(t=e.call(this)||this)._collection={},t._count=0,t}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Dl(t,n);var r,a,o,s=i.prototype;return s.set_count=function(e){return this._count=e,e},s.add=function(e){e.toString()in this._collection||(this.set_count(this.count+1),this._collection[e.toString()]=!0)},s.remove=function(e){var t=e.toString();t in this._collection&&(this.set_count(this.count-1),delete this._collection[t])},s.contains=function(e){return e.toString()in this._collection},r=i,(a=[{key:"count",get:function(){return this._count}}])&&Rl(r.prototype,a),o&&Rl(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(Ll);function Bl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ul(e,t){return(Ul=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(xl,"XHashSet",Ll,[]);var Hl=function(e){var t,n;function i(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this)._list=t||[],n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ul(t,n);var r,a,o,s=i.prototype;return s.get_item=function(e){return this._list[e]},s.shallowClone=function(){return new i(Array.clone(this._list))},s.add=function(e){Array.add(this._list,e)},s.insert=function(e,t){if(this.isInsertionIndexInvalid(e))throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}] [item: {2}]",e,this.length,t));Array.insert(this._list,e,t)},s.insertRange=function(e,t){if(this.isInsertionIndexInvalid(e))throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}]",e,this.length));for(var n=t.length-1;n>=0;n--)Array.insert(this._list,e,t.getItemAt(n))},s.deleteAt=function(e){if(e<0||e>=this.length)throw Error.argument(String.format("ArgumentException: [index: {0}] [length: {1}]",e,this.length));Array.removeAt(this._list,e)},s.toHashSet=function(){var e=new xl;return this.fillHashSet(e),e},s.toArray=function(){return this._list},s.reverse=function(){this._list.reverse()},s.clear=function(){Array.clear(this._list)},s.toArrayList=function(){return this._list},r=i,(a=[{key:"length",get:function(){return this._list.length}}])&&Bl(r.prototype,a),o&&Bl(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(Ml);function Nl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Wl(e,t){return(Wl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Hl,"XList",Ml,[]);var jl=function(e){var t,n;function i(t){var n;return void 0===t&&(t=null),(n=e.call(this)||this)._count=0,n._defaultValue=t,n._dictionary={},n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Wl(t,n);var r,a,o,s=i.prototype;return s.get_item=function(e){var t=this._dictionary[e.toString()];return t?t.value:this._defaultValue},s.set_item=function(e,t){return this.containsKey(e)||this.set_count(this.count+1),this._dictionary[e.toString()]=new Ol(e,t),t},s.set_count=function(e){return this._count=e,e},s.remove=function(e){this.containsKey(e)&&(this.set_count(this.count-1),delete this._dictionary[e.toString()])},s.containsKey=function(e){return e.toString()in this._dictionary},s.tryGetValue=function(e){return e.toString()in this._dictionary?{returnValue:!0,value:this.get(e)}:{returnValue:!1,value:this._defaultValue}},s.forEach=function(e){var t=this._dictionary;for(var n in t){var i={key:n,value:t[n]}.value;if(!e(i.key,i.value))break}},s.toList=function(e){var t=new Hl,n=this._dictionary;for(var i in n){var r={key:i,value:n[i]}.value;t.add(e(r))}return t},s.toSerializableDictionary=function(){var e={},t=this._dictionary;for(var n in t){var i={key:n,value:t[n]},r=i.value;e[i.key]=r.value}return e},i.createFromSerializableDictionary=function(e,t,n,r){void 0===r&&(r=null);var a=new i(r);for(var o in e){var s={key:o,value:e[o]};a.add(t(s.key),n(s.value))}return a},r=i,(a=[{key:"count",get:function(){return this._count}},{key:"keys",get:function(){return this.toList((function(e){return e.key}))}},{key:"values",get:function(){return this.toList((function(e){return e.value}))}}])&&Nl(r.prototype,a),o&&Nl(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(El);function Vl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(jl,"XDictionary",El,[]);var ql=function(){function e(){this._androidWordStrings=new jl,this._androidPowerPointStrings=new jl,this._androidExcelStrings=new jl,this.buildAndroidWordDictionary(this._androidWordStrings),this.buildAndroidPowerPointDictionary(this._androidPowerPointStrings),this.buildAndroidExcelDictionary(this._androidExcelStrings),this._iPadWordStrings=new jl,this._iPadPowerPointStrings=new jl,this._iPadExcelStrings=new jl,this.buildiOSWordDictionary(this._iPadWordStrings),this.buildiOSPowerPointDictionary(this._iPadPowerPointStrings),this.buildiOSExcelDictionary(this._iPadExcelStrings),this._chromeExtensionStrings=new jl,this.buildChromeExtensionDictionary(this._chromeExtensionStrings),this.addCommonStrings(this._chromeExtensionStrings),this.addCommonStrings(this._androidExcelStrings),this.addCommonStrings(this._androidPowerPointStrings),this.addCommonStrings(this._androidWordStrings),this.addCommonStrings(this._iPadPowerPointStrings),this.addCommonStrings(this._iPadWordStrings),this.addCommonStrings(this._iPadExcelStrings)}var t,n,i,r=e.prototype;return r.getStrings=function(e,t){switch(e){case 1:return this.getiPadStringsForApp(t);case 2:return this.getAndroidStringsForApp(t)}return Fl.shouldUseChromeBar?this._chromeExtensionStrings:null},r.buildAndroidWordDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireWordBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireWordBizBarAndroidCallToAction)},r.buildAndroidPowerPointDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFirePPTBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFirePPTBizBarAndroidCallToAction)},r.buildAndroidExcelDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireExcelBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireExcelBizBarAndroidCallToAction)},r.buildiOSWordDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireWordBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireWordBizBarIPadCallToAction),e.add("OverlayBig","Get the Word app"),e.add("OverlaySmall","Built for the iPad\u2014for when you're working on the go, even offline."),e.add("OverlaySmallSplit1","Discover Word"),e.add("OverlaySmallSplit2","designed for the iPad."),e.add("SkipButton","Skip for now")},r.buildChromeExtensionDictionary=function(e){e.add("Headline","Get the Office Online extension for Chrome"),e.add("UseAppButton","Get the extension"),e.add("CallToAction","The quickest way to view, edit, and share Office files in Chrome.")},r.buildiOSPowerPointDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFirePPTBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFirePPTBizBarIPadCallToAction),e.add("OverlayBig","Get the PowerPoint app"),e.add("OverlaySmall","Built for the iPad\u2014for when you're working on the go, even offline."),e.add("OverlaySmallSplit1","Discover PowerPoint"),e.add("OverlaySmallSplit2","designed for the iPad."),e.add("SkipButton","Skip for now")},r.buildiOSExcelDictionary=function(e){e.add("Headline",CommonUIStrings.l_WildFireExcelBizBarHeadline),e.add("UseAppButton",CommonUIStrings.l_WildFireBizBarUseAppButtonText),e.add("InstallButton",CommonUIStrings.l_WildFireBizBarInstallButtonText),e.add("OpenAppButton",CommonUIStrings.l_WildFireBizBarOpenAppButtonText),e.add("CallToAction",CommonUIStrings.l_WildFireExcelBizBarIPadCallToAction)},r.addCommonStrings=function(e){e.add("Corporation","Microsoft Corporation")},r.getiPadStringsForApp=function(e){switch(e){case 3:return this._iPadWordStrings;case 2:return this._iPadPowerPointStrings;case 1:return this._iPadExcelStrings}return null},r.getAndroidStringsForApp=function(e){switch(e){case 3:return this._androidWordStrings;case 2:return this._androidPowerPointStrings;case 1:return this._androidExcelStrings}return null},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&Vl(t.prototype,n),i&&Vl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Gl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ql._instance=null,Object(i.a)(ql,"WildFireStringFactory",null,[]);var Kl=function(){function e(e,t,n,i,r,a){void 0===r&&(r=null),void 0===a&&(a=null),this._openURL=null,this._id=e,this._platform=t,this._getURL=r,this._isEdit=i,this._saveAction=a,this._appLinkBar=null,this._useTwoButton=n,this._stringsDict=ql.instance.getStrings(t,e)}var t,n,i,a=e.prototype;return a.createBusinessBarEntry=function(){this._appLinkBar=new Il.a(this.title,this.message,null),this._appLinkBar.addButton(this.buttonOneText,Object(A.a)(this,this.onButtonOneClick,"onButtonOneClick"),""),this._useTwoButton&&this._appLinkBar.addSecondButton(this.buttonTwoText,Object(A.a)(this,this.onButtonTwoClick,"onButtonTwoClick"),""),this._appLinkBar.closeHandler=Object(A.a)(this,this.dismissBar,"dismissBar"),this._appLinkBar.image=3,this._appLinkBar.id=16,this._appLinkBar.closeable=!0},a.onButtonOneClick=function(e){this._useTwoButton?this.installAppButtonClick(e):this.useAppButtonClick(e)},a.onButtonTwoClick=function(e){this._useTwoButton&&this.openAppButtonClick(e)},a.installAppButtonClick=function(e){r.ULS.sendTraceTag(17932829,306,50,"Install App Button of BusinessBar Clicked"),this._isEdit&&this._saveAction&&this._saveAction(),Fl.redirectToStore(this._id,this._platform)},a.openAppButtonClick=function(e){this.openUrl&&(r.ULS.sendTraceTag(17932830,306,50,"Open App Button of BusinessBar Clicked"),this._isEdit&&this._saveAction&&this._saveAction(),MSOJS.ClientUtils.OpenDocumentWithProtocolHandlerNoCallBack(Fl.appTypeToApplication(this._id),this.openUrl,0,!1))},a.useAppButtonClick=function(e){Fl.shouldUseChromeBar?this.buttonClickChromeExtension(e):(r.ULS.sendTraceTag(17109255,306,50,"AppBusinessBarNav"),Fl.setTrueInLocalStore("BizBarClicked"),1!==this._platform&&2!==this._platform||Fl.clientRedirect(this.openUrl,this._isEdit,this._id,this._saveAction))},a.buttonClickChromeExtension=function(e){this._isEdit?r.ULS.sendTraceTag(17571974,323,50,"ChromeExtBannerClicked"):r.ULS.sendTraceTag(17571975,301,50,"ChromeExtBannerClicked"),ut.a.followHyperlinkWithNoReferrer(s.AFrameworkApplication.appSettingsManager.appSettings.WildFireChromeExtensionUrl.toString())},a.dismissBarChromeExtension=function(e){this._isEdit?r.ULS.sendTraceTag(17571976,323,50,"ChromeExtBannerDismissed"):r.ULS.sendTraceTag(17571977,301,50,"ChromeExtBannerDismissed"),Fl.setTrueInLocalStore(Fl.chomeExtensionBarDismissKey)},a.dismissBar=function(e){Fl.shouldUseChromeBar?this.dismissBarChromeExtension(e):(Fl.setTrueInLocalStore(Fl.getBizBarDismissKeyForApplication(this._id)),r.ULS.sendTraceTag(17109256,306,50,"AppBusinessBarDismissed"))},e.createWildFireBusinessBar=function(){var t=s.AFrameworkApplication.activeFrame.applicationInstance,n=(s.AFrameworkApplication.appSettingsManager,t.officeAppType),i=1===t.officeAppMode,a=Fl.getWildFirePlatform(),o=t.saveAction(),l=new e(n,a,z.a.iPadOsVersion>8,i,(function(){return t.clientUrl}),o);return r.ULS.sendTraceTag(9208407,306,50,"AppBusinessBarDisplayed"),l},t=e,(n=[{key:"title",get:function(){return this._stringsDict.get_item("Headline")}},{key:"message",get:function(){return this._stringsDict.get_item("CallToAction")}},{key:"useTwoButton",get:function(){return this._useTwoButton}},{key:"buttonOneText",get:function(){return this._useTwoButton?this._stringsDict.get_item("InstallButton"):this._stringsDict.get_item("UseAppButton")}},{key:"buttonTwoText",get:function(){return this._useTwoButton?this._stringsDict.get_item("OpenAppButton"):""}},{key:"businessBarEntry",get:function(){return this._appLinkBar}},{key:"openUrl",get:function(){return this._openURL||(this._openURL=this._getURL()),this._openURL}}])&&Gl(t.prototype,n),i&&Gl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function zl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Kl,"WildFireBusinessBar",null,[]);var Xl=function(){function e(){}var t,n,i,a=e.prototype;return a.addBusinessBarEntry=function(e){var t=s.AFrameworkApplication.activeFrame.applicationInstance,n=!1;return e&&(e.createBusinessBarEntry(),e.businessBarEntry&&(n=t.addEntryToBusinessBar(e.businessBarEntry,!0))),n},a.createChromeExtensionBizBar=function(){var e=s.AFrameworkApplication.activeFrame.applicationInstance,t=(e.officeAppType,1===e.officeAppMode),n=new Kl(e.officeAppType,Fl.getWildFirePlatform(),!1,t);this.addBusinessBarEntry(n)&&r.ULS.sendTraceTag(17571982,306,50,"ChromeExtBannerDisplayed")},a.createWildFireBusinessBar=function(e,t,n,i,a,o,s){var l=new Kl(t,i,a,n,o,s);this.addBusinessBarEntry(l)&&r.ULS.sendTraceTag(9208407,306,50,"AppBusinessBarDisplayed")},a.createWildFireWacUI=function(){var e=s.AFrameworkApplication.activeFrame.applicationInstance,t=s.AFrameworkApplication.appSettingsManager,n=e.officeAppType,i=1===e.officeAppMode;if(t.getBooleanAppSetting(Fl.getWildFireConfigSettingName(n))){var r=Fl.getWildFirePlatform(),a=z.a.iPadOsVersion>8;if(2!==n||2!==r||!i){document.body;var o=t.getBooleanAppSetting(Fl.getWildFireFlightSettingName(n)),l=e.saveAction();o&&!Fl.isLocalStorageValueTrue(Fl.getBizBarDismissKeyForApplication(n))&&this.createWildFireBusinessBar(e,n,i,r,a,(function(){return e.clientUrl}),l)}}},a.init=function(){var e=s.AFrameworkApplication.appSettingsManager,t=e.getBooleanAppSetting("WildFireChromeExtensionEnabled"),n=e.getBooleanAppSetting("WildFireChromeExtensionBar")&&t;Fl.shouldUseChromeBar&&n&&!Fl.isLocalStorageValueTrue(Fl.chomeExtensionBarDismissKey)?this.createChromeExtensionBizBar():(document.body&&Fl.shouldShowWildFireUI&&this.createWildFireWacUI(),s.AFrameworkApplication.theActionManager.addAction(p.a.launchWildFireBusinessBar,_e.a.frame,Object(A.a)(this,this.launchWildFireBusinessBar,"launchWildFireBusinessBar")))},a.launchWildFireBusinessBar=function(e,t,n,i,r){if(1===n)return 32;if(!r)return 8;var a=r;return this.createWildFireBusinessBar(s.AFrameworkApplication.activeFrame.applicationInstance,a.app,a.mode,a.platform,a.useTwoButton,null,null),32},a.dispose=function(){},a.configure=function(e){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.WildFire"}}])&&zl(t.prototype,n),i&&zl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Xl,"PackageManager",null,[2,3]);var Jl=function(e,t,n){void 0===n&&(n=null),this.id=e.Id,n||(n=""),this.isRecommendation=t,this.recommendationText=n,this.sensitivityLabel=e};Object(i.a)(Jl,"AutoPolicyLabelData",null,[]);var Ql=function(e,t){this.applyLabelFlag=e,this.displayName=t};Object(i.a)(Ql,"PolicyLabelRequestState",null,[]);var Zl=function(){this.noSensitivityLabel="",this.selectASensitivityLabel=""};function Yl(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(Zl,"PolicyStrings",null,[]);var $l=function(){function e(){}var t,n,i;return t=e,i=[{key:"justificationDialogHtmlTemplate",get:function(){return e.justificationDialogHtmlTemplateFormat}}],(n=null)&&Yl(t.prototype,n),i&&Yl(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ec(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function tc(e,t){return(tc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}$l.justificationDialogHtmlTemplateFormat="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>",Object(i.a)($l,"JustificationDialogHtml",null,[]);var nc=function(e){var t,n;function i(t,n){var r;return(r=e.call(this,!1,!1,i.useReactDialog)||this)._justificationList=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther],r._reactJustification=null,r._reactActionButtonEnabled=!1,r.justificationDialogHandler=function(e,t){var n="";if(1===e)for(var a=0;a<r._justificationList.length;a++)if(t[i.radioBox+a]){n=a===r._justificationList.length-1?t[i.textJustification]:r._justificationList[a];break}r._callback(e,r._selectedPolicyId,n)},r.reactJustificationDialogHandler=function(e,t){var n="";1===e&&r._reactJustification&&(n=r._reactJustification),r._callback(e,r._selectedPolicyId,n)},r.onJustificationUpdated=function(e){r._reactJustification=e;var t=r.validate();r._reactActionButtonEnabled!==t&&(r._reactActionButtonEnabled=t,r.updateDialog(CommonUIStrings.l_SensitivityJustificationTitle,r.reactJustificationDialogHandler,r.getReactDialogProps(r._reactActionButtonEnabled)))},r.textAreaHandler=function(e){e.target&&r.setButtonState(1,r.validate())},r.radioButtonFocusHandler=function(e){var t=e.target;if(t){t.checked=!0;var n=$get(i.textJustification);t.id===i.radioBox+(r._justificationList.length-1)?(n.disabled=!1,Sys.UI.DomElement.setVisible(n,!0),n.focus()):(n.disabled=!0,t.focus()),r.setButtonState(1,r.validate())}},r._selectedPolicyId=t,r._callback=n,r.dialogHtml=r.buildDialogHtml(),r.buttonsOption=1,r.dialogId=i.id,r.setButtonText(1,CommonUIStrings.l_DialogChange),r.setButtonState(1,!1),r.setDefaultButton(0),r}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,tc(t,n);var r,a,o,l=i.prototype;return l.showJustificationDialog=function(){if(i.useReactDialog)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,this.reactJustificationDialogHandler,this.getReactDialogProps(this._reactActionButtonEnabled));else{for(var e={},t=0;t<this._justificationList.length;t++)e[i.radioBox+t]=!1;e[i.textJustification]="",this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,this.justificationDialogHandler,e),this.registerFocusForRadioButtons(),Be.a.addHandler($get(i.textJustification),m.a.input,this.textAreaHandler)}},l.validate=function(){if(i.useReactDialog)return this.validateJustificationString(this._reactJustification);var e=$get(i.textJustification);return!!e.disabled||this.validateJustificationString(e.value)},l.validateJustificationString=function(e){var t=e.length<2,n=e.length>500,i=new RegExp("[{|}|;|\\\\]").test(e),r=""===Ze.a.removeAllWhitespace(e);return!(t||n||i||r)},l.getReactDialogProps=function(e){return{id:this.dialogId,bodyControls:{choiceGroupProps:{},textAreaProps:{placeholder:CommonUIStrings.l_SensitivityJustificationPlaceholder}},actionButtonProps:{label:CommonUIStrings.l_DialogChange,disabled:!e},infoMessage:CommonUIStrings.l_SensitivityJustificationMessage,justificationIrrelevantLabel:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,justificationIncorrectLabel:CommonUIStrings.l_SensitivityJustificationIncorrect,justificationOtherLabel:CommonUIStrings.l_SensitivityJustificationOther,onJustificationUpdated:this.onJustificationUpdated}},l.buildDialogHtml=function(){return Bi.a.formatHtml(i.justificationDialogHtmlTemplate,s.AFrameworkApplication.imageClusterPath,na.getImageClass(i.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this._justificationList[0],this._justificationList[1],this._justificationList[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)},l.registerFocusForRadioButtons=function(){for(var e=document.getElementsByName(i.listRadioBox),t=0;t<e.length;t++)Be.a.addHandler(e[t],m.a.focus,this.radioButtonFocusHandler),Be.a.addHandler(e[t],m.a.click,this.radioButtonFocusHandler)},r=i,o=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactJustificationDialogEnabled}}],(a=null)&&ec(r.prototype,a),o&&ec(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}(Bi.a);function ic(e,t){return(ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}nc.justificationDialogHtmlTemplate=$l.justificationDialogHtmlTemplate,nc.listRadioBox="ListRadioBox",nc.radioBox="radiobox",nc.textJustification="txtJustification",nc.iconName="Info_32x32x32",nc.id="JustificationDialog",Object(i.a)(nc,"JustificationDialog",Bi.a,[]);var rc=function(e){var t,n;function i(t,n,i){var a;if((a=e.call(this,!1,!1,!0)||this).mandatoryLabellingDialogHandler=function(e,t){if(1===e&&t.selectedLabel){var n=t.selectedLabel;if(""!==n)return void a._dialogResultCallback(n)}},!t||!i)return r.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a);var o={id:"MandatoryLabellingDialog"};if(a._dialogResultCallback=i,a._learnMoreUrl=n,!s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||a._learnMoreUrl&&""!==a._learnMoreUrl){var l={href:a._learnMoreUrl,target:"_blank"};o.learnMoreLink={type:"AppLinkProps",id:"mandatoryLabellingLearnMoreLink",text:CommonUIStrings.l_LearnMore,handler:l,customTooltip:CommonUIStrings.L_LearnMoreTooltip}}var c={id:"mandatoryLabellingFlyoutMenuSection",controls:t},u={sections:[],shouldAutoOpen:!1};Array.add(u.sections,c),o.labelFlyout={type:"AppFlyoutAnchorProps",id:"mandatoryLabellingFyout",label:"Pick a label",hideLabel:!1,hideChevron:!1,hideIcon:!0,menuDefinition:u};var d={id:"MandatoryLabellingDialog",bodyControls:o};return o.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText,o.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,a.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,a.mandatoryLabellingDialogHandler,d),a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,ic(t,n),i}(Bi.a);function ac(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(rc,"MandatoryLabellingDialog",Bi.a,[]);var oc=function(){function e(){this._isReactDialogEnabled=!!s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,n,i;return e.prototype.createMandatoryLabellingDialog=function(e,t,n){return this._isReactDialogEnabled?new rc(e,t,n):null},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&ac(t.prototype,n),i&&ac(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();oc._instance=null,Object(i.a)(oc,"MandatoryLabellingDialogFactory",null,[158]);var sc=function(){};function lc(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function cc(e,t){return(cc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}sc.statusBarProtectedImageClass="sbProtectForm14",sc.statusBarUnprotectedImageClass="SBStatusBarMarkAsReadOnly14",sc.learnMoreImageClass="Info_16x16x32",sc.checkMarkImageClass="QuickSearchCompletedToday_16x16x32",sc.reactCheckMarkImageClass="CommonControlCheckboxCheck_16",sc.toggleButtonOn="On",sc.visible="Visible",sc.flyoutAnchorImageIsVisible="ImageIsVisible",sc.sourceControlId="SourceControlId",sc.menuItemId="MenuItemId",sc.menu="Menu",sc.appLockId="AppLockId",sc.value="Value",sc.labelText="LabelText",sc.alt="Alt",sc.image16by16="Image16by16",sc.image16by16Class="Image16by16Class",sc.statusBarProtectedIconName="SBProtectForm_16",sc.statusBarUnprotectedIconName="SBStatusBarMarkAsReadOnly_16",sc.icon="Icon",sc.iconColor="IconColor",sc.customTooltip="CustomTooltip",sc.reactTagImage="MipTagDynamicFillWithOutline_20",sc.reactTagLockImage="MipTagLockDynamicFillWithOutline_20",sc.reactTagErrorImage="MipTagErrorOutline_20",sc.reactTagQuestionImage="MipTagQuestionOutline_20",sc.transparentFillColor="transparent",sc.uiLocationId="UILocation",Object(i.a)(sc,"PolicyConstants",null,[]);var uc=function(e){var t,n,i,r,a;function o(t,n,i){var r;return(r=e.call(this,!1,!1,o.useReactDialog)||this).userDefinedPermissionsDialogHandler=function(e,t){1!==e&&r._callback(e,r._selectedPolicyId,"",r._justification)},r._selectedPolicyId=t,r._justification=n,r._callback=i,r.buttonsOption=1,r.dialogId=o.id,r.setDefaultButton(1),r.setDefaultButton(0),r}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,cc(t,n),o.prototype.showUserDefinedPermissionsDialog=function(){var e={id:"UserDefinedPermissionsDialog"};o.useReactDialog&&this.initializeAndShow("Defined Permissions",this.userDefinedPermissionsDialogHandler,e)},i=o,a=[{key:"useReactDialog",get:function(){return s.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled&&s.AFrameworkApplication.activeFrame.applicationInstance.isReactJustificationDialogEnabled}}],(r=null)&&lc(i.prototype,r),a&&lc(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(Bi.a);uc.id="UserDefinedPermissionsDialog",Object(i.a)(uc,"UserDefinedPermissionsDialog",Bi.a,[]);var dc=n(347),pc=n(120),hc=n(73),gc=n(256),mc=n(236),fc=n(174),vc=n(237),_c=n(72),yc=function(e){return e?e.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CleanUpMsospPolicyScript",!1):s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CleanUpMsospPolicyScript",!1)};function Sc(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return bc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bc(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ac(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Cc=function(){function e(e,t,n,i){var a=this;this._labelTitle=null,this._labelDescription=null,this._defaultLabelSetAttempted=!1,this._mandatoryLabelSetAttempted=!1,this._labelsAvailableActivityLogged=!1,this._isStandardLabelApplied=!1,this._isWaitingForFileExistsOnHost=!1,this._isRefreshDocumentPolicyLabelsRequired=!1,this._isJustificationDialogUsed=!1,this._labelsData=null,this._parentToChild=null,this._idToSensitivityLabel=null,this._justification=null,this._autoPolicyLabelData=null,this._recommendedPolicyLabelData=null,this._currentRecommendedPolicyLabelId=null,this._currentAutoPolicyLabelId=null,this._awaitFileExistsOnHostRetryCount=0,this._controlIndex=0,this._policyStrings=null,this._blockSetSensitivityCall=null,this._isThisANewFile=null,this._fileExistsOnHost=null,this.refreshDocumentPolicyLabelsOnModeChange=function(e){a._isRefreshDocumentPolicyLabelsRequired&&!a.isDocumentInViewMode()&&(a._isRefreshDocumentPolicyLabelsRequired=!1,a._policyManager.value.refreshDocumentPolicyLabels())},this.mandatoryLabellingDialogCallback=function(e){a.escapeMandatoryLabeling(a._mandatoryLabellingMenuItemToPolicyId[e])},this.processAutoSensitivityLabel=function(e,t){if(!a._policyManager.value.isSetPolicyLabelRequestInProgress()){var n=a._idToSensitivityLabel[a._labelsData.AppliedPolicyId];if(a._isStandardLabelApplied&&a._autoPolicyLabelData&&a._currentAutoPolicyLabelId!==a._autoPolicyLabelData.id&&(!n||n.Order<a._autoPolicyLabelData.sensitivityLabel.Order)){var i=a.setSensitivityByPolicyId(a._autoPolicyLabelData.id,{},4);if(32!==i)r.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+i);else if(a._currentAutoPolicyLabelId=a._autoPolicyLabelData.id,a._currentRecommendedPolicyLabelId){var o=a._idToSensitivityLabel[a._currentRecommendedPolicyLabelId];o&&o.Order<=a._autoPolicyLabelData.sensitivityLabel.Order&&(a._policyManager.value.removeAutoPolicyBusinessBarEntry(29),a._currentRecommendedPolicyLabelId=null)}}if(n=a._idToSensitivityLabel[a._policyManager.value.getPolicyLabelsData().AppliedPolicyId],a._recommendedPolicyLabelData&&a._currentRecommendedPolicyLabelId!==a._recommendedPolicyLabelData.id&&(!n||n.Order<a._recommendedPolicyLabelData.sensitivityLabel.Order)){var s=a._recommendedPolicyLabelData.id;a._policyManager.value.removeAutoPolicyBusinessBarEntry(29),a._policyManager.value.addAutoPolicyBusinessBarEntry(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,a.getParentChildSensitivityLabelText(a._recommendedPolicyLabelData.sensitivityLabel))+" "+a._recommendedPolicyLabelData.recommendationText,CommonUIStrings.l_PolicyLabelRecommendationButton,(function(e){a.setSensitivityByPolicyId(s,{},8)})),a._currentRecommendedPolicyLabelId=a._recommendedPolicyLabelData.id}a._autoPolicyLabelData=null,a._recommendedPolicyLabelData=null}},this.continueToSetPolicyLabelFromUDPDialog=function(e,t,n,i){1===e&&a.setPolicyLabel(t,i,n)},this.continueToSetPolicyLabelFromJustificationDialog=function(e,t,n){1===e?a.isUDPEnabled()?a.setSensitivityByPolicyId(t,null,2,n):a.setPolicyLabel(t===a._labelsData.AppliedPolicyId?"":t,n,""):a._activeFrame.updateCommandUI()},this.blockUDPSetLabelHandler=function(e,t){1===e&&a._policyManager.value.raiseUDPLabelingAppHandlerEvent(!0)},this.documentLabelPaneHandler=function(e,t,n,i,r){return 32},this.onUpdateLabelInfo=function(e,t){if(t.onSuccess&&a._idToSensitivityLabel){var n=a._idToSensitivityLabel[a._policyManager.value.getPolicyLabelsData().AppliedPolicyId];if(n){if(a._currentRecommendedPolicyLabelId){var i=a._idToSensitivityLabel[a._currentRecommendedPolicyLabelId];i&&i.Order<=n.Order&&(a._policyManager.value.removeAutoPolicyBusinessBarEntry(29),a._currentRecommendedPolicyLabelId=null)}a._currentAutoPolicyLabelId&&a._currentAutoPolicyLabelId!==n.Id&&(a._policyManager.value.removeAutoPolicyBusinessBarEntry(28),a._currentAutoPolicyLabelId=null)}}},this._actionManager=e,this._activeFrame=t,this._appSettingsManager=n,this._policyManager=i,this._menuItemToPolicyId={},this._policyIdToMenuItem={},this._mandatoryLabellingMenuItemToPolicyId={},this.isApplyManualPolicyLabelEnabled=n.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled"),this._policyManager.value.add_setPolicyLabelHandler(this.processAutoSensitivityLabel),this._policyManager.value.add_setPolicyLabelFailureHandler(this.processAutoSensitivityLabel),this._policyManager.value.add_labelInfoUpdateHandler(this.onUpdateLabelInfo),s.AFrameworkApplication.activeFrame&&s.AFrameworkApplication.activeFrame.add_modeSwitched(this.refreshDocumentPolicyLabelsOnModeChange),n.getBooleanAppSetting("SupportsPolicies")&&n.getStringAppSetting("AppliedPolicyId")&&(this._labelTitle=n.getStringAppSetting("IrmPolicyTitle"),this._labelDescription=n.getStringAppSetting("IrmPolicyDescription")),this._awaitFileExistsOnHostMaxRetryCount=this._appSettingsManager.getIntAppSetting("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6),this._awaitFileExistsOnHostRetryDelayMs=this._appSettingsManager.getIntAppSetting("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5e3)}var t,n,i,a=e.prototype;return a.registerActions=function(){this._actionManager.addAction(p.a.openDocumentLabelPane,_e.a.frame,this.documentLabelPaneHandler),this._actionManager.addActionWithFlags(p.a.queryPolicyLabel,_e.a.frame,Object(A.a)(this,this.queryPolicyLabel,"queryPolicyLabel"),96),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this._actionManager.addAction(p.a.openDocumentShortLabelPane,_e.a.frame,this.documentLabelPaneHandler),this._actionManager.addActionWithFlags(p.a.queryPolicyShortLabel,_e.a.frame,Object(A.a)(this,this.queryPolicyShortLabel,"queryPolicyShortLabel"),96)),this._actionManager.addAction(p.a.toggleSensitivity,_e.a.frame,Object(A.a)(this,this.toggleSensitivity,"toggleSensitivity")),this._actionManager.addAction(p.a.populateSensitivityFlyout,_e.a.frame,Object(A.a)(this,this.populateSensitivityFlyout,"populateSensitivityFlyout")),this._actionManager.addAction(p.a.setSensitivity,_e.a.frame,Object(A.a)(this,this.setSensitivity,"setSensitivity")),this._actionManager.addActionWithFlags(p.a.querySensitivity,_e.a.frame,Object(A.a)(this,this.querySensitivity,"querySensitivity"),96),this._actionManager.addAction(p.a.querySensitivityToggleButton,_e.a.frame,Object(A.a)(this,this.querySensitivityToggleButton,"querySensitivityToggleButton")),this._actionManager.addAction(p.a.querySensitivitySubFlyout,_e.a.frame,Object(A.a)(this,this.querySensitivitySubFlyout,"querySensitivitySubFlyout")),this.actionHasFlags(p.a.toggleSensitivity)||this._actionManager.setActionFlags(p.a.toggleSensitivity,4),this.actionHasFlags(p.a.populateSensitivityFlyout)||this._actionManager.setActionFlags(p.a.populateSensitivityFlyout,4),this.actionHasFlags(p.a.setSensitivity)||this._actionManager.setActionFlags(p.a.setSensitivity,4),this.actionHasFlags(p.a.querySensitivityToggleButton)||this._actionManager.setActionFlags(p.a.querySensitivityToggleButton,4),this.actionHasFlags(p.a.querySensitivitySubFlyout)||this._actionManager.setActionFlags(p.a.querySensitivitySubFlyout,4),this._activeFrame.updateCommandUI(),s.AFrameworkApplication.appSettingsManager&&Ot.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this._policyManager.value.remove_labelInfoUpdateHandler(Object(A.a)(this,this.registerActionsHandler,"registerActionsHandler"))},a.registerActionsHandler=function(e,t){this.registerActions()},a.unregisterActions=function(){this._actionManager.removeAction(p.a.openDocumentLabelPane,_e.a.frame,this.documentLabelPaneHandler),this._actionManager.removeAction(p.a.queryPolicyLabel,_e.a.frame,Object(A.a)(this,this.queryPolicyLabel,"queryPolicyLabel")),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpQueryShortLabelEnabled",!1)&&(this._actionManager.removeAction(p.a.openDocumentShortLabelPane,_e.a.frame,this.documentLabelPaneHandler),this._actionManager.removeAction(p.a.queryPolicyShortLabel,_e.a.frame,Object(A.a)(this,this.queryPolicyShortLabel,"queryPolicyShortLabel"))),this._actionManager.removeAction(p.a.toggleSensitivity,_e.a.frame,Object(A.a)(this,this.toggleSensitivity,"toggleSensitivity")),this._actionManager.removeAction(p.a.populateSensitivityFlyout,_e.a.frame,Object(A.a)(this,this.populateSensitivityFlyout,"populateSensitivityFlyout")),this._actionManager.removeAction(p.a.setSensitivity,_e.a.frame,Object(A.a)(this,this.setSensitivity,"setSensitivity")),this._actionManager.removeAction(p.a.querySensitivity,_e.a.frame,Object(A.a)(this,this.querySensitivity,"querySensitivity")),this._actionManager.removeAction(p.a.querySensitivityToggleButton,_e.a.frame,Object(A.a)(this,this.querySensitivityToggleButton,"querySensitivityToggleButton")),this._actionManager.removeAction(p.a.querySensitivitySubFlyout,_e.a.frame,Object(A.a)(this,this.querySensitivitySubFlyout,"querySensitivitySubFlyout"))},a.toggleSensitivity=function(e,t,n,i,r){return 32},a.getAppToggleButtonProps=function(e){var t="mandatoryLabelling_"+e.Id;return this._mandatoryLabellingMenuItemToPolicyId[t]=e.Id,{type:"AppToggleButtonProps",id:t,label:e.DisplayName,hideLabel:!1,customTooltip:e.Tooltip}},a.isUDPEnabled=function(){return this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)},a.isLouderLabelEnabled=function(){return this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)},a.getMandatoryLabellingDialogFlyoutProperties=function(){var e=[];for(var t in this._parentToChild){var n=void 0,i=void 0;if(yc(this._appSettingsManager))n=this._parentToChild[t],i=this._idToSensitivityLabel[t];else{var r={key:t,value:this._parentToChild[t]};n=r.value,i=this._idToSensitivityLabel[r.key]}if(i&&i.Enabled&&!i.HasUserDefinedPermissions)if(n.count){for(var a,o={sections:[],shouldAutoOpen:!1},s={id:"mandatoryLabelling_flyoutMenuSection_"+i.Id,controls:[]},l=Sc(n);!(a=l()).done;){var c=a.value,u=this._idToSensitivityLabel[c];u&&u.Enabled&&!u.HasUserDefinedPermissions&&Array.add(s.controls,this.getAppToggleButtonProps(u))}Array.add(o.sections,s);var d={type:"AppFlyoutAnchorProps",id:"mandatoryLabelling_"+i.Id,label:i.DisplayName,hideLabel:!1,hideChevron:!1,hideIcon:!1,menuDefinition:o};Array.add(e,d)}else Array.add(e,this.getAppToggleButtonProps(i))}return e},a.populateSensitivityFlyout=function(e,t,n,i,r){if(1===n||!this._policyManager.value.areLabelsAvailableForDisplay(!0))return 32;var a=r;return a.MenuItems=Object.assign(new mc.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0}),Array.add(a.MenuItems.MenuSectionList,this.createMenuSection(!this.isReactRibbonEnabled())),this._labelsData.CustomUrl&&Array.add(a.MenuItems.MenuSectionList,this.createLearnMoreButton(this.isReactRibbonEnabled()?this._labelsData.CustomUrl:Ze.a.xmlEncode(this._labelsData.CustomUrl))),this.isReactRibbonEnabled()||(a.PopulationXML=hc.k(a.MenuItems)),32},a.querySensitivity=function(t,n,i,r,a){if(1===i||!a||!this.isApplyManualPolicyLabelEnabled)return 32;if((this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._policyManager.value.areLabelsAvailableForDisplay(!0))&&(a[sc.visible]=!0,this._labelsAvailableActivityLogged||(c.a("MipLabelsAvailable"),this._labelsAvailableActivityLogged=!0),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&!this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.WordOnline.CEBlockPopupEnabled",!1)&&this._labelsData&&this._labelsData.AreLabelsAvailable)){var o=Q.a.instance.resolveFuture("Common.ISystemInitiatedFeedback");if(o)if(yc(this._appSettingsManager)){var s=this._labelsData.AppliedPolicyId?"LouderLabel_LabelExistsOnLoadActivity":"LouderLabel_NoLabelAppliedOnLoadActivity";o.execute((function(e){e.logActivity(s,null)}))}else{var l=!e.isNullOrEmpty(this._labelsData.AppliedPolicyId)?"LouderLabel_LabelExistsOnLoadActivity":"LouderLabel_NoLabelAppliedOnLoadActivity";o.execute((function(e){e.logActivity(l,null)}))}}return 32},a.querySensitivityToggleButton=function(e,t,n,i,r){if(1===n||!r)return 32;var a,o,s=r;return s[sc.toggleButtonOn]=!!(a=s[sc.menuItemId])&&!!(o=this._menuItemToPolicyId[a])&&o===this._labelsData.AppliedPolicyId,32},a.querySensitivitySubFlyout=function(e,t,n,i,r){if(1===n||!r)return 32;var a,o,s,l=r,c=!!(a=l[sc.sourceControlId])&&!!(o=this._menuItemToPolicyId[a])&&!!(s=this._parentToChild[o])&&s.contains(this._labelsData.AppliedPolicyId);return l[sc.flyoutAnchorImageIsVisible]=c,l[sc.toggleButtonOn]=c,32},a.setSensitivity=function(e,t,n,i,r){if(1===n||!r)return 32;var a=r,o=a[sc.sourceControlId],s=this._menuItemToPolicyId[o],l=this.uiLocationToSensitivityPickerLocation(a[sc.uiLocationId]),u=new wa.a;return u.name="SensitivityPickerLocation",u.int64=l,c.a("SensitivityPickerUsage",void 0,void 0,[u]),this.setSensitivityByPolicyId(s,a,2)},a.isDocumentInViewMode=function(){return!!s.AFrameworkApplication.activeFrame&&1===s.AFrameworkApplication.activeFrame.mode},a.triggerDefaultOrMandatoryLabelingIfNeeded=function(){this._labelsData.DefaultLabelId&&this._labelsData.MandatoryLabelingEnforced?this._defaultLabelSetAttempted||this.isDocumentInViewMode()?this._labelsData.AppliedPolicyId?this.escapeMandatoryLabeling(""):(this._policyManager.value.isRetriableLabelError(this._policyManager.value.latestSetPolicyLabelFailureReason)||this.isDocumentInViewMode())&&this.enforceMandatoryLabeling():this.setDefaultLabelIfNeeded():this._labelsData.DefaultLabelId?this.setDefaultLabelIfNeeded():this._labelsData.MandatoryLabelingEnforced&&(this._labelsData.AppliedPolicyId?this.escapeMandatoryLabeling(""):this.enforceMandatoryLabeling())},a.isMandatoryLabelingEnabled=function(){return this._labelsData.MandatoryLabelingEnforced?this._labelsData&&this._labelsData.AreLabelsAvailable?!!(this._appSettingsManager.getBooleanAppSetting("TestOverrideIsReactDialogEnabled")||this._activeFrame&&this._activeFrame.applicationInstance&&this._activeFrame.applicationInstance.isReactDialogEnabled)||(r.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(r.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(r.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)},a.enforceMandatoryLabeling=function(){var e=this;!this.isMandatoryLabelingEnabled()||s.AFrameworkApplication.isMandatoryLabellingMode||this._mandatoryLabelSetAttempted||(s.AFrameworkApplication.isMandatoryLabellingMode=!0,this._mandatoryLabelSetAttempted=!0,r.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this._policyManager.value.raiseMandatoryLabellingAppHandlerEvent("",1),this._policyManager.value.addMandatoryLabellingBusinessBarEntry(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,(function(t){e.mandatoryLabellingBusBarCallback()})))},a.escapeMandatoryLabeling=function(e){this.isMandatoryLabelingEnabled()&&s.AFrameworkApplication.isMandatoryLabellingMode&&(s.AFrameworkApplication.isMandatoryLabellingMode=!1,r.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this._policyManager.value.removeMandatoryLabellingBusinessBarEntry(),this._policyManager.value.raiseMandatoryLabellingAppHandlerEvent(e,2))},a.mandatoryLabellingBusBarCallback=function(){oc.instance.createMandatoryLabellingDialog(this.getMandatoryLabellingDialogFlyoutProperties(),this._labelsData.CustomUrl,this.mandatoryLabellingDialogCallback)},a.awaitFileExistsOnHostEnabled=function(){return this._appSettingsManager.getBooleanAppSetting("CoAuthForProtectedFilesEnabled")&&this._appSettingsManager.getBooleanAppSetting("SupportsOfficeClientCoauthoring")&&this._appSettingsManager.getBooleanAppSetting("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this._fileExistsOnHost&&this.isNewFile},a.setSensitivityByPolicyId=function(e,t,n,i){var a=this;void 0===i&&(i=null),this._policyManager.value.raiseSetPolicyLabelTriggeredEvent(n);var o=32,s=!1,l=!0,c=2===n||8===n||16===n,u=e===this._labelsData.AppliedPolicyId;if(this._blockSetSensitivityCall&&this._blockSetSensitivityCall(e,c))r.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",n),this._activeFrame.updateCommandUI();else if(t&&sc.appLockId in t&&this._policyManager.value.setLockId(t[sc.appLockId]),e)if(this._policyManager.value.isSetPolicyLabelRequestInProgress()||this.awaitFileExistsOnHostEnabled()&&this._isWaitingForFileExistsOnHost)r.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),c&&this.alertSetPolicyLabelFailedUsingDialog(n,e,CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this._appSettingsManager.getBooleanAppSetting("HasDocumentEditRights"))if(this._policyManager.value.canSetPolicyLabelInCoauthSession(e))if(!this.isUDPEnabled()&&this._idToSensitivityLabel[e]&&this._idToSensitivityLabel[e].HasUserDefinedPermissions&&!u)r.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",n),1!==n&&4!==n&&this.alertBlockUDPSetPolicyLabelUsingDialog();else if(c&&this._labelsData.MandatoryLabelingEnforced&&u)r.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",n),this.alertSetPolicyLabelFailedUsingDialog(n,"",CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(c&&this._appSettingsManager.getBooleanAppSetting("WacLabelingJustificationDialogIsEnabled")&&this._labelsData.RequiredDowngradeJustification&&(u||this._idToSensitivityLabel[e].RequiredDowngradeJustification)&&(this.isUDPEnabled()?!this._isJustificationDialogUsed&&!i:!this._justification))return r.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",n),this.showJustificationDialog(e),o;if(this.isUDPEnabled()&&this._idToSensitivityLabel[e].HasUserDefinedPermissions&&!u)return r.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",n),this.showUserDefinedPermissionsDialog(e,i),o;if(!this.awaitFileExistsOnHostEnabled()||this._fileExistsOnHost())return this.isParentLabel(e)&&(r.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",n),1===n||8===n||4===n)||(r.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",n),this.setPolicyLabel(u?"":e,this.isUDPEnabled()?i:this._justification,"",n)),o;this._awaitFileExistsOnHostRetryCount<this._awaitFileExistsOnHostMaxRetryCount?(r.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this._awaitFileExistsOnHostRetryCount,n),this._isWaitingForFileExistsOnHost=!0,this._awaitFileExistsOnHostRetryCount++,At.Task.delay(this._awaitFileExistsOnHostRetryDelayMs).continueWith((function(i){a._isWaitingForFileExistsOnHost=!1,a.setSensitivityByPolicyId(e,t,n)}))):(r.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",n),s=1!==n,l=!1,o=8)}else r.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),c&&this.alertSetPolicyLabelFailedUsingDialog(n,e,CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else r.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),c&&this.alertSetPolicyLabelFailedUsingDialog(n,e,CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else r.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",n),this._activeFrame.updateCommandUI(),s=c,l=!1,o=8;return this._policyManager.value.raiseSetPolicyLabelFailureEvent(0,n,s,l),o},a.applyAutoPolicyLabel=function(t,n,i,r){var a,o;return void 0===i&&(i=null),void 0===r&&(r=!1),l.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null),this._appSettingsManager.getBooleanAppSetting("SupportsOfficeClientCoauthoring")&&this._appSettingsManager.getBooleanAppSetting("CoAuthForProtectedFilesIsEnabled")?(this._isStandardLabelApplied=!1,this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData&&!this._labelsData.AppliedPolicyId?this._isStandardLabelApplied=!0:this._labelsData&&this._labelsData.PolicyLabelAssignmentMethod&&(this._isStandardLabelApplied=_c.e(this._labelsData.PolicyLabelAssignmentMethod)===_c.e("standard"))):this._isStandardLabelApplied=r,yc(this._appSettingsManager)?(a=t?this._idToSensitivityLabel[t]:null,o=n?this._idToSensitivityLabel[n]:null):(a=e.isNullOrEmpty(t)?null:this._idToSensitivityLabel[t],o=e.isNullOrEmpty(n)?null:this._idToSensitivityLabel[n]),o?this._recommendedPolicyLabelData=new Jl(o,!0,i):(this._policyManager.value.removeAutoPolicyBusinessBarEntry(29),this._currentRecommendedPolicyLabelId=null),a?this._autoPolicyLabelData=new Jl(a,!1):this._currentAutoPolicyLabelId=null,this.processAutoSensitivityLabel(null,null),32},a.applyMandatoryPolicyLabel=function(e,t){return void 0===t&&(t=!1),""!==this._labelsData.AppliedPolicyId&&t?(this._policyManager.value.raiseSetPolicyLabelFailureEvent(14,16,!0),8):this.setSensitivityByPolicyId(e,null,16)},a.setIdToSensitivityDictionary=function(){if(this._idToSensitivityLabel={},this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData)for(var e,t=Sc(this._labelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;this._idToSensitivityLabel[n.Id]=n}},a.isParentLabel=function(e){if(this._parentToChild&&e in this._parentToChild)for(var t,n=Sc(this._parentToChild[e]);!(t=n()).done;){var i=t.value,r=this._idToSensitivityLabel[i];if(r&&r.Enabled)return!0}return!1},a.setParentToChildSensitivityLabelsDictionary=function(){if(this._parentToChild={},this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData){for(var e,t=Sc(this._labelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;n.ParentId||(this._parentToChild[n.Id]=new te.a)}for(var i,r=Sc(this._labelsData.SensitivityLabels);!(i=r()).done;){var a=i.value;if(this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1)){if(!a.ParentId||!(a.ParentId in this._parentToChild))continue;if(this._idToSensitivityLabel[a.ParentId]&&(a.ParentName=this._idToSensitivityLabel[a.ParentId].DisplayName),a.Enabled)this._parentToChild[a.ParentId].add(a.Id)}else{if(!a.ParentId||!(a.ParentId in this._parentToChild)||!a.Enabled)continue;this._parentToChild[a.ParentId].add(a.Id)}}}},a.querySensitivityControl=function(){this._labelsData=this._policyManager.value.getPolicyLabelsData();var t=this.isApplyManualPolicyLabelEnabled&&this.isReactRibbonEnabled()&&this._policyManager.value.areLabelsAvailableForDisplay();e.reportAndUpdateSensitivityControlBootStatus(t)},a.registerBlockSetSensitivityCall=function(e){this._blockSetSensitivityCall=e},a.registerIsANewFile=function(e){this._isThisANewFile=e},a.registerFileExistsOnHost=function(e){this._fileExistsOnHost=e},a.setDefaultLabelIfNeeded=function(){if(this._appSettingsManager.getBooleanAppSetting("WacApplyDefaultPolicyLabelIsEnabled"))if(this.isDocumentInViewMode())this._isRefreshDocumentPolicyLabelsRequired=!0;else if(!this._defaultLabelSetAttempted&&(this._defaultLabelSetAttempted=!0,this._labelsData=this._policyManager.value.getPolicyLabelsData(),this._labelsData&&this._labelsData.DefaultLabelId)){if(!this._labelsData.AppliedPolicyId)return r.ULS.sendTraceTag(509732190,306,50,"Default labeling triggered. DefaultLabelType: {0}",this._labelsData.DefaultLabelType),void this.setSensitivityByPolicyId(this._labelsData.DefaultLabelId,null,1);if(P.a.get_ordinalIgnoreCase().equals(this._labelsData.DefaultLabelType,"documentLibraryDefault")){var e=this._idToSensitivityLabel[this._labelsData.AppliedPolicyId],t=this._idToSensitivityLabel[this._labelsData.DefaultLabelId];this._labelsData.AppliedPolicyId!==this._labelsData.DefaultLabelId&&P.a.get_ordinalIgnoreCase().equals(this._labelsData.PolicyLabelAssignmentMethod,"standard")&&e.Order<t.Order&&(r.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this._labelsData.DefaultLabelType),this.setSensitivityByPolicyId(this._labelsData.DefaultLabelId,null,1))}}},a.createAutoPolicyBusinessBarEntry=function(e,t,n,i){var r=new Il.a(e,t,null);return r.id=28,r.closeable=!0,r.image=3,r.addButton(n,i,n,!0),r},a.setPolicyLabel=function(e,t,n,i){void 0===i&&(i=2),this.isUDPEnabled()?t&&(this._isJustificationDialogUsed=!0):this._justification=t,this._policyManager.value.setPolicyLabel(e),this._activeFrame.updateCommandUI();var r=this._idToSensitivityLabel[e],a=new Ql(i,this.getParentChildSensitivityLabelText(r));this._policyManager.value.setPolicyLabelRequestAsync(e,this.isUDPEnabled()?t:this._justification,a)},a.showJustificationDialog=function(e){new nc(e,this.continueToSetPolicyLabelFromJustificationDialog).showJustificationDialog()},a.showUserDefinedPermissionsDialog=function(e,t){new uc(e,t,this.continueToSetPolicyLabelFromUDPDialog).showUserDefinedPermissionsDialog()},a.alertSetPolicyLabelFailedUsingDialog=function(e,t,n,i){void 0===t&&(t=""),void 0===n&&(n=""),void 0===i&&(i="");var r=new Kn.StandardDialog;r.hasCloseGlyph=s.AFrameworkApplication.isCloseable,r.buttonsOption=0,r.setButtonText(1,CommonUIStrings.l_DialogClose),r.showWarning(n,i,null)},a.alertBlockUDPSetPolicyLabelUsingDialog=function(){var e=new Kn.StandardDialog;e.hasCloseGlyph=s.AFrameworkApplication.isCloseable,e.buttonsOption=1,e.setButtonText(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton),e.setButtonText(0,CommonUIStrings.l_DialogClose),e.showWarning(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,this.blockUDPSetLabelHandler)},a.isReactRibbonEnabled=function(){return!!this._activeFrame&&!!this._activeFrame.applicationInstance&&this._activeFrame.applicationInstance.isReactRibbonEnvironmentEnabled},a.isReactStatusBarEnabled=function(){return!(!this._activeFrame||!this._activeFrame.applicationInstance)&&this._activeFrame.applicationInstance.isReactStatusBarEnabled},a.setPropsForQueryPolicyLabel=function(e,t,n,i){e?(i[sc.value]=e,i[sc.labelText]=e,i[sc.customTooltip]=t,this.setLabelImage(n,s.AFrameworkApplication.protectedFile,i)):(i[sc.iconColor]=sc.transparentFillColor,this._labelsData.MandatoryLabelingEnforced?(i[sc.value]=i[sc.labelText]=this.getPolicyStrings().selectASensitivityLabel,i[sc.icon]=sc.reactTagErrorImage):(i[sc.value]=i[sc.labelText]=this.getPolicyStrings().noSensitivityLabel,i[sc.icon]=sc.reactTagQuestionImage)),i[sc.visible]=!0},a.setLabelInformationForQueryPolicyLabel=function(e){var t="",n="",i="";if(this._labelsData.AreLabelsAvailable){var r=null;if(this._idToSensitivityLabel&&(r=this._idToSensitivityLabel[this._labelsData.AppliedPolicyId]),r&&(t=this.getParentChildSensitivityLabelText(r),n=r.Tooltip,this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)||(s.AFrameworkApplication.protectedFile=this._policyManager.value.isProtectedLabel(r)),i=this.getColorFromLabel(r)),!this._policyManager.value.areLabelsAvailableForDisplay()&&!r)return}else{if(!this._labelTitle)return;t=this._labelTitle,i=sc.transparentFillColor,n=this._labelDescription?this._labelDescription:""}this.setPropsForQueryPolicyLabel(t,n,i,e)},a.queryPolicyLabel=function(e,t,n,i,r){if(1===n)return 32;if(this._labelsData=this._policyManager.value.getPolicyLabelsData(),!this._labelsData||!r)return 32;var a=r;if(a[sc.value]="",a[sc.labelText]="",a[sc.alt]=null,a[sc.image16by16]=null,a[sc.image16by16Class]=null,a[sc.customTooltip]="",a[sc.visible]=!1,a[sc.iconColor]="",a[sc.icon]="",this.isLouderLabelEnabled())this.setLabelInformationForQueryPolicyLabel(a);else{var o="",l="",c="";if(this._labelsData.AreLabelsAvailable){if(this._labelsData.AppliedPolicyId){for(var u,d=null,p=Sc(this._labelsData.SensitivityLabels);!(u=p()).done;){var h=u.value;if(h.Id.toLowerCase()===this._labelsData.AppliedPolicyId.toLowerCase()){d=h;break}}d&&(o=this.getParentChildSensitivityLabelText(d),l=d.Tooltip,this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)||(s.AFrameworkApplication.protectedFile=this._policyManager.value.isProtectedLabel(d)),c=this.getColorFromLabel(d))}}else{if(!this._labelTitle)return 32;o=this._labelTitle,c=sc.transparentFillColor,this._labelDescription&&(l=this._labelDescription)}o&&(a[sc.value]=o,a[sc.labelText]=o,this.isReactStatusBarEnabled()?a[sc.customTooltip]=l:a[sc.alt]=l,this.setLabelImage(c,s.AFrameworkApplication.protectedFile,a),a[sc.visible]=!0)}return 32},a.queryPolicyShortLabel=function(e,t,n,i,r){if(1===n)return 32;if(this._labelsData=this._policyManager.value.getPolicyLabelsData(),!this._labelsData||!r)return 32;var a=r;if(a[sc.labelText]="",this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpUseHideBarByDefaultSetting",!1)&&this._labelsData.HideBarByDefault)return 32;var o="";if(this._labelsData.AreLabelsAvailable)if(this._labelsData.AppliedPolicyId){if(!this._idToSensitivityLabel)return 32;var s=this._idToSensitivityLabel[this._policyManager.value.getPolicyLabelsData().AppliedPolicyId];s&&(o=s.ParentId&&this._idToSensitivityLabel[s.ParentId]?this._idToSensitivityLabel[s.ParentId].DisplayName:s.DisplayName)}else o=this._labelsData.MandatoryLabelingEnforced?this.getPolicyStrings().selectASensitivityLabel:this.getPolicyStrings().noSensitivityLabel;else{if(!this._labelTitle)return 32;o=this._labelTitle}return a[sc.labelText]=o,32},a.getParentChildSensitivityLabelText=function(e){return e?this._idToSensitivityLabel?e.ParentId&&this._idToSensitivityLabel[e.ParentId]?this._idToSensitivityLabel[e.ParentId].DisplayName+"\\"+e.DisplayName:e.DisplayName:(r.ULS.sendTraceTag(4282e4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),e.DisplayName):""},a.setLabelImage=function(e,t,n){this.isLouderLabelEnabled()?(n[sc.icon]=this.getTagIcon(t),n[sc.iconColor]=this.getTagIconColor(e)):this.isReactStatusBarEnabled()?n[sc.icon]=t?sc.statusBarProtectedIconName:sc.statusBarUnprotectedIconName:(n[sc.image16by16]=s.AFrameworkApplication.imageClusterPath,n[sc.image16by16Class]=t?na.getImageClass(sc.statusBarProtectedImageClass):na.getImageClass(sc.statusBarUnprotectedImageClass))},a.createLearnMoreButton=function(e){var t,n=this.createMenuSectionProps("LearnMoreSection",!0),i="SensitivityLearnMore";return t=yc(this._appSettingsManager)?Object.assign(new pc.a,{Id:i,ExternalId:i,MenuItemId:e,LabelText:CommonUIStrings.l_LearnMore,Command:p.a.openUrlInNewTab.toString(),Image16by16:s.AFrameworkApplication.imageClusterPath,Image16by16Class:na.getImageClass(sc.learnMoreImageClass),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"}):Object.assign(new pc.a,{Id:i,ExternalId:i,MenuItemId:e,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:s.AFrameworkApplication.imageClusterPath,Image16by16Class:na.getImageClass(sc.learnMoreImageClass),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"}),Array.add(n.ControlList,t),n},a.createToggleButtonProps=function(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i=!1);var r="Toggle_";r="Sensitivity_"+(r+=e.Id);var a=e.DisplayName,o=e.Tooltip,l=e.Id===this._labelsData.AppliedPolicyId,c=i?Ze.a.xmlEncode(r):r,u=null;if(this.isLouderLabelEnabled()){var d=this.getColorFromLabel(e);(u=yc(this._appSettingsManager)?Object.assign(new vc.a,{Id:c,ExternalId:c,LabelText:i?Ze.a.xmlEncode(a):a,Command:p.a.setSensitivity.toString(),MenuItemId:c,QueryCommand:p.a.querySensitivityToggleButton.toString(),Visible:!0,Alt:i?Ze.a.xmlEncode(o):o,AriaLabel:Mr.a.ariaMenuItemRadioRole,IconColor:this.getTagIconColor(d),KeyTip:t}):Object.assign(new vc.a,{Id:c,ExternalId:c,LabelText:i?Ze.a.xmlEncode(a):a,Command:"2935633379",MenuItemId:c,QueryCommand:"991261903",Visible:!0,Alt:i?Ze.a.xmlEncode(o):o,AriaLabel:Mr.a.ariaMenuItemRadioRole,IconColor:this.getTagIconColor(d),KeyTip:t})).ExternalImageId=this.getTagIcon(this._policyManager.value.isProtectedLabel(e))}else{var h;h=yc(this._appSettingsManager)?Object.assign(new dc.a,{Id:c,ExternalId:c,LabelText:i?Ze.a.xmlEncode(a):a,Command:p.a.setSensitivity.toString(),MenuItemId:c,QueryCommand:p.a.querySensitivityToggleButton.toString(),CheckedImage:s.AFrameworkApplication.imageClusterPath,Visible:!0,Alt:i?Ze.a.xmlEncode(o):o,IsChecked:l,AriaLabel:Mr.a.ariaMenuItemRadioRole,KeyTip:t}):Object.assign(new dc.a,{Id:c,ExternalId:c,LabelText:i?Ze.a.xmlEncode(a):a,Command:"2935633379",MenuItemId:c,QueryCommand:"991261903",CheckedImage:s.AFrameworkApplication.imageClusterPath,Visible:!0,Alt:i?Ze.a.xmlEncode(o):o,IsChecked:l,AriaLabel:Mr.a.ariaMenuItemRadioRole,KeyTip:t}),this.isReactRibbonEnabled()?(h.CheckedImageClass=na.getImageClass(sc.reactCheckMarkImageClass),h.ExternalImageId=sc.reactCheckMarkImageClass):h.CheckedImageClass=na.getImageClass(sc.checkMarkImageClass),u=h}return c=r,this._menuItemToPolicyId[c]=e.Id,this._policyIdToMenuItem[e.Id]=c,u},a.createMenuSectionProps=function(e,t){return void 0===t&&(t=!1),Object.assign(new fc.a,{Title:"",Id:e,DisplayMode:sc.menu,ShowMenuSectionSeparator:t,ControlsId:"Ctrl_"+e,ControlList:[]})},a.createSubMenuSection=function(e,t,n,i){for(var r,a=this.createMenuSectionProps(e+"Sub"),o=1,s=Sc(n);!(r=s()).done;){var l=r.value,c=this._idToSensitivityLabel[l];c&&c.Enabled&&(Array.add(a.ControlList,this.createToggleButtonProps(c,o.toString(),t,i)),o++)}return a},a.createMenuSection=function(e){void 0===e&&(e=!1);var t=this.createMenuSectionProps("SensitivitySection"),n=1;for(var i in this._parentToChild){var r=void 0,a=void 0;if(yc(this._appSettingsManager))r=this._parentToChild[i],a=this._idToSensitivityLabel[i];else{var o={key:i,value:this._parentToChild[i]};r=o.value,a=this._idToSensitivityLabel[o.key]}if(a&&a.Enabled){if(r.count){var l="Sensitivity_"+a.Name,c="Label"+this._controlIndex++,u=void 0;u=yc(this._appSettingsManager)?Object.assign(new gc.a,{Id:c,ExternalId:c,LabelText:e?Ze.a.xmlEncode(a.DisplayName):a.DisplayName,Command:p.a.alwaysEnabled.toString(),QueryCommand:p.a.querySensitivitySubFlyout.toString(),Menu:Object.assign(new mc.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Mr.a.ariaMenuItemRadioRole,KeyTip:n.toString(),Alt:e?Ze.a.xmlEncode(a.Tooltip):a.Tooltip}):Object.assign(new gc.a,{Id:c,ExternalId:c,LabelText:e?Ze.a.xmlEncode(a.DisplayName):a.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new mc.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Mr.a.ariaMenuItemRadioRole,KeyTip:n.toString(),Alt:e?Ze.a.xmlEncode(a.Tooltip):a.Tooltip}),this.isReactRibbonEnabled()?u.ExternalImageId=sc.reactCheckMarkImageClass:(u.Image16by16=s.AFrameworkApplication.imageClusterPath,u.Image16by16Class=na.getImageClass(sc.checkMarkImageClass)),Array.add(u.Menu.MenuSectionList,this.createSubMenuSection(c,l,r,e)),Array.add(t.ControlList,u),this._menuItemToPolicyId[u.Id]=a.Id,this._policyIdToMenuItem[a.Id]=u.Id}else Array.add(t.ControlList,this.createToggleButtonProps(a,n.toString(),void 0,e));n++}}return t},a.actionHasFlags=function(e){return!!this._actionManager.getActionMetadata(e)&&!!this._actionManager.getActionMetadata(e).flags&&!!this._actionManager.getActionMetadata(e).flags.length},a.getTagIcon=function(e){return e?sc.reactTagLockImage:sc.reactTagImage},a.getTagIconColor=function(e){return e||sc.transparentFillColor},a.getColorFromLabel=function(e){if(e.Color||!e.ParentId)return e.Color;var t=this._idToSensitivityLabel[e.ParentId];return t?t.Color:e.Color},a.uiLocationToSensitivityPickerLocation=function(e){switch(e){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}},a.getPolicyStrings=function(){return this._policyStrings||(this._policyStrings=Object.assign(new Zl,{noSensitivityLabel:HeaderStrings.NoSensitivityLabel,selectASensitivityLabel:HeaderStrings.SelectASensitivityLabel})),this._policyStrings},a.setPolicyStrings=function(e){this._policyStrings=e},e.updateSensitivityBarHiddenStatus=function(e){s.AFrameworkApplication.appSettingsManager&&!s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)||Ot.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("OpenDocumentLabelPane",e))},e.reportAndUpdateSensitivityControlBootStatus=function(e){Ot.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!e))},e.isNullOrEmpty=function(e){return!e||!e.length},t=e,(n=[{key:"isNewFile",get:function(){return s.AFrameworkApplication.isNewFile||!!this._isThisANewFile&&this._isThisANewFile()}}])&&Ac(t.prototype,n),i&&Ac(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(Cc,"PolicyActor",null,[136]);var Tc,kc=n(642),wc=function(){this.Id=null,this.Enabled=!1,this.Name=null,this.DisplayName=null,this.Order=0,this.Tooltip=null,this.IsEndpointProtectionEnabled=!1,this.ParentId=null,this.RequiredDowngradeJustification=!1,this.LabelActions=null,this.AutoLabelingSensitiveTypeIds=null,this.Color=null,this.HasUserDefinedPermissions=!1,this.DefaultSublabelId=null,this.UDPDocumentExpirationDefaultState=!1,this.UDPDocumentExpirationConfigurable=!1,this.UDPAccessProgrammaticDefaultState=!1,this.UDPAccessProgrammaticConfigurable=!1,this.UDPRequestPermissionsDefaultState=!1,this.UDPRequestPermissionsConfigurable=!1,this.UDPVerifyUserPermissionDefaultState=!1,this.UDPVerifyUserPermissionConfigurable=!1,this.HasExtractForUser=!1,this.ParentName="",this.Id="",this.Enabled=!1,this.Name="",this.DisplayName="",this.Order=0,this.Tooltip="",this.IsEndpointProtectionEnabled=!1,this.ParentId="",this.RequiredDowngradeJustification=!1,this.LabelActions=new Array(0),this.AutoLabelingSensitiveTypeIds=new Array(0),this.Color="",this.HasUserDefinedPermissions=!1,this.DefaultSublabelId="",this.UDPDocumentExpirationDefaultState=!1,this.UDPDocumentExpirationConfigurable=!1,this.UDPAccessProgrammaticDefaultState=!1,this.UDPAccessProgrammaticConfigurable=!1,this.UDPRequestPermissionsDefaultState=!1,this.UDPRequestPermissionsConfigurable=!1,this.UDPVerifyUserPermissionDefaultState=!1,this.UDPVerifyUserPermissionConfigurable=!1,this.HasExtractForUser=!1,this.ParentName=""};function Ic(e,t){return(Ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(wc,"SensitivityLabel",null,[]),function(e){e[e.unknown=0]="unknown",e[e.boot=1]="boot",e[e.refresh=2]="refresh",e[e.selfSetPolicyLabel=3]="selfSetPolicyLabel"}(Tc||(Tc={})),Object(i.b)("GetPolicyLabelsReason",Tc);var Pc=function(e){var t,n;function i(t,n,i,r,a,o){var s;return(s=e.call(this)||this).businessBarId=t,s.title=n,s.message=i,s.buttonText=r,s.businessBarEntryHandler=a,s.isRecommended=o,s}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Ic(t,n),i}(Sys.EventArgs);function Fc(e,t){return(Fc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Pc,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ec,Oc=function(e){var t,n;function i(t,n,i,r,a){var o;return(o=e.call(this)||this).businessBarId=t,o.title=n,o.message=i,o.buttonText=r,o.businessBarEntryHandler=a,o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Fc(t,n),i}(Sys.EventArgs);function Mc(e,t){return(Mc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Oc,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]),function(e){e[e.none=0]="none",e[e.reasonDefaultLabel=1]="reasonDefaultLabel",e[e.reasonManual=2]="reasonManual",e[e.reasonAutomatic=4]="reasonAutomatic",e[e.reasonRecommended=8]="reasonRecommended",e[e.reasonMandatory=16]="reasonMandatory",e[e.reasonAI=32]="reasonAI"}(Ec||(Ec={})),Object(i.b)("ApplyLabelFlags",Ec);var Lc=function(e){var t,n;function i(t,n,i){var r;return(r=e.call(this)||this).clpPartialDocSITs=t,r.clpFullDocSITs=n,r.existingLabelPriority=i,r}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Mc(t,n),i}(Sys.EventArgs);function Rc(e,t){return(Rc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Lc,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);var Dc=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).getPolicyLabelsReason=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Rc(t,n),i}(Sys.EventArgs);function xc(e,t){return(xc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Dc,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var Bc=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,xc(t,n),i}(Sys.EventArgs);Object(i.a)(Bc,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var Uc=function(){this.AreLabelsAvailable=!1,this.AppliedPolicyId=null,this.RequiredDowngradeJustification=!1,this.MandatoryLabelingEnforced=!1,this.DefaultLabelId=null,this.DefaultLabelType=null,this.CustomUrl=null,this.PolicyLabelAssignmentMethod=null,this.PolicyLabelVersionToken=null,this.SensitivityLabels=null,this.HideBarByDefault=!1,this.ViewEnabled=!1,this.EditEnabled=!1,this.ExtractEnabled=!1,this.PrintEnabled=!1,this.SaveEnabled=!1,this.ExportEnabled=!1,this.MacrosEnabled=!1,this.FullControlEnabled=!1,this.PostponeMandatoryBeforeSave=!1,this.AreLabelsAvailable=!1,this.AppliedPolicyId="",this.RequiredDowngradeJustification=!1,this.DefaultLabelId="",this.DefaultLabelType="",this.PolicyLabelAssignmentMethod="",this.PolicyLabelVersionToken="",this.SensitivityLabels=new Array(0),this.MandatoryLabelingEnforced=!1,this.CustomUrl="",this.HideBarByDefault=!1,this.ViewEnabled=!1,this.EditEnabled=!1,this.ExtractEnabled=!1,this.PrintEnabled=!1,this.SaveEnabled=!1,this.ExportEnabled=!1,this.MacrosEnabled=!1,this.FullControlEnabled=!1,this.PostponeMandatoryBeforeSave=!1};function Hc(e,t){return(Hc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Uc,"GetPolicyLabelsData",null,[]);var Nc=function(e){var t,n;function i(t,n,i,r){var a;return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===i&&(i=null),void 0===r&&(r=null),(a=e.call(this)||this).onSuccess=t,a.appliedPolicyLabel=n,a.context=i,a.setPolicyLabelErrorType=r,a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Hc(t,n),i}(Sys.EventArgs);function Wc(e,t){return(Wc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Nc,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var jc=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).mandatoryPolicyId=t,i.appMode=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Wc(t,n),i}(Sys.EventArgs);function Vc(e,t){return(Vc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(jc,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);var qc=function(e){var t,n;function i(t,n,i,r){var a;return(a=e.call(this)||this).title=t,a.policyText=n,a.buttonText=i,a.onButtonClickCallback=r,a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Vc(t,n),i}(Sys.EventArgs);function Gc(e,t){return(Gc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(qc,"PolicyTipEventArgs",Sys.EventArgs,[]);var Kc=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).businessBarId=t,i.isRecommended=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Gc(t,n),i}(Sys.EventArgs);function zc(e,t){return(zc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Kc,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Xc=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,zc(t,n),i}(Sys.EventArgs);function Jc(e,t){return(Jc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Xc,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Qc=function(e){var t,n;function i(t,n){var i;return(i=e.call(this)||this).policyLabelId=t,i.applyLabelFlag=n,i}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Jc(t,n),i}(Sys.EventArgs);function Zc(e,t){return(Zc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Qc,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var Yc=function(e){var t,n;function i(t,n,i,r,a,o,s){var l;return void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),(l=e.call(this)||this).errorType=t,l.applyLabelFlags=n,l.showMessage=i,l.title=r,l.message=a,l.buttonText=o,l.businessBarEntryHandler=s,l}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,Zc(t,n),i}(Sys.EventArgs);function $c(e,t){return($c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(Yc,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var eu=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).applyLabelFlags=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,$c(t,n),i}(Sys.EventArgs);function tu(e,t){return(tu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(eu,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);var nu=function(e){var t,n;function i(t){var n;return(n=e.call(this)||this).shouldOpenDocumentInClient=t,n}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,tu(t,n),i}(Sys.EventArgs);Object(i.a)(nu,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var iu=n(138),ru=function(e,t,n,i,r,a,o,s,l,c,u,d,p,h,g,m,f,v,_,y,S){void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=!1),void 0===u&&(u=null),void 0===d&&(d=null),void 0===p&&(p=null),void 0===h&&(h=null),void 0===g&&(g=!1),void 0===m&&(m=null),void 0===f&&(f=null),void 0===v&&(v=null),void 0===_&&(_=null),void 0===y&&(y=null),void 0===S&&(S=null),this.url=e,this.verb=t,this.body=n,this.headers=i,this.shouldSetResponseXml=r,this.priority=a,this.state=o,this.watchName=s,this.requestorId=l,this.isSynchronous=c,this.queueTimeoutMs=u,this.sentTimeoutMs=d,this.name=p,this.overwriteSessionId=h,this.forceSynchronousNotify=g,this.overwriteVersion=m,this.extraInfo=f,this.invokedCallback=v,this.responseHeadersToSet=_,this.hostAttributionInfo=y,this.responseType=S};Object(i.a)(ru,"ClientRequest",null,[]);var au=n(149);function ou(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return su(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return su(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function su(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var lu=function(){function e(){}return e.setEquals=function(e,t){if(!e||!t||e.count!==t.count)return!1;for(var n,i=ou(e);!(n=i()).done;){var r=n.value;if(!t.contains(r))return!1}return!0},e.toArray=function(e){if(!e)return null;for(var t,n=new Array(e.count),i=0,r=ou(e);!(t=r()).done;){var a=t.value;n[i]=a,i++}return n},e}();function cu(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return uu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function uu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function du(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(lu,"HashSetUtils",null,[]);var pu=function(){function e(e,t,n,i,r,o){var l=this;void 0===i&&(i=0),void 0===r&&(r=null),void 0===o&&(o=0),this._editorsTableManager=null,this._dataLossNavigateUrl=null,this._getPolicyCalls=0,this._getLabelPolicyCalls=0,this._setPolicyLabelCalls=0,this._appliedPolicyId="",this._lockId=null,this._amITheOnlyCoauthor=null,this._isClpBlockedByAppSpecificScenario=null,this._areAllCoauthorsInSessionClientMipTrusted=null,this._labelChangedByCoauthorCallback=null,this._sensitiveItemTypeIds=null,this._isLabelPriorityUpdated=!1,this._appliedLabelPriority=null,this._highestLabelPriority=0,this._policyCallTimeStopwatch=null,this._getLabelPolicyCallTimeStopwatch=null,this._setLabelPolicyCallTimeStopwatch=null,this._policyParseAndHandleResponseStopwatch=null,this._eventSource=new a.a,this._rtc=null,this.getPolicyLabelStartTime=null,this.setPolicyLabelStartTime=null,this._isAutoPolicyLabelHandlerEventRaised=!1,this.latestSetPolicyLabelFailureReason=null,this.awaitRtc=function(e){if(!l.isRtcInitialized){var t=e.getInstanceAsRealtimeChannelBasicAsync();t.continueWith((function(e){l._rtc=t.result,l._rtc.add_updateNotificationReceived(l.onLabelChangeUpdateOverRtc)}))}},this.onLabelChangeUpdateOverRtc=function(e,t){12===t.type&&(l._labelChangedByCoauthorCallback?l._labelChangedByCoauthorCallback():l.getDocumentPolicyLabelsRequestAsync(l._appliedPolicyId,2,l._amITheOnlyCoauthor,!0))},this._appSettingsManager=e,this._clientRequestManager=t,this._stopwatchBuilder=n,this._maxPolicyRetries=i,this._policyLabelsData=new Uc,this._policyHandlerEndpointName=this._appSettingsManager.getStringAppSetting("PolicyHandlerEndpointName")||"PolicyHandler.ashx",this._applicationFeatureHelperFuture=r,this._officeAppType=0===o?this.officeAppTypeToString(s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType):this.officeAppTypeToString(o),this.isApplyManualPolicyLabelEnabled=e.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled"),this.isCoAuthForProtectedFilesEnabled=e.getBooleanAppSetting("CoAuthForProtectedFilesIsEnabled"),this.supportsOfficeClientCoauthoring=e.getBooleanAppSetting("SupportsOfficeClientCoauthoring"),this.isSetPolicyLabelZeroByteFailureRetryEnabled=!1,this.setPolicyLabelZeroByteFailureRetryIntervalMs=3e4,this._taskManager=S.TaskManager.instance,e.getBooleanAppSetting("SupportsPolicies")&&c.a("MipSupportsPolicies"),this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&c.a("MipSupportsOfficeClientCoauthoring")}var t,n,i,o=e.prototype;return o.add_policyTipHandler=function(e){this._eventSource.addHandler("PolicyTipEvent",e)},o.remove_policyTipHandler=function(e){this._eventSource.removeHandler("PolicyTipEvent",e)},o.add_labelInfoUpdateHandler=function(e){this._eventSource.addHandler("LabelInfoUpdateEvent",e)},o.remove_labelInfoUpdateHandler=function(e){this._eventSource.removeHandler("LabelInfoUpdateEvent",e)},o.add_setPolicyLabelTriggeredHandler=function(e){this._eventSource.addHandler("SetPolicyLabelTriggeredEventKey",e)},o.remove_setPolicyLabelTriggeredHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelTriggeredEventKey",e)},o.add_setPolicyLabelHandler=function(e){this._eventSource.addHandler("SetPolicyLabelEventKey",e)},o.remove_setPolicyLabelHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelEventKey",e)},o.add_setPolicyLabelFailureHandler=function(e){this._eventSource.addHandler("SetPolicyLabelFailureEventKey",e)},o.remove_setPolicyLabelFailureHandler=function(e){this._eventSource.removeHandler("SetPolicyLabelFailureEventKey",e)},o.add_getPolicyLabelHandler=function(e){this._eventSource.addHandler("GetPolicyLabelEventKey",e)},o.remove_getPolicyLabelHandler=function(e){this._eventSource.removeHandler("GetPolicyLabelEventKey",e)},o.add_getPolicyLabelFailureHandler=function(e){this._eventSource.addHandler("GetPolicyLabelFailureEventKey",e)},o.remove_getPolicyLabelFailureHandler=function(e){this._eventSource.removeHandler("GetPolicyLabelFailureEventKey",e)},o.add_getAutoPolicyLabelHandler=function(e){this._eventSource.addHandler("GetAutoPolicyLabelEventKey",e),this.isAutoPolicyLabelHandlerEventRaised&&(r.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.raiseGetAutoPolicyLabelHandlerEvent(new Dc(0)))},o.remove_getAutoPolicyLabelHandler=function(e){this._eventSource.removeHandler("GetAutoPolicyLabelEventKey",e)},o.add_createAutoCLPSecurityNodesHandler=function(e){this._eventSource.addHandler("CreateAutoCLPSecurityNodesEventKey",e)},o.remove_createAutoCLPSecurityNodesHandler=function(e){this._eventSource.removeHandler("CreateAutoCLPSecurityNodesEventKey",e)},o.add_updateAutoCLPLabelPriorityNodeHandler=function(e){this._eventSource.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",e)},o.remove_updateAutoCLPLabelPriorityNodeHandler=function(e){this._eventSource.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",e)},o.add_updateAutoCLPSITNodesHandler=function(e){this._eventSource.addHandler("UpdateAutoCLPSITNodesEventKey",e)},o.remove_updateAutoCLPSITNodesHandler=function(e){this._eventSource.removeHandler("UpdateAutoCLPSITNodesEventKey",e)},o.add_addAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.addHandler("AddAutoPolicyBusinessBarEntryEventKey",e)},o.remove_addAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",e)},o.add_removeAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.remove_removeAutoPolicyBusinessBarEntryHandler=function(e){this._eventSource.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.add_addMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",e)},o.remove_addMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",e)},o.add_removeMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",e)},o.remove_removeMandatoryLabellingBusinessBarHandler=function(e){this._eventSource.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",e)},o.add_mandatoryLabellingAppHandler=function(e){this._eventSource.addHandler("MandatoryLabellingAppHandlerEventKey",e)},o.remove_mandatoryLabellingAppHandler=function(e){this._eventSource.removeHandler("MandatoryLabellingAppHandlerEventKey",e)},o.add_udpLabelingAppHandler=function(e){this._eventSource.addHandler("UDPLabelingAppHandlerEventKey",e)},o.remove_udpLabelingAppHandler=function(e){this._eventSource.removeHandler("UDPLabelingAppHandlerEventKey",e)},o.initRtcBasicProvider=function(e){e&&this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&e.execute(this.awaitRtc)},o.initEditorsTableManager=function(e){var t=this;e&&this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&e.continueWith((function(n){t._editorsTableManager=e.result}))},o.registerIsClpBlockedByAppSpecificScenario=function(e){this._isClpBlockedByAppSpecificScenario=e},o.checkIsClpBlockedByAppSpecificScenario=function(){return!!this._isClpBlockedByAppSpecificScenario&&this._isClpBlockedByAppSpecificScenario()},o.registerAreAllCoauthorsInSessionClientMipTrustedCheck=function(e){this._areAllCoauthorsInSessionClientMipTrusted=e},o.registerLabelChangedByCoauthorCallback=function(e){this._labelChangedByCoauthorCallback=e},o.getCurrentTime=function(){return(new Date).getTime()},o.isSensitivityLabelingInOfficeJSEnabled=function(){return this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1)},o.getDocumentPolicyRequestAsync=function(){this._stopwatchBuilder&&(this._policyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Get Policy Endpoint On Server"));var e=iu.a.createForCurrentApp(1,1);if(this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var t=new ru(this.preparePolicyRequestUrl("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);this._clientRequestManager.send(t).registerCallbacks(Object(A.a)(this,this.onDataLossPolicySuccessCallback,"onDataLossPolicySuccessCallback"),Object(A.a)(this,this.onDataLossPolicyFailureCallback,"onDataLossPolicyFailureCallback"))}else this._clientRequestManager.addRequest(this.preparePolicyRequestUrl("datalosspolicy"),1,null,null,!0,2,Object(A.a)(this,this.onDataLossPolicySuccessCallback,"onDataLossPolicySuccessCallback"),Object(A.a)(this,this.onDataLossPolicyFailureCallback,"onDataLossPolicyFailureCallback"),null);this._getPolicyCalls++,r.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this._policyHandlerEndpointName,this._getPolicyCalls)},o.refreshDocumentPolicyLabels=function(){this.getDocumentPolicyLabelsRequestAsync(this._appliedPolicyId,2,this._amITheOnlyCoauthor)},o.getDocumentPolicyLabelsRequestAsync=function(e,t,n,i,r){void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=!1),void 0===r&&(r=null),l.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.getExtendedPropertiesForLogging(void 0,t)),this.getPolicyLabelStartTime=this.getCurrentTime();var a=this.createHostAttributionInfoFromGetPolicyLabelsReason(t);this.getDocumentPolicyLabelsRequestInternalAsync(e,a,n,i,t,r),this.reportAsyncInitStatus(!0)},o.getPolicyLabelsData=function(){return this._policyLabelsData},o.onDataLossPolicySuccessCallback=function(e){var t;this.policyCallWatchStop();var n;(t=this.tryGetResponseData(e),n=t.data,t).returnValue&&(r.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this._getPolicyCalls=0,this._stopwatchBuilder&&(this._policyParseAndHandleResponseStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("Task","Parse and Handle Get Policy Response")),this.parseAndHandlePolicyResponse(n),this._policyParseAndHandleResponseStopwatch&&(this._policyParseAndHandleResponseStopwatch.stop(),this._policyParseAndHandleResponseStopwatch=null))},o.onDataLossPolicyFailureCallback=function(e){this.policyCallWatchStop(),this._getPolicyCalls<=this._maxPolicyRetries?this.getDocumentPolicyRequestAsync():(r.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",e&&e.data?e.data.responseXml:null),this._getPolicyCalls=0)},o.isSetPolicyLabelRequestInProgress=function(){return this._setPolicyLabelCalls>0},o.setPolicyLabel=function(e){this._policyLabelsData.AppliedPolicyId=e},o.setPolicyLabelRequestAsync=function(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var r=this.createHostAttributionInfoFromRequestState(n);this.setPolicyLabelRequestInternalAsync(e,t,r,n,i)},o.onSetPolicyLabelSuccessCallback=function(e){var t;this._setLabelPolicyCallTimeStopwatch&&(this._setLabelPolicyCallTimeStopwatch.stop(),this._setLabelPolicyCallTimeStopwatch=null);var n,i=this.getSetPolicyLabelDataFromHeader(e),a=i.selectedPolicyLabelId,o=i.setPolicyLabelJustification,s=i.requestorId,l=e.data.state,c=l?l.applyLabelFlag:2;(t=this.tryGetResponseData(e),n=t.data,t).returnValue?(r.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",c),this._setPolicyLabelCalls=0,this.parseSetPolicyLabelDataResponse(n,a,o,l,s)):this.revertAppliedPolicyId(c,s)},o.raiseSetPolicyLabelTriggeredEvent=function(e){l.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.getExtendedPropertiesForLogging(e)),this.setPolicyLabelStartTime=this.getCurrentTime(),r.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event."),this._eventSource.raiseEvent("SetPolicyLabelTriggeredEventKey",new eu(e))},o.notifyCoauthorsOfLabelChangeOverRtc=function(){this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&this.isRtcInitialized&&this._rtc.sendUpdateNotification(12,null,!0)},o.onSetPolicyLabelFailureCallback=function(e){this._setLabelPolicyCallTimeStopwatch&&(this._setLabelPolicyCallTimeStopwatch.stop(),this._setLabelPolicyCallTimeStopwatch=null);var t=this.getSetPolicyLabelDataFromHeader(e),n=t.selectedPolicyLabelId,i=t.setPolicyLabelJustification,a=t.requestorId;if(this._setPolicyLabelCalls<=this._maxPolicyRetries)this.setPolicyLabelRequestAsync(n,i,null,a);else{var o=e.data.state,s=o?o.applyLabelFlag:2;r.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",e&&e.data?e.data.responseXml:null,s),this.latestSetPolicyLabelFailureReason="WACServerConnectionFailed",this._setPolicyLabelCalls=0,this.revertAppliedPolicyId(s,a)}},o.isRetriableLabelError=function(e){return!e||"LabelNotSupported"!==e&&"LabelErrorRetryLater"!==e&&"CoherencyFailure"!==e&&"LabelIdNotFound"!==e&&"LabelDisabled"!==e?(r.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",e),!1):(r.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",e),!0)},o.isProtectedLabel=function(e){return this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPAsProtectedLabelEnabled",!1)?e.IsEndpointProtectionEnabled||e.HasUserDefinedPermissions:e.IsEndpointProtectionEnabled},o.canSetPolicyLabelInCoauthSession=function(e){if(!e)return!1;for(var t,n=null,i=null,r=cu(this._policyLabelsData.SensitivityLabels);!(t=r()).done;){var a=t.value;a.Id===e&&(n=a),a.Id===this._appliedPolicyId&&(i=a)}if(!n)return!1;if(this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring){if(this._areAllCoauthorsInSessionClientMipTrusted&&this._areAllCoauthorsInSessionClientMipTrusted()||this.isEveryCoauthorInSessionClientMipTrusted)return!0}else if(s.AFrameworkApplication.coauthManager&&s.AFrameworkApplication.coauthManager.getAmIAlone||this._amITheOnlyCoauthor&&this._amITheOnlyCoauthor())return!0;return this.isProtectedLabel(n)===(!!i&&this.isProtectedLabel(i))},o.addAutoPolicyBusinessBarEntry=function(e,t,n,i,r){28===e?this.raiseAddAutoPolicyBusinessBarEntryHandlerEvent(new Pc(e,t,n,i,r,!1)):this.raiseAddAutoPolicyBusinessBarEntryHandlerEvent(new Pc(e,t,n,i,r,!0))},o.removeAutoPolicyBusinessBarEntry=function(e){28===e?this.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent(new Kc(e,!1)):this.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent(new Kc(e,!0))},o.raiseCreateAutoCLPSecurityNodesEvent=function(e,t,n){r.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event."),this._eventSource.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new Lc(e,t,n))},o.raiseUpdateAutoCLPLabelPriorityNodeEvent=function(e){r.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event."),this._eventSource.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new Lc(null,null,e))},o.raiseUpdateAutoCLPSITNodesEvent=function(e,t){r.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event."),this._eventSource.raiseEvent("UpdateAutoCLPSITNodesEventKey",new Lc(e,t,null))},o.raiseMandatoryLabellingAppHandlerEvent=function(e,t){var n=1===t?"Reading":"Edit";r.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+n+" switch event."),this._eventSource.raiseEvent("MandatoryLabellingAppHandlerEventKey",new jc(e,t))},o.addMandatoryLabellingBusinessBarEntry=function(e,t,n,i,r){37===e&&this.raiseAddMandatoryLabellingBusinessBarEntryHandlerEvent(new Oc(37,t,n,i,r))},o.removeMandatoryLabellingBusinessBarEntry=function(){this.raiseRemoveMandatoryLabellingBusinessBarEntryHandlerEvent(new Xc)},o.raiseUDPLabelingAppHandlerEvent=function(e){r.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event."),this._eventSource.raiseEvent("UDPLabelingAppHandlerEventKey",new nu(e))},o.areLabelsAvailableForDisplay=function(e){void 0===e&&(e=!1);var t,n=!!(t=this._policyLabelsData)&&t.AreLabelsAvailable&&!!t.SensitivityLabels&&t.SensitivityLabels.length>0&&t.SensitivityLabels.some((function(e){return!!e&&e.Enabled}));return n||e||Cc.reportAndUpdateSensitivityControlBootStatus(!1),n},o.sendMipPropertiesToEdge=function(){var e={labelId:this._appliedPolicyId},t={docEdit:this._policyLabelsData.EditEnabled,extract:s.AFrameworkApplication.enableExtractForProtectedFile,print:s.AFrameworkApplication.printingEnabled,export:s.AFrameworkApplication.enableExportForProtectedFile,objModel:s.AFrameworkApplication.enableMacrosForProtectedFile,owner:s.AFrameworkApplication.enableFullControlForProtectedFile},n={type:"mipProperties",isProtected:s.AFrameworkApplication.protectedFile,sensitivity:e,usageRights:t};window.postMessage(JSON.stringify(n),"*")},o.onGetPolicyLabelsSuccessCallback=function(e){var t;this._getLabelPolicyCallTimeStopwatch&&(this._getLabelPolicyCallTimeStopwatch.stop(),this._getLabelPolicyCallTimeStopwatch=null);var n=null;e&&e.data&&(n=e.data.requestorId);var i;if(this.reportAsyncInitStatus(!1),(t=this.tryGetResponseData(e),i=t.data,t).returnValue){r.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this._getLabelPolicyCalls=0;var a=this.parseGetPolicyLabelDataResponse(i,n),o=this.getPolicyLabelsReasonFromRequestItem(e.data);this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)&&this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableEdgeBlockScreenCapture",!1)&&a&&this.sendMipPropertiesToEdge(),l.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.getAdditionalValuesForLogging(void 0,o,this.getPolicyLabelStartTime)),this.getPolicyLabelStartTime=null;var s=new Dc(o);this.raiseGetPolicyLabelHandlerEvent(s),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?a&&this.shouldAutoClassificationRun()?this.isAutoPolicyLabelHandlerEventRaised?this.updateAutoCLPSecurityNodesIfNeeded():(this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.createAutoCLPSecurityNodes(),this.raiseGetAutoPolicyLabelHandlerEvent(s),this._isAutoPolicyLabelHandlerEventRaised=!0):a||this.raiseGetPolicyLabelFailureHandlerEvent():!this.isAutoPolicyLabelHandlerEventRaised&&a&&this._appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")&&this.areAutoLabelingSensitiveTypesAvailable()?(this.raiseGetAutoPolicyLabelHandlerEvent(s),this._isAutoPolicyLabelHandlerEventRaised=!0):a||this.raiseGetPolicyLabelFailureHandlerEvent()}else this.raiseGetPolicyLabelFailureHandlerEvent()},o.shouldAutoClassificationRun=function(){return this._appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")?!!this.areAutoLabelingSensitiveTypesAvailable()&&(""===this._appliedPolicyId?(r.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0):this._appliedLabelPriority===this._highestLabelPriority?(r.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1):(r.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label"),!0)):(r.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1)},o.createAutoCLPSecurityNodes=function(){this.updateAutoCLPSecurityNodeSensitiveItemTypeIds(),r.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",this._sensitiveItemTypeIds.count>0,this._appliedLabelPriority);var e=lu.toArray(this._sensitiveItemTypeIds);this.raiseCreateAutoCLPSecurityNodesEvent(e,e,this._appliedLabelPriority)},o.updateAutoCLPSecurityNodesIfNeeded=function(){var e=this._sensitiveItemTypeIds;if(this.updateAutoCLPSecurityNodeSensitiveItemTypeIds(),!lu.setEquals(e,this._sensitiveItemTypeIds)){r.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",this._sensitiveItemTypeIds.count>0);var t=lu.toArray(this._sensitiveItemTypeIds);this.raiseUpdateAutoCLPSITNodesEvent(t,t)}this._isLabelPriorityUpdated&&(r.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this._appliedLabelPriority),this.raiseUpdateAutoCLPLabelPriorityNodeEvent(this._appliedLabelPriority))},o.updateAutoCLPSecurityNodeSensitiveItemTypeIds=function(){for(var e,t=new kc.a(P.a.get_ordinalIgnoreCase()),n=cu(this._policyLabelsData.SensitivityLabels);!(e=n()).done;){var i=e.value;if(i&&(i.AutoLabelingSensitiveTypeIds&&i.AutoLabelingSensitiveTypeIds.length>0))for(var r,a=cu(i.AutoLabelingSensitiveTypeIds);!(r=a()).done;){var o=r.value;o&&t.add(o)}}this._sensitiveItemTypeIds=t},o.onGetPolicyLabelsFailureCallback=function(t){var n=this.getPolicyLabelsReasonFromRequestItem(t.data),i=null;if(t&&t.data&&(i=t.data.requestorId),l.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.getAdditionalValuesForLogging(void 0,n,this.getPolicyLabelStartTime)),this.getPolicyLabelStartTime=null,this._getLabelPolicyCallTimeStopwatch&&(this._getLabelPolicyCallTimeStopwatch.stop(),this._getLabelPolicyCallTimeStopwatch=null),this._getLabelPolicyCalls<=this._maxPolicyRetries){if(this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var a=t.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in a&&a[iu.a.scenarioParamName]&&"HostAttributionInfo.ScenarioTypeParamName"in a&&a[iu.a.scenarioTypeParamName]){t.data.request.get_headers()[iu.a.scenarioParamName],e.ts;t.data.request.get_headers()[iu.a.scenarioTypeParamName];var o=this.createHostAttributionInfoFromGetPolicyLabelsReason(n);return void this.getDocumentPolicyLabelsRequestInternalAsync(this._appliedPolicyId,o,this._amITheOnlyCoauthor,void 0,n,i)}}this.getDocumentPolicyLabelsRequestAsync(this._appliedPolicyId,n,this._amITheOnlyCoauthor,!1,i)}else r.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",t&&t.data?t.data.responseXml:null),this.raiseGetPolicyLabelFailureHandlerEvent(),this._getLabelPolicyCalls=0,this.reportAsyncInitStatus(!1)},o.getPolicyLabelsReasonFromRequestItem=function(e){return e.state?e.state:0},o.preparePolicyRequestUrl=function(e,t){return void 0===t&&(t=!1),function(e,t,n,i,r,a){void 0===a&&(a=!1);var o=String.format("{0}{1}?action={2}&{3}",e,t,r,n);return"setpolicylabel"===r&&i&&(o=O.a.addOrReplaceParameterValue(o,"sl","1")),a&&(o=O.a.addOrReplaceParameterValue(o,"cbd","1")),o}(this._appSettingsManager.getStringAppSetting("PolicyHandlerWebServiceBase")||s.AFrameworkApplication.activeFrame.applicationInstance.newAndOpenHandlerUrlPrefix,this._policyHandlerEndpointName,s.AFrameworkApplication.baseDocQuerySignatureWithoutVersion,"setpolicylabel"===e&&s.AFrameworkApplication.coauthManager&&s.AFrameworkApplication.coauthManager.isFileCoauthorable,e,t)},o.getSetPolicyLabelDataFromHeader=function(e){var t=null,n=null,i=null;return e&&e.data&&e.data.request&&e.data.request.get_headers()&&(t=e.data.request.get_headers()[jo.a.selectedPolicyLabelIdHeaderName],n=e.data.request.get_headers()[jo.a.setPolicyLabelJustificationHeaderName],i=e.data.requestorId),{selectedPolicyLabelId:t,setPolicyLabelJustification:n,requestorId:i}},o.tryGetResponseData=function(e){var t=e&&e.data?e.data.responseData:null;return t&&t.length&&!this.isServiceUnavailableResponse(t)?{returnValue:!0,data:t}:(r.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:t})},o.parseAndHandlePolicyResponse=function(e){var t;try{t=H.b(e)}catch(e){return void r.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.")}if(t)if(t.IsPolicyTipAvailable)switch(t.IsPolicyTipAvailable.toLowerCase()){case"false":return void r.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");case"true":r.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document."),this._dataLossNavigateUrl=t.NavigateUrl,this.showPolicyTip(t.GeneralText,Object(A.a)(this,this.onDataLossPolicyOverrideButtonClick,"onDataLossPolicyOverrideButtonClick"));break;default:r.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",t.IsPolicyTipAvailable)}else r.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else r.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")},o.convertToSetPolicyLabelErrorType=function(e){switch(e){case"CoherencyFailure":return 1;case"DisabledByPolicy":return 2;case"FileCheckedOut":return 3;case"FileEncrypted":return 4;case"FileLocked":return 5;case"FileNotSupported":return 6;case"FileTooLarge":return 7;case"InvalidOperationOnZeroByteFile":return 8;case"LabelDisabled":return 9;case"LabelErrorRetryLater":return 10;case"LabelIdNotFound":return 11;case"LabelIrmDisabledByTenant":return 12;case"LabelNotSupported":return 13;case"MinorVersionLimitExceeded":return 15;default:return 0}},o.parseSetPolicyLabelDataResponse=function(e,t,n,i,a){var o,s=this;void 0===a&&(a=null);var d,p=i?i.applyLabelFlag:2,h=0,g="";if((o=H.d(e),d=o.deserialized,o).returnValue)if(d){g="Success";var m=this.createHostAttributionInfoFromGetPolicyLabelsReason(3);if(d.IsSuccessful){if(l.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.getAdditionalValuesForLogging(p,void 0,this.setPolicyLabelStartTime)),this.setPolicyLabelStartTime=null,this.latestSetPolicyLabelFailureReason=null,r.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",p),2===p&&this.removeAutoPolicyBusinessBarEntry(29),this.setSelectedPolicyId(t,p),this.notifyCoauthorsOfLabelChangeOverRtc(),this.removeAutoPolicyBusinessBarEntry(28),this.isSensitivityLabelingInOfficeJSEnabled()){if(i&&4===p){var f=a.startsWith("OFFICEJS_SENSITIVITY_CONTEXT_");this.addAutoPolicyBusinessBarEntry(28,f?"SENSITIVITY":CommonUIStrings.l_PolicyBusinessBarTitle,String.format(f?"Due to content created by Copilot, your organization automatically applied the sensitivity label: {0}.":CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,i.displayName),CommonUIStrings.l_DialogOk,(function(e){}))}}else i&&4===p&&this.addAutoPolicyBusinessBarEntry(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,i.displayName),CommonUIStrings.l_DialogOk,(function(e){}));return c.a("MipAppliedLabels",void 0,void 0,[Object.assign(new wa.a,{name:"SetPolicyLabelApplyFlag",string:Ec[p]})]),void this.getDocumentPolicyLabelsRequestInternalAsync(t,m,this._amITheOnlyCoauthor,void 0,3,a)}if(r.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",p,d.FailureReason),this.latestSetPolicyLabelFailureReason=d.FailureReason,h=this.convertToSetPolicyLabelErrorType(d.FailureReason),this.isSetPolicyLabelZeroByteFailureRetryEnabled&&d.FailureReason.indexOf("InvalidOperationOnZeroByteFile")>=0){var v=new u.a(2,1,this.setPolicyLabelZeroByteFailureRetryIntervalMs,(function(e){r.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",s._setPolicyLabelCalls),s._setPolicyLabelCalls<=s._maxPolicyRetries&&s.setPolicyLabelRequestAsync(t,n,null,a)}));this._taskManager.addTask(v)}this.isCoAuthForProtectedFilesEnabled&&this.supportsOfficeClientCoauthoring&&this.getDocumentPolicyLabelsRequestInternalAsync(this._policyLabelsData.AppliedPolicyId,m,this._amITheOnlyCoauthor,!0,3,a)}else g="setPolicyLabelData null.",r.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",p);else g="TryDeserialize failed.",r.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",p);this.revertAppliedPolicyId(p,a,h);var _=this.getAdditionalValuesForLogging(p,void 0,this.setPolicyLabelStartTime);this.setPolicyLabelStartTime=null,_.extendedProperties.set("SetPolicyLabelDataFailureReason",this.latestSetPolicyLabelFailureReason),_.extendedProperties.set("SetPolicyLabelDataParseStatus",g.toString()),l.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,_)},o.getLabelfromId=function(e){if(""===e)return null;for(var t,n=cu(this._policyLabelsData.SensitivityLabels);!(t=n()).done;){var i=t.value;if((null==i?void 0:i.Id)===e)return i}return null},o.updateAppliedLabelHasExtractProperty=function(){if(""!==this._appliedPolicyId)for(var e,t=cu(this._policyLabelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;(null==n?void 0:n.Id)===this._appliedPolicyId&&(n.HasExtractForUser=!this.isProtectedLabel(n)||this._policyLabelsData.ExtractEnabled)}},o.revertAppliedPolicyId=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=0);var i=2===e||8===e||16===e,r=new Nc;this.setPolicyLabel(this._appliedPolicyId),this.isSensitivityLabelingInOfficeJSEnabled()&&(r.appliedPolicyLabel=this.getLabelfromId(this._appliedPolicyId),r.context=t,r.setPolicyLabelErrorType=n),this.raiseLabelInfoUpdateEvent(r),this.raiseSetPolicyLabelFailureEvent(n,e,i,!1)},o.setSelectedPolicyId=function(e,t){if(this.setPolicyLabel(this._appliedPolicyId=e),!this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1))if(""===e)s.AFrameworkApplication.protectedFile=!1,s.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(var n,i=cu(this._policyLabelsData.SensitivityLabels);!(n=i()).done;){var r=n.value;if(r.Id===e){s.AFrameworkApplication.protectedFile=this.isProtectedLabel(r);break}}this.raiseSetPolicyLabelEvent(new Qc(e,t))},o.updateLabelPriorityInfo=function(){for(var e,t=cu(this._policyLabelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;(null==n?void 0:n.Enabled)&&(n.Id===this._appliedPolicyId&&(this._isLabelPriorityUpdated=this._appliedLabelPriority!==n.Order,this._appliedLabelPriority=n.Order),n.Order>this._highestLabelPriority&&(this._highestLabelPriority=n.Order))}},o.updatePolicyProperties=function(){this._appSettingsManager.appSettings&&(this._appSettingsManager.appSettings.AppliedPolicyId=this._appliedPolicyId);var e=!1;if(""!==this._appliedPolicyId)for(var t,n=cu(this._policyLabelsData.SensitivityLabels);!(t=n()).done;){var i=t.value;if(i.Id===this._appliedPolicyId){e=this.isProtectedLabel(i);break}}s.AFrameworkApplication.protectedFile=e,s.AFrameworkApplication.protectFile=!!e&&(this._policyLabelsData.ViewEnabled&&!this._policyLabelsData.EditEnabled),s.AFrameworkApplication.printingEnabled=!!e&&this._policyLabelsData.PrintEnabled,s.AFrameworkApplication.enableMacrosForProtectedFile=!!e&&this._policyLabelsData.MacrosEnabled,s.AFrameworkApplication.enableExtractForProtectedFile=!!e&&this._policyLabelsData.ExtractEnabled,s.AFrameworkApplication.enableExportForProtectedFile=!!e&&this._policyLabelsData.ExportEnabled,s.AFrameworkApplication.enableFullControlForProtectedFile=!!e&&this._policyLabelsData.FullControlEnabled},o.parseGetPolicyLabelDataResponse=function(e,t){var n,i;if(void 0===t&&(t=null),!(n=H.d(e),i=n.deserialized,n).returnValue)return r.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!i)return r.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!i.AreLabelsAvailable)return!1;this._policyLabelsData=i,this._appliedPolicyId=i.AppliedPolicyId,this.isSensitivityLabelingInOfficeJSEnabled()&&this.updateAppliedLabelHasExtractProperty(),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UpdateIRMWhenLabelChangedEnabled",!1)?this.updatePolicyProperties():this._appSettingsManager.appSettings&&(this._appSettingsManager.appSettings.AppliedPolicyId=this._appliedPolicyId),this._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.updateLabelPriorityInfo(),this.areLabelsAvailableForDisplay()&&r.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");var a=new Nc(!0);return this.isSensitivityLabelingInOfficeJSEnabled()&&(a.appliedPolicyLabel=this.getLabelfromId(this._appliedPolicyId),a.context=t),this.raiseLabelInfoUpdateEvent(a),!0},o.areAutoLabelingSensitiveTypesAvailable=function(){if(!this.areLabelsAvailableForDisplay())return r.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var e,t=cu(this._policyLabelsData.SensitivityLabels);!(e=t()).done;){var n=e.value;if(n&&n.AutoLabelingSensitiveTypeIds&&n.AutoLabelingSensitiveTypeIds.length>0)return!0}return r.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT"),!1},o.raiseLabelInfoUpdateEvent=function(e){r.ULS.sendTraceTag(35393610,306,50,"Raising label info update event."),this._eventSource.raiseEvent("LabelInfoUpdateEvent",e)},o.raiseGetPolicyLabelHandlerEvent=function(e){r.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event."),this._eventSource.raiseEvent("GetPolicyLabelEventKey",e)},o.raiseGetPolicyLabelFailureHandlerEvent=function(){Cc.reportAndUpdateSensitivityControlBootStatus(!1),this._eventSource.raiseEvent("GetPolicyLabelFailureEventKey",new Bc)},o.raiseGetAutoPolicyLabelHandlerEvent=function(e){var t=this;this._applicationFeatureHelperFuture&&this._applicationFeatureHelperFuture.execute((function(n){var i=[n.isFeatureEnabled("MsoClpSpTwo",!0),n.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(i).then((function(n){return au.a.any(n,(function(e){return e}))&&(r.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),t._eventSource.raiseEvent("GetAutoPolicyLabelEventKey",e),t._appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&t.createAutoCLPSecurityNodes(),c.a("MipAutoClassificationEnabled")),null}))}))},o.getExtendedPropertiesForLogging=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=new Map;return n.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString()),null!=e&&n.set("ApplyLabelFlags",Ec[e]),null!=t&&n.set("GetPolicyLabelsReason",Tc[t]),n},o.getAdditionalValuesForLogging=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null);var i=new Z.a;return i.extendedProperties=this.getExtendedPropertiesForLogging(e,t),null!=n&&(i.durationMs=this.getCurrentTime()-n),i},o.raiseSetPolicyLabelEvent=function(e){r.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event."),this._eventSource.raiseEvent("SetPolicyLabelEventKey",e)},o.raiseAddAutoPolicyBusinessBarEntryHandlerEvent=function(e){r.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event."),e&&e.isRecommended&&c.a("MipRecommendations"),this._eventSource.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",e)},o.raiseRemoveAutoPolicyBusinessBarEntryHandlerEvent=function(e){r.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event."),this._eventSource.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",e)},o.raiseAddMandatoryLabellingBusinessBarEntryHandlerEvent=function(e){r.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event."),this._eventSource.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",e)},o.raiseRemoveMandatoryLabellingBusinessBarEntryHandlerEvent=function(e){r.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event."),this._eventSource.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",e)},o.showPolicyTip=function(e,t){void 0===t&&(t=null),r.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user."),this._eventSource.raiseEvent("PolicyTipEvent",new qc(CommonUIStrings.l_PolicyBusinessBarTitle,e,CommonUIStrings.l_PolicyOverrideButton,t))},o.raiseSetPolicyLabelFailureEvent=function(e,t,n,i){var a=this;void 0===i&&(i=!0),r.ULS.sendTraceTag(42074656,306,i?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",t);var o=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle,s=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,l=null,c=null;switch(e){case 2:o=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle,s=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:s=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:o=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,s=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:o=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,s=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:o=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,s=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:s=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:o=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,s=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 15:o=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,s=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,l=CommonUIStrings.l_LearnMore,c=function(e){a.setPolicyMinorVersionLimitReachedErrorActionCallback()}}var u=new Yc(e,t,n,o,s,l,c);this._eventSource.raiseEvent("SetPolicyLabelFailureEventKey",u)},o.setLockId=function(e){this._lockId=e},o.onDataLossPolicyOverrideButtonClick=function(e){this._dataLossNavigateUrl?(r.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),ut.a.followHyperlinkWithNoReferrer(this._dataLossNavigateUrl)):r.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")},o.isServiceUnavailableResponse=function(e){return!(!e.startsWith("<")||-1===e.indexOf("Error")&&-1===e.indexOf("Unavailable"))&&(r.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint."),!0)},o.policyCallWatchStop=function(){this._policyCallTimeStopwatch&&(this._policyCallTimeStopwatch.stop(),this._policyCallTimeStopwatch=null)},o.getActionSourceStringFromPolicyLabelRequestState=function(e){if(!e)return"manual";switch(e.applyLabelFlag){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";case 32:return"ai";default:return"manual"}},o.getAssignmentMethodStringFromPolicyLabelRequestState=function(e){if(!e)return"privileged";var t=e.applyLabelFlag,n="privileged";return 4!==t&&1!==t&&32!==t||(n="standard"),n},o.officeAppTypeToString=function(e){switch(e){case 1:return"Excel";case 4:return"OneNote";case 2:return"PowerPoint";case 5:return"Visio";case 3:return"Word";case 0:default:return"Unknown"}},o.getDocumentPolicyLabelsRequestInternalAsync=function(e,t,n,i,a,o){void 0===n&&(n=null),void 0===i&&(i=!1),void 0===a&&(a=0),void 0===o&&(o=null),this._appSettingsManager.getBooleanAppSetting("WacLabelingGetPolicyLabelsIsEnabled")&&(this._appliedPolicyId=e,this._amITheOnlyCoauthor=n,this._stopwatchBuilder&&(this._getLabelPolicyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Get Policy Endpoint On Server")),function(e,t,n,i,r,a,o,s,l){void 0===s&&(s=0),void 0===l&&(l=null);var c={};c[jo.a.appliedPolicyIdHeaderName]=a;var u=e.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSensitivityLabelingInOfficeJS",!1);if(e.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var d=new ru(r,1,null,c,!0,2,s,void 0,u?l:void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o);t.send(d).registerCallbacks(n,i)}else t.addRequest(r,1,null,c,!0,2,n,i,s,u?l:void 0,void 0,void 0,void 0,"22")}(this._appSettingsManager,this._clientRequestManager,Object(A.a)(this,this.onGetPolicyLabelsSuccessCallback,"onGetPolicyLabelsSuccessCallback"),Object(A.a)(this,this.onGetPolicyLabelsFailureCallback,"onGetPolicyLabelsFailureCallback"),this.preparePolicyRequestUrl("getpolicylabels",i),e,t,a,o),this._getLabelPolicyCalls++,r.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this._getLabelPolicyCalls))},o.setPolicyLabelRequestInternalAsync=function(e,t,n,i,a){if(void 0===i&&(i=null),void 0===a&&(a=null),this.isApplyManualPolicyLabelEnabled){this._stopwatchBuilder&&(this._setLabelPolicyCallTimeStopwatch=this._stopwatchBuilder.makeAndStartStopwatch("WebServiceCall","Call Set Policy Endpoint On Server"));var o={};if(o[jo.a.selectedPolicyLabelIdHeaderName]=e,t&&(o[jo.a.setPolicyLabelJustificationHeaderName]=encodeURIComponent(t)),this._lockId&&(o[jo.a.appLockIdHeaderName]=this._lockId),i?(o[jo.a.setPolicyLabelActionSourceHeaderName]=this.getActionSourceStringFromPolicyLabelRequestState(i),o[jo.a.setPolicyLabelAssignmentMethodHeaderName]=this.getAssignmentMethodStringFromPolicyLabelRequestState(i),1===i.applyLabelFlag&&this._policyLabelsData.DefaultLabelType&&(o[jo.a.setPolicyDefaultLabelTypeHeaderName]=this._policyLabelsData.DefaultLabelType)):(o[jo.a.setPolicyLabelActionSourceHeaderName]="manual",o[jo.a.setPolicyLabelAssignmentMethodHeaderName]="privileged"),this.supportsOfficeClientCoauthoring&&this._policyLabelsData&&(o[jo.a.policyLabelVersionTokenHeaderName]=this._policyLabelsData.PolicyLabelVersionToken),this._appSettingsManager.getBooleanAppSetting("SendHostAttributionInfoForPolicyLabelEnabled")){var s=new ru(this.preparePolicyRequestUrl("setpolicylabel",!0),1,null,o,!0,2,i,void 0,this.isSensitivityLabelingInOfficeJSEnabled()?a:void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,n);this._clientRequestManager.send(s).registerCallbacks(Object(A.a)(this,this.onSetPolicyLabelSuccessCallback,"onSetPolicyLabelSuccessCallback"),Object(A.a)(this,this.onSetPolicyLabelFailureCallback,"onSetPolicyLabelFailureCallback"))}else this._clientRequestManager.addRequest(this.preparePolicyRequestUrl("setpolicylabel",!0),1,null,o,!0,2,Object(A.a)(this,this.onSetPolicyLabelSuccessCallback,"onSetPolicyLabelSuccessCallback"),Object(A.a)(this,this.onSetPolicyLabelFailureCallback,"onSetPolicyLabelFailureCallback"),i,this.isSensitivityLabelingInOfficeJSEnabled()?a:void 0,void 0,void 0,void 0,"32");this._setPolicyLabelCalls++,r.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this._setPolicyLabelCalls)}else r.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")},o.setPolicyMinorVersionLimitReachedErrorActionCallback=function(){var e=new Kn.StandardDialog,t=this._appSettingsManager.getStringAppSetting("BreadcrumbFolderUrl");t?(e.buttonsOption=11,e.setButtonText(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),e.setButtonText(2,CommonUIStrings.l_DialogOk)):(e.buttonsOption=0,e.setButtonText(1,CommonUIStrings.l_DialogOk)),e.addHelpLink(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247"),e.removeFeedbackPanel(),e.showWarning(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,(function(e,n){1===e&&t&&ut.a.safelyOpenWindow(t,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")}))},o.createHostAttributionInfoFromGetPolicyLabelsReason=function(e){return function(e){switch(e){case 1:return iu.a.createForCurrentApp(1,1);case 2:return iu.a.createForCurrentApp(7,1);case 3:return iu.a.createForCurrentApp(8,1);case 0:default:return iu.a.createForCurrentApp(7,0)}}(e)},o.createHostAttributionInfoFromRequestState=function(e){if(void 0===e&&(e=null),!e)return iu.a.createForCurrentApp(8,0);switch(e.applyLabelFlag){case 1:case 16:return iu.a.createForCurrentApp(1,1);case 4:case 2:case 8:return iu.a.createForCurrentApp(8,1);case 0:default:return iu.a.createForCurrentApp(8,0)}},o.reportAsyncInitStatus=function(e){Ot.c()&&appChrome.api.setAsyncRequestStatus("sensitivity",e)},o.getParentChildSensitivityLabelText=function(e){return e?e.ParentId&&e.ParentName?e.ParentName+"\\"+e.DisplayName:e.DisplayName:""},o.getHighestSensitivityLabel=function(e){if(!e||0==e.length)return null;for(var t,n=null,i=cu(e);!(t=i()).done;){var r=t.value;if(""!==r){for(var a,o=!1,s=cu(this._policyLabelsData.SensitivityLabels);!(a=s()).done;){var l=a.value;(null==l?void 0:l.Id)===r&&(o=!0,(!n||l.Order>n.Order)&&(n=l))}if(!o)return null}}return n||(n=new wc),n},o.getAppliedLabel=function(){return""===this._appliedPolicyId?new wc:this.getLabelfromId(this._appliedPolicyId)},o.tryUpgradeLabel=function(e,t){if(""===e.Id)return 0;var n=this.getLabelfromId(this._appliedPolicyId),i=this.getLabelfromId(e.Id);if(!i)return 2147205112;if(!i.Enabled)return 2147205117;if(i.HasUserDefinedPermissions)return 2147205116;if(1==s.AFrameworkApplication.theActionManager.mode)return 2147205119;if(i.RequiredDowngradeJustification||(null==n?void 0:n.Order)>=i.Order)return 2147205105;var r=new Ql(4,this.getParentChildSensitivityLabelText(i));return this.setPolicyLabelRequestAsync(i.Id,"",r,t),0},t=e,(n=[{key:"isAutoPolicyLabelHandlerEventRaised",get:function(){return this._isAutoPolicyLabelHandlerEventRaised}},{key:"isEveryCoauthorInSessionClientMipTrusted",get:function(){if(!this._editorsTableManager)return!1;for(var e,t=cu(this._editorsTableManager.getAllAuthors());!(e=t()).done;){var n=e.value;if(!n.Capabilities||!n.Capabilities.SupportsClientIsMipTrusted)return!1}return!0}},{key:"isRtcInitialized",get:function(){return!!this._rtc}}])&&du(t.prototype,n),i&&du(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function hu(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(pu,"PolicyManager",null,[117]);var gu=function(){function e(){var e=this;this._policyManager=null,this._container=null,this._policyActor=null,this._businessBar=null,this._autoLabellingBusinessBarEntry=null,this._recommendedLabellingBusinessBarEntry=null,this._mandatoryLabellingBusinessBarEntry=null,this._policyTipBusinessBarEntry=null,this._setPolicyErrorBusinessBarEntry=null,this.onAfterRibbonBehaviorAttached=function(){e._businessBar=e._container.tryResolve("CommonUI.BusinessBar"),e._policyManager||(e._policyManager=e._container.resolve("Common.App.Policy.Contracts.IPolicyManager")),e._policyActor=e._container.resolve("Common.App.Policy.PolicyActor"),Ot.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?e._policyManager.add_labelInfoUpdateHandler(Object(A.a)(e._policyActor,e._policyActor.registerActionsHandler,"registerActionsHandler")):e._policyActor.registerActions(),e._policyManager.add_labelInfoUpdateHandler(e.updateLabelInfo),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacApplyManualPolicyLabelIsEnabled")&&(e._policyManager.add_setPolicyLabelFailureHandler(e.handleSetPolicyLabelFailure),e._policyManager.add_addAutoPolicyBusinessBarEntryHandler(e.addAutoPolicyBusinessBarEntry),e._policyManager.add_removeAutoPolicyBusinessBarEntryHandler(e.removeAutoPolicyBusinessBarEntry),e._policyManager.add_addMandatoryLabellingBusinessBarHandler(e.addMandatoryLabellingBusinessBarEntry),e._policyManager.add_removeMandatoryLabellingBusinessBarHandler(e.removeMandatoryLabellingBusinessBarEntry))},this.updateLabelInfo=function(t,n){e._policyActor.setIdToSensitivityDictionary(),e._policyActor.setParentToChildSensitivityLabelsDictionary(),e._policyActor.querySensitivityControl();var i=e._policyManager.checkIsClpBlockedByAppSpecificScenario();s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HasDocumentEditRights")&&!i?e._policyActor.triggerDefaultOrMandatoryLabelingIfNeeded():r.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("HasDocumentEditRights"),i),s.AFrameworkApplication.activeFrame.updateCommandUI()},this.showPolicyBusinessBar=function(t,n){e._policyTipBusinessBarEntry&&e._businessBar.isEntryExistent(38)&&e._businessBar.removeEntry(e._policyTipBusinessBarEntry);var i=e.getPolicyBusinessBarEntry(n.title,n.policyText,38,null,n.onButtonClickCallback,n.buttonText);s.AFrameworkApplication.activeFrame.applicationInstance.addEntryToBusinessBar(i,!0)?(e._policyTipBusinessBarEntry=i,r.ULS.sendTraceTag(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user.")):r.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")},this.handleSetPolicyLabelFailure=function(t,n){if(n.showMessage){e._setPolicyErrorBusinessBarEntry&&e._businessBar.isEntryExistent(21)&&e._businessBar.removeEntry(e._setPolicyErrorBusinessBarEntry);var i=n.title,a=n.message,o=n.buttonText,l=n.businessBarEntryHandler,c=e.getPolicyBusinessBarEntry(i,a,21,null,null,null,l,o);s.AFrameworkApplication.activeFrame.applicationInstance.addEntryToBusinessBar(c,!0)?(e._setPolicyErrorBusinessBarEntry=c,r.ULS.sendTraceTag(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user.")):r.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}},this.removeAutoPolicyBusinessBarEntry=function(t,n){var i=n.isRecommended?e._recommendedLabellingBusinessBarEntry:e._autoLabellingBusinessBarEntry;i&&e._businessBar&&e._businessBar.isEntryExistent(n.businessBarId)&&e._businessBar.removeEntry(i)},this.addAutoPolicyBusinessBarEntry=function(t,n){if(e._businessBar){e._policyManager.removeAutoPolicyBusinessBarEntry(n.businessBarId);var i=new Il.a(n.title,n.message,null);i.id=n.businessBarId,i.closeable=!0,i.image=3,i.addButton(n.buttonText,n.businessBarEntryHandler,n.buttonText,!0),e._businessBar.addEntry(i,!1),n.isRecommended?e._recommendedLabellingBusinessBarEntry=i:e._autoLabellingBusinessBarEntry=i}},this.addMandatoryLabellingBusinessBarEntry=function(t,n){if(e._businessBar){var i=new Il.a(n.title,n.message,null);i.id=n.businessBarId,i.closeable=!1,i.image=3,i.addButton(n.buttonText,n.businessBarEntryHandler,n.buttonText,!1),e._businessBar.addEntry(i,!1),e._mandatoryLabellingBusinessBarEntry=i}},this.removeMandatoryLabellingBusinessBarEntry=function(t,n){var i=e._mandatoryLabellingBusinessBarEntry;i&&e._businessBar&&e._businessBar.isEntryExistent(i.id)&&e._businessBar.removeEntry(i)}}var t,n,i,a=e.prototype;return a.init=function(){var e=this;s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("ShouldInitCommonPolicyPackage")&&(s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("IsDataLossPreventionEnabledForUser")&&s.AFrameworkApplication.activeFrame&&(this._policyManager=this._container.resolve("Common.App.Policy.Contracts.IPolicyManager"),this._policyManager.add_policyTipHandler(this.showPolicyBusinessBar),r.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?Fe.a.get_instance().executeWhen(5,(function(){e._policyManager.getDocumentPolicyRequestAsync()})):Fe.a.get_instance().executeWhen(6,(function(){e._policyManager.getDocumentPolicyRequestAsync()}))),s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("WacLabelingPoliciesIsEnabled")&&s.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("SupportsPolicies")?s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.InitPolicyManagerEarlierEnabled",!1)?Fe.a.get_instance().executeWhen(5,this.onAfterRibbonBehaviorAttached):Fe.a.get_instance().executeWhen(6,this.onAfterRibbonBehaviorAttached):(Cc.updateSensitivityBarHiddenStatus(!0),Cc.reportAndUpdateSensitivityControlBootStatus(!1)))},a.dispose=function(){},a.configure=function(e){e.register(117,"Common.App.Policy.Contracts.IPolicyManager").singleInstance().usingFactory((function(){return new pu(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,s.AFrameworkApplication.activeFrame.theStopwatchBuilder,s.AFrameworkApplication.appSettingsManager.getIntAppSetting("MaxGetPolicyRetries",1),e.resolveFuture("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),s.AFrameworkApplication.activeFrame.applicationInstance.officeAppType)})),e.register(Cc,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").singleInstance().usingFactory((function(){return new Cc(s.AFrameworkApplication.theActionManager,s.AFrameworkApplication.activeFrame,s.AFrameworkApplication.appSettingsManager,e.resolveLazy("Common.App.Policy.Contracts.IPolicyManager"))})),this._container=e},a.getPolicyBusinessBarEntry=function(e,t,n,i,r,a,o,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null);var l=new Il.a(e,t,i);return l.id=n,l.closeable=!0,r&&l.addLinkWithHandler(a,r),o&&l.addButton(s,o,s),l},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.Policy"}}])&&hu(t.prototype,n),i&&hu(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(gu,"PackageManager",null,[2,3]);var mu=function(){function e(){}return e.getCache=function(t){try{return caches.open(e._cacheName).then((function(e){return e.match(t)}))}catch(e){return Promise.reject(null)}},e.getCachedData=function(t,n){try{return e.getCache(t).then((function(e){return e&&Number.parseInvariant(e.headers.get("cachedTime"))>Date.now()-n?Promise.resolve(e.text().toLocaleString()):Promise.reject("Not found")})).catch((function(e){return Promise.reject("Cache returned undefined")}))}catch(e){return Promise.reject(null)}},e.store=function(t,n){try{return caches.open(e._cacheName).then((function(e){return e.put(t,n).then((function(e){return!0})),!1})).catch((function(e){return Promise.resolve(!1)}))}catch(e){return Promise.resolve(!0)}},e.storeCache=function(t,n){var i={};i.body=n;var r={};r.cachedTime=Date.now().toString(),i.headers=r;var a=new Response(n,i);return e.store(t,a).then((function(e){return!0}))},e}();mu._cacheName="ConsentState",Object(i.a)(mu,"CacheManager",null,[]);var fu=function(){this.message=null,this.httpStatusCode=0};Object(i.a)(fu,"HttpRequstToPromiseRejectData",null,[]);var vu=n(99),_u=n(238),yu=function(){function e(e){this._props=e}return e.prototype.logTelemetryEvent=function(e,t,n,i,r,a){vu.a.sendTelemetryEvent(Object.assign(new _u.a,{name:"Office.Online."+e,dataFields:[Object.assign(new wa.a,{name:"EventMessage",string:t}),Object.assign(new wa.a,{name:"FormFactor",string:this._props.formFactor}),Object.assign(new wa.a,{name:"CorrelationId",string:this._props.correlationId}),Object.assign(new wa.a,{name:"AccountType",string:this._props.accountType}),Object.assign(new wa.a,{name:"OSVersion",string:this._props.osVersion}),Object.assign(new wa.a,{name:"AppId",string:this._props.appId}),Object.assign(new wa.a,{name:"ConsentSurface",string:"AppStart"}),Object.assign(new wa.a,{name:"ConsentLanguage",string:this._props.consentLanguage}),Object.assign(new wa.a,{name:"EventCode",string:n}),Object.assign(new wa.a,{name:"Region",string:this._props.region}),Object.assign(new wa.a,{name:"ModelType",string:i}),Object.assign(new wa.a,{name:"ModelId",string:r}),Object.assign(new wa.a,{name:"Platform",string:this._props.os}),Object.assign(new wa.a,{name:"ReConsentReason",string:""}),Object.assign(new wa.a,{name:"ConsentType",string:a})]}))},e}();Object(i.a)(yu,"TelemetryLogger",null,[]);var Su=function(){function e(e,t,n){this._consentUrl="https://consent.config.office.com/consentcheckin/v1.0/consents",this._appSettingsManager=e,this._clientRequestManager=t,this._webSdkAdapterProps=n,this._telemetryLogger=new yu(n)}var t=e.prototype;return t.createHttpResponsePromise=function(e,t){var n=this,i="UnifiedConsent.ConsentGetFailed";return new Promise((function(r,a){var o=n._appSettingsManager.getIntAppSetting("UCNoticeCheckinCallTimeoutMs",5e3),s=n._appSettingsManager.getStringAppSetting("UCNoticeCheckinStateUrl");s&&s.length||(s=n._consentUrl),n._clientRequestManager.addRequestWithHeaderForwarding(s,1,null,n.getHeaders(e),null,!1,0,(function(e){try{if(null==e||void 0===e.data||null===e.data||void 0===e.data.responseData||null===e.data.responseData){n._telemetryLogger.logTelemetryEvent(i,"CheckInApi : Invalid response","711",null,null,null);var o=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",i);return void a(n.getRejectData(o,e))}if(e.data.httpStatus!==M.a.OK_200){n._telemetryLogger.logTelemetryEvent(i,"CheckInApi : HTTP failure",e.data.httpStatus.toString(),null,null,null);var s=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",e.data.httpStatus,i);return void a(n.getRejectData(s,e))}var l=t(e.data.responseData);if(!l){n._telemetryLogger.logTelemetryEvent(i,"CheckInApi : Consent values are empty","712",null,null,null);var c=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",i);return void a(n.getRejectData(c,e))}r(l)}catch(t){n._telemetryLogger.logTelemetryEvent(i,"CheckInApi : Unexpected failure","713",null,null,null);var u=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",t,i);a(n.getRejectData(u,e))}}),(function(e){n._telemetryLogger.logTelemetryEvent(i,"CheckInApi : Error in service call ",e.data.httpStatus.toString(),null,null,null);var t=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, request - {1}",e.data.httpStatus,i);a(n.getRejectData(t,e))}),null,void 0,void 0,2500,o)}))},t.getRejectData=function(e,t){var n=new fu;return n.message=e,t&&t.data?n.httpStatusCode=t.data.httpStatus:n.httpStatusCode=-1,n},t.getHeaders=function(e){var t={};return t["Accept-Language"]=this._webSdkAdapterProps.consentLanguage,t.consentsurface="AppStart",t.platform="Web",t.formfactor=z.a.isMobileBrowser?"Mobile":"Desktop",t["x-Cid"]=this._webSdkAdapterProps.correlationId,t.Authorization="Bearer "+e,t},e}();Object(i.a)(Su,"HttpRequestToPromiseUtility",null,[]);var bu=function(){this.accountType="MSA",this.modelType=null,this.appEnv=0,this.appName=null,this.appId=null,this.appVersion=null,this.consentLanguage=null,this.deviceId=null,this.emailId=null,this.formFactor="Unknown",this.os=null,this.osVersion=null,this.region=null,this.token=null,this.useCache=!1,this.userId=null,this.correlationId=null,this.isDarkMode=!1};function Au(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Cu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Cu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}Object(i.a)(bu,"WebSdkAdapterProps",null,[]);var Tu=function(){function e(t,n,i,r){var a=this;this._modelType=null,this._modelId=null,this._consentType=null,this._httpRequestToPromiseUtility=null,this.parseConsentCheckinState=function(t){if(null==t)return a._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"Checkin response undefined or null","705",a._modelType,a._modelId,a._consentType),null;try{return H.d(t).deserialized}catch(t){a._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"Checkin response parse error : "+t.message,"706",a._modelType,a._modelId,a._consentType)}return null},this._appEnvironment=r,this._appSettingsManager=t,this._authManagerFuture=i,this._clientRequestManager=n,this._webSdkAdapterProps=this.getDimensions(),this._telemetryLogger=new yu(this._webSdkAdapterProps)}var t=e.prototype;return t.showConsentDialog=function(){var t=this;if("MSA"===(this._appSettingsManager.getStringAppSetting("HostAuthType")||"").toUpperCase()){var n=this._appSettingsManager.getIntAppSetting("UCNoticeCheckinCacheTimeMs",862e5);mu.getCachedData(this._webSdkAdapterProps.userId,n).then((function(n){return t._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"CacheFound","701",t._modelType,t._modelId,t._consentType),{}})).catch((function(n){t._authManagerFuture.execute((function(n){n.tryGetToken("Consent",e._targetCheckIn).then((function(i){return i.IsSuccess?(t._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"CheckInTokenSuccess","702",t._modelType,t._modelId,t._consentType),t.getConsentStatus(i.Token).then((function(i){return t.getModelTobeShown(i),t._modelType&&""!==t._modelType&&n.tryGetToken("Consent",e._targetWeb).then((function(n){return n.IsSuccess?(t._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"WebTokenSuccess","703",t._modelType,t._modelId,t._consentType),t.showNotice(n,t._modelType)):t._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"WebTokenFailed : "+n.ErrorMessage,n.ErrorCode,t._modelType,t._modelId,t._consentType),{}})),{}})),{}):(t._telemetryLogger.logTelemetryEvent(e._kpiNameToken,"CheckInTokenFailed : "+i.ErrorMessage,i.ErrorCode,t._modelType,t._modelId,t._consentType),{})}))}))}))}},t.getConsentStatus=function(e){return this._httpRequestToPromiseUtility=new Su(this._appSettingsManager,this._clientRequestManager,this._webSdkAdapterProps),this._httpRequestToPromiseUtility.createHttpResponsePromise(e,this.parseConsentCheckinState).then((function(e){return Promise.resolve(e)}),(function(e){return Promise.reject("Error while getting result"+e)}))},t.getModelTobeShown=function(e){for(var t,n=Au(e.consentValues);!(t=n()).done;){var i=t.value;if(i.needConsent&&!i.maxPromptsReached)return this._modelId=i.id,this._consentType=i.consentType,void(this._modelType=i.modelType)}mu.storeCache(this._webSdkAdapterProps.userId,H.c(e))},t.showNotice=function(t,n){if(Ot.a("showConsentNotice")){var i=document.createElement("div");document.body.appendChild(i),appChrome.api.showConsentNotice(this.getDimensionsWithToken(t.Token,n),i)}else this._telemetryLogger.logTelemetryEvent(e._kpiName,"1JS : ShowConsentNotice API not found","704",this._modelType,this._modelId,this._consentType)},t.getDimensionsWithToken=function(e,t){var n=this._webSdkAdapterProps;return n.token=e,n.modelType=t,n},t.getDimensions=function(){var e=this.initSessionStartInfoSettings(this._appSettingsManager.getStringAppSetting("SessionStartInfoJson"));return Object.assign(new bu,{emailId:this._appSettingsManager.getStringAppSetting("UserPrincipalName"),userId:this._appSettingsManager.getStringAppSetting("LoggableUserId"),accountType:"AAD"===(this._appSettingsManager.getStringAppSetting("HostAuthType")||"").toUpperCase()?"AAD":"MSA",appId:this._appSettingsManager.getStringAppSetting("OfficeApplicationId"),appVersion:this._appSettingsManager.getStringAppSetting("appVersion"),appName:"Application"in e?e.Application:"",appEnv:this._appEnvironment,consentLanguage:this._appSettingsManager.getStringAppSetting("UICulture")||"en-US",formFactor:z.a.isMobileBrowser?"Mobile":"Desktop",os:"Os"in e?e.Os:"",osVersion:"OsVersion"in e?e.OsVersion:"",region:this._appSettingsManager.getStringAppSetting("region"),correlationId:J.a.create().toString(),isDarkMode:this._appSettingsManager.getBooleanAppSetting("DarkModeIsOn"),useCache:!0})},t.initSessionStartInfoSettings=function(e){var t={};try{t=H.b(e)}catch(e){return t}return t},e}();function ku(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Tu._targetWeb="https://consentservice.microsoft.com/web",Tu._targetCheckIn="https://consentservice.microsoft.com/checkin",Tu._kpiName="UnifiedConsent.ConsentGetFailed",Tu._kpiNameToken="UnifiedConsent.AuthTokenStatus",Object(i.a)(Tu,"ConsentNoticeManager",null,[138]);var wu=function(){function e(){this._container=null}var t,n,i,r=e.prototype;return r.configure=function(e){this._container=e,e.register(Tu,"Common.App.ConsentNoticeDialog.ConsentNoticeManager").as("Common.App.ConsentNoticeDialog.IConsentNoticeManager").singleInstance().usingFactory((function(){return new Tu(s.AFrameworkApplication.appSettingsManager,s.AFrameworkApplication.theClientRequestManager,e.resolveFuture("Common.App.OAuth.IOAuthManager"),s.AFrameworkApplication.environment)}))},r.init=function(){this._container.resolve("Common.App.ConsentNoticeDialog.IConsentNoticeManager")},r.dispose=function(){},e.main=function(){y.a.instance.registerPackage(new e)},t=e,(n=[{key:"name",get:function(){return"Common.App.ConsentNoticeDialog"}}])&&ku(t.prototype,n),i&&ku(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(wu,"ConsentNoticeDialogPackage",null,[2,3]);Type.registerNamespace("WELT"),Type.registerNamespace("WVAc"),Type.registerNamespace("WVCo"),Type.registerNamespace("WVHi"),Type.registerNamespace("WVSea"),Type.registerNamespace("WVSel"),Type.registerNamespace("Wac.Common"),Type.registerNamespace("Wac.Common.Actors"),Type.registerNamespace("Wac.Common.SendUsYourFile"),Type.registerNamespace("WordViewer.Embed"),Type.registerNamespace("WordViewer.SendUsYourFile"),Type.registerNamespace("Common.Comments"),Type.registerNamespace("Common.App.CommandUIActors"),Type.registerNamespace("Common.App.HostNotification"),k.main(),Type.registerNamespace("Common"),Type.registerNamespace("Common.App.ApplicationFeatureHelper"),ve.main(),Type.registerNamespace("Common.App.DisplayEnvironmentName"),Ce.main(),Type.registerNamespace("Common.App.GestureInput"),Re.main(),Type.registerNamespace("Common.App.GestureManager"),ot.main(),Type.registerNamespace("Common.App.SafeLinks"),Type.registerNamespace("Common.App.SafeLinks"),ft.main(),Type.registerNamespace("Common.App.Embed"),Type.registerNamespace("Common.App.InProductMessaging"),Wt.main(),Type.registerNamespace("CNT"),on.main(),Type.registerNamespace("Common.App.NewAndOpen.Core"),y.a.instance.registerPackage(new Nn),Type.registerNamespace("Common.App.O365Shell"),Gn.main(),Type.registerNamespace("Common.App.OneDriveFilePickerApi"),mi.main(),Type.registerNamespace("Common.App.OpenInClient"),Type.registerNamespace("Common.App.SaveToCloudStorage"),Li.main(),Type.registerNamespace("Common.Search"),Type.registerNamespace("Common.App.SessionExpiration"),Type.registerNamespace("Common.App.SessionExpiration"),Cr.main(),Va.main(),y.a.instance.registerPackage(new fo),Po.main(),y.a.instance.registerPackage(new Oo),y.a.instance.registerPackage(new Ro),ll.main(),Cl.main(),Type.registerNamespace("Common.App.AppLoadStateTracker"),window.Common.App.AppLoadStateTracker.AppLoadStateTracker=Tl,y.a.instance.registerPackage(new wl,7),Type.registerNamespace("Common.App.WildFire"),Xl.main(),Type.registerNamespace("Common.App.Policy"),gu.main(),null!=s.AFrameworkApplication.appSettingsManager&&s.AFrameworkApplication.appSettingsManager.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ShowUnifiedConsent",!1)&&(Type.registerNamespace("Common.App.ConsentNoticeDialog"),wu.main())},650:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(1),a=n(35),o=n(20);function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(){}var t,n,i;return e.prototype.getRegex=function(e,t){var n="g";return t.matchCase||t.matchWildCards||(n+="i"),(t.matchPrefix||t.matchWholeWord)&&(e="\\b"+e),(t.matchSuffix||t.matchWholeWord)&&(e+="\\b"),new RegExp(e,n)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&s(t.prototype,n),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}l._instance=null,Object(i.a)(l,"FindUtils",null,[223]);var u=function(){function e(e,t,n,i){this._contextus=e,this._resultStart=t,this._resultEnd=n,this._resultType=i}var t,n,i;return t=e,(n=[{key:"contextus",get:function(){return this._contextus}},{key:"resultStart",get:function(){return this._resultStart}},{key:"resultEnd",get:function(){return this._resultEnd}},{key:"resultType",get:function(){return this._resultType}}])&&c(t.prototype,n),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(u,"SearchContext",null,[253]);var d=function(){function e(){}var t=e.prototype;return t.createSearchContext=function(e,t,n,i,r){var a,o,s=i-n;if(s>=100)a=n,o=i;else{var l;if(a=Math.max(0,n+Math.ceil(s/2)-50),o=Math.min(e.length,a+100),(a=Math.max(0,o-100))&&" "!==e.charAt(a-1)){l=Math.min(n,a+10);for(var c=a;c<l;++c)if(" "===e.charAt(c)){a=c+1;break}}if(o!==e.length&&" "!==e.charAt(o)){l=Math.max(i,o-10);for(var d=o-1;d>=l;--d)if(" "===e.charAt(d)){o=d;break}}}var p=e.substring(a,o);return new u(p,n-a,i-a,r)},t.createSearchContextFromFindResult=function(e){return this.createSearchContext(e.getOriginalText(),"",e.begin,e.end,"")},e}();Object(i.a)(d,"SearchContextFactory",null,[222]);var p=function(){function e(e){this.result=null,this.regExp=e}var t=e.prototype;return t.exec=function(e){return!!(this.result=this.regExp.exec(e))},t.getIndex=function(){return this.result.index},t.getLastIndex=function(){return this.regExp.lastIndex},e}();Object(i.a)(p,"RegularExpressionWrapper",null,[]);var h=n(7);function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(){}var t,n,i,r=e.prototype;return r.preprocessQuery=function(e){var t=this.splitSearchQuery(e).join("");var n=new RegExp("(\\\\.\\\\.\\\\.)","g");return t.replace(n,"(\\.\\.\\.|\u2026)")},r.preprocessQueryWithQueryFilters=function(t){var n,i=t.text;if(n=t.matchWildCards?this.splitSearchQueryWithWildCardEnabled(i):this.splitSearchQuery(i),t.ignorePunct||t.ignoreSpace){var r="";t.ignoreSpace&&(r+="\\s"),t.ignorePunct&&(r+=e.punctuationCharacters),r="["+r+"]*";for(var a=1;a<n.length;a++)(!t.matchWildCards||"{"!==n[a].charAt(0)&&"@"!==n[a].charAt(0))&&(n[a]=r+n[a])}return n.join("")},r.parseQuery=function(e){return[e]},r.isValidWildCardStatement=function(e){for(var t=0;t<e.length;++t){var n=e.charAt(t),i=0;if("["===n){var r;if(!(r=this.isStartWithValidSpecialCharacterStatement(e.substr(t)),i=r.endOfStatement,r).returnValue)return!1;t=i+t-1}else if("<"===n){if(!this.isStartWithValidBeginOfWordStatement(e.substr(t)))return!1}else if(">"===n){if(!t)return!1}else if("{"===n){var a;if(!t||!(a=this.isStartWithValidMultiOccurBraceStatement(e.substr(t)),i=a.endOfStatement,a).returnValue)return!1;t=i+t-1}else if("@"===n){if(!t||!this.isStartWithValidMultiOccurAtStatement(e.substr(t)))return!1}else if("("===n){var o;if(!(o=this.isStartWithParenthesisSubStatement(e.substr(t)),i=o.endOfStatement,o).returnValue)return!1;t=i+t-1}else if("}"===n||"]"===n||")"===n)return!1}return!0},r.findWildCardStatement=function(e,t){var n,i;if(n=0,i=0,e.length<=t)return{returnValue:!1,endOfStatement:n,wildCardKind:i};var r=e.length,a=e.charAt(t);if("["===a)for(var o=t+1;o<r;o++){if("]"===e.charAt(o)&&o-t!=1)return{returnValue:!0,endOfStatement:n=o,wildCardKind:i=5}}else if("{"===a)for(var s=-1,l=t+1;l<r;l++){var c=e.charAt(l);if(","===c)s=l;else if("}"===c)return{returnValue:!0,endOfStatement:n=l,wildCardKind:i=-1===s?6:l-s!=1?7:8}}return{returnValue:!1,endOfStatement:n,wildCardKind:i}},r.turnAsteriskToRegEx=function(e,t,n){var i;if(i=t,!t&&1===e.length)return{returnValue:this.turnWildCardToRegEx(e,n,!0),endOfStatement:i};switch(e.charAt(t+1)){case"{":var r,a,o,s="";return(r=this.findWildCardStatement(e,t+1),a=r.endOfStatement,o=r.wildCardKind,r).returnValue?(s=this.turnWildCardToRegEx("*",n,!0)+this.turnWildCardToRegEx(e.substring(t+1,a+1),o),7!==o&&8!==o||(s+="?"),{returnValue:s,endOfStatement:i=a}):{returnValue:this.turnWildCardToRegEx("*",n,!1),endOfStatement:i};case"@":return i=t+1,{returnValue:this.turnWildCardToRegEx("*",n,!0),endOfStatement:i};case"*":if(!t){for(i++;"*"===e.charAt(i);)i++;return i===e.length?{returnValue:this.turnWildCardToRegEx("*",n,!0),endOfStatement:i}:{returnValue:this.turnWildCardToRegEx("*",n,!1),endOfStatement:i}}return{returnValue:this.turnWildCardToRegEx("*",n,!1),endOfStatement:i};default:return{returnValue:this.turnWildCardToRegEx("*",n,!1),endOfStatement:i}}},r.turnWildCardToRegEx=function(e,t,n){void 0===n&&(n=!1);var i=e.length;switch(t){case 5:return"!"===e.charAt(1)&&i>2?"([^"+this.preprocessStringInSquareBrackets(e.substr(2,i-3))+"]\u0640*)":"(["+this.preprocessStringInSquareBrackets(e.substr(1,i-2))+"]\u0640*)";case 6:case 7:return e;case 9:return"+?";case 8:return e;case 3:case 4:return"\\b";case 1:return".";case 2:return n?"(.+?)":"(.*?)";case 10:return e}return null},r.getWildCardKind=function(e){switch(e){case"?":return 1;case"*":return 2;case"<":return 3;case">":return 4;case"@":return 9}return 0},r.preProcessChar=function(e){return"["===e||"]"===e||"\\"===e||"("===e||")"===e?String.format("\\{0}",e):"'"===e||"\u2018"===e||"\u2019"===e||'"'===e||"\u201c"===e||"\u201d"===e||h.a.isWhitespaceUnicode(e)?this.processApostraphyQuoteHyphen(e):e},r.preprocessStringInSquareBrackets=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charAt(n);t[n]=this.preProcessChar(i)}return t.join("")},r.isStartWithValidSpecialCharacterStatement=function(e){var t;t=-1;var n=new p(new RegExp("\\[.+?\\]","g"));if(!n.exec(e))return{returnValue:!1,endOfStatement:t};if(n.getIndex())return{returnValue:!1,endOfStatement:t};if(t=n.getLastIndex(),new p(new RegExp("(\\(\\))|(.+?!)","g")).exec(e.substring(1,t-1)))return{returnValue:!1,endOfStatement:t};var i=new p(new RegExp("[^!\\[]-[^\\]]","g"));for(e.substring(0,t);i.exec(e.substring(0,t));){var r=i.getIndex(),a=i.getLastIndex(),o=new RegExp("[-]","g"),s=e.substring(r,a).split(o);if(s[0].charAt(0)>s[1].charAt(0))return{returnValue:!1,endOfStatement:t}}return{returnValue:!0,endOfStatement:t}},r.isStartWithValidBeginOfWordStatement=function(e){return!new p(new RegExp("\\<(\\{|\\@|\\>|\\<|\\}|\\))","g")).exec(e)},r.isStartWithValidMultiOccurBraceStatement=function(e){var t;t=-1;if(new p(new RegExp("(\\}\\{)|(\\}\\@)","g")).exec(e))return{returnValue:!1,endOfStatement:t};var n=new p(new RegExp("\\{\\d+(,|(,\\d+))?\\}","g"));if(!n.exec(e))return{returnValue:!1,endOfStatement:t};if(n.getIndex())return{returnValue:!1,endOfStatement:t};t=n.getLastIndex();var i=new RegExp("[{,}]","g"),r=e.substring(0,t).split(i);return 4===r.length&&Number.parseInvariant(r[1])>=Number.parseInvariant(r[2])?{returnValue:!1,endOfStatement:t}:{returnValue:!0,endOfStatement:t}},r.isStartWithValidMultiOccurAtStatement=function(e){return!new p(new RegExp("\\@\\{","g")).exec(e)},r.isStartWithParenthesisSubStatement=function(e){var t;t=-1;var n=-1,i=new p(new RegExp("\\(([^\\[\\]]*?(\\[.+?\\])?)+?\\)","g"));if(i.exec(e)){if(n=i.getIndex(),t=i.getLastIndex(),n)return{returnValue:!1,endOfStatement:t};if(this.isValidWildCardStatement(e.substring(1,t-1)))return{returnValue:!0,endOfStatement:t}}return{returnValue:!1,endOfStatement:t}},r.splitSearchQueryWithWildCardEnabled=function(e){for(var t=[],n=e.length,i=0,r=0;r<n;++r){var a,o=i,s=e.charAt(r),l=0,c=0;if("["===s||"\\"===s||"^"===s||"$"===s||"."===s||"|"===s||"+"===s||"("===s||")"===s||"?"===s||"*"===s||"<"===s||">"===s||"@"===s||"?"===s||"{"===s)if("["!==s&&"{"!==s||!(a=this.findWildCardStatement(e,r),l=a.endOfStatement,c=a.wildCardKind,a).returnValue)if("?"===s||"<"===s||">"===s||"@"===s)c=this.getWildCardKind(s),t[o]=this.turnWildCardToRegEx(s,c);else if("*"===s){var u;c=this.getWildCardKind(s),t[o]=(u=this.turnAsteriskToRegEx(e,r,c),l=u.endOfStatement,u).returnValue,r=l}else"("===s||")"===s?(c=10,t[o]=this.turnWildCardToRegEx(s,c)):t[o]=String.format("\\{0}",s);else t[o]=this.turnWildCardToRegEx(e.substr(r,l+1-r),c),r=l;else"'"===s||"\u2018"===s||"\u2019"===s||'"'===s||"\u201c"===s||"\u201d"===s||"-"===s||"\u2013"===s||"\u2014"===s||h.a.isWhitespaceUnicode(s)?t[o]="["+this.processApostraphyQuoteHyphen(s)+"]":t[o]="\u2026"===s?"\\.\\.\\.":s;""!==t[o]&&0===c&&(r<e.length-1&&("@"===e.charAt(r+1)||"{"===e.charAt(r+1))?t[o]="("+t[o]+"\u0640*)":t[o]+="\u0640*"),i++}return t},r.splitSearchQuery=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charAt(n);"["===i||"\\"===i||"^"===i||"$"===i||"."===i||"|"===i||"+"===i||"("===i||")"===i||"?"===i||"*"===i?t[n]=String.format("\\{0}",i):"'"===i||"\u2018"===i||"\u2019"===i||'"'===i||"\u201c"===i||"\u201d"===i||"-"===i||"\u2013"===i||"\u2014"===i||h.a.isWhitespaceUnicode(i)?t[n]="["+this.processApostraphyQuoteHyphen(i)+"]":t[n]="\u2026"===i?"\\.\\.\\.":i,""!==t[n]&&(t[n]+="\u0640*")}return t},r.processApostraphyQuoteHyphen=function(t){return"'"===t||"\u2018"===t||"\u2019"===t?"'\u2018\u2019":'"'===t||"\u201c"===t||"\u201d"===t?'"\u201c\u201d':"-"===t||"\u2013"===t||"\u2014"===t?"-\u2013\u2014":h.a.isWhitespaceUnicode(t)?e.unicodeWhitespaceCharacters:t},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&g(t.prototype,n),i&&g(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();m._instance=null,m.unicodeWhitespaceCharacters=" \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",m.punctuationCharacters='-\u2013.,:;/?!"\u3002\uff0c\uff1a\uff1b\u3001\uff1f\uff01\u201d\u201c',Object(i.a)(m,"WordQueryProcessor",null,[221]);var f=n(3),v=n(21),_=n(9),y=n(12),S=n(37),b=n(430),A=n(89),C=n(76),T=n(189),k=n(82),w=n(91),I=n(26),P=n(62),F=n(36),E=n(2),O=n(8),M=n(19),L=n(486),R=n(651),D=n(657),x=n(664),B=function(){};B.textboxFindId="TextBoxFind",B.buttonFindMatchCaseId="ButtonFindMatchCase",B.buttonFindMatchWholeWordId="ButtonFindMatchWholeWord",B.searchBoxDropDownId="SearchBoxDropDown",B.searchBoxFrameId="SearchBoxFrame",B.searchBoxSplitButtonId="FindSplitButton",B.searchUIAreaId="SearchUIArea",B.cancelSearchMenuId="CancelSearchMenu",Object(i.a)(B,"SearchBoxControls",null,[]);var U=function(){};U.checkedImageName="QuickSearchCompletedToday_16x16x32",U.splitButtonArrow="SplitButtonArrow_5x3x32",U.splitButtonArrow8by8="SplitButtonArrow_8x8x32",U.splitButtonSearchIcon="Search_16x16x32",U.splitButtonCancelIcon="ClosePaneGlyph_16x16x32",Object(i.a)(U,"SearchBoxIcons",null,[]);var H=function(){function e(e,t){this._resultDom=e,this._resultHit=t}var t=e.prototype;return t.dispose=function(){this._resultDom=null,this._resultHit=null},t.getOffsetTop=function(){return this._resultDom.offsetTop},t.getOffsetHeight=function(){return this._resultDom.offsetHeight},t.select=function(){Sys.UI.DomElement.addCssClass(this._resultDom,"WACSelectedResult"),Sys.UI.DomElement.addCssClass(this._resultHit,"WACActiveContext")},t.deselect=function(){this._resultDom&&Sys.UI.DomElement.removeCssClass(this._resultDom,"WACSelectedResult"),this._resultHit&&Sys.UI.DomElement.removeCssClass(this._resultHit,"WACActiveContext")},e}();Object(i.a)(H,"SearchPaneItem",null,[290,10]);var N=function(){function e(t){this._resultsScroller=t,this._sampleResult=e.createSearchResult(),this._lastResultBox=null}var t=e.prototype;return t.dispose=function(){this._resultsScroller=null,this._lastResultBox=null,this._sampleResult=null},t.addResult=function(t,n,i){if(n){var r=R.b("div",null,e._wacResultDividerClassName);this._resultsScroller.appendChild(r)}var a=this.resultBoxFromContext(t,n,i);this._resultsScroller.appendChild(a),this._lastResultBox=a},t.clearAllResults=function(){for(;this._resultsScroller.hasChildNodes();)this._resultsScroller.removeChild(this._resultsScroller.lastChild);this._resultsScroller.parentNode&&(this._resultsScroller.parentNode.className=e._wacEmptyPaneClassName),this._lastResultBox=null},t.getSearchPaneItem=function(t){var n=document.getElementById(t+e._wacResultOutlineSuffix);if(!n)return null;var i=e.getDomFromSearchResult(n,3);return new H(n,i)},t.getSearchPaneIndex=function(e){var t=e.id;return parseInt(t)},t.goToResult=function(e,t,n){t+1===n&&(e.scrollTop=this._resultsScroller.offsetHeight),t||(e.scrollTop=0);var i=this.getSearchPaneItem(t),r=i.getOffsetTop(),a=e.scrollTop,o=r+i.getOffsetHeight(),s=a+e.offsetHeight;return r<e.scrollTop?e.scrollTop=r:o>s&&(e.scrollTop=o-e.offsetHeight),i},t.getLastResultBoxOffsetTop=function(){return this._lastResultBox?this._lastResultBox.offsetTop:Number.NaN},t.resultBoxFromContext=function(e,t,n){var i=this._sampleResult.cloneNode(!0);return this.updateResultBoxFromContext(i,e,t,n),i},t.updateResultBoxFromContext=function(t,n,i,r){var a=n.contextus,o=n.resultType,s=n.resultStart,l=n.resultEnd;t.id=i+e._wacResultOutlineSuffix;var c=e.getDomFromSearchResult(t,0);c.id=i+e._wacSearchResultSuffix,r&&(c.title=r);var u=e.getDomFromSearchResult(t,1);u.id=i+e._resultTypeSuffix,u.innerText=o;var d=e.getDomFromSearchResult(t,2);d.id=i+e._preResultSuffix,d.innerText=a.substring(0,s);var p=e.getDomFromSearchResult(t,3);p.id=i+e._resultSuffix,p.innerText=a.substring(s,l);var h=e.getDomFromSearchResult(t,4);h.id=i+e._postResultSuffix,h.innerText=a.substring(l,a.length)},e.createSearchResult=function(){var t=R.b("div",null,e._wacResultOutlineSuffix),n=R.b("div",null,e._wacSearchResultSuffix),i=R.b("span",null,"WACResultType"),r=R.b("span",null,null),a=R.b("span",null,"WACContext"),o=R.b("span",null,null);return n.appendChild(i),n.appendChild(r),n.appendChild(a),n.appendChild(o),t.appendChild(n),t},e.getDomFromSearchResult=function(e,t){switch(t){case 0:return e.firstChild;case 1:return e.firstChild.childNodes[0];case 2:return e.firstChild.childNodes[1];case 3:return e.firstChild.childNodes[2];case 4:return e.firstChild.childNodes[3]}},e}();N._wacResultOutlineSuffix="WACResultOutline",N._wacResultDividerClassName="ResultDivider",N._wacEmptyPaneClassName="WACSearchResultsPaneEmpty",N._wacSearchResultSuffix="WACSearchResult",N._resultTypeSuffix="resultType",N._preResultSuffix="preResult",N._resultSuffix="Result",N._postResultSuffix="postResult",N._selectedResultStyle="WACSelectedResult",Object(i.a)(N,"SearchResultsDom",null,[273,10]);var W=function(){function e(){}return e.prototype.createSearchResultsDom=function(e){return new N(e)},e}();Object(i.a)(W,"SearchResultsDomFactory",null,[252]);var j=n(64),V=n(5),q=n(155),G=n(656),K=n(6),z=n(16);function X(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var J=function(){function e(e,t,n,i){var r=this;this.registeredChangeEvent=null,this._form=null,this._inputMode=0,this._valueChangedHandler=null,this._submitHandler=null,this._textElement=null,this.onFocus=function(e){document.activeElement===r.textElement&&(r.applyFocussedStyle(),0===r._inputMode&&r.showUserInput())},this.onBlur=function(e){r.removeFocussedStyle(),1===r._inputMode&&""===r.textElement.value&&r.showPlaceholderText()},this.onSubmit=function(e){r._submitHandler&&r._submitHandler(),e.preventDefault()},this._id=e,this._className=t,this._placeholderText=n,this._keyInputManager=i,this.createPlaceholderControl(),this.showPlaceholderText()}var t,n,i,r=e.prototype;return r.enable=function(){this.textElement.removeAttribute("disabled")},r.disable=function(){this.textElement.setAttribute("disabled","true")},r.reset=function(){this.showUserInput()},r.setMaxInputLength=function(e){this.textElement.setAttribute("maxLength",String.format("{0}",e))},r.setFocus=function(){var e=this;window.setTimeout((function(){e.textElement.focus()}),0)},r.setTooltip=function(e){this.textElement.title=e},r.registerValueChangedHandler=function(e,t){this._valueChangedHandler=e,this.registeredChangeEvent=t,this._keyInputManager.registerHandler(this.registeredChangeEvent,this.textElement,this._valueChangedHandler)},r.registerSubmitHandler=function(e){this._submitHandler=e},r.createPlaceholderControl=function(){this._textElement=document.createElement("input"),this.textElement.id=this._id,this.textElement.className=this._className,this.textElement.type="text",this.textElement.setAttribute("Autocomplete","off"),this.textElement.setAttribute("data-lpignore","true"),K.a.setAriaAttribute(this.textElement,K.a.ariaRoleAttribute,K.a.ariaTextboxAttribute),Sys.UI.DomElement.addCssClass(this.textElement,"UIFont"),this.addPlaceholderCapabilityToTextbox(),this._form=document.createElement("form"),this._form.appendChild(this.textElement),M.a.addHandler(this._form,"submit",this.onSubmit)},r.addPlaceholderCapabilityToTextbox=function(){M.a.addHandler(this.textElement,"focus",this.onFocus),M.a.addHandler(this.textElement,"blur",this.onBlur)},r.showUserInput=function(){this.textElement.value="",this._inputMode=1,this.removePlaceholderStyle()},r.showPlaceholderText=function(){this.textElement.value=this._placeholderText,this._inputMode=0,this.applyPlaceholderStyle()},r.applyPlaceholderStyle=function(){Sys.UI.DomElement.addCssClass(this.textElement,"PlaceholderText")},r.removePlaceholderStyle=function(){Sys.UI.DomElement.removeCssClass(this.textElement,"PlaceholderText")},r.applyFocussedStyle=function(){Sys.UI.DomElement.addCssClass(this.textElement,"PlaceholderFocus")},r.removeFocussedStyle=function(){Sys.UI.DomElement.removeCssClass(this.textElement,"PlaceholderFocus")},r.dispose=function(){M.a.removeHandler(this.textElement,"focus",this.onFocus),M.a.removeHandler(this.textElement,"blur",this.onBlur),this._valueChangedHandler&&(this._keyInputManager.unregisterHandler(this.registeredChangeEvent,this.textElement,this._valueChangedHandler),this._valueChangedHandler=null),M.a.removeHandler(this._form,"submit",this.onSubmit),this._submitHandler=null},t=e,(n=[{key:"textElement",get:function(){return this._textElement}},{key:"rootElement",get:function(){return this._form}},{key:"value",get:function(){return this.isUserInput?this.textElement.value:""},set:function(e){this.showUserInput(),this.textElement.value=e,e&&z.a.selectAllTextInInput(this.textElement)}},{key:"placeholderText",get:function(){return this._placeholderText},set:function(e){this._placeholderText=e,0===this._inputMode&&this.showPlaceholderText()}},{key:"isUserInput",get:function(){return 1===this._inputMode}}])&&X(t.prototype,n),i&&X(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(J,"PlaceholderInput",null,[291,10]);var Q=function(){};Q.searchBoxStyle="SearchBox",Q.searchBoxFrameStyle="SearchBoxButtonFrame",Q.searchUIAreaStyle="SearchUIArea",Q.splitButtonStyle="SearchSplitButton",Object(i.a)(Q,"SearchBoxStyles",null,[]);var Z=n(73);function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $=function(){function e(t,n,i,r,a,o){var s=this;void 0===o&&(o=E.a.keyUp),this._placeholderInput=null,this._element=null,this.onQueryChanged=function(t){var n=e.isEnterKey(t);return s._placeholderInput.isUserInput?!(s.element.value===s._cachedQuery&&!n)&&(s.triggerSearch(n),!0):(s.element.value=s._placeholderInput.placeholderText,!0)},this._parent=t,this._queryChangedHandler=n,this._keyInputManager=i,this._searchBoxControlUser=r,this._stringsProvider=a,this._cachedQuery="",this.createSearchBox(),this.refreshControls(),this.registerQueryChangedHandler(o)}var t,n,i,r=e.prototype;return r.registerQueryChangedHandler=function(e){this._placeholderInput.registerValueChangedHandler(this.onQueryChanged,e)},r.refreshControls=function(){this._searchBoxControlUser.refreshControls()},r.createSearchBox=function(){var e=document.createElement("div");e.id=B.searchUIAreaId,e.className=Q.searchUIAreaStyle,this._parent.appendChild(e);var t=document.createElement("div");t.id=B.searchBoxFrameId,t.className=Q.searchBoxFrameStyle,e.appendChild(t),this._placeholderInput=new J(B.textboxFindId,Q.searchBoxStyle,this._stringsProvider.getString(0),this._keyInputManager),this._placeholderInput.setTooltip(this._stringsProvider.getString(1)),this._element=this._placeholderInput.textElement,t.appendChild(this._placeholderInput.rootElement),O.a.isInternetExplorer8&&(this.element.style.lineHeight="175%"),this.buildSearchSplitButton(t)},r.buildSearchSplitButton=function(e){var t=this.createSplitButtonXml(),n=this.getSplitButtonDomElement(t);n&&(Sys.UI.DomElement.addCssClass(n,Q.splitButtonStyle),K.a.setAriaAttribute(n,K.a.ariaRoleAttribute,K.a.ariaPresentationRole),this._stringsProvider.contains(7)&&K.a.setAriaAttribute(n,K.a.ariaRoleDescription,this._stringsProvider.getString(7)),e.appendChild(n))},r.getSplitButtonDomElement=function(e){return this._searchBoxControlUser.getSplitButtonDomElement(e,B.searchBoxDropDownId)},r.createSplitButtonXml=function(){var e=[Z.b(B.buttonFindMatchCaseId,"","2398455418","1369572530",this._stringsProvider.getString(2)),Z.b(B.buttonFindMatchWholeWordId,"","1783557000","3914542000",this._stringsProvider.getString(3))],t=Z.c("msFindSearch_Controls",e),n=Z.d("msFindSearch",t,null),i=[Z.a(B.cancelSearchMenuId,"241072808",this._stringsProvider.getString(4),U.splitButtonCancelIcon,"","",this._stringsProvider.getString(4),"","","")],r=Z.c("msCancelSearch_Controls",i),a=[n,Z.d(B.cancelSearchMenuId,r,null)];return Z.h(B.searchBoxSplitButtonId,V.a.clearSearch,V.a.queryClearSearch,this._stringsProvider.getString(6),U.splitButtonSearchIcon,a)},r.triggerSearch=function(e){this._cachedQuery=this.element.value,this._queryChangedHandler(this._cachedQuery,!e)},r.updateControl=function(e){this._searchBoxControlUser.updateControl(e)},r.enable=function(){this._placeholderInput.enable(),this.updateControl(B.searchBoxSplitButtonId)},r.disable=function(){this._placeholderInput.disable(),this.updateControl(B.searchBoxSplitButtonId)},r.reset=function(){this._placeholderInput.reset()},r.setMaxInputLength=function(e){this._placeholderInput.setMaxInputLength(e)},r.setFocus=function(){this._placeholderInput.setFocus()},r.dispose=function(){this._element=null,this._placeholderInput&&(this._placeholderInput.dispose(),this._placeholderInput=null),this._searchBoxControlUser&&(this._searchBoxControlUser.dispose(),this._searchBoxControlUser=null)},e.isEnterKey=function(e){return e.innerEvent.keyCode===F.a.vK_Enter},t=e,(n=[{key:"value",get:function(){return this._placeholderInput.value},set:function(e){this._placeholderInput.value=e}},{key:"placeholderText",get:function(){return this._placeholderInput.placeholderText},set:function(e){this._placeholderInput.placeholderText=e}},{key:"element",get:function(){return this._element}}])&&Y(t.prototype,n),i&&Y(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)($,"SearchBox",null,[275,10]);var ee=n(283),te=n(277),ne=function(){function e(){var e=new ee.a;e.ImageDownArrow=r.AFrameworkApplication.imageClusterPath,e.ImageDownArrowClass=j.getImageClass(U.splitButtonArrow),e.ImageCheckMark=r.AFrameworkApplication.imageClusterPath,e.ImageCheckMarkClass=j.getImageClass(U.checkedImageName),e.TextDirection=r.AFrameworkApplication.isRtl?"rtl":"ltr",this._root=new te.a("SearchBoxRoot",e),this._root.rootUser=y.App.get_activeAppFrame().ribbonUser}var t=e.prototype;return t.dispose=function(){this._root&&(this._root.dispose(),this._root=null)},t.refreshControls=function(){this._root.pollForStateAndUpdate()},t.getSplitButtonDomElement=function(e,t){return this._root.addControl(t,e)?this._root.getDOMElementForControlDisplayMode(t,"Small"):(v.ULS.sendTraceTag(4523030,313,15,"Failed to add SearchBox splitbutton, continuing"),null)},t.updateControl=function(e){this._root.updateControl(e)},e}();Object(i.a)(ne,"SearchBoxControlUser",null,[274,10]);var ie=function(){function e(){this._initialized=!1,this._strings={}}var t=e.prototype;return t.getString=function(e){return this.ensureStringsAdded(),this.get(e)},t.contains=function(e){return this.ensureStringsAdded(),e.toString()in this._strings},t.ensureStringsAdded=function(){this._initialized||(this.addStrings(),this._initialized=!0)},t.addString=function(e,t){this._strings[e.toString()]=t},t.get=function(e){return this._strings[e.toString()]},e}();function re(e,t){return(re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(ie,"AIntlHelper",null,[]);var ae=function(e){var t,n;function i(){return e.call(this)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,re(t,n),i.prototype.addStrings=function(){this.addString(0,WacWordviewerStrings.SearchBoxValue),this.addString(1,WacWordviewerStrings.FindPlaceholderTooltip),this.addString(2,WacWordviewerStrings.MatchCase),this.addString(3,WacWordviewerStrings.MatchWholeWord),this.addString(4,WacWordviewerStrings.ClearSearch),this.addString(5,WacWordviewerStrings.SearchButtonTitleEnd),this.addString(6,WacWordviewerStrings.SearchButtonTitleBegin)},i}(ie);function oe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ae,"SearchBoxIntl",ie,[]);var se=function(){function e(){}var t,n,i;return e.prototype.createSearchBox=function(e,t){return new $(e,t,I.KeyInputManager.instance,new ne,new ae)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&oe(t.prototype,n),i&&oe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();se._instance=null,Object(i.a)(se,"SearchBoxFactory",null,[251]);var le=function(){function e(t){var i=this;this._resultsScroller=null,this._resultsInfo=null,this._searchBox=null,this._searchBoxInput=null,this._progress=null,this._findResultsString=null,this._searchResultsDomFactory=null,this._searchResultsDom=null,this._nextResultButton=null,this._nextResultButtonFlag=0,this._prevResultButton=null,this._prevResultButtonFlag=0,this._closeButton=null,this._filtersDiv=null,this._isAutoFind=!1,this._nextButtonEnterHandler=null,this._prevButtonEnterHandler=null,this._closeButtonKeyEventHandler=null,this.matchWholeWord=!1,this.matchCase=!1,this.nextSearchResult=function(e,t,i,r,a){var o=n(650).SearchManager;return 1===i?y.App.isReadyForRibbon()?32:8:(y.App.get_activeAppFrame().isSearchPaneVisible&&o.instance.totalResults&&o.instance.goToNextResult(),32)},this.previousSearchResult=function(e,t,i,r,a){var o=n(650).SearchManager;return 1===i?y.App.isReadyForRibbon()?32:8:(y.App.get_activeAppFrame().isSearchPaneVisible&&o.instance.totalResults&&o.instance.goToPrevResult(),32)},this.enterNextResultButtonEvent=function(t){return 1!==i._nextResultButtonFlag&&Sys.UI.DomElement.addCssClass(i._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(i._nextResultButton,i._nextResultButtonFlag,"ReorderDown","_17x14x24")},this.focusNextResultButtonEvent=function(t){1!==i._nextResultButtonFlag&&Sys.UI.DomElement.addCssClass(i._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(i._nextResultButton,i._nextResultButtonFlag,"ReorderDown","_17x14x24")},this.exitNextResultButtonEvent=function(t){return Sys.UI.DomElement.removeCssClass(i._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(i._nextResultButton,i._nextResultButtonFlag,"ReorderDown","_17x14x24")},this.blurNextResultButtonEvent=function(t){Sys.UI.DomElement.removeCssClass(i._nextResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(i._nextResultButton,i._nextResultButtonFlag,"ReorderDown","_17x14x24")},this.mouseDownNextResultButtonEvent=function(t){return e.mouseDownEvent(i._nextResultButton,i._nextResultButtonFlag,"ReorderDown","_17x14x24")},this.mouseUpNextResultButtonEvent=function(t){return e.mouseUpEvent(i._nextResultButton,i._nextResultButtonFlag,"ReorderDown","_17x14x24")},this.clickNextResultButtonEvent=function(e){var t=n(650).SearchManager;return 1&i._nextResultButtonFlag||t.instance.goToNextResult(),!0},this.enterPrevResultButtonEvent=function(t){return 1!==i._prevResultButtonFlag&&Sys.UI.DomElement.addCssClass(i._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(i._prevResultButton,i._prevResultButtonFlag,"ReorderUp","_17x14x24")},this.focusPrevResultButtonEvent=function(t){1!==i._prevResultButtonFlag&&Sys.UI.DomElement.addCssClass(i._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.enterEvent(i._prevResultButton,i._prevResultButtonFlag,"ReorderUp","_17x14x24")},this.exitPrevResultButtonEvent=function(t){return Sys.UI.DomElement.removeCssClass(i._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(i._prevResultButton,i._prevResultButtonFlag,"ReorderUp","_17x14x24")},this.blurPrevResultButtonEvent=function(t){Sys.UI.DomElement.removeCssClass(i._prevResultButton.parentNode,"WACNavigationButtonFrameHover"),e.exitEvent(i._prevResultButton,i._prevResultButtonFlag,"ReorderUp","_17x14x24")},this.mouseDownPrevResultButtonEvent=function(t){return e.mouseDownEvent(i._prevResultButton,i._prevResultButtonFlag,"ReorderUp","_17x14x24")},this.mouseUpPrevResultButtonEvent=function(t){return e.mouseUpEvent(i._prevResultButton,i._prevResultButtonFlag,"ReorderUp","_17x14x24")},this.clickPrevResultButtonEvent=function(e){var t=n(650).SearchManager;return 1&i._prevResultButtonFlag||t.instance.goToPrevResult(),!0},this.resultClickedEvent=function(e){var t=n(650).SearchManager;a.FocusManager.tryBlur(i._searchBoxInput),a.FocusManager.tryFocus(y.App.get_activeAppFrame().workspace.appBaseDom);var r=e.sourceElement;var o=i._searchResultsDom.getSearchPaneIndex(r);if(isNaN(o)){if(!t.instance.totalResults)return!1;a.FocusManager.instance().setScope(b.a.searchFocusID)}else t.instance.setCurrentResult(o);return!0},this.onClosePaneClickEvent=function(e){return r.AFrameworkApplication.theActionManager.processAction(_.a.hideSearchPane,2),!0},this.onScroll=function(e){var t=n(650).SearchManager.instance;return t.isSearchComplete||t.isSearchActive||i.canPauseSearch()||t.resumeSearch(),!1},this.positionSearchPane=function(){var e=!0,t=null;y.App.get_activeAppFrame().isSearchPaneVisible?(i._pane.style.visibility="visible",y.App.get_activeAppFrame().isSearchPaneTouchMode?Sys.UI.DomElement.addCssClass(i._pane,A.AFrame.dynamicTouchModeCssClass):Sys.UI.DomElement.removeCssClass(i._pane,A.AFrame.dynamicTouchModeCssClass),t=i.onAfterSearchPaneShow):(e=!1,t=i.onAfterSearchPaneHide);var n=y.App.instance.theConfig.searchPaneWidth,r=y.App.get_activeAppFrame().workspace.getHeight();i._results.style.height=r>i._results.offsetTop?r-i._results.offsetTop+"px":"0px",i._pane.style.width=n+"px",q.a.animateFindPane(i._pane,e,t)},this.onAfterSearchPaneShow=function(e){i._pane.style.visibility="visible",G.a.instance.calculateOffset()},this.onAfterSearchPaneHide=function(e){i._pane.style.visibility="hidden",G.a.instance.calculateOffset()},this.queryChangedHandler=function(e,t){var r=n(650).SearchManager;e&&e.length?(i._isAutoFind=t,i.startNewSearch(e)):r.instance.stopSearch()},this.hideSearchPane=function(e,t,i,o,s){var l=n(650).SearchManager;if(1===i)return 32;var c=y.App.get_activeAppFrame();c.isSearchPaneVisible&&(G.a.instance.hideSelection(),c.hideSearchPane(),l.instance.stopSearch());var u=a.FocusManager.instance();u.currentScope&&(u.currentScope.name===b.a.searchFocusID&&u.setScope(u.defaultScopeName));r.AFrameworkApplication.activeFrame.theF6Manager.deactivateFocus(b.a.searchFocusID);var d=y.App.get_activeAppFrame().ribbonUser;return d&&d.poll(),32},this.queryToggleSearchPane=function(e,t,n,i,r){return 1===n||(r[C.a.On]=y.App.get_activeAppFrame().isSearchPaneVisible),32},this.queryClearSearch=function(e,t,n,r,a){var o=a,s=!i._searchBox||""===i._searchBox.value;return o[T.a.Image16by16Class]=s?j.getImageClass(U.splitButtonSearchIcon):j.getImageClass(U.splitButtonCancelIcon),o[T.a.LabelText]=s?WacWordviewerStrings.SearchButtonTitleBegin:WacWordviewerStrings.ClearSearch,o[T.a.On]=!1,32},this.clearSearch=function(e,t,i,r,a){var o=n(650).SearchManager;return 1===i||o.instance.stopSearch(),32},this.clearSearchFromSearchMenu=function(e,t,r,a,o){var s=n(650).SearchManager;return 1===r?!i._searchBox||""===i._searchBox.value?8:32:(s.instance.stopSearch(),i._searchBox&&i._searchBox.setFocus(),32)},this.updateFilters=function(e,t,n,r,a){if(1===n)return 32;switch(e){case V.a.findMatchCase:i.toggleMatchCaseFilter();break;case V.a.findWholeWord:i.toggleMatchWholeWordFilter()}return i.startNewSearch(i._searchBox.value),32},this.queryFindMatchCase=function(e,t,n,r,a){return a[C.a.On]=i.matchCase,32},this.queryFindWholeWord=function(e,t,n,r,a){return a[C.a.On]=i.matchWholeWord,32};var o=r.AFrameworkApplication.isRtl,s=k.a.instance,l=w.a.instance,c=I.KeyInputManager.instance,u=P.a.instance;this._actionManager=r.AFrameworkApplication.theActionManager,this._actionManager.addActionWithFlags(V.a.queryClearSearch,S.a.application,this.queryClearSearch,97),this._actionManager.addAction(V.a.clearSearch,S.a.application,this.clearSearch),this._actionManager.addAction(V.a.clearSearchFromSearchMenu,S.a.application,this.clearSearchFromSearchMenu),this._actionManager.addAction(V.a.findMatchCase,S.a.application,this.updateFilters),this._actionManager.addAction(V.a.findWholeWord,S.a.application,this.updateFilters),this._actionManager.addActionWithFlags(V.a.queryFindMatchCase,S.a.application,this.queryFindMatchCase,97),this._actionManager.addActionWithFlags(V.a.queryFindWholeWord,S.a.application,this.queryFindWholeWord,97),this._pane=R.b("div","WACSearchPane","FindPane");var d=this.createHeaderDom(o,l,c),p=this.createControlsDom(o,s,l,c);this._results=this.createResultsDom(l,u),this._pane.appendChild(d),this._pane.appendChild(p),this._pane.appendChild(this._results),t.appendChild(this._pane),e.createSearchResult();var h=a.FocusManager.instance().getScope(b.a.searchFocusID);h.bindAction(I.KeyInputManager.hashKey(F.a.vK_UpArrow,0),_.a.previousSearchResult),h.bindAction(I.KeyInputManager.hashKey(F.a.vK_DownArrow,0),_.a.nextSearchResult),h.parent=A.AFrame.appFocusId,h.addSetFocus((function(){i._searchBoxInput?i._searchBoxInput.focus():v.ULS.shipAssertTag(4318920,321,!1)})),w.a.instance.addFocusEvent(b.a.searchFocusID,this._searchBoxInput),r.AFrameworkApplication.activeFrame.theF6Manager.addF6KeyBindings(b.a.searchFocusID),y.App.get_activeAppFrame().add_onResize(this.positionSearchPane),this._actionManager.addAction(_.a.hideSearchPane,S.a.application,this.hideSearchPane),this._actionManager.addAction(_.a.nextSearchResult,S.a.application,this.nextSearchResult),this._actionManager.addAction(_.a.previousSearchResult,S.a.application,this.previousSearchResult),this._actionManager.addActionWithFlags(_.a.queryToggleSearchPane,S.a.application,this.queryToggleSearchPane,96),this.positionSearchPane()}var t=e.prototype;return t.dispose=function(){this.clearAllResults();var e=k.a.instance,t=w.a.instance,n=I.KeyInputManager.instance,i=P.a.instance;t.unregisterHandler(E.a.click,this._closeButton,this.onClosePaneClickEvent),n.unregisterHandlerForAllKeyEvents(this._closeButton,this._closeButtonKeyEventHandler),t.unregisterHandler(E.a.click,this._results,this.resultClickedEvent),O.a.isIPad||(e.unregisterHandler(E.a.mouseOver,this._nextResultButton,this.enterNextResultButtonEvent),e.unregisterHandler(E.a.mouseOut,this._nextResultButton,this.exitNextResultButtonEvent),e.unregisterHandler(E.a.mouseDown,this._nextResultButton,this.mouseDownNextResultButtonEvent),e.unregisterHandler(E.a.mouseUp,this._nextResultButton,this.mouseUpNextResultButtonEvent)),t.unregisterHandler(E.a.click,this._nextResultButton,this.clickNextResultButtonEvent),O.a.isIPad||(e.unregisterHandler(E.a.mouseOver,this._prevResultButton,this.enterPrevResultButtonEvent),e.unregisterHandler(E.a.mouseOut,this._prevResultButton,this.exitPrevResultButtonEvent),e.unregisterHandler(E.a.mouseDown,this._prevResultButton,this.mouseDownPrevResultButtonEvent),e.unregisterHandler(E.a.mouseUp,this._prevResultButton,this.mouseUpPrevResultButtonEvent)),t.unregisterHandler(E.a.click,this._prevResultButton,this.clickPrevResultButtonEvent),i.unregisterHandler(E.a.scroll,this._results,this.onScroll),M.a.removeHandler(this._prevResultButton.firstChild,"focus",this.focusPrevResultButtonEvent),M.a.removeHandler(this._prevResultButton.firstChild,"blur",this.blurPrevResultButtonEvent),M.a.removeHandler(this._nextResultButton.firstChild,"focus",this.focusNextResultButtonEvent),M.a.removeHandler(this._nextResultButton.firstChild,"blur",this.blurNextResultButtonEvent),M.a.removeHandler(this._prevResultButton.parentNode,E.a.keyUp,this._prevButtonEnterHandler),M.a.removeHandler(this._nextResultButton.parentNode,E.a.keyUp,this._nextButtonEnterHandler),this._progress&&(this._progress.dispose(),this._progress=null),this._resultsScroller=null,this._resultsInfo=null,this._searchBox&&(this._searchBox.dispose(),this._searchBox=null),this._results=null,this._pane=null,this._nextResultButton=null,this._prevResultButton=null,this._closeButton=null},t.createHeaderDom=function(e,t,n){var i=R.b("div","","FindPaneHeader"),r=R.b("span","WACSearchHeaderText","PaneTitle FindPaneTitle UIFontLight");return r.innerText=WacWordviewerStrings.HeaderText,this._closeButton=D.a.createButton("FindPaneCloseButton","FindPaneCloseButton",WacWordviewerStrings.Close,"ClosePaneGlyph_16x16x32",!1),e?Sys.UI.DomElement.addCssClass(this._closeButton,"FloatLeft"):Sys.UI.DomElement.addCssClass(this._closeButton,"FloatRight"),t.registerHandler(E.a.click,this._closeButton,this.onClosePaneClickEvent),this._closeButtonKeyEventHandler=n.registerHandlerForAllKeyEvents(this._closeButton,this.onClosePaneClickEvent,F.a.vK_Enter),i.appendChild(r),i.appendChild(this._closeButton),i},t.createControlsDom=function(e,t,n,i){var r=R.b("div","WACSearchControls","WACSearchControls"),a=this.createSearchBoxDom(e,t,n,i),o=this.createProgressAndNavigationDom(e,t,n);return r.appendChild(a),r.appendChild(o),r},t.createResultsDom=function(e,t){var n=R.b("div","WACSearchResultsPane","WACSearchResultsPane");return this._resultsScroller=R.b("div","WACSearchResultsScroller","WACSearchResultsScroller"),this._resultsScroller.innerText=WacWordviewerStrings.SearchText,t.registerHandler(E.a.scroll,n,this.onScroll),e.registerHandler(E.a.click,n,this.resultClickedEvent),this._searchResultsDomFactory=new W,this._searchResultsDom=this._searchResultsDomFactory.createSearchResultsDom(this._resultsScroller),n.appendChild(this._resultsScroller),n},t.createSearchBoxDom=function(e,t,n,i){var r=R.b("div","","");this._searchBox=se.instance.createSearchBox(r,this.queryChangedHandler),this._searchBox.setMaxInputLength(255),this._searchBoxInput=this._searchBox.element,this._filtersDiv=R.b("div","","FiltersLabel"),e?Sys.UI.DomElement.addCssClass(this._filtersDiv,"FloatLeft"):Sys.UI.DomElement.addCssClass(this._filtersDiv,"FloatRight"),r.appendChild(this._filtersDiv);var a=document.createElement("div");return Sys.UI.DomElement.addCssClass(a,"ClearFloat"),r.appendChild(a),r},t.createProgressAndNavigationDom=function(t,i,r){var a=t?"FloatLeft":"FloatRight",o=R.b("div","WACInfoAndNavigation","WACInfoAndNavigation"),s=R.b("span","WACSearchProgressSpan"," "),l=R.b("div","WACResultNavigationDiv","FindPaneNavigationControls "+a);return this._resultsInfo=R.b("div","WACResultsInfo","WACResultsInfo"),this._resultsInfo.innerText="",Sys.UI.DomElement.addCssClass(s,"WACSearchProgressSpan"),this._progress=new L.a(""),this._progress.isSmall=!0,this._progress.text=WacWordviewerStrings.ProgressTextSearching,this._progress.element.style.display="none",s.appendChild(this._progress.element),this._findResultsString=R.b("span","WACSearchMatchesText","WACSearchMatchesText"),this._findResultsString.style.display="none",s.appendChild(this._findResultsString),this._prevResultButton=j.createClusteredImage(17,14,"","WACResultNavigation ",!0,WacWordviewerStrings.PrevButtonTitle),this._prevResultButton.id="WACPrevResultButtonSpan",this._prevResultButton.setAttribute("aria-label",WacWordviewerStrings.PrevButtonTitle),this._prevResultButtonFlag=1,e.setButton(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24"),this._nextResultButton=j.createClusteredImage(17,14,"","WACResultNavigation ",!0,WacWordviewerStrings.NextButtonTitle),this._nextResultButton.id="WACNextResultButtonSpan",this._nextResultButton.setAttribute("aria-label",WacWordviewerStrings.NextButtonTitle),this._nextResultButtonFlag=1,e.setButton(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24"),O.a.isIPad||(i.registerHandler(E.a.mouseOver,this._nextResultButton,this.enterNextResultButtonEvent),i.registerHandler(E.a.mouseOut,this._nextResultButton,this.exitNextResultButtonEvent),i.registerHandler(E.a.mouseDown,this._nextResultButton,this.mouseDownNextResultButtonEvent),i.registerHandler(E.a.mouseUp,this._nextResultButton,this.mouseUpNextResultButtonEvent)),r.registerHandler(E.a.click,this._nextResultButton,this.clickNextResultButtonEvent),O.a.isIPad||(i.registerHandler(E.a.mouseOver,this._prevResultButton,this.enterPrevResultButtonEvent),i.registerHandler(E.a.mouseOut,this._prevResultButton,this.exitPrevResultButtonEvent),i.registerHandler(E.a.mouseDown,this._prevResultButton,this.mouseDownPrevResultButtonEvent),i.registerHandler(E.a.mouseUp,this._prevResultButton,this.mouseUpPrevResultButtonEvent)),r.registerHandler(E.a.click,this._prevResultButton,this.clickPrevResultButtonEvent),this.createNavigationButtonFrame(l,this._prevResultButton),this.createNavigationButtonFrame(l,this._nextResultButton),this.showHideNavigationButtons(!1),this._nextButtonEnterHandler=e.getNavigationButtonKeyUpHandler((function(){n(650).SearchManager.instance.goToNextResult()})),this._prevButtonEnterHandler=e.getNavigationButtonKeyUpHandler((function(){n(650).SearchManager.instance.goToPrevResult()})),M.a.addHandler(this._prevResultButton.parentNode,E.a.keyUp,this._prevButtonEnterHandler),M.a.addHandler(this._nextResultButton.parentNode,E.a.keyUp,this._nextButtonEnterHandler),Sys.UI.DomElement.addCssClass(this._prevResultButton,"WACNavigationButton"),Sys.UI.DomElement.addCssClass(this._nextResultButton,"WACNavigationButton"),t?(Sys.UI.DomElement.addCssClass(this._prevResultButton.parentNode,"FloatRight"),Sys.UI.DomElement.addCssClass(this._nextResultButton.parentNode,"FloatLeft")):(Sys.UI.DomElement.addCssClass(this._prevResultButton.parentNode,"FloatLeft"),Sys.UI.DomElement.addCssClass(this._nextResultButton.parentNode,"FloatRight")),M.a.addHandler(this._prevResultButton.firstChild,"focus",this.focusPrevResultButtonEvent),M.a.addHandler(this._prevResultButton.firstChild,"blur",this.blurPrevResultButtonEvent),M.a.addHandler(this._nextResultButton.firstChild,"focus",this.focusNextResultButtonEvent),M.a.addHandler(this._nextResultButton.firstChild,"blur",this.blurNextResultButtonEvent),o.appendChild(l),o.appendChild(s),o.appendChild(this._resultsInfo),o},t.createNavigationButtonFrame=function(e,t){var n=R.b("div",null,"WACNavigationButtonFrame");n.tabIndex=0,e.appendChild(n),n.appendChild(t)},t.foundResult=function(t,n){if(this._searchResultsDom.addResult(t.context,n,String.format(WacWordviewerStrings.ResultToolTip,t.page)),n||this.showHideNavigationButtons(!0),1===n){if(!this._isAutoFind){var i=a.FocusManager.instance();i.currentScope&&i.currentScope.name===b.a.searchFocusID&&a.FocusManager.tryFocus(this._nextResultButton.parentNode),this._searchBoxInput&&a.FocusManager.tryBlur(this._searchBoxInput)}this._nextResultButtonFlag&=-2,e.setButton(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24"),this._prevResultButtonFlag&=-2,e.setButton(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24")}},t.showHideNavigationButtons=function(e){var t=e?"inline-block":"none";this._prevResultButton&&this._prevResultButton.parentNode&&(this._prevResultButton.parentNode.style.display=t),this._nextResultButton&&this._nextResultButton.parentNode&&(this._nextResultButton.parentNode.style.display=t)},t.goToResult=function(e,t){return this._searchResultsDom.goToResult(this._results,e,t)},t.startSearch=function(){this._progress.element.style.display="inline-block",this._findResultsString.style.display="none",this._resultsScroller.innerText="",this._resultsInfo.innerText=String.format(WacWordviewerStrings.ResultsInfoText,y.App.instance.theDocument.pageCount),this.clearAllResults(),this._resultsScroller.parentNode.className="WACSearchResultsPane",this.updateSearchBoxState()},t.updateSearchBoxState=function(){this._searchBox&&(this._searchBox.updateControl(B.searchBoxSplitButtonId),this._searchBox.updateControl(B.cancelSearchMenuId))},t.reset=function(){this._progress.element.style.display="none",this._findResultsString.style.display="none",this._resultsInfo.innerText="",this.clearAllResults(),this._resultsScroller.innerText=WacWordviewerStrings.SearchText,this._searchBox.reset(),this.updateSearchBoxState(),this._resultsScroller.parentNode.className="WACSearchResultsPaneEmpty"},t.resumeSearch=function(){this._progress.element.style.display="inline-block",this._findResultsString.style.display="none"},t.doneSearch=function(e){this._progress.element.style.display="none",this._findResultsString.style.display="inline-block",this._findResultsString.innerText=e?1===e?WacWordviewerStrings.ProgressTextOneResult:String.format(WacWordviewerStrings.ProgressTextManyResults,e):WacWordviewerStrings.ProgressTextNoResults},t.doneSearchingPage=function(e){this._resultsInfo.innerText=String.format(WacWordviewerStrings.NumberOfSearchedPages,e,y.App.instance.theDocument.pageCount)},t.canPauseSearch=function(){var e=this._searchResultsDom.getLastResultBoxOffsetTop();return!isNaN(e)&&this._results.scrollTop+this._results.offsetHeight<e},t.clearAllResults=function(){this._searchResultsDom.clearAllResults(),this._prevResultButtonFlag|=1,e.setButton(this._prevResultButton,this._prevResultButtonFlag,"ReorderUp","_17x14x24"),this._nextResultButtonFlag|=1,e.setButton(this._nextResultButton,this._nextResultButtonFlag,"ReorderDown","_17x14x24"),this.showHideNavigationButtons(!1)},t.startNewSearch=function(e){var t=n(650).SearchManager;if(e&&e.length){var i=this.createQuery(e);i&&t.instance.startSearch(i)}},t.createQuery=function(e){var t=0;return this.matchCase&&(t|=1),this.matchWholeWord&&(t|=2),x.a.createQuery(e,t)},t.showSearchPane=function(e,t,i,o,s){var l=n(650).SearchManager;if(1===i)return y.App.isReadyForRibbon()?32:8;if(!y.App.get_activeAppFrame().isSearchPaneVisible){G.a.instance.hideSelection();var c=0;if(s)c=s.inputMethod;l.instance.clearQuery(),y.App.get_activeAppFrame().showSearchPane(c)}this._resultsScroller.children.length||(this._resultsScroller.parentNode.className="WACSearchResultsPaneEmpty"),r.AFrameworkApplication.activeFrame.theF6Manager.activateFocus(b.a.searchFocusID),a.FocusManager.instance().setScope(b.a.searchFocusID);var u=y.App.get_activeAppFrame().ribbonUser;return u&&u.poll(),32},t.toggleSearchPane=function(e,t,n,i,r){return y.App.get_activeAppFrame().isSearchPaneVisible?this.hideSearchPane(e,t,n,i,r):this.showSearchPane(e,t,n,i,r)},t.toggleMatchWholeWordFilter=function(){this.matchWholeWord=!this.matchWholeWord,this._searchBox&&this._searchBox.updateControl(B.buttonFindMatchWholeWordId),this.updateFiltersLabel(),this._searchBox&&this._searchBox.setFocus()},t.toggleMatchCaseFilter=function(){this.matchCase=!this.matchCase,this._searchBox&&this._searchBox.updateControl(B.buttonFindMatchCaseId),this.updateFiltersLabel(),this._searchBox&&this._searchBox.setFocus()},t.updateFiltersLabel=function(){var e=this.matchCase||this.matchWholeWord;this._filtersDiv.style.display=e?"block":"none",e&&(this._filtersDiv.innerText=this.getFiltersLabel())},t.getFiltersLabel=function(){var e="";return this.matchCase&&this.matchWholeWord?e=String.format(WacWordviewerStrings.FindMultipleFiltersLabelText,WacWordviewerStrings.MatchCase,WacWordviewerStrings.MatchWholeWord):this.matchCase?e=String.format(WacWordviewerStrings.FindFilterLabelText,WacWordviewerStrings.MatchCase):this.matchWholeWord&&(e=String.format(WacWordviewerStrings.FindFilterLabelText,WacWordviewerStrings.MatchWholeWord)),e},e.getNavigationButtonKeyUpHandler=function(e){return function(t){var n=t.keyCode;n!==F.a.vK_Enter&&n!==F.a.vK_Space||e()}},e.createSearchResult=function(){var e=R.b("div",null,"WACResultOutline"),t=R.b("div",null,"WACSearchResult"),n=R.b("span",null,null),i=R.b("span",null,"WACContext"),r=R.b("span",null,null);return t.appendChild(n),t.appendChild(i),t.appendChild(r),e.appendChild(t),e},e.enterEvent=function(t,n,i,r){return n|=4,e.setButton(t,n,i,r),!0},e.exitEvent=function(t,n,i,r){return n&=-13,e.setButton(t,n,i,r),!0},e.mouseDownEvent=function(t,n,i,r){return n|=8,e.setButton(t,n,i,r),!0},e.mouseUpEvent=function(t,n,i,r){return n&=-9,n|=4,e.setButton(t,n,i,r),!0},e.setButton=function(e,t,n,i){var r=e.firstChild;if(4&t&&"Search"!==n&&!(1&t)&&(n+="Hover"),2&t&&(n="cancel"+n),1&t)return r.className=j.getImageClass(n+"Disabled"+i),void(r.style.cursor="default");r.className=j.getImageClass(n+i)},e}();Object(i.a)(le,"SearchPane",null,[10]);var ce=n(56),ue=n(111),de=n(31),pe=n(659);function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ge=function(){function e(e,t,n,i,r){this._zoomControl=null,this._scrollControl=null,this._context=e,this._page=t,this._hitOnPage=n,this._textrunIdOfContainingParagraph=r,this._location=i}var t,n,i,a=e.prototype;return a.dispose=function(){this._location=null},a.getScrollTop=function(){var e=this.zoomControl.currentZoom,t=ue.a.instance.getPageTopAtZoom(this._page,e),n=this.scrollControl.getScrollTop(),i=t+this._location.top*e;if(i<n)return Math.round(i-e*(this._location.height*y.App.instance.theConfig.searchResultVerticalMultiplier));var r=this.scrollControl.getClientHeight(),a=n+r,o=i+this._location.height*e;return o>a?Math.round(o+this._location.height*y.App.instance.theConfig.searchResultVerticalMultiplier*e-r):Number.NaN},a.getScrollLeft=function(){var e=this.zoomControl.currentZoom,t=this.scrollControl.getScrollLeft(),n=this.scrollControl.getWidth(),i=t+n;if(r.AFrameworkApplication.isRtl){var a=ue.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(this._page,e),o=a-this._location.left*e,s=a-(this._location.left+this._location.width)*e;if(s>(t=Math.abs(t)))return Math.round(o-y.App.instance.theConfig.searchResultHorizontalBuffer);if(o<t)return Math.round(s-y.App.instance.theConfig.searchResultHorizontalBuffer)}else{var l=ue.a.instance.getPageLeftAtZoom(this._page,e,!1)+this._location.left*e,c=l+this._location.width*e;if(l<t)return Math.round(l-y.App.instance.theConfig.searchResultHorizontalBuffer);if(c>i)return Math.round(c-n+y.App.instance.theConfig.searchResultHorizontalBuffer)}return Number.NaN},t=e,(n=[{key:"context",get:function(){return this._context}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=o.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=o.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"id",get:function(){return String.format("{0}-{1}",this._page,this._hitOnPage)}},{key:"page",get:function(){return this._page}},{key:"paragraphTextrunId",get:function(){return this._textrunIdOfContainingParagraph}}])&&he(t.prototype,n),i&&he(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(ge,"SearchResult",null,[10]);var me=n(660);function fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ve=function(){function e(e){var t=this;this._isPaused=!0,this._nextSearchTask=null,this._pageBeingSearched=0,this._countHitsOnPage=0,this._isComplete=!0,this._paragraphXmls=null,this._paragraphBeingSearched=0,this._searchResults=[],this._countRunCharacters=0,this._countRunParagraphs=0,this.waitOnNextPage=function(e){var n=y.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(t._pageBeingSearched);if(n){if(t._paragraphXmls=n.selectNodes("descendant::P"),t._paragraphBeingSearched=0,!t._paragraphXmls.length)return void t.getNextPage();t._nextSearchTask=new ce.a(3,1,y.App.instance.theConfig.searchTaskDelay,t.parseParagraphXmlTask)}else 0;r.AFrameworkApplication.theTaskManager.addTask(t._nextSearchTask)},this.parseParagraphXmlTask=function(e){t._countRunCharacters=0,t._countRunParagraphs=0;for(var i=y.App.instance.theConfig;t._paragraphBeingSearched<t._paragraphXmls.length&&t._countRunCharacters<i.minCharactersToSearchBeforePausing&&t._countRunParagraphs<i.maxParagraphsToSearchBeforePausing;)t.parseParagraphXml();if(t._paragraphBeingSearched<t._paragraphXmls.length)r.AFrameworkApplication.theTaskManager.addTask(t._nextSearchTask);else{var a=y.App.get_activeAppFrame().workspace,o=n(650).SearchManager.instance;o.doneSearchingPage(t._pageBeingSearched),t._countHitsOnPage=0;var s=ue.a.instance.pageCount;t._pageBeingSearched===s?(t._nextSearchTask=null,t._isComplete=!0,o.doneSearch(t._searchResults.length)):!(t._pageBeingSearched%y.App.instance.theConfig.searchPageIncrement)&&t._pageBeingSearched>=a.getLastCachedPage()&&o.canPauseSearch()?(t._isPaused=!0,t._nextSearchTask=null,r.AFrameworkApplication.theWsaClient.incrementDw(89405,1)):t.getNextPage()}},this._searchContextFactory=e}var t,i,a,o=e.prototype;return o.startSearch=function(){this.reset(),this._isComplete=!1,this._isPaused=!1,this._countHitsOnPage=0,this.getNextPage()},o.reset=function(){this.stopSearchTask(),this.clearSearchResults(),this._isPaused=!0,this._pageBeingSearched=0,this._isComplete=!0,this._paragraphXmls=null},o.resumeSearch=function(){n(650).SearchManager;this._pageBeingSearched&&(this._isPaused=!1,r.AFrameworkApplication.theWsaClient.incrementDw(89406,1),this.getNextPage())},o.getNextPage=function(){this._pageBeingSearched++,y.App.get_activeAppFrame().thePageInfoCache.updateSearchCache(this._pageBeingSearched),this._nextSearchTask=new ce.a(3,1,y.App.instance.theConfig.searchTaskDelay,this.waitOnNextPage),r.AFrameworkApplication.theTaskManager.addTask(this._nextSearchTask)},o.parseParagraphXml=function(){var e=this._paragraphXmls[this._paragraphBeingSearched];if(!e.selectSingleNode("ancestor::P")){var t=e.selectNodes("descendant::T/text()"),n=me.a(t);t.length&&this.grepTheText(n,t),this._countRunParagraphs++,this._countRunCharacters+=n.length}this._paragraphBeingSearched++},o.grepTheText=function(e,t){for(var i,r,a,o=n(650).SearchManager.instance,s=o.regex,l=parseInt(t[0].selectSingleNode("ancestor::Page").attributes.getNamedItem("id").nodeValue),c=0,u=0;a=s.exec(e);){i=a.index,r=s.lastIndex;for(var d=0,p=this._searchContextFactory.createSearchContext(e,a[0],i,r,""),h=null;c<t.length;++c){if(d=u+t[c].data.length,u<r&&d>i){0,h=pe.a.instance.estimatedBoundingBox(t[c].parentNode,i-u,Math.min(d-u,r-u));break}u=d}var g=parseInt(de.a.parseXmlAttribute(t[0].parentNode,"id")),m=new ge(p,l,this._countHitsOnPage,h,g);this._searchResults[this._searchResults.length]=m,this._countHitsOnPage++,o.foundResult(m,this._searchResults.length-1),1===this._searchResults.length&&o.foundFirstSearchResult()}},o.stopSearchTask=function(){this._nextSearchTask&&(r.AFrameworkApplication.theTaskManager.deleteTask(this._nextSearchTask),this._nextSearchTask=null),y.App.get_activeAppFrame().thePageInfoCache&&y.App.get_activeAppFrame().thePageInfoCache.removeSearchCache()},o.clearSearchResults=function(){for(var e=0;e<this._searchResults.length;++e)this._searchResults[e].dispose(),this._searchResults[e]=null;Array.clear(this._searchResults),this._searchResults=[]},o.pageCacheChanged=function(e){var t=n(650).SearchManager;e>=this._pageBeingSearched&&t.instance.resumeSearch()},o.getResult=function(e){return this._searchResults[e]},o.dispose=function(){this.reset(),this._searchResults=null,this._searchContextFactory=null},e.createInstanceWithResolvedDependencies=function(t){return new e(t)},e.createInstance=function(t){return e.createInstanceWithResolvedDependencies(t)},t=e,(i=[{key:"pageBeingSearched",get:function(){return this._pageBeingSearched}},{key:"complete",get:function(){return this._isComplete}},{key:"paused",get:function(){return this._isPaused}},{key:"totalResults",get:function(){return this._searchResults.length}}])&&fe(t.prototype,i),a&&fe(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(ve,"SearchWorker",null,[10]),n.d(t,"SearchManager",(function(){return ye}));var ye=function(){function e(t,i,a){var o=this;this._originalQuery=null,this._regex=null,this.pageCacheChanged=function(e,t,n,i,r){var a=r;if(2===a.length&&a[0]&&a[1]){var s=a[0],l=a[1];o._highlightWorker.pageCacheChanged(s,l),o._searchWorker.pageCacheChanged(l)}return 32};var s=n(667).HighlightWorker,l=n(665).CurrentResult;this._searchWorker=ve.createInstance(e.getSearchContextFactory()),this._highlightWorker=s.createInstance(i),this._currentResult=new l,this._searchPane=new le(t),v.ULS.sendTraceTag(4575576,313,50,"{0}",{SearchPaneCreation:!!this._searchPane}),this._queryProcessor=m.instance,this._findUtils=a,this._currentQueryString="",r.AFrameworkApplication.theActionManager.addActionWithFlags(_.a.pageCacheChanged,S.a.application,this.pageCacheChanged,96)}var t,i,s,c=e.prototype;return c.dispose=function(){v.ULS.sendTraceTag(4575577,313,50,"SearchManagerDispose"),this._currentResult&&(this._currentResult.dispose(),this._currentResult=null),this._highlightWorker&&(this._highlightWorker.dispose(),this._highlightWorker=null),this._searchPane&&(this._searchPane.dispose(),this._searchPane=null),this._searchWorker&&(this._searchWorker.dispose(),this._searchWorker=null)},c.foundFirstSearchResult=function(){this._currentResult.reset(),this._highlightWorker.setupHighlighting(),this.setCurrentResult(0)},c.startSearch=function(e){r.AFrameworkApplication.theWsaClient.incrementDw(8813,1);var t=this._queryProcessor.preprocessQuery(e.text);if(t){var n=this.currentQueryString,i=this._originalQuery;if(i&&i.matchCase===e.matchCase&&i.matchWholeWord===e.matchWholeWord&&t.length===n.length)if((i.matchCase?new RegExp(t):new RegExp(t,"i")).exec(n))return;this._currentQueryString=t,this._originalQuery=e,this._regex=this._findUtils.getRegex(this.currentQueryString,this._originalQuery),this._searchPane.startSearch(),this._searchWorker.startSearch(),this._highlightWorker.reset()}},c.stopSearch=function(){this._currentResult.reset(),this._searchWorker.reset(),this._highlightWorker.reset(),this._searchPane.reset(),this.clearQuery()},c.doneSearch=function(e){r.AFrameworkApplication.theWsaClient.addToAverage(89404,e),r.AFrameworkApplication.theWsaClient.setIfMax(89528,e),r.AFrameworkApplication.theWsaClient.setIfMin(89529,e),this._searchPane.doneSearch(e)},c.resumeSearch=function(){this._searchWorker.paused&&!this._searchWorker.complete&&(this._searchWorker.resumeSearch(),this._searchPane.resumeSearch())},c.goToNextResult=function(){var e=this._currentResult.resultNumber,t=this.totalResults;this.setCurrentResult(e<t-1?e+1:0)},c.goToPrevResult=function(){var e=this._currentResult.resultNumber;this.setCurrentResult(e>0?e-1:this.totalResults-1)},c.clearQuery=function(){this._originalQuery=null,this._currentQueryString="",this._regex=null},c.setCurrentResult=function(e){var t=this.totalResults;if(!(e<0||e>=t)){var n=this._searchWorker.getResult(e),i=this._searchPane.goToResult(e,t);this._currentResult.setCurrentResult(n,i,e),a.FocusManager.instance().setScope(b.a.searchFocusID)}},c.doneSearchingPage=function(e){this._searchPane.doneSearchingPage(e)},c.canPauseSearch=function(){return this._searchPane.canPauseSearch()},c.foundResult=function(e,t){this._searchPane.foundResult(e,t)},c.foundCurrentResult=function(e){this._currentResult.foundCurrentResult(e)},c.lookForCurrentResult=function(e,t,n){this._highlightWorker.lookForCurrentResult(e,t,n)},c.clearCurrentResultHighlight=function(){this._currentResult.clearCurrentResultHighlight()},c.getHighlightsByPage=function(e){return this._highlightWorker.getHighlightsByPage(e)},c.showSearchPane=function(e,t,n,i,r){return f.c(this._searchPane)?(v.ULS.sendTraceTag(4575578,313,10,"InconsistentShowSearchState"),16):this._searchPane.showSearchPane(e,t,n,i,r)},c.toggleSearchPane=function(e,t,n,i,r){return f.c(this._searchPane)?(v.ULS.sendTraceTag(4575579,313,10,"InconsistentToggleSearchState"),16):this._searchPane.toggleSearchPane(e,t,n,i,r)},e.getSearchContextFactory=function(){return new d},t=e,s=[{key:"instance",get:function(){return e._instance||e._initializing||y.App.instance.isSmallView||r.AFrameworkApplication.isNoChrome||!y.App.get_activeAppFrame().workspace.initialized||(e._initializing=!0,e._instance=new e(y.App.get_activeAppFrame().workspace.appBaseDom,o.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller,l.instance),e._initializing=!1),e._instance}}],(i=[{key:"pageBeingSearched",get:function(){return this._searchWorker.pageBeingSearched}},{key:"isSearchActive",get:function(){return!this._searchWorker.paused}},{key:"isSearchComplete",get:function(){return this._searchWorker.complete}},{key:"totalResults",get:function(){return this._searchWorker.totalResults}},{key:"currentSelectedResult",get:function(){return this._currentResult}},{key:"currentQueryString",get:function(){return this._currentQueryString}},{key:"regex",get:function(){return this._regex}}])&&_e(t.prototype,i),s&&_e(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();ye._instance=null,ye._initializing=!1,Object(i.a)(ye,"SearchManager",null,[])},651:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var i=function(e,t,n){var i=document.createElement(e);return t&&(i.id=t),n&&(i.className=n),i},r=function(e,t,n){var r=i(e,t,n);return r.setAttribute("Unselectable","on"),r}},652:function(e,t,n){"use strict";var i=n(0),r=n(20),a=n(12),o=n(46),s=n(1),l=n(111),c=n(155);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(e,t,n,i,r,a){this._box=e,this._style=t,this._id=n,this._page=i,this._domElem=document.createElement("div"),this._domElem.id=n,this._zoom=1,this._isRtl=r,this._documentDataUtils=a,this.addStyle(t)}var t,n,i,r=e.prototype;return r.addStyle=function(e){switch(this._style=e,e){case 1:Sys.UI.DomElement.addCssClass(this._domElem,"CommonHighlight WACHighlight");break;case 2:Sys.UI.DomElement.addCssClass(this._domElem,"WACActiveHighlight");break;case 3:Sys.UI.DomElement.addCssClass(this._domElem,"CommonHighlight WACCommentHighlight");break;case 0:default:Sys.UI.DomElement.addCssClass(this._domElem,"WACSelection")}},r.removeStyle=function(e){switch(e===this._style&&2===e?this._style=1:this._style=-1,e){case 1:Sys.UI.DomElement.removeCssClass(this._domElem,"CommonHighlight WACHighlight");break;case 2:Sys.UI.DomElement.removeCssClass(this._domElem,"WACActiveHighlight");break;case 3:Sys.UI.DomElement.removeCssClass(this._domElem,"CommonHighlight WACCommentHighlight");break;case 0:default:Sys.UI.DomElement.removeCssClass(this._domElem,"WACSelection")}},r.setPosition=function(e,t,n){this._page=t,this._zoom=n,this._box=this.box,this.reposition()},r.cloneHighlight=function(){return o.WacAirSpace.cloneElement(this.domElem,!1,!0)},r.hideHighlight=function(){c.a.animateHideHighlight(this.domElem)},r.showHighlight=function(){this.reposition(),c.a.animateShowHighlight(this.domElem)},r.reposition=function(){this._isRtl?this._domElem.style.right=this._documentDataUtils.getDistanceOfPageLeftFromScrollerRightEdge(this._page,this._zoom)-(Math.round(this._box.left*this._zoom)+Math.round(this._box.width*this._zoom))+"px":this._domElem.style.left=this._documentDataUtils.getPageLeftAtZoom(this._page,this._zoom,!1)+Math.round(this._box.left*this._zoom)+"px",this._domElem.style.top=this._documentDataUtils.getPageTopAtZoom(this._page,this._zoom)+Math.round(this._box.top*this._zoom)+"px",this._domElem.style.width=Math.round(this._box.width*this._zoom)+"px",this._domElem.style.height=Math.round(this._box.height*this._zoom)+"px"},e.createAnInstance=function(t,n,i,r){return new e(t,n,i,r,s.AFrameworkApplication.isRtl,l.a.instance)},t=e,(n=[{key:"left",get:function(){return this._box.left},set:function(e){this._box.left=e}},{key:"top",get:function(){return this._box.top},set:function(e){this._box.top=e}},{key:"width",get:function(){return this._box.width},set:function(e){this._box.width=e}},{key:"height",get:function(){return this._box.height},set:function(e){this._box.height=e}},{key:"box",get:function(){return this._box},set:function(e){this._box=e}},{key:"style",get:function(){return this._style},set:function(e){this._style=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"page",get:function(){return this._page},set:function(e){this._page=e}},{key:"domElem",get:function(){return this._domElem},set:function(e){this._domElem=e}}])&&u(t.prototype,n),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(d,"HighlightRectanglePng",null,[94]);var p=n(659);function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=function(){function e(e,t){this._parent=e,this._highlightUtils=t}var t,n,i,r=e.prototype;return r.removeFromParent=function(e){e&&this._parent.removeChild(e.domElem)},r.drawRectangle=function(e,t,n,i){var r=d.createAnInstance(e,t,n,i);return this._parent.appendChild(r.domElem),r},r.isPageLoaded=function(e){return!0},r.computeBoundingBoxForTextRun=function(e,t,n){var i,r,o=a.App.instance.theConfig.dpiAspectRatio,s=parseFloat(e.attributes.getNamedItem("l").nodeValue),l=parseFloat(e.attributes.getNamedItem("t").nodeValue),c=parseFloat(e.attributes.getNamedItem("w").nodeValue),u=parseFloat(e.attributes.getNamedItem("h").nodeValue),d=e.attributes.getNamedItem("a")?parseInt(e.attributes.getNamedItem("a").nodeValue):0,p=!!e.attributes.getNamedItem("rtl"),h=!!e.attributes.getNamedItem("gr"),g="";if(!e.attributes.getNamedItem("cw"))return this._highlightUtils.estimatedBoundingBox(e,t,n);g=e.attributes.getNamedItem("cw").nodeValue;var m=0,f=0;e.childNodes[0].data.length;var v=Number.NaN,_=Number.NaN;p||d?270===d&&!p||90===d&&p?(v=(s+c)/o,_=(l+u)/o):90===d&&!p||270===d&&p?(v=s/o,_=l/o):isNaN(v)&&(v=(s+c)/o,_=(l+u)/o):(v=s/o,_=l/o);var y=g.split(";"),S=[];S.push.apply(S,y),Array.removeAt(S,S.length-1);var b=t-0,A=c/o,C=0,T=0,k=(i=this._highlightUtils.calculateWidth(h,b,A,S,C,T,!1),C=i.positionInIndicies,T=i.positionInCharRun,i).returnValue;h?m=_+k:d?270===d&&!p||90===d&&p?m=_-k:(90===d&&!p||270===d&&p)&&(m=_+k):m=p?v-k:v+k;var w=n-0,I=(r=this._highlightUtils.calculateWidth(h,w,A,S,C,T,!0),C=r.positionInIndicies,T=r.positionInCharRun,r).returnValue;return h?f=m+I:d?270===d&&!p||90===d&&p?f=m-I:(90===d&&!p||270===d&&p)&&(f=m+I):f=p?m-I:m+I,this._highlightUtils.drawHitBox(d,p,h,s,l,c,u,m,f,e,t,n)},e.createAnInstance=function(t){return new e(t,p.a.instance)},t=e,(n=[{key:"parent",get:function(){return this._parent},set:function(e){this._parent=e}},{key:"needsManualRepositioning",get:function(){return!0}}])&&h(t.prototype,n),i&&h(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(g,"HighlightManagerPng",null,[81]),n.d(t,"a",(function(){return f}));var f=function(){function e(){}var t,n,i;return e.getHighlightManagerWithResolvedDependencies=function(){return e.createHighlightManager(0,r.a.instance.resolve("WordViewer.Controls.IScrollControl").scroller)},e.createHighlightManager=function(e,t){switch(e){case 0:return g.createAnInstance(t);default:0}return null},t=e,i=[{key:"instance",get:function(){return e._instance||e._initializing||(e._initializing=!0,e._instance=e.getHighlightManagerWithResolvedDependencies(),e._initializing=!1),e._instance}}],(n=null)&&m(t.prototype,n),i&&m(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();f._initializing=!1,f._instance=null,Object(i.a)(f,"HighlightManager",null,[])},653:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0),r=function(){function e(){}return e.prototype.getSelectionXmlNodeWrapper=function(e){var t=n(666).XmlNodeWrapper;return e?new t(e):null},e}();Object(i.a)(r,"XmlNodeWrapperFactory",null,[184])},654:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(655),a=n(662),o=n(651),s=n(657),l=n(89),c=n(1),u=n(43),d=n(64),p=n(62),h=n(91),g=n(2),m=n(35),f=n(36),v=n(26),_=n(56),y=n(6),S=n(22),b=n(16),A=n(8),C=n(5);function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var I=function(){function e(e){var t=this;this.minimumTextboxRows=4,this._previousTextLength=0,this._cancelCommentButton=null,this._content=null,this._container=null,this._deleteButton=null,this._doneButton=null,this._doneButtonImage=null,this._replyButton=null,this._saveButton=null,this._footerRow=null,this._footerControls=null,this._footerAddNewControls=null,this._statusIconContainer=null,this._headerRow=null,this._textEntryBox=null,this._textMeasurementContainer=null,this._textMeasurementBox=null,this._saveButtonKeyEventHandler=null,this._doneButtonKeyEventHandler=null,this._replyButtonKeyEventHandler=null,this._cancelButtonKeyEventHandler=null,this._deleteButtonKeyEventHandler=null,this.onContainerClick=function(e){return t._comment.isCommentBeingCreatedOrEdited&&e.innerEvent.target===t._textEntryBox||t._comment.onSelect(),!0},this.onContainerDoubleClick=function(e){return t._comment.onEdit(),!0},this.onContainerKeyPress=function(e){var n=!1;return e.innerEvent.keyCode===f.a.vK_Enter&&(0===t._comment.selectionState?t._comment.onSelect():t._comment.onEdit(),n=!0),n},this.onDeleteButtonClick=function(e){return t._deleteButton.disabled||t._comment.onDelete(),!0},this.onDoneButtonClick=function(e){return t._doneButton.disabled||t._comment.onToggleDone(),!0},this.onReplyButtonClick=function(e){return t._replyButton.disabled||t._comment.onReply(),!0},this.onSaveButtonClick=function(e){return t._saveButton.disabled||t._comment.onSave(t._textEntryBox.value),!0},this.onCancelButtonClick=function(e){return t._cancelCommentButton.disabled||t._comment.onCancel(),!0},this.onKeyEvent=function(e){if(e.innerEvent.ctrlKey&&e.innerEvent.keyCode===f.a.vK_Enter)return t._textEntryBox.value.length>0&&t.onSaveButtonClick(null),!0;if(e.innerEvent.keyCode===f.a.vK_Escape)return!0;var n=e.eventName===g.a.keyPress&&e.innerEvent.charCode===f.a.vK_Enter;return t.onTextEntered(n),!1},this.onCompositionEvent=function(e){return t.onTextEntered(!1),!1},this.onPaste=function(e){var n=new _.a(0,1,0,(function(e){t.onTextEntered(!1)}),1);return c.AFrameworkApplication.theTaskManager.addTask(n),!1},A.a.isInternetExplorer8&&(this.minimumTextboxRows=6),this._comment=e,this._escapeKeyHash=v.KeyInputManager.hashKey(f.a.vK_Escape,0),this.render()}var t,n,i,r=e.prototype;return r.dispose=function(){var e=c.AFrameworkApplication.activeFrame.theClickInputManager,t=c.AFrameworkApplication.activeFrame.theKeyInputManager;if(e.unregisterHandler(g.a.click,this._container,this.onContainerClick),e.unregisterHandler(g.a.doubleClick,this._container,this.onContainerDoubleClick),t.unregisterHandler(g.a.keyUp,this._container,this.onContainerKeyPress),this._deleteButton&&(e.unregisterHandler(g.a.click,this._deleteButton,this.onDeleteButtonClick),t.unregisterHandlerForAllKeyEvents(this._deleteButton,this._deleteButtonKeyEventHandler)),this._doneButton&&(e.unregisterHandler(g.a.click,this._doneButton,this.onDoneButtonClick),t.unregisterHandlerForAllKeyEvents(this._doneButton,this._doneButtonKeyEventHandler)),this._saveButton&&(e.unregisterHandler(g.a.click,this._saveButton,this.onSaveButtonClick),t.unregisterHandlerForAllKeyEvents(this._saveButton,this._saveButtonKeyEventHandler)),this._cancelCommentButton&&(e.unregisterHandler(g.a.click,this._cancelCommentButton,this.onCancelButtonClick),t.unregisterHandlerForAllKeyEvents(this._cancelCommentButton,this._cancelButtonKeyEventHandler)),this._replyButton&&(e.unregisterHandler(g.a.click,this._replyButton,this.onReplyButtonClick),t.unregisterHandlerForAllKeyEvents(this._replyButton,this._replyButtonKeyEventHandler)),this._textEntryBox){if(t.unregisterHandler(g.a.keyPress,this._textEntryBox,this.onKeyEvent),t.unregisterHandler(g.a.keyUp,this._textEntryBox,this.onKeyEvent),A.a.isIPad){var n=c.AFrameworkApplication.activeFrame.theCompositionEventManager;n.unregisterHandler(g.a.compositionStart,this._textEntryBox,this.onCompositionEvent),n.unregisterHandler(g.a.compositionEnd,this._textEntryBox,this.onCompositionEvent),n.unregisterHandler(g.a.compositionUpdate,this._textEntryBox,this.onCompositionEvent)}p.a.instance.unregisterHandler(g.a.paste,this._textEntryBox,this.onPaste)}this._container=null,this._deleteButton=null,this._replyButton=null,this._doneButton=null,this._doneButtonImage=null,this._saveButton=null,this._cancelCommentButton=null,this._textEntryBox=null,this._textMeasurementContainer=null,this._textMeasurementBox=null,this._footerRow=null,this._headerRow=null},r.focus=function(){m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),this._container.focus(),this._comment.commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(this._container)},r.focusOnTextbox=function(){m.FocusManager.instance().scopeChanged(a.a.commentPaneTextboxFocusId),this._textEntryBox.focus(),this._comment.commentManager.getCommentPaneFocusRegion().listing.trySetCurrentElement(this._textEntryBox),2===this._comment.commentType&&this._textEntryBox.value&&this._textEntryBox.value.length>0&&b.a.selectAllTextInInput(this._textEntryBox);var e=this._comment.commentManager.pane.paneSurface,t=b.a.getRelativeLocation(e,this._container);t.y+this._container.clientHeight>e.scrollTop+e.clientHeight&&(e.scrollTop=t.y+this._container.clientHeight-e.clientHeight)},r.finishedCreatingOrEditingComment=function(){if(Sys.UI.DomElement.removeCssClass(this._container,"NewOrEditComment"),this._cancelCommentButton.style.display="none",this._textEntryBox.style.display="none",m.FocusManager.tryBlur(this._textEntryBox),m.FocusManager.tryBlur(this._saveButton),m.FocusManager.instance().getScope(a.a.commentPaneTextboxFocusId).unBindAction(this._escapeKeyHash),m.FocusManager.instance().removeScope(a.a.commentPaneTextboxFocusId),v.KeyInputManager.instance.unregisterHandler(g.a.keyPress,this._textEntryBox,this.onKeyEvent),v.KeyInputManager.instance.unregisterHandler(g.a.keyUp,this._textEntryBox,this.onKeyEvent),A.a.isIPad){var e=c.AFrameworkApplication.activeFrame.theCompositionEventManager;e.unregisterHandler(g.a.compositionStart,this._textEntryBox,this.onCompositionEvent),e.unregisterHandler(g.a.compositionEnd,this._textEntryBox,this.onCompositionEvent),e.unregisterHandler(g.a.compositionUpdate,this._textEntryBox,this.onCompositionEvent)}p.a.instance.unregisterHandler(g.a.paste,this._textEntryBox,this.onPaste),this._content.removeChild(this._textEntryBox),this._content.removeChild(this._textMeasurementContainer),this._textEntryBox=null,this._textMeasurementContainer=null,this._textMeasurementBox=null,this.updateRenderedText(),this.updateRenderedState(),this.focus()},r.updateRenderedState=function(){this.renderState(this._statusIconContainer,this._footerControls,this._footerAddNewControls,this._doneButton,this._doneButtonImage,this._container)},r.render=function(){var t=o.a("a",this.makeId("cc"),"CommentContainer");y.a.setAriaAttribute(t,y.a.ariaDescribedByAttribute,a.a.commentTabHelp),t.tabIndex=0,this._comment.replyToId&&(t.className+=" Reply1");var n=o.a("div",this.makeId("ch"),"CommentHeaderRow"),i=o.a("span",this.makeId("ca"),"CommentAuthor UIFontBold");i.innerText=this._comment.author,n.appendChild(i);var r=o.a("span",this.makeId("ct"),"CommentDate");r.innerText=e.dateToString(this._comment.date,this._comment.commentManager.dateFormat,this._comment.commentManager.timeFormat),Sys.UI.DomElement.addCssClass(r,c.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),n.appendChild(r);var l=o.a("span",this.makeId("ci"),"CommentStatusIcon");n.appendChild(l);var u=null;this._comment.isCommentBeingCreatedOrEdited&&(u=s.a.createButton(this.makeId("cl"),a.a.commentCancelButtonClassName,CommonUIStrings.l_CommentCancelButton,"ClosePaneGlyph_16x16x32",!1),Sys.UI.DomElement.addCssClass(u,c.AFrameworkApplication.isRtl?"FloatLeft":"FloatRight"),u.tabIndex=0,n.appendChild(u)),this._content=o.a("div",this.makeId("cn"),"CommentContent");var d=null,h=null,m=null;this._comment.isCommentBeingCreatedOrEdited?((d=o.a("textarea",this.makeId("ce"),a.a.commentTextEntryClassName+" UIFont")).rows=this.minimumTextboxRows,d.cols=50,d.tabIndex=0,y.a.setAriaAttribute(d,"title",CommonUIStrings.l_CommentContent),this._content.appendChild(d),h=o.a("div","","CommentTextMeasurementContainer"),(m=o.a("textarea","",a.a.commentTextEntryClassName+" UIFont")).rows=1,m.cols=50,m.style.visibility="hidden",m.spellcheck=!1,h.appendChild(m),this._content.appendChild(h),2===this._comment.commentType&&(d.value=this._comment.text.join("\n")+"\n")):this.updateRenderedText();var v=o.a("div","","CommentFooterRow"),_=o.a("span",this.makeId("cf"),""),S=s.a.createButton(this.makeId("cr"),a.a.commentReplyButtonClassName+" CommentFooterButton",CommonUIStrings.l_CommentReplyButton,"CommentReply_16x16x32",!1);S.tabIndex=0,S.setAttribute(y.a.ariaRoleAttribute,y.a.ariaButtonRole),_.appendChild(S);var b=s.a.createButton(this.makeId("cd"),"CommentDoneButton CommentFooterButton",CommonUIStrings.l_CommentDoneButton,"CheckboxUnchecked_16x16x32",!1);b.tabIndex=0;var C=b.childNodes[0].childNodes[0];_.appendChild(b);var T=s.a.createButton(this.makeId("cx"),a.a.commentDeleteButtonClassName+" CommentFooterButton",CommonUIStrings.l_CommentDeleteButton,"Delete_16x16x32",!1);b.tabIndex=0,_.appendChild(T),v.appendChild(_);var k=o.a("span",this.makeId("cfa"),""),w=s.a.createButton(this.makeId("cs"),a.a.commentSaveButtonClassName,CommonUIStrings.l_CommentSaveCommentButton,null);s.a.setButtonEnabledState(w,!1),w.tabIndex=0,k.appendChild(w),v.appendChild(k),this.renderState(l,_,k,b,C,t),this._comment.commentManager.copyingEnabled||(i.setAttribute("Unselectable","on"),r.setAttribute("Unselectable","on")),t.appendChild(n),t.appendChild(this._content),t.appendChild(v),this._container=t,this._doneButton=b,this._doneButtonImage=C,this._deleteButton=T,this._replyButton=S,this._saveButton=w,this._textEntryBox=d,this._textMeasurementContainer=h,this._textMeasurementBox=m,this._cancelCommentButton=u,this._footerRow=v,this._footerControls=_,this._footerAddNewControls=k,this._statusIconContainer=l,this._headerRow=n;var I=c.AFrameworkApplication.activeFrame.theClickInputManager,P=c.AFrameworkApplication.activeFrame.theKeyInputManager;if(I.registerHandler(g.a.click,this._container,this.onContainerClick),I.registerHandler(g.a.doubleClick,this._container,this.onContainerDoubleClick),P.registerHandler(g.a.keyUp,this._container,this.onContainerKeyPress),this._doneButton&&(I.registerHandler(g.a.click,this._doneButton,this.onDoneButtonClick),this._doneButtonKeyEventHandler=P.registerHandlerForAllKeyEvents(this._doneButton,this.onDoneButtonClick,f.a.vK_Enter)),this._replyButton&&(I.registerHandler(g.a.click,this._replyButton,this.onReplyButtonClick),this._replyButtonKeyEventHandler=P.registerHandlerForAllKeyEvents(this._replyButton,this.onReplyButtonClick,f.a.vK_Enter)),this._saveButton&&(I.registerHandler(g.a.click,this._saveButton,this.onSaveButtonClick),this._saveButtonKeyEventHandler=P.registerHandlerForAllKeyEvents(this._saveButton,this.onSaveButtonClick,f.a.vK_Enter)),this._deleteButton&&(I.registerHandler(g.a.click,this._deleteButton,this.onDeleteButtonClick),this._deleteButtonKeyEventHandler=P.registerHandlerForAllKeyEvents(this._deleteButton,this.onDeleteButtonClick,f.a.vK_Enter)),this._cancelCommentButton&&(I.registerHandler(g.a.click,this._cancelCommentButton,this.onCancelButtonClick),this._cancelButtonKeyEventHandler=P.registerHandlerForAllKeyEvents(this._cancelCommentButton,this.onCancelButtonClick,f.a.vK_Enter)),d){if(P.registerHandler(g.a.keyPress,d,this.onKeyEvent),P.registerHandler(g.a.keyUp,d,this.onKeyEvent),A.a.isIPad){var F=c.AFrameworkApplication.activeFrame.theCompositionEventManager;F.registerHandler(g.a.compositionStart,d,this.onCompositionEvent,null),F.registerHandler(g.a.compositionEnd,d,this.onCompositionEvent,null),F.registerHandler(g.a.compositionUpdate,d,this.onCompositionEvent,null)}p.a.instance.registerHandler(g.a.paste,d,this.onPaste),this.setupTextboxFocus()}},r.setSaveCommentButtonState=function(e){s.a.setButtonEnabledState(this._saveButton,e)},r.makeId=function(e){return e+"_"+this._comment.id},r.renderState=function(e,t,n,i,r,a){switch(this._comment.saveState){case 0:case 1:this.showStatusIcon(e,0);break;case 2:case 4:e.style.display="none";break;case 3:Sys.UI.DomElement.addCssClass(a,"SaveFailure"),Sys.UI.DomElement.addCssClass(a,"NoReply"),this.showStatusIcon(e,1);break;default:0}this._comment.done?(Sys.UI.DomElement.addCssClass(a,"CommentIsDone"),r.className=d.getImageClass("CheckboxChecked_16x16x32")):(Sys.UI.DomElement.removeCssClass(a,"CommentIsDone"),r.className=d.getImageClass("CheckboxUnchecked_16x16x32")),this._comment.isCommentBeingCreatedOrEdited?(Sys.UI.DomElement.addCssClass(a,"NewOrEditComment"),Sys.UI.DomElement.addCssClass(a,"SelectedComment"),e.style.display="none",t.style.display="none",n.style.display="inline",0===this._comment.commentManager.mode&&(this.setSaveCommentButtonState(!1),s.a.setButtonEnabledState(this._cancelCommentButton,!1))):1===this._comment.selectionState?(Sys.UI.DomElement.addCssClass(a,"SelectedComment"),Sys.UI.DomElement.removeCssClass(a,"SelectedParentComment"),1!==this._comment.commentManager.mode||3===this._comment.saveState||this._comment.isLocked?t.style.display="none":t.style.display="inline",n.style.display="none"):2===this._comment.selectionState?(Sys.UI.DomElement.removeCssClass(a,"SelectedComment"),Sys.UI.DomElement.addCssClass(a,"SelectedParentComment"),t.style.display="inline",n.style.display="none"):(Sys.UI.DomElement.removeCssClass(a,"SelectedComment"),Sys.UI.DomElement.removeCssClass(a,"SelectedParentComment"),t.style.display="inline",n.style.display="none")},r.showStatusIcon=function(e,t){switch(S.a.clearElement(e),t){case 0:var n=document.createElement("img");n.alt=CommonUIStrings.l_CommentProgressTooltip,n.src=u.a.commonImage("progress16.gif"),e.appendChild(n);break;case 1:var i=d.createClusteredImage(16,16,"Risks_16x16x32","",!0,CommonUIStrings.l_CommentFailTooltip);e.appendChild(i);break;default:0}e.style.display="inline-block"},r.updateRenderedText=function(){S.a.clearElementHtml(this._content);var e=this._comment.text;1===e.length&&e[0]&&(e=e[0].split("\n"));for(var t,n=T(e);!(t=n()).done;){var i=t.value,r=o.a("p","","CommentContentPara");r.innerText=i||"\xa0",this._comment.commentManager.copyingEnabled||r.setAttribute("Unselectable","on"),this._content.appendChild(r)}},r.setupTextboxFocus=function(){var e=m.FocusManager.instance().getScope(a.a.commentPaneTextboxFocusId);e.parent=l.AFrame.commentPaneFocusId,h.a.instance.addFocusEvent(a.a.commentPaneTextboxFocusId,this._textEntryBox),e.bindAction(v.KeyInputManager.hashKey(f.a.VK_S,2),C.a.doNothing),e.bindAction(this._escapeKeyHash,C.a.commentCancelled),e.bindAction(v.KeyInputManager.hashKey(f.a.vK_UpArrow,0),C.a.doBrowserDefault),e.bindAction(v.KeyInputManager.hashKey(f.a.vK_DownArrow,0),C.a.doBrowserDefault),e.unBindAction(m.FocusManager.instance()._tabInput),e.unBindAction(m.FocusManager.instance()._tabShiftInput)},r.onCancelDeleteKeyEvent=function(e){return(e.innerEvent.keyCode===f.a.vK_Enter||e.innerEvent.keyCode===f.a.vK_Space)&&(e.eventName===g.a.keyUp&&(e.sourceElement===this._deleteButton?this._comment.onDelete():e.sourceElement===this._cancelCommentButton&&this._comment.onCancel()),!0)},r.onTextEntered=function(e){if(0!==this._comment.commentManager.mode&&(this.setSaveCommentButtonState(this._textEntryBox.value.length>0),!A.a.isInternetExplorer8)){if(this._textMeasurementContainer.clientWidth!==this._textEntryBox.clientWidth&&(this._textMeasurementContainer.style.width=this._textEntryBox.clientWidth+"px"),this._textMeasurementBox.value=this._textEntryBox.value+"___",this._previousTextLength>this._textEntryBox.value.length&&(this._textMeasurementBox.rows=1),A.a.isInternetExplorer8)this._textMeasurementBox.scrollHeight;for(var t=0,n=Number.MAX_VALUE;1<=(t=this._textMeasurementBox.scrollHeight-this._textMeasurementBox.clientHeight)&&t<n;)if(n=t,this._textMeasurementBox.rows++,A.a.isInternetExplorer8)this._textMeasurementBox.scrollHeight;this._textMeasurementBox.rows<this.minimumTextboxRows?this._textEntryBox.rows=this.minimumTextboxRows:(e&&this._textMeasurementBox.rows++,this._textEntryBox.rows=this._textMeasurementBox.rows),this._previousTextLength=this._textEntryBox.value.length}},e.dateToString=function(e,t,n){if(!e||isNaN(e.getDate()))return"";var i=n,r=new Date;return r.getFullYear()===e.getFullYear()&&r.getMonth()===e.getMonth()&&r.getDate()===e.getDate()||(i=String.format(CommonUIStrings.l_CommentLongDateFormat,t,n)),e.localeFormat(i)},t=e,(n=[{key:"containerElement",get:function(){return this._container}},{key:"deleteButtonElement",get:function(){return this._deleteButton}},{key:"saveButtonElement",get:function(){return this._saveButton}}])&&w(t.prototype,n),i&&w(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(I,"CommentViewObject",null,[10,186]);var P=n(105);function F(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"Comment",(function(){return E}));var E=function(){function e(e,t,n,i,a,o,s,l,c,u,d,p){void 0===c&&(c=!1),void 0===u&&(u=null),void 0===d&&(d=null),void 0===p&&(p=null),this._durableId=null,this._anchorStartId=null,this._anchorEndId=null,this._selectedState=0,this._saveState=2,this._commentType=0,this._viewObject=null,this._draftConfiguration=null,this.isNewComment=!1,this.objectId=null,this.isLocked=!1,this._id=e,this._guardId=t,this._author=n,this._date=i,this._replyToId=a,this._done=o,this._paragraphs=s,this._groupNumber=l,this.contentCanBeLostOnEditing=c,this._authorId=u,this._authorIdProvider=d,this.usersByReactionType=p,this._commentManager=r.a.instance}var t,n,i,a=e.prototype;return a.dispose=function(){this._viewObject&&(this._viewObject.dispose(),this._viewObject=null)},a.render=function(){return this._viewObject=new I(this),this._viewObject.containerElement},a.modeChanged=function(){this._viewObject&&this._viewObject.updateRenderedState()},a.focus=function(){this.onSelect(),this._viewObject.focus(),this.isCommentBeingCreatedOrEdited&&this._viewObject.focusOnTextbox()},a.toString=function(){var e="[null]";return this._paragraphs&&this._paragraphs.length>0&&(e=this._paragraphs[0].length>30?this._paragraphs[0].substr(0,30)+"...":this._paragraphs[0]),String.format('I:{0} A:{1} T:{2} R:{3} D:{4} "{5}"',this._id||"[null]",this._author||"[null]",this._date?this._date.toString():"[null]",this._replyToId||"[null]",this._done,e)},a.onSelect=function(){2!==this.commentManager.mode&&3!==this.commentManager.mode?(m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),1!==this._selectedState&&this.commentManager.selectComment(this._id)):this.isCommentBeingCreatedOrEdited&&this._viewObject.focusOnTextbox()},a.onEdit=function(){this.commentManager.supportEdit&&0===this._commentType&&(m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),this._commentType=2,this._saveState=0,this.commentManager.editComment(this,null))},a.onEditCancelled=function(){3===this.commentManager.mode&&(m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),this._commentType=0,this._saveState=2,this.commentManager.cancelEditingComment(this))},a.onDelete=function(){m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),this.commentManager.deleteComment(this)},a.onToggleDone=function(){this.commentManager.changeDoneStatus(this,!this._done)},a.onReply=function(){if(2!==this.commentManager.mode){0,m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId);var e=this._replyToId||this._id;this.commentManager.addReply(e,null)}},a.onSave=function(e){m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),this._paragraphs=new Array(1),this._paragraphs[0]=e,1===this._commentType?this.commentManager.commitNewComment(this):this.commentManager.commitEditComment(this)},a.onCancel=function(){m.FocusManager.instance().scopeChanged(l.AFrame.commentPaneFocusId),this.commentManager.pane.paneSurface&&this.commentManager.pane.paneSurface.focus(),1===this._commentType?(this.commentManager.deleteComment(this),this.commentManager.selectAfterRemoval(this.replyToId)):this.onEditCancelled()},e.createCommentForEditing=function(t,n,i,r){var a=P.a.create().toString(),o=c.AFrameworkApplication.appSettingsManager.getStringAppSetting("PresenceUserId"),s=c.AFrameworkApplication.appSettingsManager.getStringAppSetting("PresenceProvider"),l=new e(a,e.guardIdInvalid,t,new Date,n,!1,new Array(0),i,!1,o,s);return l._commentType=1,l._saveState=0,l._draftConfiguration=r,l},t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"author",get:function(){return this.isScrubbed?CommonUIStrings.l_RemovedAuthorName:this._author}},{key:"authorId",get:function(){return this._authorId}},{key:"authorIdProvider",get:function(){return this._authorIdProvider}},{key:"date",get:function(){return this.isScrubbed?null:this._date},set:function(e){this._date=e}},{key:"done",get:function(){return this._done},set:function(e){this._done!==e&&(this._done=e,this._viewObject&&this._viewObject.updateRenderedState())}},{key:"groupNumber",get:function(){return this._groupNumber},set:function(e){this._groupNumber=e}},{key:"replyToId",get:function(){return this._replyToId},set:function(e){this._replyToId=e}},{key:"text",get:function(){return this._paragraphs},set:function(e){this._paragraphs=e,this._viewObject&&this._viewObject.updateRenderedText()}},{key:"guardId",get:function(){return this._guardId},set:function(e){this._guardId=e}},{key:"durableId",get:function(){return this._durableId},set:function(e){this._durableId=e}},{key:"anchorStartId",get:function(){return this._anchorStartId},set:function(e){this._anchorStartId=e}},{key:"anchorEndId",get:function(){return this._anchorEndId},set:function(e){this._anchorEndId=e}},{key:"selectionState",get:function(){return this._selectedState},set:function(e){this._selectedState!==e&&(this._selectedState=e,this._viewObject&&this._viewObject.updateRenderedState())}},{key:"saveState",get:function(){return this._saveState},set:function(e){if(this._saveState!==e){if(0===this._saveState&&2===e)return;if(3===this._saveState)return;this._saveState=e,this._viewObject&&this._viewObject.updateRenderedState()}}},{key:"commentType",get:function(){return this._commentType},set:function(e){if(this._commentType!==e){var t=this.isCommentBeingCreatedOrEdited&&0===e;this._commentType=e,t&&this._viewObject&&this._viewObject.finishedCreatingOrEditingComment()}}},{key:"isCommentBeingCreatedOrEdited",get:function(){return 1===this._commentType||2===this._commentType}},{key:"isScrubbed",get:function(){return!!this._commentManager&&this._commentManager.removePersonalInformation}},{key:"containerElement",get:function(){return this._viewObject?this._viewObject.containerElement:null}},{key:"commentManager",get:function(){return this._commentManager}},{key:"commentViewObject",get:function(){return this._viewObject}},{key:"draftConfiguration",get:function(){return this._draftConfiguration},set:function(e){this._draftConfiguration=e}}])&&F(t.prototype,n),i&&F(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();E.guardIdInvalid=null,E.pageNumberUnknown=-1,Object(i.a)(E,"Comment",null,[10,173])},655:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i=n(0),r=n(661),a=n(89),o=n(1),s=n(70),l=n(106),c=n(432),u=n(434),d=n(254),p=n(433),h=n(88),g=n(77),m=n(38),f=n(5);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=function(){function e(e){var t=this;this._commentPane=null,this._commentModel=null,this._hintManager=null,this._currentMode=0,this._focusManager=null,this._eventHost=null,this._commentPendingDeleteConfirmation=null,this._sharedCommentsEnabled=!1,this._commentHighlightEnabled=!1,this._commentDoesNotExistNotificationId=null,this.copyingEnabled=!0,this.deleteDialogHandler=function(e,n){1===e?t.deleteCommentConfirmed(t._commentPendingDeleteConfirmation):(t._commentPendingDeleteConfirmation&&t.selectComment(t._commentPendingDeleteConfirmation.id),t._commentPendingDeleteConfirmation=null)},this.dismiss=function(){h.UISurfaces.getNotificationsAPIAsync().then((function(e){return e.removeNotification(t._commentDoesNotExistNotificationId),t._commentDoesNotExistNotificationId=null,null}))},this._actionManager=e,this.registerActions()}var t,n,i,_=e.prototype;return _.dispose=function(){this._commentPane&&(this._commentPane.dispose(),this._commentPane=null),this._commentModel&&(this._commentModel.dispose(),this._commentModel=null),this._hintManager&&(this._hintManager.dispose(),this._hintManager=null),this.endCommentingSession()},_.selectComment=function(e,t){void 0===t&&(t=1);var n=this._commentModel.getComment(e);n&&(2===this.mode&&1!==n.commentType||(this._commentModel.selectComment(n),this._hintManager.highlightComment(n,!0),this._commentPane.selectComment(n,t),1===t&&this.sharedCommentsEnabled&&this._eventHost.selectComment(e)))},_.selectNextComment=function(){var e=this._commentModel.selectNextComment();e&&(this._hintManager.highlightComment(e,!0),this._commentPane.selectComment(e),this.sharedCommentsEnabled&&this._eventHost.selectComment(e.id))},_.selectPrevComment=function(){var e=this._commentModel.selectPrevComment();e&&(this._hintManager.highlightComment(e,!0),this._commentPane.selectComment(e),this.sharedCommentsEnabled&&this._eventHost.selectComment(e.id))},_.selectAfterRemoval=function(e){e?this.selectComment(e,0):this._commentPane.newCommentButton&&this.getCommentPaneFocusRegion().listing.trySetCurrentElement(this._commentPane.newCommentButton)},_.clearSelection=function(){this._commentModel.clearSelection(),this.sharedCommentsEnabled&&this._eventHost.selectComment(null),this._hintManager.clearHighlighting()},_.paneClosing=function(){if(!this.discreteHostedCommentsEnabled)if(2===this._currentMode){this.clearSelection();var e=this._commentModel.inProgressComment;0,this.deleteComment(e)}else this.clearSelection()},_.addNewComment=function(e){var t;if(1===this.mode){var n,i=r.a.createNewComment(e),a=(t=this._hintManager.createAnchorForSelectedParagraphs(i),n=t.anchor,t).returnValue;if(!n||0!==a){var o;switch(a){case 1:o=CommonUIStrings.l_NewCommentError;break;case 2:o=CommonUIStrings.l_NewCommentInvalidContent;break;case 0:default:0,o=CommonUIStrings.l_NewCommentError}var s=new g.StandardDialog;return s.buttonsOption=0,void s.showInformation(CommonUIStrings.l_DefaultDialogTitle,o,null)}this.addComment(i,n)}},_.addComment=function(e,t){0!==this.mode&&(this._commentModel.addCommentToModel(e,t),this._commentPane.renderNewComment(e),0===e.commentType||this.newSelectionInteractionsEnabled||this.selectComment(e.id),this._actionManager.processAction(f.a.commentNewCreated,2))},_.editComment=function(e,t){1===this.mode&&e&&(this._commentModel.editCommentInModel(e,t),this._commentPane.renderEditingComment(e),this.selectComment(e.id))},_.cancelEditingComment=function(e){this._commentModel.cancelEditingCommentInModel(e),this._commentPane.renderEditingComment(e)},_.addReply=function(e,t){if(1===this.mode){var n=this._commentModel.createAndAddReplyToModel(e,t);this._hintManager.createAnchorForReply(n),this._commentPane.renderNewComment(n),this.selectComment(n.id,0),this._actionManager.processAction(f.a.commentReply,2)}},_.onHighlightChange=function(e,t){},_.deleteComment=function(e){if(1!==this.mode){if(2!==this.mode)return void 0;if(1!==e.commentType)return void 0;this.mode=1}if(this.showConfirmDeleteDialog&&1!==e.commentType){this._commentPendingDeleteConfirmation=e;var t=new g.StandardDialog;return t.buttonsOption=4,t.setDefaultButton(2),void t.showQuestion(CommonUIStrings.l_DefaultDialogTitle,this.deleteCommentConfirmMessage,this.deleteDialogHandler)}this.deleteCommentConfirmed(e)},_.registerActions=function(){var e=this;this._actionManager.addActionWithFlags(f.a.commentBeginRefresh,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(f.a.commentBeginRefreshRefused,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(f.a.commentBeginSucceeded,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addAction(f.a.commentCancelled,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addAction(f.a.commentDelete,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addAction(f.a.commentDone,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(f.a.commentDownloadFailed,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(f.a.commentDownloadSucceeded,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addAction(f.a.commentNewCreated,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addAction(f.a.commentNewSaved,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addAction(f.a.commentReply,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addActionWithFlags(f.a.commentSaveNetworkError,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(f.a.commentSaveSucceeded,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addActionWithFlags(f.a.commentSaveRetry,m.a.frame,s.ActionManager.doNothingButReportHandler,64),this._actionManager.addAction(f.a.commentUndone,m.a.frame,s.ActionManager.doNothingButReportHandler),this._actionManager.addAction(f.a.notifyCommentDoesNotExist,m.a.frame,(function(t,n,i,r,a){return e.notifyCommentDoesNotExist(),32}))},_.deleteCommentConfirmed=function(e){var t=e.replyToId;1===e.commentType?this._actionManager.processAction(f.a.commentCancelled,2):this._actionManager.processAction(f.a.commentDelete,2),this._commentPendingDeleteConfirmation=null,this.sharedCommentsEnabled||this.clearSelection();var n=this._commentModel.deleteComment(e);this._commentPane.removeCommentsFromPane(n),this._hintManager.commentsDeleted(n);for(var i=0;i<n.length;i++)n[i].dispose();this.selectAfterRemoval(t)},_.changeDoneStatus=function(e,t){0!==this.mode&&(this._actionManager.processAction(t?f.a.commentDone:f.a.commentUndone,2),this._commentModel.changeDoneStatus(e,t))},_.commitNewComment=function(e){this._commentModel.commitNewComment(e),this.mode=1,this._actionManager.processAction(f.a.commentNewSaved,2)},_.commitEditComment=function(e){this._commentModel.commitEditComment(e),this.mode=1},_.commitTaskChanges=function(e,t){this._commentModel.recordTaskChanges(e,t)},_.initiateCommentingSession=function(){},_.endCommentingSession=function(){},_.selectCommentByNavigationId=function(e,t){},_.showCommentPane=function(e,t,n,i,r){return this._commentPane.showCommentPane(e,t,n,i,r)},_.toggleCommentPane=function(e,t,n,i,r){return this._commentPane.toggleCommentPane(e,t,n,i,r)},_.getCommentPaneFocusRegion=function(){var e=this,t=this._focusManager.getRegion(a.AFrame.commentPaneFocusId);if(!t){var n=this._focusManager.getScope(a.AFrame.commentPaneFocusId),i=new l.DOMFocusListing((function(){return e.pane.paneSurface}));i.rememberFirstElement=!0,i.addValidTag(3),i.addValidTag(2),i.addValidTag(4),i.addValidTag(1),i.addValidTag(6),i.addValidTag(5),this._focusManager.buildRegionWithDelegate((function(){return e.pane.paneSurface}),n,i),(t=this._focusManager.getRegion(a.AFrame.commentPaneFocusId)).rememberFocusStealers(),t.looped=!0,t.contained=!0,n.unBindAction(this._focusManager._tabInput),n.unBindAction(this._focusManager._tabShiftInput)}return t},_.addCommentReaction=function(e,t){0!==this.mode&&this._commentModel.addCommentReaction(e,t)},_.removeCommentReaction=function(e,t){0!==this.mode&&this._commentModel.removeCommentReaction(e,t)},_.notifyCommentDoesNotExist=function(){var e=this;h.UISurfaces.getNotificationsAPIAsync().then((function(t){var n=Object.assign(new c.a,{target:e.selectorFixForMissingCommentNotificationEnabled?'[data-unique-id*="ShowCommentsTopBar"]':'[data-unique-id~="ShowCommentsTopBar"]',showCloseIcon:!0,content:CommonUIStrings.l_DeepLinkedCommentDoesNotExistNotification,calloutProps:Object.assign(new p.a,{directionalHint:6,gapSpace:4,isBeakVisible:!1})}),i=t.callout(n),r=Object.assign(new d.a,{expirationOptions:Object.assign(new u.a,{displayTimeoutSeconds:10,onExpire:e.dismiss})});e._commentDoesNotExistNotificationId=t.addNotification(i,r)}))},t=e,i=[{key:"instance",get:function(){return e._instance||(e.factory?e._instance=e.factory():null)},set:function(t){e._instance=t}}],(n=[{key:"pane",get:function(){return this._commentPane}},{key:"model",get:function(){return this._commentModel}},{key:"hintManager",get:function(){return this._hintManager}},{key:"dateFormat",get:function(){return o.AFrameworkApplication.shortDateFormat}},{key:"timeFormat",get:function(){return o.AFrameworkApplication.shortTimeFormat}},{key:"deleteCommentConfirmMessage",get:function(){return CommonUIStrings.l_DeleteCommentConfirm}},{key:"supportEdit",get:function(){return!1}},{key:"discreteHostedCommentsEnabled",get:function(){return!1}},{key:"newSelectionInteractionsEnabled",get:function(){return!1}},{key:"selectorFixForMissingCommentNotificationEnabled",get:function(){return!1}},{key:"commentTasksWithMultiAssignEnabled",get:function(){return!1}},{key:"eventHost",get:function(){return this._eventHost},set:function(e){this._eventHost=e}},{key:"mode",get:function(){return this._currentMode},set:function(e){if(e!==this._currentMode){if(this._currentMode=e,-1===this._currentMode)return;this._commentPane.modeChanged(),this._commentModel.modeChanged(),0===this._currentMode&&this.endCommentingSession()}}},{key:"sharedCommentsEnabled",get:function(){return this._sharedCommentsEnabled},set:function(e){this._sharedCommentsEnabled=e}},{key:"commentHighlightEnabled",get:function(){return this._commentHighlightEnabled},set:function(e){this._commentHighlightEnabled=e}},{key:"removePersonalInformation",get:function(){return!1}},{key:"showConfirmDeleteDialog",get:function(){return!0}}])&&v(t.prototype,n),i&&v(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();_._instance=null,_.factory=null,Object(i.a)(_,"CommentManager",null,[19,20,10])},656:function(e,t,n){"use strict";var i=n(0),r=n(1),a=n(8),o=n(2),s=n(35),l=n(89),c=n(56),u=n(26),d=n(36),p=n(77),h=n(16),g=n(22),m=n(7),f=n(20),v=n(21),_=n(67);function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var S=function(){function e(e,t){this._dialogHandler=e,this._clipboardAccessExtensionLink=t}var t,n,i,o=e.prototype;return o.extensionLinkHandler=function(e){v.ULS.sendTraceTag(8716421,307,50,null),h.a.safelyOpenWindow(this.clipboardAccessExtensionLink,"_blank",void 0,"ClipboardAccessExtensionLink")},o.resolveCopyPasteShortcut=function(e,t){var n=a.a.isMac;return r.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("CcpFixIPadShortcutStringsIsEnabled")&&(n=a.a.isIPad||n),n?String.format(t,"\u2318"):e},o.dispose=function(){this._dialogHandler=null},o.reactCopyPasteShortcutDialogHandler=function(e,t){this.copyPasteShortcutDialogHandler(e)},o.legacyCopyPasteShortcutDialogHandler=function(e,t){this.copyPasteShortcutDialogHandler(e)},o.copyPasteShortcutDialogHandler=function(e){this._dialogHandler&&this._dialogHandler(e)},t=e,(n=[{key:"titleText",get:function(){return CommonUIStrings.l_ClipboardUseShortcutTitle}},{key:"forwardElementText",get:function(){return CommonUIStrings.l_ClipboardUseShortcutMessage}},{key:"cutText",get:function(){return CommonUIStrings.l_ClipboardCut}},{key:"macCutText",get:function(){return CommonUIStrings.l_ClipboardCut_Mac}},{key:"copyText",get:function(){return CommonUIStrings.l_ClipboardCopy}},{key:"macCopyText",get:function(){return CommonUIStrings.l_ClipboardCopy_Mac}},{key:"pasteText",get:function(){return CommonUIStrings.l_ClipboardPaste}},{key:"macPasteText",get:function(){return CommonUIStrings.l_ClipboardPaste_Mac}},{key:"pasteTextOnly",get:function(){return CommonUIStrings.l_ClipboardPasteText}},{key:"macPasteTextOnly",get:function(){return CommonUIStrings.l_ClipboardPasteText_Mac}},{key:"clipboardAccessExtensionLink",get:function(){return this._clipboardAccessExtensionLink}},{key:"clipboardExtensionLinkText",get:function(){return CommonUIStrings.l_ClipboardExtensionLink}},{key:"clipboardExtensionSuggestionText",get:function(){return CommonUIStrings.l_ClipboardExtensionSuggestion}}])&&y(t.prototype,n),i&&y(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();S.id="CopyPasteShortcutDialog",S.textElementId="CopyPasteText",Object(i.a)(S,"ACopyPasteShortcutDialog",null,[10]);var b=n(19);function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){var t,n;function i(t,n,i){var r;r=e.call(this,t,n)||this;var o=document.createElement("span");o.className="WACCopyPasteShortcutDialogTextPanel";var s=document.createElement("span");s.id=S.textElementId;var l=document.createElement("span");l.innerText=r.forwardElementText;var c=document.createElement("span");c.className="UIFontBold",c.innerText=r.resolveCopyPasteShortcut(r.cutText,r.macCutText);var u=document.createElement("span");u.className="UIFontBold",u.innerText=r.resolveCopyPasteShortcut(r.copyText,r.macCopyText);var d=document.createElement("span");if(d.className="UIFontBold",d.innerText=r.resolveCopyPasteShortcut(r.pasteText,r.macPasteText),s.appendChild(l),s.appendChild(document.createElement("br")),s.appendChild(c),s.appendChild(u),s.appendChild(d),i.getBooleanAppSetting("PasteTextOnlyShortcutDialogIsEnabled")&&(a.a.isChrome||a.a.isFirefox)){var h=document.createElement("span");h.className="UIFontBold",h.innerText=r.resolveCopyPasteShortcut(r.pasteTextOnly,r.macPasteTextOnly),s.appendChild(h)}if(o.appendChild(s),r.clipboardAccessExtensionLink){v.ULS.sendTraceTag(8716420,307,50,null);var g=document.createElement("span"),m=document.createElement("a");m.href="#",m.innerText=r.clipboardExtensionLinkText,b.a.addHandler(m,"click",Object(_.a)(A(r),r.extensionLinkHandler,"extensionLinkHandler")),g.appendChild(m);var f=r.clipboardExtensionSuggestionText.indexOf("{0}");if(-1!==f){var y=r.clipboardExtensionSuggestionText.substring(0,f),C=r.clipboardExtensionSuggestionText.substring(f+3,r.clipboardExtensionSuggestionText.length),T=document.createTextNode(y),k=document.createTextNode(C);g.insertBefore(T,m),g.appendChild(k)}o.appendChild(document.createElement("br")),o.appendChild(g)}else v.ULS.sendTraceTag(8716422,307,50,null);var w=new p.StandardDialog;return w.buttonsOption=0,w.dialogId=S.id,w.messageBox(r.titleText,null,0,Object(_.a)(A(r),r.legacyCopyPasteShortcutDialogHandler,"legacyCopyPasteShortcutDialogHandler"),o),w.setDescribedByForDialog(S.textElementId),r}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,C(t,n),i}(S);Object(i.a)(T,"CopyPasteShortcutDialog",S,[]);var k=n(87);function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function I(e,t){return(I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){var t,n,i,a,o;function s(t,n){var i,a={},o=(i=e.call(this,t,n)||this).installTitleText;a.extensionStartText=i.extensionStartText,a.extensionLink=null,a.extensionEndText=null,a.shortcutsMessageText=i.shortcutsMessageText,a.cutText=i.resolveCopyPasteShortcut(i.cutText,i.macCutText),a.copyText=i.resolveCopyPasteShortcut(i.copyText,i.macCopyText),a.pasteText=i.resolveCopyPasteShortcut(i.pasteText,i.macPasteText),4!==r.AFrameworkApplication.activeFrame.applicationInstance.officeAppType&&(a.pasteTextOnly=i.resolveCopyPasteShortcut(i.pasteTextOnly,i.macPasteTextOnly));var s={id:"CopyPasteInstallDialog",bodyControls:a},l=new k.a(!1,!1,!0);return l.dialogId="CopyPasteInstallDialog",l.buttonsOption=0,l.setButtonText(1,i.installText),l.setDefaultButton(1),l.initializeAndShow(o,Object(_.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),i.reactCopyPasteShortcutDialogHandler,"reactCopyPasteShortcutDialogHandler"),s),i}return n=e,(t=s).prototype=Object.create(n.prototype),t.prototype.constructor=t,I(t,n),s.shouldUseInstallDialog=function(e){return!!e&&new RegExp("^https:\\/\\/((.*?(word-edit|powerpoint|onenote|excel|visio)\\.(officeapps\\.live\\.com|partner\\.officewebapps\\.cn|gov\\.online\\.office365\\.us|dod\\.online\\.office365\\.us))|(project\\.microsoft\\.com))$","g").test(e)},i=s,(a=[{key:"shortcutsMessageText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogShortcutsMessage}},{key:"installText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogInstallButton}},{key:"installTitleText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogTitle}},{key:"extensionStartText",get:function(){return CommonUIStrings.l_ClipboardInstallDialogExtensionMessage}}])&&w(i.prototype,a),o&&w(i,o),Object.defineProperty(i,"prototype",{writable:!1}),s}(S);Object(i.a)(P,"ReactCopyPasteInstallDialog",S,[]);var F=n(43);function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function O(e,t){return(O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var M=function(e){var t,n,i,r,a;function o(t){var n;(n=e.call(this,t,null)||this).learnMoreLink="https://prod.support.services.microsoft.com/en-us/office/troubleshoot-copy-and-paste-errors-in-powerpoint-for-the-web-0dc01da6-6988-40e5-96ea-0567c151ae2f?preview=true";var i={},r=n.noClipboardAccessDiloagTitleText,a="",o="";if(n.messageText&&(a=n.messageText.split(" {")[0],o=n.messageText.split("} ")[1]),i.startText=a,i.endText=o,i.cutText=n.cutKeyText,i.copyText=n.copyKeyText,i.pasteText=n.pasteKeyText,i.cutShortcutText=n.resolveCopyPasteShortcut(n.cutShortcutText,n.macCutShortcutText),i.copyShortcutText=n.resolveCopyPasteShortcut(n.copyShortcutText,n.macCopyShortcutText),i.pasteShortcutText=n.resolveCopyPasteShortcut(n.pasteShortcutText,n.macPasteShortcutText),i.imageSrc=F.a.commonImage("NoClipboardAccessDialogImage.svg"),i.imageAltText=n.imageAltText,i.primaryButtonLabel=n.primaryButtonLabel,n.learnMoreLink){v.ULS.sendTraceTag(527986756,307,50,"Learn more link is available");i.learnMoreLink={type:"AppLinkProps",id:"learnMoreLink",text:n.learnMoreLinkText,onExecute:function(e){n.learnMoreLinkHandler(e)}}}var s={id:"CopyPasteNoClipboardAccessDialog",bodyControls:i},l=new k.a(!1,!1,!0);return l.buttonsOption=0,l.dialogId="CopyPasteNoClipboardAccessDialog",l.initializeAndShow(r,Object(_.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n),n.reactCopyPasteShortcutDialogHandler,"reactCopyPasteShortcutDialogHandler"),s),n}return n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,O(t,n),o.prototype.learnMoreLinkHandler=function(e){v.ULS.sendTraceTag(527986757,307,50,"Learn more link is clicked"),h.a.safelyOpenWindow(this.learnMoreLink,"_blank",void 0,"learnMoreLink")},i=o,(r=[{key:"noClipboardAccessDiloagTitleText",get:function(){return CommonUIStrings.l_NoClipboardAccessDialogTitle}},{key:"messageText",get:function(){return CommonUIStrings.l_NoClipboardAccessDialogMessage}},{key:"learnMoreLinkText",get:function(){return CommonUIStrings.l_NoClipboardAccessDialogLearnMoreMessage}},{key:"imageAltText",get:function(){return CommonUIStrings.l_NoClipboardAccessDialogImageAltText}},{key:"primaryButtonLabel",get:function(){return CommonUIStrings.l_DialogOk}},{key:"cutKeyText",get:function(){return CommonUIStrings.l_CutString}},{key:"cutShortcutText",get:function(){return CommonUIStrings.l_CutShortcut}},{key:"macCutShortcutText",get:function(){return CommonUIStrings.l_CutShortcut_Mac}},{key:"copyKeyText",get:function(){return CommonUIStrings.l_CopyString}},{key:"copyShortcutText",get:function(){return CommonUIStrings.l_CopyShortcut}},{key:"macCopyShortcutText",get:function(){return CommonUIStrings.l_CopyShortcut_Mac}},{key:"pasteKeyText",get:function(){return CommonUIStrings.l_PasteString}},{key:"pasteShortcutText",get:function(){return CommonUIStrings.l_PasteShortcut}},{key:"macPasteShortcutText",get:function(){return CommonUIStrings.l_PasteShortcut_Mac}}])&&E(i.prototype,r),a&&E(i,a),Object.defineProperty(i,"prototype",{writable:!1}),o}(S);function L(e,t){return(L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(M,"ReactCopyPasteNoClipboardAccessDialog",S,[]);var R=function(e){var t,n;function i(t,n,i){var r;r=e.call(this,t,n)||this;var o={};if(o.forwardElementText=r.forwardElementText,o.cutText=r.resolveCopyPasteShortcut(r.cutText,r.macCutText),o.copyText=r.resolveCopyPasteShortcut(r.copyText,r.macCopyText),o.pasteText=r.resolveCopyPasteShortcut(r.pasteText,r.macPasteText),i.getBooleanAppSetting("PasteTextOnlyShortcutDialogIsEnabled")&&(a.a.isChrome||a.a.isFirefox)&&(o.pasteTextOnly=r.resolveCopyPasteShortcut(r.pasteTextOnly,r.macPasteTextOnly)),r.clipboardAccessExtensionLink){v.ULS.sendTraceTag(40726914,307,50,null);o.extensionLink={type:"AppLinkProps",id:"extensionLink",text:r.clipboardExtensionLinkText,onExecute:function(e){r.extensionLinkHandler(e)}};var s=r.clipboardExtensionSuggestionText.indexOf("{0}");-1!==s&&(o.suggestionPrefixElement=r.clipboardExtensionSuggestionText.substring(0,s),o.suggestionSuffixElement=r.clipboardExtensionSuggestionText.substring(s+3,r.clipboardExtensionSuggestionText.length))}else v.ULS.sendTraceTag(40726915,307,50,null);var l={id:S.id,bodyControls:o},c=new k.a(!1,!1,!0);return c.buttonsOption=0,c.dialogId=S.id,c.initializeAndShow(r.titleText,Object(_.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r),r.reactCopyPasteShortcutDialogHandler,"reactCopyPasteShortcutDialogHandler"),l),r}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,L(t,n),i}(S);function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(R,"ReactCopyPasteShortcutDialog",S,[]);var x=function(){function e(){this._isReactDialogEnabled=!!r.AFrameworkApplication.activeFrame&&r.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,n,i;return e.prototype.createCopyPasteShortcutDialog=function(e,t,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),v.ULS.sendTraceTag(594882645,307,50,String.format("_isReactDialogEnabled={0}, useInstallDialog={1}",this._isReactDialogEnabled,n)),i?new M(e):this._isReactDialogEnabled?n?new P(e,t):new R(e,t,r.AFrameworkApplication.appSettingsManager):new T(e,t,r.AFrameworkApplication.appSettingsManager)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&D(t.prototype,n),i&&D(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();x._instance=null,Object(i.a)(x,"CopyPasteShortcutDialogFactory",null,[162]);var B=n(9),U=n(12),H=n(37),N=n(431),W=n(167),j=n(111),V=n(258),q=n(31),G=n(652),K=n(70),z=function(e,t){this.cp=e,this.wordBreakType=t};Object(i.a)(z,"WordBreak",null,[]);var X=n(616),J=function(){this.wordCount=0,this.browserWordBreakCount=0};function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(J,"WordCountFromWordBreaksResult",null,[]);var Z=function(){function e(){e._punctuationCheck=null}var t,n,i,o=e.prototype;return o.getForwardBreakByWord=function(e,t,n){void 0===n&&(n=!1);var i=this.getForwardBreak(e,t,n);return i&&(0!==i.wordBreakType||(i=this.getForwardBreak(e,i.cp,n)))?i.cp:e.length},o.getBackwardBreakByWord=function(e,t,n){void 0===n&&(n=!1);var i=this.getBackwardBreak(e,t,n);return i&&(0!==i.wordBreakType||(i=this.getBackwardBreak(e,i.cp,n)))?i.cp:0},o.getForwardBreak=function(e,t,n){return void 0===n&&(n=!1),this.getForwardBreakInternal(e,t,e.length,n)},o.getBackwardBreak=function(e,t,n){return void 0===n&&(n=!1),this.getBackwardBreakInternal(e,t,n)},o.getTextStartWordBreak=function(e){return this.getTextWordBreak(e,0)},o.getTextWordBreak=function(e,t){return new z(t,this.getWordBreakType(e,t))},o.getBreaks=function(e){var t=this.getBreaksForRange(e,0,e.length);return e.length&&Array.insert(t,0,this.getTextStartWordBreak(e)),t},o.getBreaksForRange=function(e,t,n){var i=[];if(""===e)return i;for(var r=t,a=!1;!a;){var o=this.getForwardBreakInternal(e,r,n);if(o)if(4===o.wordBreakType)if((r=o.cp+1)>=n)a=!0;else{var s=this.getWordBreakType(e,o.cp),l=this.getWordBreakType(e,r);s!==l&&Array.add(i,new z(r,l))}else Array.add(i,o),r=o.cp;else a=!0}return i},o.getWordCount=function(e,t){return this.getWordCountFromWordBreaks(e,t).wordCount},o.getWordCountInRange=function(e,t,n){var i=this.getBreaksForRange(e,t,n);return Array.insert(i,0,this.getTextWordBreak(e,t)),this.getWordCount(i,e)},o.getWordCountFromWordBreaks=function(e,t){for(var n=new J,i=0;i<e.length;i++){var r=e[i];3===r.wordBreakType||2===r.wordBreakType?(2===r.wordBreakType&&n.browserWordBreakCount++,this.shouldCountAlphaBreak(i,e,t)&&n.wordCount++):1!==r.wordBreakType&&5!==r.wordBreakType||this.shouldCountPuncuationBreak(i,e,t)&&n.wordCount++}return n},o.shouldCountAlphaBreak=function(e,t,n){if(!e)return!0;var i=t[e];if(!i.cp)return!0;var r=t[e-1];if(m.a.isEastAsianCharExtended(n.charCodeAt(i.cp))||m.a.isEastAsianCharExtended(n.charCodeAt(r.cp)))return!0;var a=!0;if(1===r.wordBreakType)for(var o=!1,s=r.cp;s<i.cp;s++){var l=n.charAt(s);if("-"===l){if(o)return!0;o=!0}else o=!1;if(a=this.doesPunctuationIndiciateNewWord(l))return!0}else if(2===r.wordBreakType)return!1;return(2!==i.wordBreakType||0===r.wordBreakType)&&a},o.shouldCountPuncuationBreak=function(e,t,n){var i=t[e];if(this.doesPunctuationIndiciateNewWord(n.charAt(i.cp)))return!1;if(!e)return!0;if(!i.cp)return!1;var r=t[e-1];return!!m.a.isEastAsianCharExtended(n.charCodeAt(r.cp))||(0===r.wordBreakType||6===r.wordBreakType)},o.doesPunctuationIndiciateNewWord=function(e){return"\u2013"===e||"\u2014"===e},o.getForwardBreakInternal=function(t,n,i,r){if(void 0===r&&(r=!1),n>=i-1)return null;for(var a=n;a<i;){var o=this.getWordBreakType(t,a);switch(o){case 2:var s=this.getBrowserNextWordBreak(t,n,!0);return s?s.cp>=i?null:s:null;case 3:case 1:case 0:case 5:case 6:if(a>=i-1)return null;var l=a+1,c=this.getWordBreakType(t,l);if(o!==c&&this.shouldCreateBreakOnNextWordBreak(o,c,r)&&(2!==c||!e.supportsBrowserWordBreaking))return new z(l,c);break;default:0}a+=1}return null},o.getBackwardBreakInternal=function(t,n,i){if(void 0===i&&(i=!1),1>=n)return null;for(var r=n;0<r;){var a=this.getWordBreakType(t,r-1);switch(a){case 2:var o=this.getBrowserNextWordBreak(t,n,!1);return o||null;case 3:case 1:case 0:case 5:case 6:if(1>=r)return null;var s=r-1,l=this.getWordBreakType(t,s-1);if(a!==l&&this.shouldCreateBreakOnNextWordBreak(a,l,i)&&(2!==l||!e.supportsBrowserWordBreaking))return new z(s,a);break;default:0}r-=1}return null},o.shouldCreateBreakOnNextWordBreak=function(e,t,n){return void 0===n&&(n=!1),n?!(3===e&&1===t||1===e&&3===t):5===e&&3!==t||3===e&&5!==t||(1===e||6===e)||0===e},o.ensureBrowserWordBreakSurface=function(){e._browserWordBreakingSurface||(e._browserWordBreakingSurface=X.a.getScratchPad("WordBreakUtils"),e._browserWordBreakingSurface.className="WACWordBreakSurface")},o.updateCurrentText=function(t){e._currentText!==t&&(e._browserWordBreakingSurface.innerText=t,e._currentText=t)},o.setNoBrowserWordBreaker=function(){e._noBrowserWordBreakerCount++},o.removeNoBrowserWordBreaker=function(){e._noBrowserWordBreakerCount--},o.getBrowserNextWordBreak=function(t,n,i){this.ensureBrowserWordBreakSurface(),this.updateCurrentText(t);var r=-1;var o=!1;a.a.supportsTextRange?n!==(r=this.textRangeWordBreak(n,i))&&(o=!0):a.a.supportsWordBreakingRange&&n!==(r=this.rangeWordBreak(n,i))&&(o=!0),o||(r=this.noSupportWordBreak(n,i));var s=-1;return i?r>=e._currentText.length?r=-1:r===n?s=4:r<n&&(r=-1):(r<=0&&(r=-1),r>=n&&(r=-1)),-1===r?null:(-1===s&&(s=this.getWordBreakType(t,r)),new z(r,s))},o.textRangeWordBreak=function(t,n){r.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGFROMBROWSER,1),e._textRangeObject||(e._textRangeObject=document.body.createTextRange()),e._textRangeObject.moveToElementText(e._browserWordBreakingSurface),e._textRangeObject.collapse(),e._textRangeObject.move("character",t),n?e._textRangeObject.moveEnd("word",1):e._textRangeObject.moveStart("word",-1);var i=e._textRangeObject.text.length,a=n?t+i:t-i;return(a<0||a>e._currentText.length)&&(a=t),a=this.correctBrowerWordBreak(t,a,n)},o.rangeWordBreak=function(t,n){r.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGFROMBROWSER,1),X.a.beginScratchPadUse();var i=e._browserWordBreakingSurface.firstChild,a=e._browserWordBreakingSurface.ownerDocument.createRange();a.setStart(i,t),a.setEnd(i,t),a.expand("word");var o=n?a.endOffset:a.startOffset;return o===t&&!n&&t>0&&(a.setStart(i,t-1),a.setEnd(i,t-1),a.expand("word"),o=a.startOffset),o=this.correctBrowerWordBreak(t,o,n),X.a.endScratchPadUse(),o},o.correctBrowerWordBreak=function(e,t,n){return e===t?t:n?this.correctForwardHelper(e,t):this.correctBackwardHelper(e,t)},o.correctForwardHelper=function(t,n){for(var i=!1,a=t;a<n;a++){var o=this.getWordBreakType(e._currentText,a);if(i){if(1===o||0===o)return r.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGOVERRIDEBROWSER,1),a}else 2===o&&(i=!0)}return n},o.correctBackwardHelper=function(t,n){for(var i=!1,a=t-1;a>=n;a--){var o=this.getWordBreakType(e._currentText,a);if(i){if(1===o||0===o)return r.AFrameworkApplication.theWsaClient.incrementDw(e.DATAID_WACWORDBREAKINGOVERRIDEBROWSER,1),a+1}else 2===o&&(i=!0)}return n},o.noSupportWordBreak=function(e,t){return t?this.noSupportWordBreakForward(e):this.noSupportWordBreakBackward(e)},o.noSupportWordBreakForward=function(t){for(var n=t;n<e._currentText.length&&2===this.getWordBreakType(e._currentText,n)&&!m.a.isEastAsianCharExtended(m.a.charCodeAt(e._currentText,n));)n++;return n===t&&(n++,this.isCpInMiddleOfSurrogatePair(n)&&n++),n},o.noSupportWordBreakBackward=function(t){for(var n=t;n>0&&2===this.getWordBreakType(e._currentText,n-1)&&!m.a.isEastAsianCharExtended(m.a.charCodeAt(e._currentText,n-1));)n--;return n===t&&(n--,this.isCpInMiddleOfSurrogatePair(n)&&n--),n},o.isCpInMiddleOfSurrogatePair=function(t){return m.a.isLowSurrogateCharAt(e._currentText,t-1)},o.getWordBreakType=function(e,t){var n=e.charAt(t).toString();return this.isAlphaNumeric(n)?3:this.isWhiteSpace(n)?0:this.isPunctuation(n)?1:this.isPunctuationWithoutBreak(n)?5:this.isFootnoteEndnotePunctuation(n)?6:2},o.isAlphaNumeric=function(e){return m.a.isAlphaNum(e.charAt(0))},o.isWhiteSpace=function(t){return e._whiteSpaceCheck||(e._whiteSpaceCheck=new RegExp("[\\u0000-\\u001F]|\\u0020|[\\u007F-\\u009F]|\\u00A0|[\\u2000-\\u200B]|\\u202F|\\u205F|\\u2420|[\\u2422-\\u2424]|\\u3000|\\uFF02")),e._whiteSpaceCheck.test(t)},o.isPunctuation=function(t){return e._punctuationCheck||(e._punctuationCheck=new RegExp("[!-&]|[\\(-\\.]|/|[:-@]|[\\[-`]|[{-~]|\xa1|\xa6|\xa7|\xa9|\xab|\xac|\xae|\xb0|\xb1|[\xb4-\xb7]|\xbb|\xbf|\xd7|\xf7|\u01c3|\u037e|[\u2012-\u2015]|[\u201a-\u2022]|[\u2024-\u2026]|\\u202F|\u2030|\u2039|\u203a|\u203c|\u203d|\u2048|\u2049|\\u2060|\u2103|\u2105|\u2106|\u2109|\u2116|\u2122|\u2211|\u2212|\u221a|\u221e|\u222b|\u2248|\u2260|\u2264|\u2265|\\u25A1|\\u25AA|\\u25AB|\u25ca|\u25cf|\u25e6|[\u2639-\u263b]|\u2762|\\uFEFF|\uff01|\uff0e|\uff1b|\uff1f|\uff61")),e._punctuationCheck.test(t)},o.isPunctuationWithoutBreak=function(e){return"'"===e||"\u2018"===e||"\u2019"===e},o.isFootnoteEndnotePunctuation=function(e){return"\ue000"===e},t=e,i=[{key:"supportsBrowserWordBreaking",get:function(){return a.a.supportsTextRange||a.a.supportsWordBreakingRange}},{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}],(n=null)&&Q(t.prototype,n),i&&Q(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Z.DATAID_WACWORDBREAKINGOVERRIDEBROWSER=10265,Z.DATAID_WACWORDBREAKINGFROMBROWSER=10266,Z._whiteSpaceCheck=null,Z._punctuationCheck=null,Z._browserWordBreakingSurface=null,Z._currentText="",Z._textRangeObject=null,Z._callback=null,Z._noBrowserWordBreakerCount=0,Z._instance=null,Object(i.a)(Z,"WordBreakUtils",null,[245]);var Y=n(658),$=n(653);function ee(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ie=function(){function e(e,t,n,i){this._dpiAspectRatio=e,this._isRtl=t,this._xmlNodeWrapperFactory=n,this._wordBreakUtils=i}var t,n,i,a=e.prototype;return a.getRectanglePosition=function(t){return e.getRectanglePositionInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(t))},a.getSelectionBoundingBox=function(t,n,i,r,a,o,s){var l;if(!t||!n||!i)return e._loggedNullValueForBoundingBox||(v.ULS.sendTraceTag(20557894,301,50,"Can't get bounding box due to null value"),e._loggedNullValueForBoundingBox=!0),null;if(!t.firstChild||!t.firstChild.nodeValue)return this.getRectanglePosition(t);var c=n.characterPosition,u=i.characterPosition;return-1===c||-1===u?l=this.getRectanglePosition(t):n.id===i.id?(l=G.a.instance.computeBoundingBoxForTextRun(t,c,u),e.fixBoundingBoxDimensionsIfImagePresent(l,n.selectionPosition.x,i.selectionPosition.x,n.imagesInlineWithText),e.logBoxIfInvalid(l)):!a&&t.firstChild&&o?(l=G.a.instance.computeBoundingBoxForTextRun(t,c,t.firstChild.nodeValue.length),e.fixBoundingBoxDimensionsIfImagePresent(l,n.selectionPosition.x,Number.MAX_VALUE,n.imagesInlineWithText),e.logBoxIfInvalid(l)):a===r&&t.firstChild&&s?(l=G.a.instance.computeBoundingBoxForTextRun(t,0,u),e.fixBoundingBoxDimensionsIfImagePresent(l,0,i.selectionPosition.x,i.imagesInlineWithText),e.logBoxIfInvalid(l)):l=this.getRectanglePosition(t),l},a.getImagesInlineWithText=function(e,t){return this.getImagesInlineWithTextInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(e),this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(t))},a.getImagesInlineWithTextInternal=function(t,n){var i,r;if(!t||!n)return null;if(!(i=this.tryGetCharacterWidthArray(t),r=i.charWidths,i).returnValue)return null;for(var a,o=n.selectNodes("Image[@type='Figure']/boundingRect"),s=0,l=ee(r);!(a=l()).done;){s+=a.value}s=Math.round(s*this._dpiAspectRatio());for(var c=e.getRectanglePositionInternal(t),u=[],d=0;d<o.length;d++){var p=o.get_item(d),h=e.getRectanglePositionInternal(p);this.areBoxesIntersecting(c,h)&&(Math.abs(c.width-s)>Math.abs(c.width-(s+h.width))&&(u.push(p),s+=h.width))}return u},a.areBoxesIntersecting=function(e,t){return!(!e||!t)&&(!(e.left>t.left+t.width||t.left>e.left+e.width)&&!(e.top>t.top+t.height||t.top>e.top+e.height))},a.getCharacterPosition=function(e,t,n){var i=this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(t);return this.getCharacterPositionInternal(e,i,n)},a.getCharacterPositionInternal=function(t,n,i){var r,a;if(!(r=this.tryGetCharacterWidthArray(n),a=r.charWidths,r).returnValue)return-1;if(!n.attributes.getNamedItem("l"))return e._loggedMissingLeftOffset||(v.ULS.sendTraceTag(20557895,301,50,"CharSelection failed: missing left offset"),e._loggedMissingLeftOffset=!0),-1;var o=parseFloat(n.attributes.getNamedItem("l").nodeValue);if(isNaN(o))return e._loggedLeftOffsetNaN||(v.ULS.sendTraceTag(20557896,301,50,"CharSelection failed: left offset NaN"),e._loggedLeftOffsetNaN=!0),-1;if(t.x<o)return 0;var s,l=0,c=0,u=0;if(i&&i.length)for(s=0;s<i.length;s++){var d,p,h=i[s],g=void 0;(d=e.tryGetXCoordinatesForXmlNode(h,g),p=d.x1,g=d.x2,d).returnValue&&(g<t.x?c+=g-p:p<t.x&&t.x<=g&&(c+=t.x-p,u=1))}for(s=0;s<a.length;s++)if((l+=a[s])*this._dpiAspectRatio()+o+c>t.x)return s+u;return s},a.tryGetCharacterWidthArray=function(t){return this._isRtl?(e._loggedApplicationRtl||(v.ULS.sendTraceTag(20557900,301,50,"CharSelection failed: App RTL"),e._loggedApplicationRtl=!0),{returnValue:!1,charWidths:null}):t?t.attributes?t.attributes.getNamedItem("a")?(e._loggedAngle||(v.ULS.sendTraceTag(20557902,301,50,"CharSelection failed: angled text"),e._loggedAngle=!0),{returnValue:!1,charWidths:null}):t.attributes.getNamedItem("rtl")?(e._loggedTextRtl||(v.ULS.sendTraceTag(20557903,301,50,"CharSelection failed: text RTL"),e._loggedTextRtl=!0),{returnValue:!1,charWidths:null}):t.attributes.getNamedItem("gr")?(e._loggedRotated||(v.ULS.sendTraceTag(20557904,301,50,"CharSelection failed: rotated text"),e._loggedRotated=!0),{returnValue:!1,charWidths:null}):t.firstChild&&t.firstChild.nodeValue?this.tryParseWidths(t):(e._loggedNullValue||(v.ULS.sendTraceTag(20557897,301,50,"CharSelection failed: null node/FirstChild"),e._loggedNullValue=!0),{returnValue:!1,charWidths:null}):(e._loggedNullValue||(v.ULS.sendTraceTag(20557901,301,50,"CharSelection failed: null attributes"),e._loggedNullValue=!0),{returnValue:!1,charWidths:null}):{returnValue:!1,charWidths:null}},a.tryParseWidths=function(t){var n=null;if(!t.attributes.getNamedItem("cw"))return e._loggedNullValue||(v.ULS.sendTraceTag(21002058,301,50,"CharSelection failed: null cw attribute"),e._loggedNullValue=!0),{returnValue:!1,charWidths:n};var i=t.attributes.getNamedItem("cw").nodeValue,r=(i=i.substring(1,i.length-1)).split(e.characterWidthDelimiter);if(r.length!==t.firstChild.nodeValue.length)return e._loggedCharWidthParseFailedWrongLength||(v.ULS.sendTraceTag(20557898,301,50,"CharSelection failed: char width array length [cwLength:{0}] [textLength:{1}]",r.length,t.firstChild.nodeValue.length),e._loggedCharWidthParseFailedWrongLength=!0),{returnValue:!1,charWidths:n};n=new Array(r.length);for(var a=0;a<r.length;a++){var o=parseFloat(r[a]);if(isNaN(o))return e._loggedCharWidthParseFailedInvalidWidths||(v.ULS.sendTraceTag(20557899,301,50,"CharSelection failed: char width NaN [width:{0}]",r[a]),e._loggedCharWidthParseFailedInvalidWidths=!0),{returnValue:!1,charWidths:n};n[a]=o}return{returnValue:!0,charWidths:n}},a.tryGetWordStart=function(e,t,n){var i,r,a=null,o=(i=this.tryGetWordStartInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(e),t),r=i.startNode,n=i.startPosition,i).returnValue;return r&&(a=r.backingNode),{returnValue:o,startNode:a,startPosition:n}},a.tryGetWordStartInternal=function(e,t){var n=-1,i=null;if(!this.tryGetCharacterWidthArray(e).returnValue)return{returnValue:!1,startNode:i,startPosition:n};var r=e.firstChild.nodeValue,a=this._wordBreakUtils.getBackwardBreak(r,t);i=e;for(var o=0;!a&&o<1e6;){var s=i.previousSibling;if(this.tryGetCharacterWidthArray(s).returnValue){var l=s.firstChild.nodeValue;(a=this._wordBreakUtils.getBackwardBreak(l,l.length))?a=new z(0,-1):i=s}else a=new z(0,-1);o++}return a&&i?{returnValue:!0,startPosition:n=a.cp,startNode:i}:(v.ULS.sendTraceTag(20820181,301,15,"TryGetWordEnd returning unexpected output [InfiniteLoop:{0}]",!a),{returnValue:!1,startNode:i,startPosition:n})},a.tryGetWordEnd=function(e,t,n){var i,r,a=null,o=(i=this.tryGetWordEndInternal(this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(e),t),r=i.endNode,n=i.endPosition,i).returnValue;return r&&(a=r.backingNode),{returnValue:o,endNode:a,endPosition:n}},a.tryGetWordEndInternal=function(e,t){var n=null,i=-1;if(!this.tryGetCharacterWidthArray(e).returnValue)return{returnValue:!1,endNode:n,endPosition:i};var r=e.firstChild.nodeValue,a=this._wordBreakUtils.getForwardBreak(r,t);n=e;for(var o=0;!a&&o<1e6;){var s=n.nextSibling;this.tryGetCharacterWidthArray(s).returnValue?(n=s,a=this._wordBreakUtils.getForwardBreak(n.firstChild.nodeValue,0)):a=new z(n.firstChild.nodeValue.length,-1),o++}return a&&n?{returnValue:!0,endPosition:i=a.cp,endNode:n}:(v.ULS.sendTraceTag(20820182,301,15,"TryGetWordEnd returning unexpected output [InfiniteLoop:{0}]",!a),{returnValue:!1,endNode:n,endPosition:i})},e.getInstanceWithResolvedDependencies=function(){return new e((function(){return U.App.instance.theConfig.dpiAspectRatio}),r.AFrameworkApplication.isRtl,new $.a,Z.instance)},e.buildXPathForPageSelection=function(e,t){if(t.id<e.id){var n=e;e=t,t=n}return String.format("descendant::P[@storyId='{0}']/T[@id>={1} and @id<={2}]",e.storyId,e.id,t.id)},e.buildXPathFromPosition=function(e,t,n,i){var r=String.format("/Pages/Page[@id='{0}']/descendant::P[@storyId='{1}']/T[@l<={2} and (@l + @w)>={2}",e,t,i.x);return r+=n?String.format(" and (@t + @h)>={0}]",i.y):String.format(" and @t<={0}]",i.y)},e.getRectanglePositionInternal=function(t){var n=Math.round(parseFloat(t.attributes.getNamedItem("l").nodeValue)),i=Math.round(parseFloat(t.attributes.getNamedItem("t").nodeValue)),r=Math.round(parseFloat(t.attributes.getNamedItem("w").nodeValue)),a=Math.round(parseFloat(t.attributes.getNamedItem("h").nodeValue)),o=new Y.a(n,i,r,a);return e.logBoxIfInvalid(o),o},e.fixBoundingBoxDimensionsIfImagePresent=function(t,n,i,r){if(t&&r)for(var a=0;a<r.length;a++){var o,s,l=r[a],c=void 0;(o=e.tryGetXCoordinatesForXmlNode(l,c),s=o.x1,c=o.x2,o).returnValue&&(s+5>i||(c-5<n?t.left=t.left+(c-s):t.width=t.width+(c-s)))}},e.tryGetXCoordinatesForXmlNode=function(e,t){var n=t=0;if(!e||!e.attributes)return{returnValue:!1,x1:n,x2:t};var i=e.attributes.getNamedItem("l"),r=e.attributes.getNamedItem("w");return i&&r?(t=(n=parseFloat(i.nodeValue))+parseFloat(r.nodeValue),isNaN(n)||isNaN(t)?{returnValue:!1,x1:n,x2:t}:{returnValue:!0,x1:n,x2:t}):{returnValue:!1,x1:n,x2:t}},e.logBoxIfInvalid=function(e){(e.left<=0&&e.top<=0&&e.width<=0&&e.height<=0||e.width<0||e.height<0)&&v.ULS.sendTraceTag(4792668,301,50,"It seems like the user is not going to see a selection. L={0} T={1} W={2} H={3}",e.left,e.top,e.width,e.height)},e.getXmlNodeAtPosition=function(e,t,n){if(!n)return null;var i=U.App.instance.theConfig.selectionTolerance,r=String.format("/Pages/Page[@id='{0}']/descendant::P/T[@l<={1} and (@l + @w)>={2} and @t<={3} and (@t + @h)>={4}]",t,e.x+i,e.x-i,e.y+i,e.y-i);return n.selectSingleNode(r)},e.getXmlLinkNodeAtPosition=function(e,t,n){if(!n)return null;var i=String.format("/Pages/Page[@id='{0}']/descendant::L[@l<={1} and (@l + @w)>={2} and @t<={3} and (@t + @h)>={4}]",t,e.x,e.x,e.y,e.y);return n.selectSingleNode(i)},e.nodeHasDimensions=function(e){return!!e&&!!parseInt(e.attributes.getNamedItem("w").nodeValue)&&!!parseInt(e.attributes.getNamedItem("h").nodeValue)},e.getCopyableHtmlElementsForRegion=function(t,n){for(var i=e.buildXPath(t,n),r=[],a=-1,o=t.page;o<=n.page;o++){var s=q.a.getPageSetXmlFromPage(o);if(s!==a){var l=U.App.get_activeAppFrame().thePageInfoCache.getCopyableHtmlElementsForQuery(i,o,t.characterPosition,n.characterPosition);l&&r.push.apply(r,l),a=s}}return r},e.buildXPath=function(e,t){if(t.id<e.id){var n=e;e=t,t=n}return String.format("/Pages/Page[@id>={0} and @id<={1}]/descendant::P[@storyId='{2}']/T[@id>={3} and @id<={4}]",e.page,t.page,e.storyId,e.id,t.id)},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=e.getInstanceWithResolvedDependencies())}}],(n=null)&&ne(t.prototype,n),i&&ne(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}ie._loggedCharWidthParseFailedWrongLength=!1,ie._loggedCharWidthParseFailedInvalidWidths=!1,ie._loggedApplicationRtl=!1,ie._loggedNullValue=!1,ie._loggedAngle=!1,ie._loggedTextRtl=!1,ie._loggedRotated=!1,ie._loggedMissingLeftOffset=!1,ie._loggedLeftOffsetNaN=!1,ie._loggedNullValueForBoundingBox=!1,ie.characterWidthDelimiter=";,",ie._instance=null,Object(i.a)(ie,"SelectionUtils2",null,[]);var ae=function(){function e(e){var t=this;this._start=null,this._end=null,this._copyFrameLoaded=!1,this._setFocusExceptionLogged=!1,this.documentScopeOnFocus=function(e,n){t.setFocus()},this.buildClipboard=function(e,n,i,r,a){var o=ie.getCopyableHtmlElementsForRegion(t._start,t._end);return t.placeCopyElementsInIFrame(o),32},this.contextMenuHandler=function(e){return N.a.showFromKey(e),!0},this.onCopyFrameLoad=function(e){t._copyFrame.contentWindow.document.title=String.format("{0} {1}",WacWordviewerStrings.CopyIframeTitle,CommonUIStrings.l_AccHelpShortcutAnnouncement),t.initKeyInputManager(),t._copyFrameLoaded=!0},this._copyFrame=document.createElement("iFrame"),this._copyFrame.className="WACCopyFrame",this._copyFrame.title=WacWordviewerStrings.NonUserFacingFrameTitle,s.FocusManager.instance().getScope(l.AFrame.documentFocusID).addOnFocus(this.documentScopeOnFocus),b.a.addHandler(this._copyFrame,"load",this.onCopyFrameLoad),e.appendChild(this._copyFrame),this._copyFrame.id="WACCopyFrame",r.AFrameworkApplication.theActionManager.addActionWithFlags(B.a.buildClipboard,H.a.application,U.App.instance.copyingEnabled?this.buildClipboard:K.ActionManager.doNothingHandler,96)}var t,n,i,o=e.prototype;return o.initKeyInputManager=function(){var e=this._copyFrame.contentWindow.document.body,t=U.App.get_activeAppFrame();e.id="WACCopyFrameBody",t.theKeyInputManager.initializeForElement(e),t.theContextMenuInputManager.registerHandler(e,this.contextMenuHandler),t.registerShowViewerWarningBusinessBarElement(e)},o.setContentEditable=function(e){this._copyFrame.contentWindow.document.body.setAttribute("contentEditable",e?"true":"false")},o.clearCopy=function(){var e=!1,t=Number.MAX_VALUE,n=Number.MIN_VALUE;this._start&&this._end&&(e=!0,t=this._start.page,n=this._end.page),this.clearCopyIframe(),this._start=null,this._end=null,e&&U.App.get_activeAppFrame().thePageInfoCache.removeFromCache(t,n)},o.updateCopy=function(e,t){if(U.App.instance.copyingEnabled&&e&&t){if(e.id>t.id){var n=e;e=t,t=n}this._start=e,this._end=t;for(var i=U.App.get_activeAppFrame().thePageInfoCache,a=!0,o=this._start.page;o<=this._end.page;o++)if(!i.getPage(o)){a=!1;break}a?r.AFrameworkApplication.theActionManager.processAction(B.a.buildClipboard,2):U.App.get_activeAppFrame().thePageInfoCache.addToCache(this._start.page,this._end.page)}},o.clearCopyIframe=function(){this.forceCompatibility();var e=this._copyFrame.contentWindow.document.body;g.a.clearElementHtml(e),s.FocusManager.instance().setScope(l.AFrame.documentFocusID)},o.placeCopyElementsInIFrame=function(e){if(e.length,U.App.instance.copyingEnabled){0,this.forceCompatibility();var t=this._copyFrame.contentWindow.document.body;if(t){g.a.clearElementHtml(t);for(var n=0;n<e.length;n++)t.appendChild(e[n]);s.FocusManager.instance().setScope(l.AFrame.documentFocusID),e.length>0&&this.setFocus()}}},o.setFocus=function(){if(this._copyFrame.contentWindow){0;try{this._copyFrame.contentWindow.focus()}catch(e){v.ULS.sendTraceTag(4792863,301,10,"Cannot focus the copy frame's window. Exception: {0}. Copy frame load status = {1}.",e.message,this._copyFrameLoaded)}try{if(a.a.supportsDomL2Selection){var e=this._copyFrame.contentWindow.getSelection();e.removeAllRanges(),e.selectAllChildren(this._copyFrame.contentWindow.document.body)}else this._copyFrame.contentWindow.document.execCommand("SelectAll")}catch(e){this._setFocusExceptionLogged||(v.ULS.sendTraceTag(6362266,301,50,"Selection failed: Message: {0}, stacktrace: {1}, _setFocusExceptionLogged = {2}",e.message,e.stack,this._setFocusExceptionLogged),this._setFocusExceptionLogged=!0)}}else v.ULS.sendTraceTag(4792862,301,10,"Cannot focus the copy frame's window, because it's null. Copy frame load status = {0}.",this._copyFrameLoaded)},o.forceCompatibility=function(){if(a.a.isFirefox){var e=this._copyFrame.contentWindow;window.self.__loadCompat&&!e.attachEvent&&(__loadCompat(e),_loadMozillaCompat(e))}},o.dispose=function(){var e,t;b.a.removeHandler(this._copyFrame,"load",this.onCopyFrameLoad),this._start&&(this._start.dispose(),this._start=null),this._end&&(this._end.dispose(),this._end=null);var n=null===(t=null===(e=this._copyFrame.contentWindow)||void 0===e?void 0:e.document)||void 0===t?void 0:t.body;if(n){this._copyFrameLoaded||v.ULS.sendTraceTag(4032355,301,50,"It seems like the OnLoad handler for _copyFrame has not been run - the event may have not been fired by the browser; Expected=WACCopyFrameBody Actual={0}",n.id||"null");var i=U.App.get_activeAppFrame();i.unregisterShowViewerWarningBusinessBarElement(n),i.theKeyInputManager.deinitializeForElement(n),i.theContextMenuInputManager.unregisterHandler(n,this.contextMenuHandler)}this._copyFrameLoaded=!1,this._copyFrame=null,this._setFocusExceptionLogged=!1},t=e,(n=[{key:"copyFrame",get:function(){return this._copyFrame}}])&&re(t.prototype,n),i&&re(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(ae,"ClipboardManager",null,[10]);var oe=function(e,t){this.eventArgs=e,this.selectionFlag=t};Object(i.a)(oe,"EventDataForSelection",null,[]);var se=n(663),le=function(e,t){this.cursorY=e,this.directionUp=t};function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(le,"SelectionData",null,[]);var ue,de=function(){function e(e){var t=this;this._start=new Sys.UI.Point(-1,-1),this._position=new Sys.UI.Point(-1,-1),this._scrollPosition=new Sys.UI.Point(-1,-1),this._startFlag=0,this._currentlyScrolling=!1,this._scrollTimeoutId=0,this._aLongTimeAgo=new Date(0).getTime(),this._scrollControl=null,this.forceScroll=function(){if(t._currentlyScrolling&&-1!==t._position.y&&-1!==t._start.y&&-1!==t._scrollPosition.y){var e=!1,n=t._lastScrolltime!==t._aLongTimeAgo,i=(new Date).getTime(),a=i-t._lastScrolltime;if(t._lastScrolltime=i,n&&(t._scrollPosition.y<U.App.instance.theConfig.scrollZone?t._start.y<t._position.y?n=!1:e=!0:t._start.y>t._position.y&&(n=!1)),n){var o=Math.floor(a/1e3*U.App.instance.theConfig.scrollMagnitudePerSecond);0,e&&(o*=-1),r.AFrameworkApplication.theActionManager.processActionWithData(B.a.repositionScrollerWithoutAnimation,2,new W.a(Math.round(t.scrollControl.getScrollTop()+o),Number.NaN)),r.AFrameworkApplication.theActionManager.processActionWithData(B.a.selectFromScroll,2,new le(t._position.y,e)),t._region.style.cursor="text"}t._scrollTimeoutId=window.setTimeout(t.forceScroll,U.App.instance.theConfig.scrollDelay)}},this._region=e,this._lastScrolltime=this._aLongTimeAgo}var t,n,i,a=e.prototype;return a.setStart=function(e){if(-1===this._start.y){this._start=e;var t=U.App.get_activeAppFrame().workspace.getHeight();this._start.y<=U.App.instance.theConfig.scrollZone?this._startFlag=0:t-this._start.y<U.App.instance.theConfig.scrollZone?this._startFlag=2:this._startFlag=1}},a.update=function(e){var t=U.App.instance.theConfig.scrollZone,n=Math.round(t*U.App.instance.theConfig.scrollOffset/100);this._scrollPosition=new Sys.UI.Point(e.x,e.y),this._startFlag?2===this._startFlag&&(this._start.y<e.y-n?this._scrollPosition.y=this._region.clientHeight+e.y-t-this._start.y-n:this.stopScrolling()):e.y+n<this._start.y?this._scrollPosition.y=t+n+e.y-this._start.y:this.stopScrolling(),this._scrollPosition.y<t||this._region.offsetHeight-this._scrollPosition.y<t?(this._position=e,this._currentlyScrolling||(-1===this._start.y&&(this._start=e),this._currentlyScrolling=!0,this._scrollTimeoutId=window.setTimeout(this.forceScroll,U.App.instance.theConfig.scrollDelay))):this.stopScrolling()},a.stopScrolling=function(){this._currentlyScrolling&&(this._region.style.cursor="",this._currentlyScrolling=!1,this._lastScrolltime=this._aLongTimeAgo,window.clearTimeout(this._scrollTimeoutId))},a.resetScroller=function(){this.stopScrolling(),this._scrollPosition=new Sys.UI.Point(-1,-1),this._position=new Sys.UI.Point(-1,-1),this._start=new Sys.UI.Point(-1,-1)},a.dispose=function(){this._region=null},t=e,(n=[{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=f.a.instance.resolve("WordViewer.Controls.IScrollControl"))}}])&&ce(t.prototype,n),i&&ce(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(de,"ScrollHandler",null,[10]),function(e){e[e.beginSelection=0]="beginSelection",e[e.moveSelection=1]="moveSelection",e[e.endSelection=2]="endSelection",e[e.clickSelection=3]="clickSelection",e[e.hover=4]="hover",e[e.doubleClickSelection=5]="doubleClickSelection",e[e.checkClickInSelection=6]="checkClickInSelection",e[e.checkClickInPage=7]="checkClickInPage"}(ue||(ue={})),Object(i.b)("SelectionFlag",ue),n.d(t,"a",(function(){return he}));var he=function(){function e(){var t=this;if(this._clicking=!1,this._offset=new Sys.UI.Point(0,0),this._eventPosition=new Sys.UI.Point(0,0),this._selected={},this._externalLinkOnClickRegistered=!1,this._safeLinksManager=null,this._scrollControl=null,this._zoomControl=null,this._start=null,this._end=null,this._previousSelectionStart=null,this._previousSelectionEnd=null,this._selectionCopier=null,this._waitingOnReposition=!1,this._loggedWordSelectionFailed=!1,this.selection=function(e,n,i,r,a){var o=a,s=!1;if(!o||!o.eventArgs)return 8;try{s=t.eventHandler(o.eventArgs,o.selectionFlag)}catch(e){v.ULS.sendTraceTag(24151193,301,10,"Drag event failed for '{0}': {1}",ue[o.selectionFlag],e.message)}return s?32:8},this.xmlPageDownloaded=function(e,n,i,r,a){var o,s=a,l=s.firstPage,c=s.lastPage,u=U.App.get_activeAppFrame().thePageInfoCache;if(!t._start||!t._end)return 32;for(var d=l;d<=c;d++)o=u.getPage(l),t.selectPage(o,t._start,t._end,d===l,d===c);return 32},this.updateSelection=function(e,n,i,r,a){return t.repositionAllSelections(),32},this.selectFromScroll=function(e,n,i,a,o){if(!t._start)return 32;t._end||(t._end=t._start);var s=o,l=s.directionUp,c=s.cursorY,u=t.zoomControl.currentZoom,d=t.scrollControl.getScrollTop()+c,p=j.a.instance.getPageFromScrollTop(d,u),h=new Sys.UI.Point(0,0);r.AFrameworkApplication.isRtl?h.x=j.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(p,u)-t._eventPosition.x:h.x=t._eventPosition.x-j.a.instance.getPageLeftAtZoom(p,u,!1),h.y=d-j.a.instance.getPageTopAtZoom(p,u);var g=ie.buildXPathFromPosition(p,t._start.storyId,l,h),m=U.App.get_activeAppFrame().thePageInfoCache.getPage(p);if(!m)return 32;for(var f,v=m.selectNodes(g),_=null,y=null,S=Number.MIN_VALUE,b=Number.MAX_VALUE,A=0;A<v.length;A++)(f=parseInt(v[A].attributes.getNamedItem("id").nodeValue))<b&&(b=f,y=v[A]),f>S&&(S=f,_=v[A]);var C,T=-1;return l?(C=ie.instance.getImagesInlineWithText(y,m),T=ie.instance.getCharacterPosition(h,y,C),t.updateSelectionNode(y,T,h,C)):(C=ie.instance.getImagesInlineWithText(_,m),T=ie.instance.getCharacterPosition(h,_,C),t.updateSelectionNode(_,T,h,C)),32},this.browserCopied=function(e,t,n,i,a){return r.AFrameworkApplication.theWsaClient.incrementDw(8812,1),4},this.contextMenuFromKey=function(e,n,i,r,a){if(!t._start||!t._end)return 32;var o=0,s=0;if(void 0!==t._start&&null!==t._start&&void 0!==t._start.node&&null!==t._start.node){var l=t._start.node.attributes,c=Math.round(parseFloat(l.getNamedItem("l").nodeValue)),u=Math.round(parseFloat(l.getNamedItem("t").nodeValue));o=c+Math.round(parseFloat(l.getNamedItem("w").nodeValue))/2,s=u+Math.round(parseFloat(l.getNamedItem("h").nodeValue))/2}var d=t.scrollControl.scroller.offsetLeft;U.App.get_activeAppFrame().workspace;var p=t.scrollControl.getScrollTop(),h=t.zoomControl.currentZoom,g=t._start.page,m=Math.round(j.a.instance.getPageTopAtZoom(g,h)/h),f=new Sys.UI.Point(o+d,m-p+s);return N.a.ensureContextMenuCreated(),N.a.contextMenuUser.showContextMenuAt("mnuSelectionViewer",f,2),32},this.copy=function(n,i,r,o,s){if(!t._start||!t._end)return 8;if(1===r)return U.App.isReadyForRibbon()?32:8;var l;try{t._selectionCopier.updateCopy(t.selectionStart,t.selectionEnd),l=e.executeBrowserCopyCommand(t._selectionCopier.copyFrame.contentWindow.document)}catch(e){v.ULS.shipAssertTag(4792664,301,a.a.isFirefox,"We failed to copy to the system clipboard, even though we thought we had access!"),l=!1}return l?(t._selectionCopier.setFocus(),32):(t.handleBlockedAccessAttempt(),8)},this.showContextMenuInDocument=function(e,n,i,r,a){var o=a;return t.eventHandler(o,7)?(t._start&&t._end||t.eventHandler(o,3),N.a.contextMenuUser.showContextMenuAt("mnuSelectionViewer",o.clientPoint,o.inputSource),32):8},this.closeHandler=function(e){t.sharedCloseHandler()},this.standardDialogCloseHandler=function(e,n){t.sharedCloseHandler()},this.setupExternalLinkAnchorInternal=function(e){t._externalLinkOnClickRegistered||(U.App.get_activeAppFrame().theClickInputManager.registerHandler(o.a.click,t._externalLinkAnchor,t.linkOnClick),t._externalLinkOnClickRegistered=!0),t._surface.appendChild(t._externalLinkAnchor)},this.clearPreviousSelectionTask=function(e){t._previousSelectionStart||t._previousSelectionEnd,t._previousSelectionStart=null,t._previousSelectionEnd=null},this.repositionAllSelectionsTask=function(e){var n,i=t.zoomControl.currentZoom,r=t._selected;for(var a in r){n={key:a,value:r[a]}.value;var o=ie.instance.getRectanglePosition(n.node);n.rectangle.setPosition(o,q.a.getPageFromXmlLine(n.node),i)}t.showSelection(),t._waitingOnReposition=!1},this.onContainerResize=function(e,n,i,r,a){return t.repositionAllSelections(),t.calculateOffset(),32},this.linkOnClick=function(e){return e.innerEvent.stopPropagation(),!1},this.onClick=function(e){return t.eventHandler(e,3)},this.onDoubleClick=function(e){return t.executeDragOrClickEventForSelection(e,B.a.doubleClickSelection,5)},this.onMouseDown=function(e){return s.FocusManager.usable()&&s.FocusManager.instance().setScope(l.AFrame.documentFocusID),document.body.focus(),!1},this.onMouseMove=function(e){return t._clicking||t.eventHandler(e,4),!1},U.App.get_activeAppFrame().workspace&&U.App.get_activeAppFrame().workspace.initialized){if(this._newEmbedModeIsEnabled=r.AFrameworkApplication.appSettingsManager.getBooleanAppSetting("NewEmbedModeIsEnabled"),this._surface=this.scrollControl.container,this.calculateOffset(),this._selectionScroller=new de(this._surface),this._externalLinkAnchor=document.createElement("a"),this._externalLinkDiv=document.createElement("div"),this._externalLinkDiv.className="WACLink",this._externalLinkAnchor.appendChild(this._externalLinkDiv),this._externalLinkAnchor.target="_blank",this._externalLinkAnchor.setAttribute("rel","noreferrer noopener"),!U.App.instance.isAccessiblePdfMode&&(U.App.instance.copyingEnabled&&(this._selectionCopier=new ae(this._surface)),!U.App.instance.isSmallView||this._newEmbedModeIsEnabled)){U.App.get_activeAppFrame().theDragInputManager.registerDragAdapter(this._surface,this),U.App.get_activeAppFrame().theClickInputManager.registerHandler(o.a.doubleClick,this._surface,this.onDoubleClick),U.App.get_activeAppFrame().theClickInputManager.registerHandler(o.a.click,this._surface,this.onClick);var n=U.App.get_activeAppFrame().theMouseInputManager;n.registerHandler(o.a.mouseDown,this._surface,this.onMouseDown,null),n.registerHandler(o.a.mouseMove,this._surface,this.onMouseMove,null)}this._repositionAllSelectionsTask=new c.a(3,1,10,this.repositionAllSelectionsTask),this._clearPreviousSelectionTask=new c.a(3,1,1e3,this.clearPreviousSelectionTask),this.actionManager.addActionWithFlags(B.a.onContainerResizeForSelection,H.a.application,this.onContainerResize,96),this.actionManager.addActionWithFlags(B.a.xmlPageDownloaded,H.a.application,this.xmlPageDownloaded,97),this.actionManager.addActionWithFlags(B.a.updateSelection,H.a.application,this.updateSelection,96),this.actionManager.addActionWithFlags(B.a.selectFromScroll,H.a.application,this.selectFromScroll,97),this.actionManager.addAction(B.a.browserCopied,H.a.application,this.browserCopied),this.actionManager.addAction(B.a.copy,H.a.application,this.copy),this.actionManager.addAction(B.a.showContextMenuInDocument,H.a.application,this.showContextMenuInDocument),this.actionManager.addAction(B.a.showContextMenuFromKey,H.a.application,this.contextMenuFromKey),this.actionManager.addAction(B.a.beginSelection,H.a.application,this.selection),this.actionManager.addAction(B.a.endSelection,H.a.application,this.selection),this.actionManager.addAction(B.a.doubleClickSelection,H.a.application,this.selection),s.FocusManager.instance().getScope(l.AFrame.documentFocusID).bindAction(u.KeyInputManager.hashKey(d.a.VK_C,u.KeyInputManager.commandKeyModifier),B.a.browserCopied)}}var t,n,i,_=e.prototype;return _.dispose=function(){var e=this._selected;for(var t in e){({key:t,value:e[t]}).value.dispose()}if(this.teardownExternalLinkAnchor(),this._externalLinkAnchor=null,this._externalLinkDiv=null,this._selectionCopier&&(this._selectionCopier.dispose(),this._selectionCopier=null),this._selectionScroller&&(this._selectionScroller.dispose(),this._selectionScroller=null),this._waitingOnReposition&&(r.AFrameworkApplication.theTaskManager.deleteTask(this._repositionAllSelectionsTask),this._waitingOnReposition=!1),(!U.App.instance.isSmallView||this._newEmbedModeIsEnabled)&&!U.App.instance.isAccessiblePdfMode&&this._surface){U.App.get_activeAppFrame().theDragInputManager.unregisterDragAdapter(this._surface,this),U.App.get_activeAppFrame().theClickInputManager.unregisterHandler(o.a.click,this._surface,this.onClick),U.App.get_activeAppFrame().theClickInputManager.unregisterHandler(o.a.doubleClick,this._surface,this.onDoubleClick);var n=U.App.get_activeAppFrame().theMouseInputManager;n.unregisterHandler(o.a.mouseDown,this._surface,this.onMouseDown),n.unregisterHandler(o.a.mouseMove,this._surface,this.onMouseMove)}this._surface=null,this._selected=null},_.handleBlockedAccessAttempt=function(){if(r.AFrameworkApplication.wacCopyPasteShortcutDialogIsEnabled)x.instance.createCopyPasteShortcutDialog(this.closeHandler,null);else{var e=new p.StandardDialog;e.buttonsOption=0,e.showWarning(CommonUIStrings.l_ClipboardAccessDeniedTitle,CommonUIStrings.l_ClipboardAccessDenied,this.standardDialogCloseHandler)}},_.sharedCloseHandler=function(){this._selectionCopier.setFocus()},_.eventHandler=function(t,n){var i=t.innerEvent.rawEvent.shiftKey,a=U.App.get_activeAppFrame().workspace,o=this.scrollControl.getScrollLeft(),s=this.scrollControl.getScrollTop(),l=new Sys.UI.Point(0,0);r.AFrameworkApplication.isRtl?l.x=this.scrollControl.getWidth()+this._offset.x+Math.abs(o)-t.clientPoint.x:l.x=t.clientPoint.x+o-this._offset.x,l.y=t.clientPoint.y+s-this._offset.y;var c=this.zoomControl.currentZoom,u=j.a.instance.getPageFromScrollTop(l.y,c);this._eventPosition=new Sys.UI.Point(l.x-o,l.y-s),this._clicking&&this._selectionScroller.update(this._eventPosition);var d=new Sys.UI.Point(0,0);if(r.AFrameworkApplication.isRtl){var p=j.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(u,c);d.x=Math.round((p-l.x)/c)}else{var g=j.a.instance.getPageLeftAtZoom(u,c,!1);d.x=Math.round((l.x-g)/c)}d.y=Math.round((l.y-j.a.instance.getPageTopAtZoom(u,c))/c);var m=U.App.get_activeAppFrame().thePageInfoCache,f=null,_=null,y=-1,S=null;if(m&&(f=ie.getXmlNodeAtPosition(d,u,m.getPage(u)),S=ie.instance.getImagesInlineWithText(f,m.getPage(u)),y=ie.instance.getCharacterPosition(d,f,S),_=ie.getXmlLinkNodeAtPosition(d,u,m.getPage(u))),4===n)return e.isValidIntLinkNode(_)?this._surface.style.cursor="pointer":e.isValidExtLinkNode(_)?(this._surface.style.cursor="pointer",this.setupExternalLinkAnchor(_,s,u,c)):(this.teardownExternalLinkAnchor(),this._surface.style.cursor=ie.nodeHasDimensions(f)?"text":""),!1;if(3===n&&e.isValidExtLinkNode(_)&&this.isHyperlinkLaunchEvent(t)){try{var b=e.returnScreenedLink(_.text);this.safeLinksManager&&this.safeLinksManager.tryNavigate(b)||h.a.followHyperlinkWithNoReferrer(b)}catch(e){e.message;v.ULS.sendTraceTag(39965912,301,50,"Error thrown when opening the link with protocol '{0}'",this.getLinkProtocol(_.text))}return!0}if(3===n&&e.isValidIntLinkNode(_)&&this.isHyperlinkLaunchEvent(t))return this.navigatepublicLink(_),!0;switch(n){case 0:this._selectionScroller.setStart(this._eventPosition),this.beginSelection(f,i,y,d,S);break;case 1:this.moveSelection(f,y,d,S);break;case 2:this.endSelection();break;case 3:if(3===t.inputSource)this.checkIfClickIsInSelection(d.x,d.y)?U.App.get_activeAppFrame().contextMenuControl.show(t):this.selectParagraph(f);else f&&i?(this.beginSelection(f,i,y,d,S),this.moveSelection(f,y,d,S),this.endSelection()):"contextmenu"!==t.eventName&&this.clearSelection();break;case 5:this.selectWordAtPosition(f,y,d,S);break;case 6:return this.checkIfClickIsInSelection(d.x,d.y);case 7:var A=r.AFrameworkApplication.isRtl?U.App.get_activeAppFrame().isCommentPaneVisible?U.App.instance.theConfig.commentPaneWidth:0:U.App.get_activeAppFrame().isSearchPaneVisible?U.App.instance.theConfig.searchPaneWidth:0;return!(d.x<0||d.x>j.a.instance.getPageWidthAtZoom(u,c)/c||t.clientPoint.x-A>this.scrollControl.getWidth())&&!(d.y<0||d.y>j.a.instance.getPageHeightAtZoom(u,c)/c||t.clientPoint.y-a.appBaseDom.offsetTop>a.getHeight());default:0,v.ULS.sendTraceTag(4792667,301,15,"Invalid Selection Code {0}",n)}return!0},_.isHyperlinkLaunchEvent=function(e){return 2!==e.inputSource||(!e.innerEvent.button||e.innerEvent.button===Sys.UI.MouseButton.middleButton)},_.getLinkProtocol=function(e){if(!e)return"NULL";if(!e.length)return"EMPTY";var t=e.indexOf("://");return-1===t?"UNKNOWN":e.substring(0,t)},_.checkIfClickIsInSelection=function(e,t){if(!this._start||!this._end)return!1;var n=this._selected;for(var i in n){var r={key:i,value:n[i]}.value.rectangle;if(e>=r.left&&e<=r.left+r.width&&t>=r.top&&t<=r.top+r.height)return!0}return!1},_.setupExternalLinkAnchor=function(t,n,i,a){var o=e.returnScreenedLink(t.text);if(o){this._externalLinkAnchor.href=o;var s=Math.round(parseFloat(t.attributes.getNamedItem("t").nodeValue)),l=Math.round(parseFloat(t.attributes.getNamedItem("l").nodeValue)),u=n-j.a.instance.getPageTopAtZoom(i,a);if(this._externalLinkDiv.style.top=n+s*a-u+"px",r.AFrameworkApplication.isRtl){var d=Math.round(parseFloat(t.attributes.getNamedItem("w").nodeValue));this._externalLinkDiv.style.right=j.a.instance.getDistanceOfPageLeftFromScrollerRightEdge(i,a)-(d+l)*a+"px"}else this._externalLinkDiv.style.left=j.a.instance.getPageLeftAtZoom(i,a,!1)+l*a+"px";this._externalLinkDiv.style.width=Math.round(parseFloat(t.attributes.getNamedItem("w").nodeValue)*a)+"px",this._externalLinkDiv.style.height=Math.round(parseFloat(t.attributes.getNamedItem("h").nodeValue)*a)+"px",this._externalLinkDiv.title=o;var p=new c.a(2,1,1e3,this.setupExternalLinkAnchorInternal);return r.AFrameworkApplication.theTaskManager.addTask(p),!0}return!1},_.teardownExternalLinkAnchor=function(){g.a.removeElement(this._externalLinkAnchor),this._externalLinkOnClickRegistered&&(U.App.get_activeAppFrame().theClickInputManager.unregisterHandler(o.a.click,this._externalLinkAnchor,this.linkOnClick),this._externalLinkOnClickRegistered=!1)},_.navigatepublicLink=function(e){if(e.hasChildNodes()){0;var t=e.selectSingleNode("LT"),n=t.attributes.getNamedItem("p"),i=t.attributes.getNamedItem("t"),a=parseInt(n.nodeValue),o=parseInt(i.nodeValue),s=this.zoomControl.currentZoom,l=j.a.instance.getPageTopAtZoom(a,s);l+=o*s;var c=parseInt(this._surface.offsetHeight);r.AFrameworkApplication.theActionManager.processActionWithData(B.a.repositionScroller,2,new W.a(l-.2*c,0))}},_.beginSelection=function(e,t,n,i,r){this._clicking=!0;var a=null;e&&(a=new se.a(null,e,n,i,r)),t&&this._end&&this._start?this.updateSelectionNode(e,n,i,r):(this.clearSelection(),this._selectionCopier&&this._selectionCopier.clearCopy(),this._start=a)},_.moveSelection=function(e,t,n,i){this.updateSelectionNode(e,t,n,i)},_.endSelection=function(){this._selectionScroller.resetScroller(),this._clicking&&this._selectionCopier&&this._selectionCopier.updateCopy(this._start,this._end),this._surface.style.cursor="",this._clicking=!1},_.clearSelection=function(){var e,t=this._selected;for(var n in t){e={key:n,value:t[n]}.value.rectangle,G.a.instance.removeFromParent(e)}this._previousSelectionStart=this._start,this._previousSelectionEnd=this._end,r.AFrameworkApplication.theTaskManager.addTask(this._clearPreviousSelectionTask),this._selected={},this._start=null,this._end=null},_.unselectRange=function(e,t){if(t<e){var n=e;e=t,t=n}var i,r,a=[],o=this._selected;for(var s in o){var l={key:s,value:o[s]};i=l.value.rectangle,(r=parseInt(i.id))>=e&&r<=t&&(G.a.instance.removeFromParent(i),a.push(l.key));for(var c=0;c<a.length;c++)delete this._selected[a[c]]}},_.updateSelectionNode=function(e,t,n,i){if(this._end||(this.selectRange(this._start,this._start),this._end=this._start),e){var r=new se.a(null,e,t,n,i);if(r.storyId===this._start.storyId&&(1===r.storyId||r.page===this._start.page)){var a=this._end.page,o=U.App.get_activeAppFrame().thePageInfoCache;this._end.id===r.id?(this.unselectRange(this._end.id,this._end.id),this.selectRange(this._start,r),this._end=r):this._start.id<r.id?this._end.id<this._start.id?(this.unselectRange(this._end.id,this._start.id-1),this.selectRange(this._start,r),this._end=r,o.removeFromCache(a,this._start.page)):this._end.id<r.id?(this.unselectRange(this._end.id,this._end.id),this.selectRange(this._start,r),this._end=r):r.id<this._end.id&&(this.unselectRange(r.id+1,this._end.id),this._end=r,o.removeFromCache(r.page,a)):r.id<this._start.id?this._start.id<this._end.id?(this.unselectRange(this._start.id+1,this._end.id),this.selectRange(r,this._start),this._end=r,o.removeFromCache(this._start.page,a)):r.id<this._end.id?(this.unselectRange(this._end.id,this._end.id),this.selectRange(this._start,r),this._end=r):this._end.id<r.id&&(this.unselectRange(this._end.id,r.id-1),this._end=r,o.removeFromCache(a,r.page)):r.id===this._start.id&&this._end.id!==this._start.id&&(this._end.id<this._start.id?(this.unselectRange(this._end.id,this._start.id-1),this._end=r,o.removeFromCache(a,r.page)):(this.unselectRange(this._start.id+1,this._end.id),this._end=r,o.removeFromCache(r.page,a)))}}},_.selectRange=function(e,t){if(t.id<e.id||e.id===t.id&&t.characterPosition<e.characterPosition){var n=e;e=t,t=n}for(var i,r=U.App.get_activeAppFrame().thePageInfoCache,a=e.page;a<=t.page;a++)i=r.getPage(a),this.selectPage(i,e,t,a===e.page,a===t.page)},_.selectWordAtPosition=function(e,t,n,i){var r,a,o,s,l,c,u=(r=ie.instance.tryGetWordStart(e,t,l),o=r.startNode,l=r.startPosition,r).returnValue,d=(a=ie.instance.tryGetWordEnd(e,t,c),s=a.endNode,c=a.endPosition,a).returnValue;u&&d?(this.beginSelection(o,!1,l,n,i),this.updateSelectionNode(s,c,n,i),this.endSelection()):(this._loggedWordSelectionFailed||(v.ULS.sendTraceTag(20557893,301,50,"Unable to select word"),this._loggedWordSelectionFailed=!0),this.selectParagraph(e))},_.selectParagraph=function(e){if(e){var t=e.selectSingleNode("ancestor::P");if(t){var n=t.selectNodes("descendant::T");n&&n.length&&(this.beginSelection(n[0],!1,-1,null,null),this.updateSelectionNode(n[n.length-1],-1,null,null),this.endSelection())}}else this.clearSelection()},_.selectPage=function(e,t,n,i,r){if(e){var a=ie.buildXPathForPageSelection(t,n),o=e.selectNodes(a);if(o.length){var s,l,c,u=o[0].selectSingleNode("ancestor::Page");0;for(var d=parseInt(u.selectSingleNode("@id").text),p=0;p<o.length;p++)if(l=(s=o[p]).attributes.getNamedItem("id").nodeValue,!this._selected[l]&&ie.nodeHasDimensions(s)){var h=this.zoomControl.currentZoom,g=ie.instance.getSelectionBoundingBox(s,t,n,o.length-1,p,i,r),m=G.a.instance.drawRectangle(g,0,l,q.a.getPageFromXmlLine(s));m.setPosition(m.box,d,h),c=new se.a(m,s),this._selected[m.id]=c}}}},_.repositionAllSelections=function(){this._waitingOnReposition||(this._waitingOnReposition=!0,r.AFrameworkApplication.theTaskManager.addTask(this._repositionAllSelectionsTask))},_.calculateOffset=function(){this._offset=V.a(this._surface),r.AFrameworkApplication.isRtl&&(a.a.isInternetExplorerNonEdge||a.a.isChromeOrIEEdge)&&(this._offset.x+=this.scrollControl.verticalScrollBarWidth)},_.hideSelection=function(){var e=this._selected;for(var t in e){({key:t,value:e[t]}).value.rectangle.hideHighlight()}},_.showSelection=function(){var e=this._selected;for(var t in e){({key:t,value:e[t]}).value.rectangle.showHighlight()}},_.isDragPossible=function(e){return 2===e.inputSource&&!e.mouseButton},_.onDragStart=function(e){return!!this.isDragPossible(e)&&this.executeDragOrClickEventForSelection(e,B.a.beginSelection,0)},_.onDragMove=function(e){return!!this._start&&this.eventHandler(e,1)},_.onDragEnd=function(e){e.mouseButton||this.executeDragOrClickEventForSelection(e,B.a.endSelection,2)},_.onDragCancel=function(e){this.endSelection()},_.executeDragOrClickEventForSelection=function(e,t,n){return 32===this.actionManager.processActionWithData(t,2,new oe(e,n))},e.executeBrowserCopyCommand=function(e){return e.execCommand("copy",!1,null)},e.returnScreenedLink=function(e){var t=["javascript:","vbscript:"];if(!e)return null;for(var n=m.a.toLower(e),i=t.length,r=0;r<i;++r)if(m.a.startsWith(n,t[r]))return null;return m.a.isLinkable(e)?e:"BLOCKED:"+e},e.isValidExtLinkNode=function(e){return!!e&&!(1!==e.childNodes.length||3!==e.childNodes[0].nodeType||!ie.nodeHasDimensions(e))},e.isValidIntLinkNode=function(e){if(!e)return!1;var t=e.selectSingleNode("LT");return!!t&&!!(t.attributes.getNamedItem("p")&&t.attributes.getNamedItem("l")&&t.attributes.getNamedItem("t"))},t=e,i=[{key:"instance",get:function(){return e._instance||e._initializing||(e._initializing=!0,U.App.get_activeAppFrame()&&(e._instance=new e),e._initializing=!1),e._instance}}],(n=[{key:"actionManager",get:function(){return r.AFrameworkApplication.theActionManager}},{key:"safeLinksManager",get:function(){return this._safeLinksManager||(this._safeLinksManager=f.a.instance.tryResolve("Common.App.SafeLinks.ISafeLinksManager"))}},{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=f.a.instance.resolve("WordViewer.Controls.IZoomControl"))}},{key:"scrollControl",get:function(){return this._scrollControl||(this._scrollControl=f.a.instance.resolve("WordViewer.Controls.IScrollControl"))}},{key:"firstPage",get:function(){return this._start&&this._end?Math.min(this._start.page,this._end.page):Number.MAX_VALUE}},{key:"lastPage",get:function(){return this._start&&this._end?Math.max(this._start.page,this._end.page):Number.MIN_VALUE}},{key:"selectionStart",get:function(){return this._start?this._end&&this._start.id>this._end.id?this._end:this._start:null}},{key:"surface",get:function(){return this._surface}},{key:"selectionEnd",get:function(){return this._end?this._start&&this._start.id>this._end.id?this._start:this._end:null}},{key:"previousSelectionStart",get:function(){return this._previousSelectionStart?this._previousSelectionEnd?this._previousSelectionStart.id>this._previousSelectionEnd.id?this._previousSelectionEnd:this._previousSelectionStart:this._start:null}},{key:"previousSelectionEnd",get:function(){return this._previousSelectionEnd?this._previousSelectionStart?this._previousSelectionStart.id>this._previousSelectionEnd.id?this._previousSelectionStart:this._previousSelectionEnd:this._end:null}}])&&pe(t.prototype,n),i&&pe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();he._initializing=!1,he._instance=null,Object(i.a)(he,"SelectionManager",null,[90])},657:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(0),r=n(651),a=n(64),o=n(6),s=function(){function e(){}return e.prototype.dispose=function(){},e.createButton=function(e,t,n,i,s){void 0===i&&(i=null),void 0===s&&(s=!0);var l=s?"":n;var c=r.a("a",e,"StandardButton "+t);c.title=l,c.tabIndex=0;var u=null;if(i?((u=a.createClusteredImage(16,16,i,"StandardButtonImage",!0,null)).setAttribute(o.a.ariaRoleAttribute,o.a.ariaPresentationRole),c.appendChild(u)):Sys.UI.DomElement.addCssClass(c,"StandardButtonNoImage"),s){var d=r.a("span",null,"StandardButtonLabel");d.innerText=n,c.appendChild(d)}else Sys.UI.DomElement.addCssClass(u,"StandardButtonImageNoText");return c.setAttribute(o.a.ariaRoleAttribute,o.a.ariaButtonRole),c},e.setButtonEnabledState=function(e,t){var n;null!=e&&(e.disabled=!t,t?(n=o.a.ariaFalseValue,Sys.UI.DomElement.removeCssClass(e,"DisabledButton"),Sys.UI.DomElement.removeCssClass(e,"cui-disabled")):(n=o.a.ariaTrueValue,Sys.UI.DomElement.containsCssClass(e,"DisabledButton")||Sys.UI.DomElement.addCssClass(e,"DisabledButton"),Sys.UI.DomElement.containsCssClass(e,"cui-disabled")||Sys.UI.DomElement.addCssClass(e,"cui-disabled")),o.a.setAriaAttribute(e,o.a.ariaDisabledAttribute,n))},e}();Object(i.a)(s,"SimpleButtonFactory",null,[10])},658:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t,n,i){this._left=e,this._top=t,this._width=n,this._height=i}var t,n,i;return t=e,(n=[{key:"height",get:function(){return this._height},set:function(e){this._height=e}},{key:"left",get:function(){return this._left},set:function(e){this._left=e}},{key:"top",get:function(){return this._top},set:function(e){this._top=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(a,"Box",null,[])},659:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(0),r=n(12),a=n(658);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(){}var t,n,i,s=e.prototype;return s.estimatedBoundingBox=function(e,t,n){var i,r=e.firstChild.data.length,o=parseFloat(e.attributes.getNamedItem("l").nodeValue),s=parseFloat(e.attributes.getNamedItem("t").nodeValue),l=parseFloat(e.attributes.getNamedItem("w").nodeValue),c=parseFloat(e.attributes.getNamedItem("h").nodeValue),u=0,d=0,p=0;return e.attributes.getNamedItem("a")&&(d=parseInt(e.attributes.getNamedItem("a").nodeValue)),e.attributes.getNamedItem("rtl")&&(p=parseInt(e.attributes.getNamedItem("rtl").nodeValue)),d?(i=c/r*(n-t),270===d&&1!==p||90===d&&1===p?(s=s+c-c/r*t-i,new a.a(o,s,l,i)):90===d&&1!==p||270===d&&1===p?(s+=c/r*t,new a.a(o,s,l,i)):new a.a(o,s,l,c)):(u=l/r*(n-t),1!==p?o+=l/r*t:o=o+l-l/r*t-u,new a.a(o,s,u,c))},s.drawHitBox=function(e,t,n,i,o,s,l,c,u,d,p,h){var g=r.App.instance.theConfig.dpiAspectRatio;return n?(o=c*g,l=Math.abs(u-c)*g-o):e?270===e&&!t||90===e&&t?(o=u*g,l=Math.abs(u-c)*g):(90===e&&!t||270===e&&t)&&(o=c*g,l=Math.abs(u-c)*g):(i=t?u*g:c*g,s=Math.abs(u-c)*g),i<0||o<0||s<0||l<0||isNaN(i)||isNaN(o)||isNaN(s)||isNaN(l)?this.estimatedBoundingBox(d,p,h):new a.a(i,o,s,l)},s.calculateWidth=function(e,t,n,i,r,a,o){for(var s=new RegExp("\\(\\d:\\d\\)"),l=0;a<t;){var c=1,u=1,d=i[r],p=s.exec(d);if(p){for(var h=p[0].split(new RegExp("[\\(|\\:|\\)]")),g=0;!h[g]&&g<h.length;)g++;for(c=parseInt(h[g]),g++;!h[g]&&g<h.length;)g++;u=parseInt(h[g])}if(a+c>t&&!o)return{returnValue:l,positionInIndicies:r,positionInCharRun:a};for(var m=0;m<u;m++){var f=i[r].split(",");e?l=r?n-parseFloat(f[3]):n:l+=parseFloat(f[1]),r++}a+=c}return{returnValue:l,positionInIndicies:r,positionInCharRun:a}},t=e,i=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(n=null)&&o(t.prototype,n),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();s._instance=null,Object(i.a)(s,"HighlightUtils",null,[93])},660:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var i=function(e,t,n){e&&e.setPosition(e.box,t,n)},r=function(e){for(var t,n=[],i=0;i<e.length;++i)t=e[i],n[i]=t.data;return n.join("")}},661:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),r=n(1),a=n(394);function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(){this._commentManager=null,this._comments=[],this._changes=[],this._selected=null,this._selectedParent=null,this._inProgress=null}var t,i,s,c=e.prototype;return c.initialize=function(e){this._commentManager=e},c.dispose=function(){for(var e=this._comments.length,t=0;t<e;t++)this._comments[t].dispose();this._comments=[]},c.modeChanged=function(){this._selected&&this._selected.modeChanged(),this._selectedParent&&this._selectedParent.modeChanged()},c.selectComment=function(e){if(this.clearSelection(),e.selectionState=1,this._selected=e,e.replyToId){0;for(var t=Array.indexOf(this._comments,e)-1;t>=0;t--){var n=this._comments[t];if(n.id===e.replyToId){n.selectionState=2,this._selectedParent=n;break}}0}r.AFrameworkApplication.activeFrame&&r.AFrameworkApplication.activeFrame.applicationInstance.isShyRibbonEnabled&&a.ShyRibbon.changeShyRibbonState(1,0)},c.selectNextComment=function(){if(!this._comments.length)return null;var e=null;return e=this._selected?this.getCommentAfter(this._selected,!0):this._comments[0],this.selectComment(e),e},c.selectPrevComment=function(){if(!this._comments.length)return null;var e=null;return e=this._selected?this.getCommentBefore(this._selected,!0):this._comments[this._comments.length-1],this.selectComment(e),e},c.clearSelection=function(){this._selected&&(this._selected.selectionState=0,this._selected=null),this._selectedParent&&(this._selectedParent.selectionState=0,this._selectedParent=null)},c.editCommentInModel=function(e,t){this._commentManager.mode=3,e.commentType=2,e.saveState=0,e.draftConfiguration=t,this._inProgress=e},c.cancelEditingCommentInModel=function(e){this._inProgress=null,this._commentManager.mode=1},c.createAndAddReplyToModel=function(e,t){var i=this.getComment(e);this._commentManager.mode=2;var a=n(654).Comment.createCommentForEditing(r.AFrameworkApplication.userName,e,i.groupNumber,t);this._inProgress=a;for(var o=this._comments.length-1;o>=0;o--){var s=this._comments[o];if(s.replyToId===a.replyToId||s.id===a.replyToId){Array.insert(this._comments,o+1,a),!0;break}}return a},c.commitNewComment=function(e){this.commitNewOrEditComment(e,2)},c.commitEditComment=function(e){this.commitNewOrEditComment(e,4)},c.deleteComment=function(e){var t=[];for(var n=Array.indexOf(this._comments,e);n<this._comments.length;){var i=this._comments[n];if(i.id!==e.id&&i.replyToId!==e.id)break;Array.removeAt(this._comments,n),Array.add(t,i)}return this._commentManager.sharedCommentsEnabled,this.recordChanges(t,3),Array.indexOf(t,this._inProgress)>-1&&(this._inProgress=null,this._commentManager.mode=1),t},c.changeDoneStatus=function(e,t){var n=[];for(var i=Array.indexOf(this._comments,e);i<this._comments.length;){var r=this._comments[i];if(r.id!==e.id&&r.replyToId!==e.id)break;r.done=t,Array.add(n,r),i++}this.recordChanges(n,t?0:1)},c.getAllComments=function(){return Array.clone(this._comments)},c.hasComments=function(){return!!this._comments&&!!this._comments.length},c.hasResolvedComments=function(){if(this.hasComments())for(var e,t=o(this._comments);!(e=t()).done;){if(e.value.done)return!0}return!1},c.getComment=function(e){for(var t=0;t<this._comments.length;t++){var n=this._comments[t];if(n.id===e)return n}return null},c.getCommentAfter=function(e,t){var n=Array.indexOf(this._comments,e);return n===this._comments.length-1?t?this._comments[0]:null:this._comments[n+1]},c.getFirstCommentAfter=function(e,t,n){void 0===n&&(n=!1);var i=Array.indexOf(this._comments,e);var r=i;do{if(r===this._comments.length-1&&!t)return null;if(r=r===this._comments.length-1?0:r+1,!n||!this._comments[r].done)return this._comments[r]}while(r!==i);return this._comments[i]},c.getCommentBefore=function(e,t){var n=Array.indexOf(this._comments,e);return n?this._comments[n-1]:t?this._comments[this._comments.length-1]:null},c.getFirstCommentBefore=function(e,t,n){void 0===n&&(n=!1);var i=Array.indexOf(this._comments,e);var r=i;do{if(!r&&!t)return null;if(r=r?r-1:this._comments.length-1,!n||!this._comments[r].done)return this._comments[r]}while(r!==i);return this._comments[i]},c.dumpChanges=function(){for(var e="",t=0;t<this._changes.length;t++)e+=this._changes[t].toString()+"\n\n";return e},c.addCommentReaction=function(e,t){},c.removeCommentReaction=function(e,t){},c.commitNewOrEditComment=function(e,t){var n=[];e.commentType=0,Array.add(n,e),this.recordChanges(n,t),this._inProgress=null},e.createNewComment=function(e){return n(654).Comment.createCommentForEditing(r.AFrameworkApplication.userName,null,n(654).Comment.pageNumberUnknown,e)},e.dateToLocalTime=function(e){return e.getTime()-60*e.getTimezoneOffset()*1e3},t=e,(i=[{key:"selectedComment",get:function(){return this._selected}},{key:"inProgressComment",get:function(){return this._inProgress}}])&&l(t.prototype,i),s&&l(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(c,"CommentModel",null,[10,172])},662:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(0),r=function(){};r.commentPaneTextboxFocusId="CommentPaneTextbox",r.commentPaneData="CommentPaneData",r.commentPaneID="CommentPane",r.commentDeleteButtonClassName="CommentDeleteButton",r.commentSaveButtonClassName="CommentSaveButton",r.commentReplyButtonClassName="CommentReplyButton",r.commentCancelButtonClassName="CommentCancelButton",r.commentTextEntryClassName="CommentTextEntry",r.commentTaskPaneCloseClassName="TaskPaneClose",r.commentPaneCloseButtonClassName="CommentPaneCloseButton",r.commentPaneWidth=300,r.commentTabHelp="CommentTabHelp",Object(i.a)(r,"CommentManagerConstants",null,[])},663:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t,n,i,r){if(void 0===n&&(n=-1),void 0===i&&(i=null),void 0===r&&(r=null),this._id=0,this._storyId=0,this._page=0,this._rectangle=e,this._xmlNode=t,this._characterPosition=n,this._selectionPosition=i,this._imagesInlineWithText=r,this._xmlNode){this._id=parseInt(this._xmlNode.attributes.getNamedItem("id").nodeValue);var a=this._xmlNode.parentNode;this._storyId=parseInt(a.attributes.getNamedItem("storyId").nodeValue);var o=a.selectSingleNode("ancestor::Page");this._page=parseInt(o.attributes.getNamedItem("id").nodeValue)}}var t,n,i;return e.prototype.dispose=function(){this._rectangle=null},t=e,(n=[{key:"rectangle",get:function(){return this._rectangle},set:function(e){this._rectangle=e}},{key:"id",get:function(){return this._id}},{key:"node",get:function(){return this._xmlNode}},{key:"page",get:function(){return this._page}},{key:"storyId",get:function(){return this._storyId}},{key:"characterPosition",get:function(){return this._characterPosition}},{key:"selectionPosition",get:function(){return this._selectionPosition}},{key:"imagesInlineWithText",get:function(){return this._imagesInlineWithText}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(a,"LineInfo",null,[10])},664:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(e,t){this._text=e,this._filters=t}var t,n,i;return e.prototype.isQueryFilterSet=function(e){return(this._filters&e)===e},e.createQuery=function(t,n){return new e(t,n)},t=e,(n=[{key:"text",get:function(){return this._text}},{key:"matchCase",get:function(){return this.isQueryFilterSet(1)}},{key:"matchWholeWord",get:function(){return this.isQueryFilterSet(2)}},{key:"matchWildCards",get:function(){return this.isQueryFilterSet(4)}},{key:"matchPrefix",get:function(){return this.isQueryFilterSet(8)}},{key:"matchSuffix",get:function(){return this.isQueryFilterSet(16)}},{key:"ignorePunct",get:function(){return this.isQueryFilterSet(32)}},{key:"ignoreSpace",get:function(){return this.isQueryFilterSet(64)}}])&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(a,"Query",null,[18])},665:function(e,t,n){"use strict";n.r(t),n.d(t,"CurrentResult",(function(){return p}));var i=n(0),r=n(1),a=n(9),o=n(12),s=n(322),l=n(167),c=n(155),u=n(650);function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(){this._resultNumber=0,this._currentResultItem=null,this._currentSearchResultHighlights=[],this._currentResult=null}var t,n,i,p=e.prototype;return p.dispose=function(){this._currentResultItem&&(Array.clear(this._currentSearchResultHighlights),this._currentResultItem=null)},p.reset=function(){this._resultNumber=Number.NaN,this._currentResult=null,this._currentResultItem&&(this._currentResultItem.deselect(),this._currentResultItem=null),Array.clear(this._currentSearchResultHighlights)},p.setCurrentResult=function(e,t,n){this._resultNumber=n,this._currentResult=e;var i=e.id;this.clearCurrentResultHighlight(),this._currentResultItem&&this._currentResultItem.deselect(),this._currentResultItem=t,this._currentResultItem.select(),this.searchForCurrentResult(i),u.SearchManager.instance.lookForCurrentResult(e.page,i,this._currentSearchResultHighlights.length>0);var c=e.getScrollTop(),d=e.getScrollLeft();if(!isNaN(c)||!isNaN(d)){var p=new l.a(c,d);r.AFrameworkApplication.theActionManager.processActionWithData(a.a.repositionScroller,2,p),o.App.instance.isBroadcastMode&&r.AFrameworkApplication.theActionManager.processActionWithData(a.a.broadcastOnScroll,2,new s.a(e.page,p,2))}},p.searchForCurrentResult=function(e){var t,n,i=0,r=new RegExp("(\\d+)-(\\d+)").exec(e);t=Number.parseInvariant(r[1]),n=Number.parseInvariant(r[2]);var a=u.SearchManager.instance,o=a.getHighlightsByPage(t);if(o){var s=o[n];if(s)for(var l=s.highlightRectangles[i];l;)this.foundCurrentResult(l),i++,l=(s=(o=a.getHighlightsByPage(t))[n]).highlightRectangles[i]}},p.foundCurrentResult=function(e){this._currentSearchResultHighlights[this._currentSearchResultHighlights.length]=e;var t=e.cloneHighlight();if(e.addStyle(2),t){var n=e.domElem;c.a.animateFoundCurrentResultHighlight(t,n)}},p.clearCurrentResultHighlight=function(){if(this._currentSearchResultHighlights){for(var e=0;e<this._currentSearchResultHighlights.length;++e){var t=this._currentSearchResultHighlights[e],n=t.cloneHighlight();if(t.removeStyle(2),n){var i=t.domElem;c.a.animateClearCurrentResultHighlight(n,i)}}Array.clear(this._currentSearchResultHighlights)}},t=e,(n=[{key:"resultNumber",get:function(){return this._resultNumber}},{key:"result",get:function(){return this._currentResult}}])&&d(t.prototype,n),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(p,"CurrentResult",null,[10])},666:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(653),a=function(){function e(e){this._xmlNodeWrapperFactory=new r.a,this._xmlNamedNodeMap=e}return e.prototype.getNamedItem=function(e){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._xmlNamedNodeMap.getNamedItem(e))},e}();Object(i.a)(a,"XmlNamedNodeMapWrapper",null,[249]);var o=function(){function e(){}return e.prototype.getSelectionXmlNamedNodeMapWrapper=function(e){return e?new a(e):null},e}();function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(o,"XmlNamedNodeMapWrapperFactory",null,[219]);var l=function(){function e(e){this._xmlnodeWrapperFactory=new r.a,this._list=e}var t,n,i;return e.prototype.get_item=function(e){return this._xmlnodeWrapperFactory.getSelectionXmlNodeWrapper(this._list[e])},t=e,(n=[{key:"length",get:function(){return this._list.length}}])&&s(t.prototype,n),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(l,"XmlNodeListWrapper",null,[248]);var c=function(){function e(){}return e.prototype.getXmlNodeListWrapper=function(e){return e?new l(e):null},e}();function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(c,"XmlNodeListWrapperFactory",null,[218]),n.d(t,"XmlNodeWrapper",(function(){return d}));var d=function(){function e(e){this._xmlNodeWrapperFactory=new r.a,this._xmlNamedNodeMapWrapperFactory=new o,this._xmlNodeListWrapperFactory=new c,this._node=e}var t,n,i,a=e.prototype;return a.selectSingleNode=function(e){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.selectSingleNode(e))},a.selectNodes=function(e){return this._xmlNodeListWrapperFactory.getXmlNodeListWrapper(this._node.selectNodes(e))},t=e,(n=[{key:"backingNode",get:function(){return this._node}},{key:"firstChild",get:function(){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.firstChild)}},{key:"previousSibling",get:function(){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.previousSibling)}},{key:"nextSibling",get:function(){return this._xmlNodeWrapperFactory.getSelectionXmlNodeWrapper(this._node.nextSibling)}},{key:"nodeValue",get:function(){return this._node.nodeValue}},{key:"attributes",get:function(){return this._xmlNamedNodeMapWrapperFactory.getSelectionXmlNamedNodeMapWrapper(this._node.attributes)}}])&&u(t.prototype,n),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(d,"XmlNodeWrapper",null,[204])},667:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(1),a=n(56),o=n(20),s=n(9),l=n(12),c=n(37),u=n(652);function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(e){this._page=e,this._highlightRectangles=[]}var t,n,i,r=e.prototype;return r.dispose=function(){for(var e=0;e<this._highlightRectangles.length;++e)this._highlightRectangles[e]&&(u.a.instance.removeFromParent(this._highlightRectangles[e]),null)},r.addHighlightRectangle=function(e){this._highlightRectangles[this._highlightRectangles.length]=e},t=e,(n=[{key:"highlightRectangles",get:function(){return this._highlightRectangles}},{key:"page",get:function(){return this._page}}])&&d(t.prototype,n),i&&d(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(p,"HighlightResult",null,[10]);var h=n(650),g=n(660);function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"HighlightWorker",(function(){return f}));var f=function(){function e(e){var t=this;this._nextHighlightTask=null,this._pageBeingHighlighted=0,this._countHitsOnPage=0,this._waitingOnReposition=!1,this._countRunParagraphs=0,this._countRunCharacters=0,this._paragraphXmls=null,this._paragraphBeingHighlighted=0,this._firstPageToHighlight=Number.NaN,this._lastPageToHighlight=Number.NaN,this._currentResultPage=Number.NaN,this._currentResultId=null,this._currentResultFound=!0,this._oldCurrentPage=Number.NaN,this._zoomControl=null,this.onResize=function(){t.repositionAllHighlights()},this.updateHighlight=function(e,n,i,r,a){return t.repositionAllHighlights(),32},this.waitOnNewPage=function(e){if(l.App.get_activeAppFrame().workspace,u.a.instance.isPageLoaded(t._pageBeingHighlighted)){var n=l.App.get_activeAppFrame().thePageInfoCache.getXmlForPage(t._pageBeingHighlighted);n?(t._paragraphXmls=n.selectNodes("descendant::P"),t._paragraphBeingHighlighted=0,t._nextHighlightTask=new a.a(3,1,l.App.instance.theConfig.highlightTaskDelay,t.parseParagraphXmlTask),r.AFrameworkApplication.theTaskManager.addTask(t._nextHighlightTask)):r.AFrameworkApplication.theTaskManager.addTask(t._nextHighlightTask)}else r.AFrameworkApplication.theTaskManager.addTask(t._nextHighlightTask)},this.parseParagraphXmlTask=function(e){t._countRunCharacters=0,t._countRunParagraphs=0;var n=l.App.instance.theConfig,i=t._highlights[t._pageBeingHighlighted];for(i||(i=[],t._highlights[t._pageBeingHighlighted]=i);t._paragraphBeingHighlighted<t._paragraphXmls.length&&t._countRunCharacters<n.minCharactersToSearchBeforePausing&&t._countRunParagraphs<n.maxParagraphsToSearchBeforePausing;)t.parseParagraphXml();t._paragraphBeingHighlighted<t._paragraphXmls.length?r.AFrameworkApplication.theTaskManager.addTask(t._nextHighlightTask):t.highlightNextPage()},this.repositionAllHighlightsTask=function(e){for(var n,i=l.App.get_activeAppFrame().workspace,r=t.zoomControl.currentZoom,a=i.getCurrentPage(),o=i.getFirstCachedPage(),s=i.getLastCachedPage(),c=a;c<=s;++c)t.repositionHighlightsOnPage(t._highlights[c],r);for(var u=o;u<a;++u)t.repositionHighlightsOnPage(t._highlights[u],r);var d=t._highlights;for(var p in d){var h={key:p,value:d[p]};((n=h.key)<o||n>s)&&t.repositionHighlightsOnPage(h.value,r)}t._waitingOnReposition=!1},r.AFrameworkApplication.theActionManager.addActionWithFlags(s.a.updateSearchHighlight,c.a.application,this.updateHighlight,96),l.App.get_activeAppFrame().add_onResize(this.onResize),this._highlights={},this._repositionAllHighlightsTask=new a.a(3,1,10,this.repositionAllHighlightsTask)}var t,n,i,d=e.prototype;return d.dispose=function(){this.reset(),this._highlights=null,this._paragraphXmls=null,this._repositionAllHighlightsTask=null},d.reset=function(){this._waitingOnReposition&&(r.AFrameworkApplication.theTaskManager.deleteTask(this._repositionAllHighlightsTask),this._waitingOnReposition=!1),this.clearAllHighlights(),this._paragraphXmls=null,this._firstPageToHighlight=Number.NaN,this._lastPageToHighlight=Number.NaN,this._currentResultFound=!0,this._currentResultPage=Number.NaN,this._currentResultId=null},d.stopHighlightTask=function(){this._nextHighlightTask&&(r.AFrameworkApplication.theTaskManager.deleteTask(this._nextHighlightTask),this._nextHighlightTask=null)},d.setupHighlighting=function(){var e=l.App.get_activeAppFrame().workspace;this._firstPageToHighlight=e.getFirstCachedPage(),this._lastPageToHighlight=e.getLastCachedPage(),this.beginHighlighting()},d.beginHighlighting=function(){this.clearAllHighlights(),this._pageBeingHighlighted=l.App.get_activeAppFrame().workspace.getCurrentPage(),this._countHitsOnPage=0,this._nextHighlightTask=new a.a(3,1,l.App.instance.theConfig.highlightTaskDelay,this.waitOnNewPage),this.waitOnNewPage(null)},d.clearAllHighlights=function(){this.stopHighlightTask();var e=this._highlights;for(var t in e){var n={key:t,value:e[t]};this.clearHighlightsOnPage(n.key)}this._highlights={}},d.clearHighlightsOnPage=function(e){if(this._highlights[e]){for(var t=this._highlights[e],n=0;n<t.length;++n)t[n].dispose(),t[n]=null;Array.clear(t),delete this._highlights[e],e===this._currentResultPage&&(this._currentResultFound=!1,h.SearchManager.instance.clearCurrentResultHighlight())}},d.highlightNextPage=function(){var e=this._lastPageToHighlight-this._firstPageToHighlight+1,t=0,n=l.App.get_activeAppFrame().workspace.getCurrentPage();for(n!==this._oldCurrentPage&&(this._pageBeingHighlighted=n,this._oldCurrentPage=n);t!==e&&this._highlights[this._pageBeingHighlighted];)t++,this._pageBeingHighlighted=this._pageBeingHighlighted===this._lastPageToHighlight?this._firstPageToHighlight:this._pageBeingHighlighted+1;t===e?this._nextHighlightTask=null:(this._countHitsOnPage=0,this._nextHighlightTask=new a.a(3,1,l.App.instance.theConfig.highlightTaskDelay,this.waitOnNewPage),r.AFrameworkApplication.theTaskManager.addTask(this._nextHighlightTask))},d.parseParagraphXml=function(){var e=this._paragraphXmls[this._paragraphBeingHighlighted];if(!e.selectSingleNode("ancestor::P")){var t=e.selectNodes("descendant::T/text()"),n=g.a(t);t.length&&this.grepTheText(n,t),this._countRunParagraphs++,this._countRunCharacters+=n.length}this._paragraphBeingHighlighted++},d.grepTheText=function(e,t){var n,i,r,a=0,o=0,s=h.SearchManager.instance,l=s.regex,c=this.zoomControl.currentZoom,d=this._highlights[this._pageBeingHighlighted];for(d||(d=[],this._highlights[this._pageBeingHighlighted]=d);r=l.exec(e);){var m=!this._currentResultFound&&this._pageBeingHighlighted===this._currentResultPage;n=r.index,i=l.lastIndex;for(var f=0,v=new p(this._pageBeingHighlighted),_=void 0,y=null;a<t.length;++a){if(f=o+t[a].data.length,o<i&&f>n){var S=t[a].parentNode,b=Math.max(0,n-o),A=Math.min(f-o,i-o);_=u.a.instance.computeBoundingBoxForTextRun(S,b,A),y||(y=String.format("{0}-{1}",this._pageBeingHighlighted,this._countHitsOnPage),this._countHitsOnPage++,m&&y===this._currentResultId&&(this._currentResultFound=!0));var C=u.a.instance.drawRectangle(_,1,y,this._pageBeingHighlighted);g.b(C,this._pageBeingHighlighted,c),v.addHighlightRectangle(C),this._currentResultFound&&m&&s.foundCurrentResult(C)}if(f>=i)break;o=f}d[d.length]=v}},d.lookForCurrentResult=function(e,t,n){this._currentResultPage=e,this._currentResultId=t,this._currentResultFound=n},d.pageCacheChanged=function(e,t){if(""!==h.SearchManager.instance.currentQueryString&&(this._firstPageToHighlight!==e||this._lastPageToHighlight!==t)){if(this._nextHighlightTask&&(this._pageBeingHighlighted<e||this._pageBeingHighlighted>t)&&(r.AFrameworkApplication.theTaskManager.deleteTask(this._nextHighlightTask),this._nextHighlightTask=null),isNaN(this._firstPageToHighlight)||isNaN(this._lastPageToHighlight)||e>this._lastPageToHighlight||t<this._firstPageToHighlight)return this._firstPageToHighlight=e,this._lastPageToHighlight=t,void this.beginHighlighting();for(var n=this._firstPageToHighlight;n<e;++n)this.clearHighlightsOnPage(n);for(var i=t+1;i<=this._lastPageToHighlight;++i)this.clearHighlightsOnPage(i);this._firstPageToHighlight=e,this._lastPageToHighlight=t,this._nextHighlightTask||(this._paragraphBeingHighlighted=Number.NaN,this.highlightNextPage())}},d.repositionAllHighlights=function(){this._waitingOnReposition||(this._waitingOnReposition=!0,r.AFrameworkApplication.theTaskManager.addTask(this._repositionAllHighlightsTask))},d.repositionHighlightsOnPage=function(e,t){if(e)for(var n,i,r,a=0;a<e.length;++a){i=(n=e[a]).highlightRectangles,r=n.page;for(var o=0;o<i.length;++o)g.b(i[o],r,t)}},d.getHighlightsByPage=function(e){return this._highlights[e]},e.createInstanceWithResolvedDependencies=function(t){return new e(t)},e.createInstance=function(t){return e.createInstanceWithResolvedDependencies(t)},t=e,(n=[{key:"zoomControl",get:function(){return this._zoomControl||(this._zoomControl=o.a.instance.resolve("WordViewer.Controls.IZoomControl"))}}])&&m(t.prototype,n),i&&m(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(f,"HighlightWorker",null,[10])},668:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),r=n(672),a=n(1),o=n(24),s=n(20);function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(e,t,n,i,r,a){this._onDialogDismissed=e,this._onLaunchDownload=t,this._iHaveOfficeHandler=n,this._callbackData=i,this._dialogCause=r,this._application=a}var t,n,i,c=e.prototype;return c.reactOICErrorDialogWithTrialHandler=function(e,t){this.oicErrorDialogWithTrialHandler(e)},c.legacyOICErrorDialogWithTrialHandler=function(e,t){this.oicErrorDialogWithTrialHandler(e)},c.oicErrorDialogWithTrialHandler=function(e){var t=10;1===e?(s.a.instance.resolve("Common.IOfficeTrialExperience").launchOffer(this._application),t=3):2===e&&(this._iHaveOfficeHandler&&!this._iHaveOfficeHandler(this._callbackData)||this._onLaunchDownload&&r.a.instance.createOICErrorDialogWithDownload(this._onLaunchDownload,this._onDialogDismissed,this._callbackData),t=5);0!==e&&1!==e||this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),a.AFrameworkApplication.reportErrorWithCauseAndResolution(o.a.openInClientWithC2RFailed,this._dialogCause,t),this.dispose()},c.dispose=function(){this._onDialogDismissed=null,this._onLaunchDownload=null,this._callbackData=null},t=e,(n=[{key:"showHelpLink",get:function(){return!this._onLaunchDownload&&!this._iHaveOfficeHandler}},{key:"offerString",get:function(){return 2===this._application?CommonUIStrings.l_OICErrorC2ROneNoteOffer:CommonUIStrings.l_OICErrorC2ROffer}},{key:"id",get:function(){return"OICErrorDialogWithTrial"}},{key:"errorMessageNoOffice",get:function(){return CommonUIStrings.l_OICErrorMessageNoOffice}},{key:"iHaveOfficeButtonText",get:function(){return CommonUIStrings.l_OICErrorIHaveOfficeButton}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"helpLinkContentId",get:function(){return"OICFailure"}},{key:"icon",get:function(){return 3}},{key:"actionButtonText",get:function(){return 2===this._application?CommonUIStrings.l_OICErrorC2RInstallOneNoteButton:CommonUIStrings.l_OICErrorC2RInstallButton}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&l(t.prototype,n),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(c,"AOICErrorDialogWithTrial",null,[10])},670:function(e,t,n){"use strict";n.r(t),n.d(t,"ReactOICErrorDialogWithTrial",(function(){return c}));var i=n(0),r=n(67),a=n(668),o=n(133),s=n(87);function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){var t,n;function i(t,n,i,a,l,c){var u,d={errorMessage:(u=e.call(this,t,n,i,a,l,c)||this).errorMessageNoOffice,offerString:u.offerString},p=new s.a(!1,!1,!0);if(u.showHelpLink){p.buttonsOption=1;d.helpLink={type:"AppLinkProps",id:"helpLink",text:u.helpLinkText,onExecute:function(e){o.Redirect.showHelp(u.helpLinkContentId)}}}else p.buttonsOption=4,p.setButtonText(2,u.iHaveOfficeButtonText);p.setButtonText(1,u.actionButtonText),p.dialogId=u.id;var h={id:u.id,dialogIcon:u.icon,bodyControls:d};return p.initializeAndShow(u.dialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(u),u.reactOICErrorDialogWithTrialHandler,"reactOICErrorDialogWithTrialHandler"),h),u}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),i}(a.a);Object(i.a)(c,"ReactOICErrorDialogWithTrial",a.a,[])},671:function(e,t,n){"use strict";n.r(t),n.d(t,"OICErrorDialogWithTrial",(function(){return l}));var i=n(0),r=n(67),a=n(668),o=n(77);function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){var t,n;function i(t,n,i,a,s,l){var c;c=e.call(this,t,n,i,a,s,l)||this;var u=document.createElement("span");u.innerText=c.errorMessageNoOffice,u.appendChild(document.createElement("br")),u.appendChild(document.createElement("br"));var d=document.createElement("span");d.innerText=c.offerString,u.appendChild(d);var p=new o.StandardDialog;return c.showHelpLink?(p.buttonsOption=1,p.addHelpLink(c.helpLinkText,c.helpLinkContentId)):(p.buttonsOption=4,p.setButtonText(2,c.iHaveOfficeButtonText)),p.setButtonText(1,c.actionButtonText),p.dialogId=c.id,p.messageBox(c.dialogTitle,null,c.icon,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(c),c.legacyOICErrorDialogWithTrialHandler,"legacyOICErrorDialogWithTrialHandler"),u),c}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,s(t,n),i}(a.a);Object(i.a)(l,"OICErrorDialogWithTrial",a.a,[])},672:function(e,t,n){"use strict";var i=n(0),r=n(67),a=n(21),o=n(1),s=n(24),l=n(133),c=n(20);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=function(){function e(e,t,n,i){this._macOfficeOffer=null,this._dialogCause=i,this._onDialogDismissed=e,this._onLaunchDownload=t,this._callbackData=n,this._shouldOfferMacOfficeTrial=this.macOfficeOffer.shouldOfferMacOfficeTrialInErrorDialog;var r=CommonUIStrings.l_OICErrorMacOfficeOffer.split("{0}");this._macOfficePreLinkText=r[0],this._macOfficePostLinkText=r[1]}var t,n,i,r=e.prototype;return r.reactOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.legacyOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.oicErrorDialogHandler=function(e){var t=10;this._onLaunchDownload&&1===e&&(this._onLaunchDownload(this._callbackData),t=1),this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),this.reportError(t)},r.oicErrorHelpLinkHandler=function(e){l.Redirect.showHelp("OICFailure"),this.reportError(2)},r.oicErrorMacOfferLinkHandler=function(e){this.macOfficeOffer.launchMacOfficeTrialWindow(),this.reportError(4)},r.reportError=function(e){a.ULS.sendTraceTag(18715410,211,10,"Report OICErrorDialog. Dialog cause: {0}, solution: {1}",this._dialogCause,e),o.AFrameworkApplication.reportErrorWithCauseAndResolution(s.a.openInClientFailed,this._dialogCause,e)},r.dispose=function(){this._onLaunchDownload=null,this._onDialogDismissed=null,this._callbackData=null},t=e,(n=[{key:"macOfficeOffer",get:function(){return this._macOfficeOffer||(this._macOfficeOffer=c.a.instance.resolve("Common.IMacOfficeOffer"))}},{key:"id",get:function(){return"OICErrorDialog"}},{key:"errorMessage",get:function(){return CommonUIStrings.l_OICErrorMessage}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"shouldOfferMacOfficeTrial",get:function(){return this._shouldOfferMacOfficeTrial}},{key:"macOfficePreLinkText",get:function(){return this._macOfficePreLinkText}},{key:"macOfficePostLinkText",get:function(){return this._macOfficePostLinkText}},{key:"macOfficeLinkText",get:function(){return CommonUIStrings.l_OICErrorMacOFficeLink}},{key:"icon",get:function(){return this._shouldOfferMacOfficeTrial?3:2}},{key:"errorFileDownloadOffer",get:function(){return CommonUIStrings.l_OICErrorFileDownloadOffer}},{key:"containsOnLaunchDownload",get:function(){return!!this._onLaunchDownload}},{key:"errorNoOfficeDownloadButtonText",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDownloadButton}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&u(t.prototype,n),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object(i.a)(d,"AOICErrorDialog",null,[10]);var p=n(19),h=n(77);function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){var t,n;function i(t,n,i,a){var o;(o=e.call(this,t,n,i,a)||this)._helpLink=null,o._macOfferLink=null;var s=document.createElement("span");s.id="errorMessageText",s.innerText=o.errorMessage,l.Redirect.isHelpAvailable()&&(s.appendChild(document.createElement("br")),s.appendChild(document.createElement("br")),o._helpLink=document.createElement("a"),o._helpLink.href="#",o._helpLink.innerText=o.helpLinkText,s.appendChild(o._helpLink),p.a.addHandler(o._helpLink,"click",Object(r.a)(g(o),o.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")));var c=new h.StandardDialog;if(c.dialogId=o.id,o.shouldOfferMacOfficeTrial){var u=document.createElement("span"),d=document.createElement("span");u.innerText=o.macOfficePreLinkText,d.innerText=o.macOfficePostLinkText,o._macOfferLink=document.createElement("a"),o._macOfferLink.href="#",o._macOfferLink.innerText=o.macOfficeLinkText,s.appendChild(document.createElement("br")),s.appendChild(u),s.appendChild(o._macOfferLink),s.appendChild(d),p.a.addHandler(o._macOfferLink,"click",Object(r.a)(g(o),o.oicErrorMacOfferLinkHandler,"oicErrorMacOfferLinkHandler"))}else if(o.containsOnLaunchDownload){s.appendChild(document.createElement("br")),s.appendChild(document.createElement("br"));var m=document.createElement("span");m.innerText=o.errorFileDownloadOffer,s.appendChild(m)}return o.containsOnLaunchDownload?(c.buttonsOption=1,c.setButtonText(1,o.errorNoOfficeDownloadButtonText)):c.buttonsOption=0,c.messageBox(o.dialogTitle,null,o.icon,Object(r.a)(g(o),o.legacyOICErrorDialogHandler,"legacyOICErrorDialogHandler"),s),c.setDescribedByForDialog("errorMessageText"),o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,m(t,n),i.prototype.dispose=function(){this._helpLink&&(p.a.removeHandler(this._helpLink,"click",Object(r.a)(this,this.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")),this._helpLink=null),this._macOfferLink&&(p.a.removeHandler(this._macOfferLink,"click",Object(r.a)(this,this.oicErrorMacOfferLinkHandler,"oicErrorMacOfferLinkHandler")),this._macOfferLink=null),e.prototype.dispose.call(this)},i}(d);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(f,"OICErrorDialog",d,[]);var _=function(){function e(e,t,n){this._onDialogDismissed=t,this._onLaunchDownload=e,this._callbackData=n}var t,n,i,r=e.prototype;return r.reactOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.legacyOICErrorDialogHandler=function(e,t){this.oicErrorDialogHandler(e)},r.oicErrorDialogHandler=function(e){var t=10;1===e&&(this._onLaunchDownload(this._callbackData),t=1),this._onDialogDismissed&&this._onDialogDismissed(this._callbackData),this.reportError(t)},r.oicErrorHelpLinkHandler=function(e){l.Redirect.showHelp("OICFailure"),this.reportError(2)},r.reportError=function(e){o.AFrameworkApplication.reportErrorWithCauseAndResolution(s.a.openInClientSecondaryFailed,3,e)},r.dispose=function(){this._onDialogDismissed=null,this._onLaunchDownload=null,this._callbackData=null},t=e,(n=[{key:"id",get:function(){return"OICErrorDialogWithDownload"}},{key:"errorMessageNoOfficeDetected",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDetected}},{key:"helpLinkText",get:function(){return CommonUIStrings.l_OICErrorHelpLink}},{key:"errorFileDownloadOffer",get:function(){return CommonUIStrings.l_OICErrorFileDownloadOffer}},{key:"errorNoOfficeDownloadButtonText",get:function(){return CommonUIStrings.l_OICErrorNoOfficeDownloadButton}},{key:"icon",get:function(){return 2}},{key:"dialogTitle",get:function(){return CommonUIStrings.l_DefaultDialogTitle}}])&&v(t.prototype,n),i&&v(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(_,"AOICErrorDialogWithDownload",null,[10]);var b=function(e){var t,n;function i(t,n,i){var a;(a=e.call(this,t,n,i)||this)._helpLink=null;var o=document.createElement("span");o.id="errorMessageText",o.innerText=a.errorMessageNoOfficeDetected,l.Redirect.isHelpAvailable()&&(o.appendChild(document.createElement("br")),o.appendChild(document.createElement("br")),a._helpLink=document.createElement("a"),a._helpLink.href="#",a._helpLink.innerText=a.helpLinkText,o.appendChild(a._helpLink),p.a.addHandler(a._helpLink,"click",Object(r.a)(y(a),a.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler"))),o.appendChild(document.createElement("br")),o.appendChild(document.createElement("br"));var s=document.createElement("span");s.innerText=a.errorFileDownloadOffer,o.appendChild(s);var c=new h.StandardDialog;return c.dialogId=a.id,c.buttonsOption=1,c.setButtonText(1,a.errorNoOfficeDownloadButtonText),c.messageBox(a.dialogTitle,null,a.icon,Object(r.a)(y(a),a.legacyOICErrorDialogHandler,"legacyOICErrorDialogHandler"),o),c.setDescribedByForDialog("errorMessageText"),a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,S(t,n),i.prototype.dispose=function(){this._helpLink&&(p.a.removeHandler(this._helpLink,"click",Object(r.a)(this,this.oicErrorHelpLinkHandler,"oicErrorHelpLinkHandler")),this._helpLink=null),e.prototype.dispose.call(this)},i}(_);Object(i.a)(b,"OICErrorDialogWithDownload",_,[]);var A=n(87);function C(e,t){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){var t,n;function i(t,n,i,a){var o,s={errorMessage:(o=e.call(this,t,n,i,a)||this).errorMessage};if(l.Redirect.isHelpAvailable()){s.helpLink={type:"AppLinkProps",id:"helpLink",text:o.helpLinkText,onExecute:function(e){o.oicErrorHelpLinkHandler(e)}}}if(o.shouldOfferMacOfficeTrial){s.macOfficePreLinkText=o.macOfficePreLinkText;s.macOfficeLink={type:"AppLinkProps",id:"macOfficeLink",text:o.macOfficeLinkText,onExecute:function(e){o.oicErrorMacOfferLinkHandler(e)}},s.macOfficePostText=o.macOfficePostLinkText}else o.containsOnLaunchDownload&&(s.errorFileDownloadOffer=o.errorFileDownloadOffer);var c=new A.a(!1,!1,!0);o.containsOnLaunchDownload?(c.buttonsOption=1,c.setButtonText(1,o.errorNoOfficeDownloadButtonText)):c.buttonsOption=0,c.dialogId=o.id;var u={id:o.id,dialogIcon:o.icon,bodyControls:s};return c.initializeAndShow(o.dialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(o),o.reactOICErrorDialogHandler,"reactOICErrorDialogHandler"),u),o}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,C(t,n),i}(d);function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object(i.a)(T,"ReactOICErrorDialog",d,[]);var w=function(e){var t,n;function i(t,n,i){var a,o={errorMessage:(a=e.call(this,t,n,i)||this).errorMessageNoOfficeDetected,errorFileDownloadOffer:a.errorFileDownloadOffer};if(l.Redirect.isHelpAvailable()){o.helpLink={type:"AppLinkProps",id:"helpLink",text:a.helpLinkText,onExecute:function(e){a.oicErrorHelpLinkHandler(e)}}}var s=new A.a(!1,!1,!0);s.buttonsOption=1,s.setButtonText(1,a.errorNoOfficeDownloadButtonText),s.dialogId=a.id;var c={id:a.id,dialogIcon:a.icon,bodyControls:o};return s.initializeAndShow(a.dialogTitle,Object(r.a)(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(a),a.reactOICErrorDialogHandler,"reactOICErrorDialogHandler"),c),a}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,k(t,n),i}(_);function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object(i.a)(w,"ReactOICErrorDialogWithDownload",_,[]),n.d(t,"a",(function(){return P}));var P=function(){function e(){this._isReactDialogEnabled=!!o.AFrameworkApplication.activeFrame&&o.AFrameworkApplication.activeFrame.applicationInstance.isReactDialogEnabled}var t,i,r,a=e.prototype;return a.createOICErrorDialog=function(e,t,n,i){return this._isReactDialogEnabled?new T(e,t,n,i):new f(e,t,n,i)},a.createOICErrorDialogWithDownload=function(e,t,n){return this._isReactDialogEnabled?new w(e,t,n):new b(e,t,n)},a.createOICErrorDialogWithTrial=function(e,t,i,r,a,o){var s=n(670).ReactOICErrorDialogWithTrial,l=n(671).OICErrorDialogWithTrial;return this._isReactDialogEnabled?new s(e,t,i,r,a,o):new l(e,t,i,r,a,o)},t=e,r=[{key:"instance",get:function(){return e._instance||(e._instance=new e)}}],(i=null)&&I(t.prototype,i),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();P._instance=null,Object(i.a)(P,"OICErrorDialogFactoryImpl",null,[230])}}]);
//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/23607125/wdjs/WordViewerDS.dll1.js.map